2006-01-25  Timothy Hatcher  <timothy@apple.com>

        Build fix, -[NSFont defaultLineHeightForFont] is deprecated.
        We need to use -[NSLayoutManager defaultLineHeightForFont:] instead.

        * kwq/KWQLineEdit.mm:
        (QLineEdit::sizeForCharacterWidth):
        (QLineEdit::baselinePosition):

2006-01-24  Darin Adler  <darin@apple.com>

        Reviewed by Adele.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6731
          REGRESSION: change event fires at load time for checked items

        Test: fast/forms/radio-button-no-change-event.html

        * khtml/html/HTMLInputElementImpl.cpp: (WebCore::HTMLInputElementImpl::setChecked):
        One of many possible fixes: Don't send the event if the element is not yet in
        a document (as in when parsing the initial attributes).

2006-01-24  Adele Peterson  <adele@apple.com>

        Reviewed by Hyatt.

        This change will allow the new text field elements to get focus, and to respond to the focus and blur events.

        Added: fast/forms/input-appearance-focus.html

        * khtml/html/HTMLElementImpl.cpp: (WebCore::HTMLElementImpl::isFocusable): 
          Removed recently added code that allowed editable elements with no parent to be focusable.  
          We don't need to do this now that we try to focus the input element, instead of the inner div.
        * khtml/html/HTMLGenericFormElementImpl.cpp: (WebCore::HTMLGenericFormElementImpl::isMouseFocusable): Added case to for text fields.
        * khtml/html/HTMLInputElementImpl.cpp:
        (WebCore::HTMLInputElementImpl::focus): Added. Selects contents of text field.
        (WebCore::HTMLInputElementImpl::setSelectionStart): Added break; in switch statement.
        (WebCore::HTMLInputElementImpl::setSelectionEnd): ditto.
        (WebCore::HTMLInputElementImpl::select): ditto.
        (WebCore::HTMLInputElementImpl::setSelectionRange): ditto.
        * khtml/html/HTMLInputElementImpl.h: Added focus()
        * khtml/xml/dom_elementimpl.h: Made focus() virtual.
        * page/Frame.cpp: (Frame::setFocusNodeIfNeeded):
          Walk up the Render Tree instead of the DOM tree when trying to find a node to focus.  
          This will let us choose the input node instead of one of the nodes in the shadow tree.
        * page/FrameView.cpp: (FrameView::dispatchMouseEvent): ditto.
        * rendering/RenderContainer.cpp: (WebCore::RenderContainer::destroyLeftoverChildren): Corrected misspelling. 
        * rendering/RenderTextField.cpp:
        (WebCore::RenderTextField::select): Implemented.  Select contents of inner div.
        * rendering/RenderTextField.h:
        (WebCore::RenderTextField::renderName): Changed order.
        (WebCore::RenderTextField::removeLeftoverAnonymousBoxes): ditto.

2006-01-24  Darin Adler  <darin@apple.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6782
          REGRESSION: replaceChild broken when node to replace is first (TinyMCE test app broken)

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6784
          REGRESSION: 25 layout tests failing (basic DOM operations)

        Test: fast/dom/replace-first-child.html

        * khtml/xml/ContainerNodeImpl.cpp:
        (WebCore::ContainerNodeImpl::insertBefore): Change one place that hands off ownership of
        as PassRefPtr that causes us to almost always return 0. Fix test that would screw up when
        both "prev" and "refChild->previousSibling()" were 0.
        (WebCore::ContainerNodeImpl::appendChild): Changed a nearly-identical place handing off
        ownership as above.

2006-01-24  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Dave Hyatt.
        
        - fixed crash if a node is removed from the DOM before being reparented due to residual style
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6778

        * khtml/html/htmlparser.cpp:
        (HTMLParser::handleResidualStyleCloseTagAcrossBlocks): If the
        block has been removed from the document, then do not remove it
        from its parent or add it to its new location. This prevents the
        crash and matches Mozilla.

2006-01-24  Darin Adler  <darin@apple.com>

        Reviewed by John Sullivan.

        - http://bugzilla.opendarwin.org/show_bug.cgi?id=6750
          replace QDateTime with a simpler platform abstraction

        * ForwardingHeaders/qdatetime.h: Removed.
        * kwq/KWQDateTime.cpp: Removed.
        * kwq/KWQDateTime.h: Removed.

        * platform/SystemTime.h: Added.
        * platform/mac/SystemTime.cpp: (WebCore::currentTime): Added.
        * platform/win: Added.
        * platform/win/SystemTime.cpp: (WebCore::currentTime): Added.

        * WebCore.vcproj/WebCore/WebCore.vcproj: Added new files, removed old.
        * WebCore.xcodeproj/project.pbxproj: Ditto.

        * css/css_base.h: Removed include of <qdatetime.h>.
        * css/cssstyleselector.cpp: Ditto.

        * khtml/html/htmltokenizer.h:
        * khtml/html/htmltokenizer.cpp: Convert tabs to spaces.
        (WebCore::HTMLTokenizer::continueProcessing): Change parameter from QTime to double.
        Use currentTime() instead of QTime::elapsed().
        (WebCore::HTMLTokenizer::write): Use currentTime() instead of QTime::elapsed().

        * config.h: Added HAVE_FUNC_USLEEP for now, not sure this is really a
        good way to handle this.
        * khtml/xml/ContainerNodeImpl.cpp: (WebCore::ContainerNodeImpl::setActive):
        Use currentTime() instead of QTime::elapsed(). Use HAVE_FUNC_USLEEP for the if.

        * khtml/xml/DocumentImpl.h:
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::DocumentImpl): Use currentTime() instead of QTime::elapsed().
        (WebCore::DocumentImpl::implicitClose): Ditto.
        (WebCore::DocumentImpl::minimumLayoutDelay): Ditto.
        (WebCore::DocumentImpl::elapsedTime): Ditto.

        * khtml/xml/dom2_eventsimpl.cpp: (WebCore::EventImpl::EventImpl): Use currentTime()
        instead of local function called currentTimeStamp().

        * khtml/xml/xml_tokenizer.h: Removed declaration of class QTime.

        * ksvg2/misc/KSVGTimeScheduler.h:
        * ksvg2/misc/KSVGTimeScheduler.cpp:
        (KSVG::TimeScheduler::TimeScheduler): Use currentTime instead of QTime::elapsed.
        (KSVG::TimeScheduler::startAnimations): Ditto.
        (KSVG::TimeScheduler::toggleAnimations): Ditto.
        (KSVG::TimeScheduler::elapsed): Ditto.

        * page/Frame.cpp: (Frame::clear): Removed unused m_parsetime.
        * page/FramePrivate.h: Ditto.

2006-01-24  David Hyatt  <hyatt@apple.com>

        Fix for bug 6781, convert QColor to Color (and QRgb to RGBA32).  r=maciej.

        * ForwardingHeaders/qcolor.h: Removed.
        * WebCore+SVG/KDOMSettings.h:
        * WebCore+SVG/RGBColorImpl.cpp:
        (RGBColorImpl::RGBColorImpl):
        (RGBColorImpl::red):
        (RGBColorImpl::green):
        (RGBColorImpl::blue):
        * WebCore+SVG/RGBColorImpl.h:
        * WebCore.xcodeproj/project.pbxproj:
        * bindings/objc/DOMCSS.mm:
        (getWrapperForRGB):
        (setWrapperForRGB):
        (removeWrapperForRGB):
        (-[DOMRGBColor dealloc]):
        (-[DOMRGBColor finalize]):
        (-[DOMRGBColor red]):
        (-[DOMRGBColor green]):
        (-[DOMRGBColor blue]):
        (-[DOMRGBColor _initWithRGB:]):
        (+[DOMRGBColor _RGBColorWithRGB:]):
        (-[DOMRGBColor alpha]):
        (-[DOMRGBColor _color]):
        * bridge/mac/MacFrame.mm:
        (MacFrame::attributedString):
        (MacFrame::fontAttributesForSelectionStart):
        (MacFrame::bodyBackgroundColor):
        (convertAttributesToUnderlines):
        * css/css_valueimpl.cpp:
        (WebCore::CSSPrimitiveValueImpl::CSSPrimitiveValueImpl):
        (WebCore::CSSPrimitiveValueImpl::cssText):
        * css/csshelper.h:
        * css/cssparser.cpp:
        (CSSParser::parseColor):
        (CSSParser::parseColorFromValue):
        * css/cssparser.h:
        * css/cssstyleselector.cpp:
        (WebCore::CSSStyleSelector::canShareStyleWithElement):
        (WebCore::):
        (WebCore::colorForCSSValue):
        (WebCore::CSSStyleSelector::applyProperty):
        (WebCore::CSSStyleSelector::getColorFromPrimitiveValue):
        * css/cssstyleselector.h:
        * kcanvas/KCanvasFilters.h:
        (KCanvasFEDiffuseLighting::lightingColor):
        (KCanvasFEDiffuseLighting::setLightingColor):
        (KCanvasFEFlood::floodColor):
        (KCanvasFEFlood::setFloodColor):
        (KCanvasFESpecularLighting::lightingColor):
        (KCanvasFESpecularLighting::setLightingColor):
        * kcanvas/KCanvasTreeDebug.cpp:
        (operator<<):
        * kcanvas/KCanvasTreeDebug.h:
        * kcanvas/device/KRenderingDevice.h:
        * kcanvas/device/KRenderingPaintServerGradient.cpp:
        (KCSortedGradientStopList::addStop):
        * kcanvas/device/KRenderingPaintServerGradient.h:
        * kcanvas/device/KRenderingPaintServerSolid.cpp:
        (KRenderingPaintServerSolid::color):
        (KRenderingPaintServerSolid::setColor):
        * kcanvas/device/KRenderingPaintServerSolid.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.mm:
        (ciColor):
        * kcanvas/device/quartz/KRenderingPaintServerGradientQuartz.mm:
        (setupShadingWithStyle):
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.mm:
        (KRenderingPaintServerPatternQuartz::setup):
        * khtml/ecma/kjs_css.h:
        * khtml/ecma/kjs_html.cpp:
        (KJS::KJS::Context2DFunction::callAsFunction):
        (KJS::colorRefFromValue):
        (KJS::colorFromValue):
        (KJS::Context2D::putValueProperty):
        (KJS::GradientFunction::callAsFunction):
        * khtml/ecma/kjs_html.h:
        * khtml/editing/apply_style_command.cpp:
        (WebCore::StyleChange::checkForLegacyHTMLStyleChange):
        * khtml/html/html_baseimpl.cpp:
        (WebCore::HTMLBodyElementImpl::parseMappedAttribute):
        * khtml/misc/helper.h:
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::DocumentImpl):
        (WebCore::DocumentImpl::resetLinkColor):
        (WebCore::DocumentImpl::resetVisitedLinkColor):
        * khtml/xml/DocumentImpl.h:
        (WebCore::DocumentImpl::setTextColor):
        (WebCore::DocumentImpl::textColor):
        (WebCore::DocumentImpl::linkColor):
        (WebCore::DocumentImpl::visitedLinkColor):
        (WebCore::DocumentImpl::activeLinkColor):
        (WebCore::DocumentImpl::setLinkColor):
        (WebCore::DocumentImpl::setVisitedLinkColor):
        (WebCore::DocumentImpl::setActiveLinkColor):
        * ksvg2/css/SVGCSSStyleSelector.cpp:
        (KDOM::CSSStyleSelector::applySVGProperty):
        * ksvg2/css/SVGRenderStyle.h:
        * ksvg2/css/SVGRenderStyleDefs.h:
        * ksvg2/misc/KCanvasRenderingStyle.cpp:
        (WebCore::KSVGPainterFactory::fillPaintServer):
        * ksvg2/misc/KSVGTimeScheduler.cpp:
        (KSVG::SVGTimer::notifyAll):
        * ksvg2/svg/SVGAnimateColorElementImpl.cpp:
        (SVGAnimateColorElementImpl::handleTimerEvent):
        (SVGAnimateColorElementImpl::clampColor):
        (SVGAnimateColorElementImpl::color):
        (SVGAnimateColorElementImpl::initialColor):
        * ksvg2/svg/SVGAnimateColorElementImpl.h:
        * ksvg2/svg/SVGAnimateElementImpl.cpp:
        (SVGAnimateElementImpl::handleTimerEvent):
        * ksvg2/svg/SVGColorImpl.cpp:
        (SVGColorImpl::setRGBColor):
        (SVGColorImpl::color):
        * ksvg2/svg/SVGColorImpl.h:
        * ksvg2/svg/SVGGradientElementImpl.cpp:
        (SVGGradientElementImpl::rebuildStops):
        * kwq/KWQAccObject.mm:
        (AXAttributeStringSetStyle):
        * kwq/KWQBrush.h:
        (QBrush::QBrush::QBrush):
        (QBrush::color):
        (QBrush::setColor):
        * kwq/KWQColor.h: Removed.
        * kwq/KWQColor.mm: Removed.
        * kwq/KWQColorData.gperf: Removed.
        * kwq/KWQKConfigBase.h:
        * kwq/KWQKConfigBase.mm:
        (KConfig::readColorEntry):
        * kwq/KWQLineEdit.mm:
        (QLineEdit::setPalette):
        * kwq/KWQNamespace.h:
        (Qt::):
        * kwq/KWQObject.h:
        * kwq/KWQPainter.h:
        * kwq/KWQPainter.mm:
        (QPainter::setPen):
        (QPainter::setBrush):
        (QPainter::drawText):
        (QPainter::drawHighlightForText):
        (QPainter::selectedTextBackgroundColor):
        (_fillRectXX):
        (QPainter::setShadow):
        (QPainter::initFocusRing):
        * kwq/KWQPalette.h:
        (QColorGroup::QColorGroup):
        (QColorGroup::color):
        (QColorGroup::setColor):
        (QColorGroup::background):
        (QColorGroup::foreground):
        (QColorGroup::base):
        (QPalette::QPalette):
        (QPalette::background):
        (QPalette::foreground):
        * kwq/KWQPen.cpp:
        (QPen::QPen):
        (QPen::color):
        (QPen::setColor):
        * kwq/KWQPen.h:
        * kwq/KWQRenderTreeDebug.cpp:
        (operator<<):
        * kwq/KWQTextEdit.mm:
        (QTextEdit::setPalette):
        * loader/CachedImage.cpp:
        (WebCore::CachedImage::tiled_pixmap):
        * loader/CachedImage.h:
        * page/Frame.cpp:
        (Frame::paint):
        * page/Frame.h:
        (MarkedTextUnderline::MarkedTextUnderline):
        * platform/Color.cpp: Added.
        (WebCore::makeRGB):
        (WebCore::makeRGBA):
        (WebCore::parseHexColor):
        (WebCore::Color::Color):
        (WebCore::Color::name):
        (WebCore::Color::setNamedColor):
        (WebCore::Color::hsv):
        (WebCore::Color::setHsv):
        (WebCore::Color::light):
        (WebCore::Color::dark):
        (WebCore::Color::getRgbaF):
        * platform/Color.h: Added.
        (WebCore::Color::Color):
        (WebCore::Color::rgb):
        (WebCore::Color::setRgb):
        (WebCore::operator==):
        (WebCore::operator!=):
        * platform/ColorData.gperf: Added.
        * rendering/InlineTextBox.cpp:
        (khtml::simpleDifferenceBetweenColors):
        (khtml::correctedTextColor):
        (khtml::InlineTextBox::paint):
        (khtml::InlineTextBox::paintSelection):
        (khtml::InlineTextBox::paintMarkedTextBackground):
        (khtml::InlineTextBox::paintDecoration):
        * rendering/RenderTable.h:
        (WebCore::RenderTable::bgColor):
        * rendering/RenderTableCell.cpp:
        (WebCore::outlineBox):
        (WebCore::RenderTableCell::paintBoxDecorations):
        * rendering/font.cpp:
        (khtml::Font::drawHighlightForText):
        (khtml::Font::drawText):
        * rendering/font.h:
        * rendering/render_box.cpp:
        (WebCore::RenderBox::paintRootBoxDecorations):
        (WebCore::RenderBox::paintBackgrounds):
        (WebCore::RenderBox::paintBackground):
        (WebCore::RenderBox::paintBackgroundExtended):
        (WebCore::RenderBox::outlineBox):
        * rendering/render_box.h:
        * rendering/render_flow.cpp:
        (RenderFlow::paintFocusRing):
        (RenderFlow::paintOutlineForLine):
        * rendering/render_form.cpp:
        (RenderFieldset::paintBorderMinusLegend):
        * rendering/render_frames.cpp:
        (WebCore::RenderFrameSet::userResize):
        * rendering/render_image.cpp:
        (WebCore::RenderImage::paint):
        * rendering/render_layer.h:
        * rendering/render_line.cpp:
        (WebCore::InlineFlowBox::paintBackgrounds):
        (WebCore::InlineFlowBox::paintBackground):
        (WebCore::InlineFlowBox::paintBackgroundAndBorder):
        (WebCore::InlineFlowBox::paintDecorations):
        (WebCore::EllipsisBox::paint):
        * rendering/render_line.h:
        * rendering/render_list.cpp:
        (RenderListMarker::paint):
        * rendering/render_object.cpp:
        (WebCore::RenderObject::drawBorder):
        (WebCore::RenderObject::paintBorder):
        (WebCore::RenderObject::paintOutline):
        (WebCore::RenderObject::selectionColor):
        (WebCore::RenderObject::getTextDecorationColors):
        * rendering/render_object.h:
        (WebCore::RenderObject::paintBackgroundExtended):
        * rendering/render_replaced.cpp:
        (WebCore::RenderReplaced::selectionColor):
        * rendering/render_replaced.h:
        * rendering/render_style.h:
        (khtml::BorderValue::isTransparent):
        (khtml::CollapsedBorderValue::color):
        (khtml::RenderStyle::hasBackground):
        (khtml::RenderStyle::borderLeftColor):
        (khtml::RenderStyle::borderRightColor):
        (khtml::RenderStyle::borderTopColor):
        (khtml::RenderStyle::borderBottomColor):
        (khtml::RenderStyle::outlineColor):
        (khtml::RenderStyle::color):
        (khtml::RenderStyle::backgroundColor):
        (khtml::RenderStyle::setBackgroundColor):
        (khtml::RenderStyle::setBorderLeftColor):
        (khtml::RenderStyle::setBorderRightColor):
        (khtml::RenderStyle::setBorderTopColor):
        (khtml::RenderStyle::setBorderBottomColor):
        (khtml::RenderStyle::setOutlineColor):
        (khtml::RenderStyle::setColor):
        (khtml::RenderStyle::initialColor):
        * rendering/render_theme.cpp:
        (khtml::RenderTheme::isControlStyled):
        * rendering/render_theme.h:

2006-01-24  Darin Adler  <darin@apple.com>

        Reviewed by John and Anders.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6732
          REGRESSION: Repro crash at Google Maps

        * khtml/ecma/JSXMLHttpRequest.cpp:
        (KJS::JSXMLHttpRequest::getValueProperty): Clean up a bit, using PassRefPtr where appropriate.
        (KJS::JSXMLHttpRequest::mark): Remove get calls now that getter functions don't return PassRefPtr.
        (KJS::JSXMLHttpRequest::JSXMLHttpRequest): Put the object into the DOM objects map.
        (KJS::JSXMLHttpRequest::~JSXMLHttpRequest): Remove the object from the DOM objects map. Also clear
        out both listeners so the implementation object isn't left with dangling pointers (since we won't
        be around to mark those objects any more).
        (KJS::JSXMLHttpRequestProtoFunc::callAsFunction): Tightened up the code a bit.

        * xml/xmlhttprequest.h:
        * xml/xmlhttprequest.cpp:
        (WebCore::XMLHttpRequest::getResponseXML): Change to return just a plain old pointer. Remove
        the unnecessary typeIsXML boolean.
        (WebCore::XMLHttpRequest::onReadyStateChangeListener): Change to return just a plain old pointer.
        Update for name changes.
        (WebCore::XMLHttpRequest::setOnReadyStateChangeListener): Ditto.
        (WebCore::XMLHttpRequest::onLoadListener): Ditto.
        (WebCore::XMLHttpRequest::setOnLoadListener): Ditto.
        (WebCore::XMLHttpRequest::send): Protect the DOM wrapper if any as well as ourselves while
        the load is in progress.
        (WebCore::XMLHttpRequest::abort): Unprotect to balance out the above.
        (WebCore::XMLHttpRequest::slotFinished): Ditto.

        * khtml/ecma/JSXMLHttpRequest.h: Just formatting changes.

2006-01-24  Darin Adler  <darin@apple.com>

        Reviewed by Justin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6753
          REGRESSION (r12282-12292): Crash loading TinyMCE test app

        * khtml/xml/ContainerNodeImpl.h: Remove some internals that don't need
        to be member functions.
        * khtml/xml/ContainerNodeImpl.cpp:
        (WebCore::ContainerNodeImpl::insertBefore): Improved algorithm to keep
        refs to more things so that we don't end up with a dangling pointer (fixes
        the crash) and so that we do not crash if someone modifies the tree inside
        a DOM mutation event handler (theoretical only at this point, needs test
        cases).
        (WebCore::ContainerNodeImpl::replaceChild): Ditto.
        (WebCore::willRemoveChild): Changed from member function to free function.
        (WebCore::ContainerNodeImpl::removeChild): Fix potential problem if the
        mutation event handler moves the node into a different parent.
        (WebCore::ContainerNodeImpl::appendChild): Made changes like those in
        insertBefore above.
        (WebCore::dispatchChildInsertionEvents): Changed from member function to
        free function. Tightened up handling of some edge cases.
        (WebCore::dispatchChildRemovalEvents): Ditto.

2006-01-24  Darin Adler  <darin@apple.com>

        Reviewed by John Sullivan.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6696
          REGRESSION: JavaScript window.opener set incorrectly

        * khtml/ecma/kjs_window.cpp: (KJS::WindowFunc::callAsFunction):
        Fix local variable "frame" that was shadowing another local variable
        named "frame" by naming the one for the new frame "newFrame".

2006-01-24  Maciej Stachowiak  <mjs@apple.com>

        - fix build

        * ksvg2/scripts/make_names.pl: Update script to generate code that
        works with the new HashMap.

2006-01-23  Darin Adler  <darin@apple.com>

        Reviewed by Eric.

        - fixed a storage leak found by running run-webkit-tests fast --leak

        * khtml/xml/dom_xmlimpl.cpp:
        (ProcessingInstructionImpl::checkStyleSheet): Removed bogus deref call,
        since the RefPtr handles it for us. Also deployed PassRefPtr in one place.
        (ProcessingInstructionImpl::setStyleSheet): Removed more bogus ref/deref calls.

2006-01-23  Maciej Stachowiak  <mjs@apple.com>

        Rubber stamped by Eric.

        - Made some functions return const AtomicString& instead of
        AtomicString because they could. 
        
        Result of Darin's and Eric's comments on the last patch.

        * khtml/html/HTMLGenericFormElementImpl.cpp:
        (WebCore::HTMLGenericFormElementImpl::name):
        * khtml/html/HTMLGenericFormElementImpl.h:
        * khtml/html/HTMLInputElementImpl.cpp:
        (WebCore::HTMLInputElementImpl::name):
        * khtml/html/HTMLInputElementImpl.h:

2006-01-23  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - renamed PointerHash to PtrHash
        - made PtrHash the default hash function for int and pointer types that aren't further specialized
        - added an AtomicStringImpl class to make it easier and more typesafe to identity hash atomic strings
        - did appropriate consequent cleanup (very few places now need to declare a hash function)
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6752
        
        * bindings/objc/DOM.mm:
        * bridge/mac/WebCoreFrameBridge.mm:
        (-[WebCoreFrameBridge elementWithName:inForm:]):
        * css/cssstyleselector.cpp:
        (WebCore::CSSRuleSet::getIDRules):
        (WebCore::CSSRuleSet::getClassRules):
        (WebCore::CSSRuleSet::getTagRules):
        (WebCore::CSSRuleSet::addToRuleSet):
        * khtml/dom/dom_string.h:
        (KXMLCore::):
        * khtml/ecma/kjs_binding.cpp:
        (KJS::UString::UString):
        * khtml/ecma/kjs_dom.cpp:
        (KJS::DOMNode::mark):
        * khtml/ecma/kjs_html.cpp:
        (KJS::KJS::HTMLElement::classInfo):
        (KJS::HTMLElement::accessors):
        (KJS::HTMLElement::selectSetter):
        (KJS::HTMLElement::inputSetter):
        (KJS::HTMLElement::textAreaSetter):
        (KJS::HTMLElement::buttonSetter):
        * khtml/ecma/kjs_window.h:
        * khtml/editing/apply_style_command.cpp:
        (WebCore::ApplyStyleCommand::applyRelativeFontStyleChange):
        * khtml/html/HTMLCollectionImpl.h:
        * khtml/html/HTMLElementImpl.cpp:
        (WebCore::HTMLElementImpl::isRecognizedTagName):
        (WebCore::inlineTagList):
        (WebCore::blockTagList):
        * khtml/html/HTMLFormCollectionImpl.cpp:
        (WebCore::HTMLFormCollectionImpl::updateNameCache):
        * khtml/html/HTMLGenericFormElementImpl.cpp:
        (WebCore::HTMLGenericFormElementImpl::name):
        (WebCore::HTMLGenericFormElementImpl::setName):
        * khtml/html/HTMLGenericFormElementImpl.h:
        * khtml/html/HTMLInputElementImpl.cpp:
        (WebCore::HTMLInputElementImpl::name):
        * khtml/html/HTMLInputElementImpl.h:
        * khtml/html/htmlfactory.cpp:
        (DOM::HTMLElementFactory::createHTMLElement):
        * khtml/html/htmlparser.cpp:
        (HTMLParser::isHeaderTag):
        (HTMLParser::isResidualStyleTag):
        (HTMLParser::isAffectedByResidualStyle):
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::checkedRadioButtonForGroup):
        (WebCore::DocumentImpl::removeRadioButtonGroup):
        * khtml/xml/DocumentImpl.h:
        * khtml/xml/NodeImpl.h:
        * khtml/xml/dom_atomicstring.h:
        (DOM::AtomicString::AtomicString):
        (DOM::AtomicString::impl):
        (KXMLCore::):
        * khtml/xml/dom_stringimpl.cpp:
        (DOM::equal):
        * khtml/xml/dom_stringimpl.h:
        (KXMLCore::):
        * khtml/xml/xml_tokenizer.h:
        * ksvg2/misc/KSVGTimeScheduler.cpp:
        (KSVG::SVGTimer::notifyAll):
        * kwq/KWQKJobClasses.h:
        * kwq/KWQObject.cpp:
        * loader/CachedObject.h:
        * loader/CachedObjectClientWalker.h:
        * loader/loader.h:
        * page/Frame.cpp:
        (Frame::endAllLifeSupport):
        * rendering/render_canvas.cpp:
        (RenderCanvas::selectionRect):
        (RenderCanvas::setSelection):
        * rendering/render_canvas.h:
        * rendering/render_object.h:
        * xml/xmlhttprequest.h:

2006-01-23 Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6733
          REGRESSION: html input doesn't honor change to value

        * rendering/render_form.cpp: (RenderLineEdit::slotTextChanged): Made newText a
        DOMString. Assigning the empty DOMString to a QString and back to a DOMString
        resulted in a null string, which should be avoided here.

        * khtml/dom/dom_string.cpp: (DOM::DOMString::qstring): Don't turn an empty
        DOMString into a null QString; make an empty QString instead.

2006-01-23  Darin Adler  <darin@apple.com>

        Reviewed by Maciej.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6385
          REGRESSION: Unnamed frames return a generated name as window.frameElement.name

        Test: fast/frames/frame-element-name.html

        * khtml/ecma/kjs_html.cpp: (KJS::HTMLElement::getOwnPropertySlot):
        Remove the quirk where frame and iframe elements reflect all the
        properties of the window inside the frame. Testing indicates that
        no other browser does this -- not sure why we were doing it.

2006-01-23  Maciej Stachowiak  <mjs@apple.com>

        Rubber stamped by Tim Hatcher.
        
        - renamed insert() operation on HashSet, HashCountedSet and HashTable to add()
        for consistency with HashMap

        * bridge/mac/MacFrame.mm:
        (MacFrame::didTellBridgeAboutLoad):
        * khtml/ecma/kjs_dom.cpp:
        (KJS::DOMNode::mark):
        * khtml/html/HTMLElementImpl.cpp:
        (WebCore::HTMLElementImpl::isRecognizedTagName):
        (WebCore::inlineTagList):
        (WebCore::blockTagList):
        * khtml/html/HTMLFormCollectionImpl.cpp:
        (WebCore::HTMLFormCollectionImpl::updateNameCache):
        * khtml/html/htmlparser.cpp:
        (HTMLParser::isHeaderTag):
        (HTMLParser::isResidualStyleTag):
        (HTMLParser::isAffectedByResidualStyle):
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::addElementById):
        (WebCore::DocumentImpl::registerDisconnectedNodeWithEventListeners):
        * khtml/xml/NodeImpl.cpp:
        (WebCore::NodeImpl::registerNodeList):
        * khtml/xml/dom_atomicstring.cpp:
        (DOM::AtomicString::add):
        * khtml/xml/dom_qname.cpp:
        (DOM::QualifiedName::QualifiedName):
        * loader/CachedObject.cpp:
        (WebCore::CachedObject::ref):
        * page/Frame.cpp:
        (Frame::keepAlive):
        * rendering/render_canvas.cpp:
        (RenderCanvas::addWidget):
        * rendering/render_frames.cpp:
        (WebCore::RenderPartObject::updateWidget):
        * rendering/render_line.cpp:
        (WebCore::InlineFlowBox::paint):
        * xml/xmlhttprequest.cpp:
        (WebCore::XMLHttpRequest::addToRequestsByDocument):

2006-01-23  Justin Garcia  <justin.garcia@apple.com>

        Reviewed by thatcher
        
        Turned on -O2 for B&I build.

        * WebCore.xcodeproj/project.pbxproj:

2006-01-23  Darin Adler  <darin@apple.com>

        Reviewed by John Sullivan.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6617
          REGRESSION: Crash in cloneChildNodes when clicking element

        Test: fast/dom/clone-node-form-elements-with-attr.html

        Changed cloneNode and some other functions to return PassRefPtr.
        Also made m_render private and changed its name to m_renderer.

        * bindings/objc/DOM.mm: (-[DOMNode cloneNode:]): Add call to get() needed
        now that cloneNode returns a PassRefPtr.

        * khtml/editing/break_blockquote_command.cpp:
        (WebCore::BreakBlockquoteCommand::doApply):
        * khtml/editing/insert_paragraph_separator_command.cpp:
        (khtml::InsertParagraphSeparatorCommand::doApply):
        * khtml/editing/split_element_command.cpp:
        (khtml::SplitElementCommand::doApply):
        * khtml/html/htmlparser.cpp:
        (HTMLParser::handleResidualStyleCloseTagAcrossBlocks):
        (HTMLParser::reopenResidualStyleTags):
        * khtml/xml/dom2_rangeimpl.cpp: (DOM::RangeImpl::processContents):
        * ksvg2/svg/SVGUseElementImpl.cpp: (SVGUseElementImpl::closeRenderer):
        Use RefPtr and PassRefPtr as appropriate, since the result of cloneNode
        is now a referenced object in a PassRefPtr rather than a floating one and
        so needs to be kept referenced until used.

        * khtml/html/HTMLElementImpl.h:
        * khtml/html/HTMLElementImpl.cpp:
        (WebCore::HTMLElementImpl::cloneNode): Changed to return a PassRefPtr.
        (WebCore::HTMLElementImpl::children): Ditto.
        * khtml/xml/DocumentFragmentImpl.h:
        * khtml/xml/DocumentFragmentImpl.cpp:
        (DOM::DocumentFragmentImpl::cloneNode): Changed to return a PassRefPtr.
        * khtml/xml/DocumentImpl.h:
        * khtml/xml/DocumentTypeImpl.h:
        * khtml/xml/DocumentTypeImpl.cpp:
        (DOM::DocumentTypeImpl::cloneNode): Changed to return a PassRefPtr.
        * khtml/xml/NamedNodeMapImpl.h:
        (WebCore::NamedNodeMapImpl::getNamedItem): Changed to return PassRefPtr.
        (WebCore::NamedNodeMapImpl::removeNamedItem): Ditto.
        (WebCore::NamedNodeMapImpl::setNamedItemNS): Ditto.

        * khtml/html/HTMLGenericFormElementImpl.cpp:
        (WebCore::HTMLGenericFormElementImpl::attach): Use renderer() instead of
        getting at m_render directly.
        (WebCore::HTMLGenericFormElementImpl::recalcStyle): Ditto.
        (WebCore::HTMLGenericFormElementImpl::isFocusable): Ditto.
        (WebCore::HTMLGenericFormElementImpl::isKeyboardFocusable): Ditto.
        (WebCore::HTMLGenericFormElementImpl::isMouseFocusable): Ditto.
        * khtml/html/HTMLInputElementImpl.cpp:
        (WebCore::HTMLInputElementImpl::selectionStart): Ditto.
        (WebCore::HTMLInputElementImpl::selectionEnd): Ditto.
        (WebCore::HTMLInputElementImpl::setSelectionStart): Ditto.
        (WebCore::HTMLInputElementImpl::setSelectionEnd): Ditto.
        (WebCore::HTMLInputElementImpl::select): Ditto.
        (WebCore::HTMLInputElementImpl::setSelectionRange): Ditto.
        (WebCore::HTMLInputElementImpl::parseMappedAttribute): Ditto.
        (WebCore::HTMLInputElementImpl::setValue): Ditto.
        (WebCore::HTMLInputElementImpl::defaultEventHandler): Ditto.
        * khtml/html/HTMLSelectElementImpl.cpp:
        (WebCore::HTMLSelectElementImpl::recalcStyle): Ditto.
        (WebCore::HTMLSelectElementImpl::setRecalcListItems): Ditto.
        (WebCore::HTMLSelectElementImpl::reset): Ditto.
        (WebCore::HTMLSelectElementImpl::notifyOptionSelected): Ditto.
        (WebCore::HTMLSelectElementImpl::defaultEventHandler): Ditto.
        * khtml/html/HTMLTextAreaElementImpl.cpp:
        (WebCore::HTMLTextAreaElementImpl::selectionStart): Ditto.
        (WebCore::HTMLTextAreaElementImpl::selectionEnd): Ditto.
        (WebCore::HTMLTextAreaElementImpl::setSelectionStart): Ditto.
        (WebCore::HTMLTextAreaElementImpl::setSelectionEnd): Ditto.
        (WebCore::HTMLTextAreaElementImpl::select): Ditto.
        (WebCore::HTMLTextAreaElementImpl::setSelectionRange): Ditto.
        (WebCore::HTMLTextAreaElementImpl::updateValue): Ditto.
        (WebCore::HTMLTextAreaElementImpl::setValue): Ditto.
        * khtml/html/html_baseimpl.cpp:
        (WebCore::HTMLFrameElementImpl::updateForNewURL): Ditto.
        (WebCore::HTMLFrameElementImpl::openURL): Ditto.
        (WebCore::HTMLFrameElementImpl::attach): Ditto.
        (WebCore::HTMLFrameElementImpl::close): Ditto.
        (WebCore::HTMLFrameElementImpl::willRemove): Ditto.
        (WebCore::HTMLFrameElementImpl::isFocusable): Ditto.
        (WebCore::HTMLFrameElementImpl::setFocus): Ditto.
        (WebCore::HTMLFrameElementImpl::frameWidth): Ditto.
        (WebCore::HTMLFrameElementImpl::frameHeight): Ditto.
        (WebCore::HTMLFrameSetElementImpl::defaultEventHandler): Ditto.
        (WebCore::HTMLFrameSetElementImpl::recalcStyle): Ditto.
        (WebCore::HTMLIFrameElementImpl::attach): Ditto.
        (WebCore::HTMLIFrameElementImpl::recalcStyle): Ditto.
        * khtml/html/html_imageimpl.cpp:
        (WebCore::HTMLImageElementImpl::parseMappedAttribute): Ditto.
        (WebCore::HTMLImageElementImpl::width): Ditto.
        (WebCore::HTMLImageElementImpl::height): Ditto.
        * khtml/html/html_inlineimpl.cpp:
        (WebCore::HTMLAnchorElementImpl::isFocusable): Ditto.
        * khtml/html/html_listimpl.cpp:
        (DOM::HTMLLIElementImpl::parseMappedAttribute): Ditto.
        (DOM::HTMLLIElementImpl::attach): Ditto.
        * khtml/html/html_objectimpl.cpp:
        (WebCore::HTMLAppletElementImpl::getAppletInstance): Ditto.
        (WebCore::HTMLAppletElementImpl::closeRenderer): Ditto.
        (WebCore::HTMLEmbedElementImpl::getEmbedInstance): Ditto.
        (WebCore::HTMLEmbedElementImpl::attach): Ditto.
        (WebCore::HTMLObjectElementImpl::getObjectInstance): Ditto.
        (WebCore::HTMLObjectElementImpl::parseMappedAttribute): Ditto.
        (WebCore::HTMLObjectElementImpl::attach): Ditto.
        (WebCore::HTMLObjectElementImpl::detach): Ditto.
        (WebCore::HTMLObjectElementImpl::recalcStyle): Ditto.
        * khtml/html/html_tableimpl.cpp:
        (WebCore::HTMLTableElementImpl::parseMappedAttribute): Ditto.
        (WebCore::HTMLTableElementImpl::attach): Ditto.
        * khtml/xml/ContainerNodeImpl.cpp:
        (WebCore::ContainerNodeImpl::getUpperLeftCorner): Ditto.
        (WebCore::ContainerNodeImpl::getLowerRightCorner): Ditto.
        (WebCore::ContainerNodeImpl::setActive): Ditto.
        (WebCore::ContainerNodeImpl::setHovered): Ditto.
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::~DocumentImpl): Ditto.
        (WebCore::DocumentImpl::elementFromPoint): Ditto.
        (WebCore::DocumentImpl::recalcStyle): Ditto.
        (WebCore::DocumentImpl::attach): Ditto.
        (WebCore::DocumentImpl::restoreRenderer): Ditto.
        (WebCore::DocumentImpl::detach): Ditto.
        (WebCore::DocumentImpl::setVisuallyOrdered): Ditto.
        (WebCore::DocumentImpl::updateSelection): Ditto.
        (WebCore::DocumentImpl::prepareMouseEvent): Ditto.
        (WebCore::DocumentImpl::cloneNode): Changed to return PassRefPtr.
        (WebCore::DocumentImpl::recalcStyleSelector): Use renderer() instead
        of getting at m_render directly.
        (WebCore::DocumentImpl::setInPageCache): Ditto.

        * khtml/xml/NodeImpl.h:
        * khtml/xml/NodeImpl.cpp:
        (WebCore::NodeImpl::NodeImpl): Changed m_render to m_renderer.
        (WebCore::NodeImpl::~NodeImpl): Changed use of m_render to renderer().
        (WebCore::NodeImpl::getRect): Ditto.
        (WebCore::NodeImpl::attach): Ditto.
        (WebCore::NodeImpl::detach): Ditto.
        (WebCore::NodeImpl::createRendererIfNeeded): Ditto.
        (WebCore::NodeImpl::getElementsByTagName): Changed to return PassRefPtr.
        (WebCore::NodeImpl::getElementsByTagNameNS): Ditto.

        * khtml/xml/dom_elementimpl.h:
        * khtml/xml/dom_elementimpl.cpp:
        (WebCore::AttrImpl::cloneNode): Changed to return PassRefPtr.
        (WebCore::ElementImpl::cloneNode): Ditto.
        (WebCore::ElementImpl::scrollIntoView): Use renderer() instead of m_render.
        (WebCore::ElementImpl::scrollIntoViewIfNeeded): Ditto.
        (WebCore::ElementImpl::recalcStyle): Ditto.
        (WebCore::ElementImpl::setAttributeNode): Changed to return PassRefPtr.
        (WebCore::ElementImpl::removeAttributeNode): Ditto.
        (WebCore::NamedAttrMapImpl::removeNamedItemNS): Ditto.
        (WebCore::NamedAttrMapImpl::setNamedItem): Ditto.
        (WebCore::NamedAttrMapImpl::removeNamedItem): Ditto.
        (DOM::ElementImpl::setAttributeNodeNS): Ditto.

        * khtml/xml/dom_textimpl.h:
        * khtml/xml/dom_textimpl.cpp:
        (CharacterDataImpl::setData): Changed use of m_render to renderer().
        (CharacterDataImpl::appendData): Ditto.
        (CharacterDataImpl::insertData): Ditto.
        (CharacterDataImpl::deleteData): Ditto.
        (CharacterDataImpl::replaceData): Ditto.
        (CommentImpl::cloneNode): Changed to return PassRefPtr.
        (TextImpl::splitText): Changed use of m_render to renderer().
        (TextImpl::cloneNode): Changed to return PassRefPtr.
        (TextImpl::recalcStyle): Changed use of m_render to renderer().
        (CDATASectionImpl::cloneNode): Changed to return PassRefPtr.

        * khtml/xml/dom_xmlimpl.h:
        * khtml/xml/dom_xmlimpl.cpp:
        (DOM::EntityImpl::cloneNode): Changed to return PassRefPtr.
        (DOM::EntityReferenceImpl::cloneNode): Ditto.
        (DOM::NotationImpl::cloneNode): Ditto.
        (DOM::ProcessingInstructionImpl::cloneNode): Ditto.

        - removed unused code

        * khtml/html/html_documentimpl.cpp: Removed unused slotHistoryChanged function.
        * khtml/html/html_documentimpl.h: Ditto.
        * kwq/KWQObject.cpp: (QObject::connect): Removed special case for
        slotHistoryChanged, no longer used.

        - fixed storage leak

        * bridge/mac/MacFrame.mm: (MacFrame::~MacFrame): Delete window widget.

2006-01-23  Anders Carlsson  <andersca@mac.com>

        Forgot to add this as part of 
        http://bugzilla.opendarwin.org/show_bug.cgi?id=3869
        
        * manual-tests/resources/webkit-background.png: Added.

2006-01-22  Darin Adler  <darin@apple.com>

        - fix layout tests

        * rendering/RenderTable.cpp: (WebCore::RenderTable::addChild): Added
        missing code to set wrapInAnonymousSection false in the case where
        adding a footer.

2006-01-22  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.
        
        - Set up Page class and invert Frame / WebCoreFrameBridge ownership
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6577

        * bridge/mac/MacFrame.h:
        * bridge/mac/MacFrame.mm:
        (MacFrame::MacFrame): Initialize _bridge
        (MacFrame::~MacFrame): Clear the bridge's frame pointer and release it.
        (Frame::frameDetached): Reverse order of removing from old-style frames
        array and calling frameDetached.
        (MacFrame::createPart): Don't ref the part when creating it, since the child
        bridge is no longer going to own a ref.
        (MacFrame::setBridge): KWQRetain / KWQRelease since we know own the bridge.
        (MacFrame::detachFromView): New method; clear out the view.
        * bridge/mac/WebCoreFrameBridge.h:
        * bridge/mac/WebCoreFrameBridge.mm:
        (Bridge): Helper method to get a WebCoreFrameBridge from a Frame.
        (-[WebCoreFrameBridge firstChild]): Call through Frame.
        (-[WebCoreFrameBridge lastChild]): ditto
        (-[WebCoreFrameBridge childCount]): ditto
        (-[WebCoreFrameBridge previousSibling]): ditto
        (-[WebCoreFrameBridge nextSibling]): ditto
        (-[WebCoreFrameBridge isDescendantOfFrame:]): No need to cast parent
        pointer.
        (-[WebCoreFrameBridge appendChild:]): Call through Frame.
        (-[WebCoreFrameBridge _clearRenderPart]): New helper method to free
        the renderPart when removing a child.
        (-[WebCoreFrameBridge removeChild:]): Clear child's render part
        and call through to Frame.
        (-[WebCoreFrameBridge dealloc]): Remove unneeded m_frame-related code.
        (-[WebCoreFrameBridge finalize]): ditto
        (-[WebCoreFrameBridge clearFrame]): New helper method, needed now that
        bridge can outlive frame.
        (-[WebCoreFrameBridge handleFallbackContent]): Make safe against a null
        frame.
        (-[WebCoreFrameBridge removeFromFrame]): ditto
        * bridge/mac/WebCorePageBridge.h:
        * bridge/mac/WebCorePageBridge.mm:
        (-[WebCorePageBridge initWithMainFrame:]): Create a Page instance.
        (-[WebCorePageBridge dealloc]): Delete the Page.
        (-[WebCorePageBridge mainFrame]): Get the main frame from the Page.
        * khtml/ecma/kjs_binding.cpp:
        (KJS::ScriptInterpreter::globalExec): Override; keep frame alive, then
        call superclass.
        * khtml/ecma/kjs_binding.h:
        * khtml/ecma/kjs_proxy.cpp:
        (KJSProxyImpl::clear): Don't pass exec to window.
        (KJSProxyImpl::interpreter): Don't do keepAlive.
        * khtml/ecma/kjs_window.cpp:
        (KJS::Window::isSafeScript): If the active part's document is gone, use the frame's
        URL for security check purposes.
        (KJS::Window::clear): Don't take an ExecState parameter any more - it
        wasn't used.
        * khtml/ecma/kjs_window.h:
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::implicitOpen): If we've got a tokenizer, delete
        it before closing - you don't ever want to fire an onload handler because of
        an open.
        * page/Frame.cpp:
        (Frame::init): Pass `this' to FramePrivate constructor.
        (FrameCounter::~FrameCounter): Added debug counting of leftover
        Frame objects on exit.
        (Frame::Frame): Moved out-of-line. Increment debug counter.
        (Frame::~Frame): Assert that there is no life support going, either at the
        start or end of this method. Decrement frame counter.
        (Frame::stopLoading): tweaked for the fact that ChildFrame::m_frame is now
        a RefPtr.
        (Frame::clear): ditto
        (Frame::stop): ditto
        (Frame::stopAnimations): ditto
        (Frame::checkEmitLoadEvent): ditto
        (Frame::processObjectRequest): ditto
        (Frame::childFrame): ditto
        (Frame::findFrame): ditto
        (Frame::setZoomFactor): ditto
        (Frame::frames): ditto
        (Frame::connectChild): ditto
        (Frame::disconnectChild): ditto
        (Frame::endAllLifeSupport): Method that, in debug mode, will clear
        all life suppor timers so the Frame exit counter works.
        (Frame::keepAlive): In debug mode, add proper support for
        endAllLifeSupport
        (Frame::slotEndLifeSupport): ditto
        (Frame::setPolicyBaseURL): Update for the fact that ChildFrame::m_frame is now
        a RefPtr.
        (Frame::treeNode): New helper method, get the FrameTreeNode class that implements
        frame tree traversal.
        (Frame::nextSibling): Simple wrapper that calls through to treeNode().
        (Frame::previousSibling): ditto
        (Frame::firstChild): ditto
        (Frame::lastChild): ditto
        (Frame::childCount): ditto
        (Frame::appendChild): ditto
        (Frame::removeChild): ditto
        (Frame::detachFromView): no-op, just a virtual base for the MAcFrame method.
        * page/Frame.h:
        * page/FramePrivate.h:
        (FramePrivate::FramePrivate): Add FrameTreeNode member.
        * page/FrameTreeNode.cpp: Added.
        (FrameTreeNode::~FrameTreeNode): detach all children from their view
        (FrameTreeNode::appendChild): implemented
        (FrameTreeNode::removeChild): implemented - make sure to detach child
        from its view.
        * page/FrameTreeNode.h: Added.
        (FrameTreeNode::FrameTreeNode): New; initialize fields tht need it.
        (FrameTreeNode::nextSibling): Trivial inline.
        (FrameTreeNode::previousSibling): ditto
        (FrameTreeNode::firstChild): ditto
        (FrameTreeNode::lastChild): ditto
        (FrameTreeNode::childCount): ditto
        * page/Page.cpp: Added.
        (Page::Page): Initialize mainFrame and bump pageCount appropriately.
        (Page::~Page): Detach main frame from view, handle ending life support
        when last frame is destroyed.
        * page/Page.h: Added.
        (Page::mainFrame): Trivial inline.
        * WebCore.xcodeproj/project.pbxproj: Add new files.

2006-01-22  Darin Adler  <darin@apple.com>

        * Info.plist: Updated Apple copyright date. Need to update others
        too at some point.

        * WebCore-svg.exp: Removed unused empty file.

2006-01-22  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        Make <animateColor> work again (broke during DOM merger).
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5964

        * WebCore.xcodeproj/project.pbxproj:
        * kcanvas/device/quartz/KCanvasItemQuartz.h:
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (KCanvasItemQuartz::getAbsoluteRepaintRect): moved to .cpp file
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::implicitClose): start svg animations
        (WebCore::DocumentImpl::svgExtensions): svg document extensions
        (WebCore::DocumentImpl::accessSVGExtensions): svg doc extensions
        * khtml/xml/DocumentImpl.h:
        * ksvg2/css/SVGCSSStyleSelector.cpp:
        (KDOM::CSSStyleSelector::applySVGProperty):
        * ksvg2/svg/SVGAElementImpl.cpp:
        (SVGAElementImpl::defaultEventHandler): cleanup
        * ksvg2/svg/SVGAnimateColorElementImpl.cpp:
        (SVGAnimateColorElementImpl::handleTimerEvent): update css lookup
        * ksvg2/svg/SVGAnimateElementImpl.cpp:
        (SVGAnimateElementImpl::handleTimerEvent): fix css property lookup
        * ksvg2/svg/SVGAnimateTransformElementImpl.cpp:
        (SVGAnimateTransformElementImpl::handleTimerEvent):
        * ksvg2/svg/SVGAnimationElementImpl.cpp:
        (SVGAnimationElementImpl::closeRenderer): use doc extensions
        (SVGAnimationElementImpl::targetAttribute): fix css properties
        (SVGAnimationElementImpl::setTargetAttribute): fix css properties
        * ksvg2/svg/SVGDocumentImpl.cpp:
        (SVGDocumentImpl::svgView): remove unnecessary static cast
        (SVGDocumentImpl::executeScripts):
        * ksvg2/svg/SVGDocumentImpl.h:
        * ksvg2/svg/SVGElementImpl.cpp:
        (WebCore::SVGElementImpl::addSVGEventListener): helper function
        (WebCore::SVGElementImpl::parseMappedAttribute): use helper
        * ksvg2/svg/SVGElementImpl.h:
        * ksvg2/svg/SVGGElementImpl.cpp:
        * ksvg2/svg/SVGGElementImpl.h:
        * ksvg2/svg/SVGSVGElementImpl.cpp:
        (WebCore::SVGSVGElementImpl::SVGSVGElementImpl):
        (WebCore::SVGSVGElementImpl::~SVGSVGElementImpl):
        (WebCore::SVGSVGElementImpl::addSVGWindowEventListner): helper
        (WebCore::SVGSVGElementImpl::parseMappedAttribute): use helper
        * ksvg2/svg/SVGSVGElementImpl.h:
        * ksvg2/svg/SVGSetElementImpl.cpp:
        (SVGSetElementImpl::handleTimerEvent): use doc extensions
        * ksvg2/svg/SVGStyledElementImpl.h:
        * page/Frame.cpp:
        (Frame::pauseTimeouts): pause svg animation
        (Frame::resumeTimeouts): resume svg animation
        * rendering/render_canvas.h:

2006-01-22  Darin Adler  <darin@apple.com>

        - fix deployment builds

        * rendering/RenderTable.cpp: (WebCore::RenderTable::addChild): Init bool.

2006-01-22  Darin Adler  <darin@apple.com>

        Reviewed by Maciej.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5731
          Form element as display table-cell hangs Safari (will eventually crash)

        Test: fast/table/form-with-table-style.html

        Hang was caused by the fact that RenderContainer has code to wrap table
        styled elements in appropriate anonymous table elements, but the table
        elements themselves have a special case for form elements that causes them
        to call through, which led to infinite recursion as RenderContainer kept
        making new tables which kept calling through to RenderContainer::addChild.

        * rendering/RenderTable.cpp:
        (WebCore::RenderTable::addChild): Improved logic about wrapping children
        in anonymous table sections in the following ways: (1) Do wrap a form
        properly it has a table display style (such as table-cell or table-row).
        (2) When an item has a particular display style, check that it has the
        right type of render object before casting it to that type. Also
        restructured the code a little to make it slightly more readable.
        (WebCore::RenderTable::layout): Added a FIXME about forms that have a
        display style that makes it a table section, since they will be skipped
        here in the loop to lay children out.
        (WebCore::RenderTable::recalcSections): Added checks similar to the ones
        in addChild above.

        * rendering/RenderTableSection.cpp: (WebCore::RenderTableSection::addChild):
        Moved form tag logic inside render object type check so that a table row
        that happens to be a form element won't be affected by the special form
        tag logic. Also added an explicit check for the table-cell style so we
        will wrap it in a row rather than just putting the form at this level.

        * rendering/RenderTableRow.h: Removed removeChildNode and dump functions
        that just called through to the base class.
        * rendering/RenderTableRow.cpp: (WebCore::RenderTableRow::addChild):
        Moved form tag logic inside render object type check so that a table cell
        that happens to be a form element won't be affected by the special form
        tag logic. Removed unnecessary null check of section() at end of function.

        * rendering/RenderTableCol.h: Removed addChild because all it did was
        assert (incorrectly) and then call through to the base class. Changed
        _span to be m_span.
        * rendering/RenderTableCol.cpp: Removed addChild function. Updated for
        change in name of m_span field.

2006-01-22  Darin Adler  <darin@apple.com>

        Reviewed by Maciej.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=3518
          REGRESSION (312-412): mojibake left behind when scrolling a clipped <select>

        * kwq/KWQListBox.mm: (QListBox::QListBox): Call setCopiesOnScroll:NO.
        * kwq/KWQTextArea.mm: (-[KWQTextArea initWithFrame:]): Ditto.

2006-01-22  David Kilzer  <ddkilzer@kilzer.net>

        Reviewed by Maciej.

        - fix for http://bugzilla.opendarwin.org/show_bug.cgi?id=5656
        REGRESSION: Buttons on Yahoo! Mail misplaced in ToT
        <rdar://problem/4404335>
        Tests whether white-space mode on buttons is inheritied and not forced.
        Originally broken in Subversion revision r10909.

        * css/html4.css: Remove default white-space value for <button> tag to
        allow it to be inherited.
        * rendering/render_theme_mac.mm:
        (khtml::RenderThemeMac::adjustButtonStyle): Fix misleading comment.

        * css/UserAgentStyleSheets.cpp: Touched this file to make the rebuild
        of html4.css work (shouldn't have to do this).

2006-01-22  Darin Adler  <darin@apple.com>

        * css/make-css-file-arrays.pl: Fix typo that was resulting in a bunch
        of whitespace that was supposed to go into a derived source file going
        to the console instead.

2006-01-22  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        SVG needs to support "evt" instead of "event" in event handlers.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5874

        * WebCore.xcodeproj/project.pbxproj: added new classes
        * khtml/ecma/kjs_events.cpp:
        * khtml/ecma/kjs_events.h:
        * khtml/ecma/kjs_proxy.cpp:
        (WebCore::KJSProxyImpl::createHTMLEventHandler): simplified
        (WebCore::KJSProxyImpl::createSVGEventHandler): new
        * khtml/ecma/kjs_proxy.h:
        * khtml/ecma/kjs_window.cpp:
        * khtml/ecma/kjs_window.h:
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::createHTMLEventListener): simplified
        (WebCore::DocumentImpl::createSVGEventListener): new
        * khtml/xml/DocumentImpl.h:
        * khtml/xml/NodeImpl.cpp:
        (WebCore::NodeImpl::dispatchEvent): use RefPtr
        * ksvg2/events/JSSVGLazyEventListener.cpp: Added.
        (WebCore::JSSVGLazyEventListener::JSSVGLazyEventListener): added.
        (WebCore::JSSVGLazyEventListener::eventParameterName): added.
        * ksvg2/events/JSSVGLazyEventListener.h: Added.
        * ksvg2/svg/SVGElementImpl.cpp:
        (SVGElementImpl::parseMappedAttribute): use new SVG event handler
        * ksvg2/svg/SVGSVGElementImpl.cpp:
        (SVGSVGElementImpl::parseMappedAttribute): use new SVG event handler
        * page/Frame.cpp: updated KJSProxyImpl namespace
        * page/Frame.h: updated KJSProxyImpl namespace
        * page/FramePrivate.h: updated KJSProxyImpl namespace

2006-01-22  Darin Adler  <darin@apple.com>

       Reviewed by Maciej.

       - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=3508
         REGRESSION (125-412): problem with negative margin-top and position: absolute (vre.aitg.com)
         <rdar://problem/4093277> REGRESSION (125-312): layout problem at vre.aitg.com (3508)

       Test: fast/css/position-negative-top-margin.html

       * rendering/RenderBlock.cpp: (WebCore::RenderBlock::adjustPositionedBlock):
       Fixed two different problems that contributed to the bug: (1) Added a call to calcVerticalMargins
       otherwise the margin will always be 0. (2) Corrected logic for the negative margin case, which
       was comparing a negative margin-top to a number representing the absolute value of the margin.

2006-01-22  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Darin.

       - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=3702
         Web page is laid out incorrectly after printing with print-specific style sheet.
         <rdar://problem/3706259> Web page distorts after printing with print-specific style sheet (3702)

        Also replaced tabs with spaces in the changed files.

        Test cases: 
        * fast/table/append-cells.html
        * fast/table/append-cells2.html
        * fast/table/remove-td-display-none.html

        * rendering/RenderTable.cpp:
        (WebCore::RenderTable::recalcSections): Shrink columns and columnPos to the
          actual number of columns.

        * rendering/RenderTableSection.cpp:
        (WebCore::RenderTableSection::numColumns): New function.
        (WebCore::RenderTableSection::dump): Use gridRows instead of grid.size() for row count,
          preventing crashes.

        * rendering/RenderTableSection.h: Added numColumns() and a comment about cCol/cRow.

2006-01-22  Darin Adler  <darin@apple.com>

        Reviewed by Anders.

        - http://bugzilla.opendarwin.org/show_bug.cgi?id=6705
          use PassRefPtr in more of the basic DOM operations

        Once we do the same with cloneNode, I believe we'll fix one of our P1 bugs,
        but cloneNode was a little too much to do without doing this first pass.

        * khtml/xml/NodeImpl.cpp:
        (WebCore::NodeImpl::childNodes): Updated for parameter changes.
        (WebCore::NodeImpl::insertBefore): Ditto.
        (WebCore::NodeImpl::replaceChild): Ditto.
        (WebCore::NodeImpl::removeChild): Ditto.
        (WebCore::NodeImpl::appendChild): Ditto.
        (WebCore::NodeImpl::addChild): Ditto.
        (WebCore::NodeImpl::addEventListener): Ditto.
        (WebCore::NodeImpl::setHTMLEventListener): Ditto.
        (WebCore::NodeImpl::isDefaultNamespace): Updated for changed name of ancestorElement.
        (WebCore::NodeImpl::lookupPrefix): Ditto.
        (WebCore::NodeImpl::lookupNamespaceURI): Ditto.
        (WebCore::NodeImpl::lookupNamespacePrefix): Ditto.
        (WebCore::NodeImpl::ancestorElement): Changed name from getAncestorElement.
        * khtml/xml/NodeImpl.h: Changed most functions where it makes sense to take and return
        PassRefPtr instead of raw pointers. Even non-obvious cases like appendChild, where the
        return value has to be PassRefPtr only because it might be removed when the JavaScript
        triggered by the DOM mutation event runs (normally, there's no need to return an "owning"
        pointer because the tree now owns the newly-inserted node). Made the ancestorElement
        function private.

        * khtml/xml/ContainerNodeImpl.cpp:
        (WebCore::ContainerNodeImpl::ContainerNodeImpl): Updated for changes from
        _first to m_firstChild and _last to m_lastChild.
        (WebCore::ContainerNodeImpl::removeAllChildren): Ditto.
        (WebCore::ContainerNodeImpl::firstChild): Ditto.
        (WebCore::ContainerNodeImpl::lastChild): Ditto.
        (WebCore::ContainerNodeImpl::insertBefore): Updated for parameter changes.
        (WebCore::ContainerNodeImpl::replaceChild): Ditto.
        (WebCore::ContainerNodeImpl::willRemove): Updated for m_lastChild.
        (WebCore::ContainerNodeImpl::removeChild): Updated for parameter changes.
        (WebCore::ContainerNodeImpl::removeChildren): Updated for m_first/lastChild.
        (WebCore::ContainerNodeImpl::appendChild): Updated for parameter changes.
        (WebCore::ContainerNodeImpl::hasChildNodes): Updated for m_firstChild.
        (WebCore::ContainerNodeImpl::addChild): Updated for parameter changes.
        (WebCore::ContainerNodeImpl::attach): Updated for m_firstChild.
        (WebCore::ContainerNodeImpl::detach): Ditto.
        (WebCore::ContainerNodeImpl::insertedIntoDocument): Ditto.
        (WebCore::ContainerNodeImpl::removedFromDocument): Ditto.
        (WebCore::ContainerNodeImpl::insertedIntoTree): Ditto.
        (WebCore::ContainerNodeImpl::removedFromTree): Ditto.
        * khtml/xml/ContainerNodeImpl.h: Removed unused checkSameDocument and checkIsChild.
        Made more things private, updated parameters for NodeImpl functions.

        * khtml/html/HTMLSelectElementImpl.cpp:
        (DOM::HTMLSelectElementImpl::insertBefore): Ditto.
        (DOM::HTMLSelectElementImpl::replaceChild): Ditto.
        (DOM::HTMLSelectElementImpl::removeChild): Ditto.
        (DOM::HTMLSelectElementImpl::appendChild): Ditto.
        (DOM::HTMLSelectElementImpl::addChild): Ditto.
        * khtml/html/HTMLSelectElementImpl.h: Ditto.

        * khtml/html/HTMLOptGroupElementImpl.cpp:
        (WebCore::HTMLOptGroupElementImpl::insertBefore): Updated for parameter type change.
        Also changed to look at return value, not exception code, to check for success.
        (WebCore::HTMLOptGroupElementImpl::replaceChild): Ditto.
        (WebCore::HTMLOptGroupElementImpl::removeChild): Ditto.
        (WebCore::HTMLOptGroupElementImpl::appendChild): Ditto.
        (WebCore::HTMLOptGroupElementImpl::addChild): Ditto.
        * khtml/html/HTMLOptGroupElementImpl.h: Ditto.

        * WebCore+SVG/kdom.h: Renamed enum from ExceptionCode to ExceptionCodes
        to avoid conflict with a typedef ExceptionCode I added.

        * bindings/objc/DOM.mm:
        (-[DOMNode insertBefore::]): Added get() call since return value is a PassRefPtr.
        (-[DOMNode replaceChild::]): Ditto.
        (-[DOMNode removeChild:]): Ditto.
        (-[DOMNode appendChild:]): Ditto.

        * khtml/ecma/kjs_dom.h: Changed getDOMNode to take PassRefPtr.
        * khtml/ecma/kjs_dom.cpp: (KJS::getDOMNode): Changed to take PassRefPtr.

        * khtml/html/HTMLElementImpl.cpp: Added dom2_events.h include, now needed.
        Re-sorted includes.
        * ksvg2/svg/SVGElementImpl.cpp: Ditto.

        * khtml/html/html_documentimpl.cpp: (WebCore::HTMLDocumentImpl::documentElement):
        Changed access to now-private data member _first to equivalent inline function
        fastFirstChild().
        * khtml/xml/DocumentImpl.cpp: (WebCore::DocumentImpl::recalcStyle): Ditto.
        * khtml/xml/dom_elementimpl.cpp: (WebCore::ElementImpl::recalcStyle): Ditto.

        * khtml/html/html_tableimpl.cpp:
        (WebCore::HTMLTableElementImpl::setCaption): Updated to work with new replaceChild
        that returns PassRefPtr.
        (WebCore::HTMLTableElementImpl::setTHead): Ditto.
        (WebCore::HTMLTableElementImpl::setTFoot): Ditto.
        (WebCore::HTMLTableElementImpl::setTBody): Ditto.
        (WebCore::HTMLTableElementImpl::addChild): Updated for parameter type change.
        (WebCore::HTMLTableSectionElementImpl::addChild): Ditto.
        (WebCore::HTMLTableRowElementImpl::addChild): Ditto.
        * khtml/html/html_tableimpl.h: Ditto.

        * khtml/html/htmlparser.cpp: (HTMLParser::handleResidualStyleCloseTagAcrossBlocks):
        Removed an unneeded explicit call to removeChild. appendChild already takes care of
        removing the child from its own location. This avoids the fact that removeChild was
        removing the parent, the only thing keeping the node alive. This is sort of the
        "flip side" of our removeChild leaks -- code that depended on the behavior that
        caused the leaks.

        * khtml/xml/xml_tokenizer.cpp: (WebCore::XMLTokenizer::startElementNs):
        Removed unneeded isHTMLElement() calls from before the "qualified name" change.

2006-01-22  Eric Seidel  <eseidel@apple.com>

        Rubber-stamped by anders.

        Remove WebCore-no-SVG target and wrap files in #if SVG_SUPPORT
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6633

2006-01-22  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Maciej.

        - http://bugzilla.opendarwin.org/show_bug.cgi?id=6642
          Split XMLHttpRequest class into JS binding and implementation

        * WebCore.xcodeproj/project.pbxproj: Adjusted for moved and renamed files.
        New group "xml" to match directory structure.
        * xml: Added.
        * khtml/ecma/JSXMLHttpRequest.cpp: Added.
        * khtml/ecma/JSXMLHttpRequest.h: Added.
        * khtml/ecma/xmlhttprequest.cpp: Removed.
        * khtml/ecma/xmlhttprequest.h: Removed.
        * xml/xmlhttprequest.cpp: Added.
        * xml/xmlhttprequest.h: Added.
        * khtml/ecma/kjs_binding.cpp:
        (KJS::jsStringOrUndefined): Moved from kjs_events.cpp.
        * khtml/ecma/kjs_binding.h: Added prototype for jsStringOrUndefined().
        * khtml/ecma/kjs_events.cpp: Removed jsStringOrUndefined().
        * khtml/ecma/kjs_window.cpp: 
        (KJS::Window::getValueProperty): Use new class name for JSXMLHttpRequest.
        * kwq/KWQSlot.cpp: XMLHttpRequestQObject is now in WebCore, not KJS.
        * page/Frame.cpp:
        (Frame::stopLoading): XMLHttpRequest is now in WebCore, not KJS.

2006-01-22  Alexander Kellett  <lypanov@kde.org>

        Reviewed by eseidel.

        Add support for custom fill/strokes on text.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6448

        * kcanvas/RenderSVGText.cpp:
        (RenderSVGText::paint): use new painter setup/teardown infrastructure
        * kcanvas/device/KRenderingPaintServer.h:
        (KRenderingPaintServer::KRenderingPaintServer):
        (KRenderingPaintServer::setup):
        (KRenderingPaintServer::render):
        (KRenderingPaintServer::teardown):
        (KRenderingPaintServer::isPaintingText):
        (KRenderingPaintServer::setPaintingText):
        * kcanvas/device/quartz/KRenderingPaintServerGradientQuartz.mm:
        (setupShadingWithStyle):
        (renderShadingWithStyle):
        (teardownShadingWithStyle):
        (KRenderingPaintServerLinearGradientQuartz::draw):
        (KRenderingPaintServerLinearGradientQuartz::setup):
        (KRenderingPaintServerLinearGradientQuartz::render):
        (KRenderingPaintServerLinearGradientQuartz::teardown):
        (KRenderingPaintServerRadialGradientQuartz::draw):
        (KRenderingPaintServerRadialGradientQuartz::setup):
        (KRenderingPaintServerRadialGradientQuartz::render):
        (KRenderingPaintServerRadialGradientQuartz::teardown):
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.h:
        (KRenderingPaintServerPatternQuartz::KRenderingPaintServerPatternQuartz):
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.mm:
        (KRenderingPaintServerQuartzHelper::strokePath):
        (KRenderingPaintServerQuartzHelper::clipToStrokePath):
        (KRenderingPaintServerQuartzHelper::fillPath):
        (KRenderingPaintServerQuartzHelper::clipToFillPath):
        (KRenderingPaintServerSolidQuartz::draw):
        (KRenderingPaintServerSolidQuartz::setup):
        (KRenderingPaintServerSolidQuartz::render):
        (KRenderingPaintServerSolidQuartz::teardown):
        (KRenderingPaintServerPatternQuartz::draw):
        (KRenderingPaintServerPatternQuartz::setup):
        (KRenderingPaintServerPatternQuartz::render):
        (KRenderingPaintServerPatternQuartz::teardown):
        * kcanvas/device/quartz/QuartzSupport.h: fix prototype
        * kcanvas/device/quartz/QuartzSupport.mm:
        (applyStrokeStyleToContext):
        * ksvg2/misc/KCanvasRenderingStyle.cpp:
        (KSVGPainterFactory::fillPaintServer):
        (KSVGPainterFactory::strokePaintServer):
        (KSVGPainterFactory::cssPrimitiveToLength):
        (KSVGPainterFactory::strokePainter):
        (KSVGPainterFactory::fillPainter):
        * ksvg2/misc/KCanvasRenderingStyle.h:

2006-01-21  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Darin.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=3509
          REGRESSION(125-412) Portion of nested table is not painted correctly on cafepress site
          <rdar://problem/4039615> REGRESSION(125-188) Portion of nested table is not painted correctly on cafepress site

        * manual-tests/bugzilla-3509.html: Added.
        * rendering/RenderBlock.cpp:
        (WebCore::RenderBlock::layoutBlockChildren): Force repaint if the child didn't move but
        didn't repaint correctly during layout because it was not at its final position then.

2006-01-21  Anders Carlsson  <andersca@mac.com>

        Reviewed by Darin.

        http://bugzilla.opendarwin.org/show_bug.cgi?id=3869
        Should use HTML Image element instead of JS Image object
        <rdar://problem/3852987> JavaScript image.complete property never returns true (3869)

        * khtml/ecma/kjs_events.cpp:
        (KJS::ClipboardProtoFunc::callAsFunction):
        Don't check Image object. Instead, if the element passed in
        is an image element which isn't in any document, use its pixmap.
        
        * khtml/ecma/kjs_html.cpp:
        (KJS::HTMLElement::imageGetter):
        Add complete.
        
        (KJS::ImageConstructorImp::construct):
        Take a QPixmap instead of an Image.
        
        (KJS::KJS::Context2DFunction::callAsFunction):
        Remove usage of Image and use HTMLImageElementImpl instead.

        * khtml/ecma/kjs_html.h:
        Remove Image class.
        
        (KJS::HTMLElement::):
        Add ImgComplete.
        
        * khtml/html/html_imageimpl.cpp:
        (WebCore::HTMLImageElementImpl::width):
        (WebCore::HTMLImageElementImpl::height):
        If the element has no renderer but its image size is known
        return that instead.
        
        (WebCore::HTMLImageElementImpl::complete):
        New function, returns true if an image has finished loading.
        
        * khtml/html/html_imageimpl.h:
        Add complete.
        
        * manual-tests/drag-image.html: Added.

2006-01-21  Anders Carlsson  <andersca@mac.com>

        Reviewed by Darin.

        - fixes http://bugzilla.opendarwin.org/show_bug.cgi?id=6691
        TinyMCE: strikethrough unimplemented
        
        * khtml/editing/jsediting.cpp:
        Add support for the "Strikethrough" command.
        
2006-01-21  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Test: fast/dynamic/hovered-detach.html

        Reviewed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5983
          REGRESSION: onmouseover-powered navbar at MacNN renders incorrectly
          <rdar://problem/4403730> REGRESSION: onmouseover powered navbar renders incorrectly at macnn.com (5983)

        * khtml/xml/NodeImpl.cpp:
        (WebCore::NodeImpl::detach): Set m_hovered to false and set the document's
        hoverNode to an hovered ancestor that still has a renderer.
        * rendering/render_layer.cpp: Changed static method hoverAncestor() into a
        RenderObject instance method.
        (WebCore::commonAncestor):
        (WebCore::RenderLayer::updateHoverActiveState):
        * rendering/render_object.cpp: Ditto.
        (WebCore::RenderObject::hoverAncestor)
        * rendering/render_object.h: Ditto.

2006-01-20  David Hyatt  <hyatt@apple.com>

        Fix for bug 6666, pseudo-element rules incorrectly displayed
        in Web Inspector.
        
        Reviewed by darin

        Added fast/inspector/matchedrules.html as test case.

        * css/cssstyleselector.cpp:
        (WebCore::CSSStyleSelector::matchRulesForList):

2006-01-20  Timothy Hatcher  <timothy@apple.com>

        Reviewed by John.

        Removes code that is no longer needed with the new Web Inspector.

        * bridge/mac/WebCoreFrameBridge.h: removes the WebCoreDOMTreeCopier protocol.
        * bridge/mac/WebCoreFrameBridge.mm: removes copyDOMNode:copier:

2006-01-21  Anders Carlsson  <andersca@mac.com>

        Reviewed by David Hyatt.

        Rename Frame::xmlDocImpl => Frame::document and
        Frame::replaceDocImpl => Frame::setDocument
        
        * bridge/mac/MacFrame.mm:
        (MacFrame::findString):
        (MacFrame::advanceToNextMisspelling):
        (MacFrame::nextKeyViewInFrame):
        (MacFrame::nextKeyViewInFrameHierarchy):
        (MacFrame::keyEvent):
        (MacFrame::dispatchCPPEvent):
        (MacFrame::setDisplaysWithFocusAttributes):
        (MacFrame::bodyBackgroundColor):
        (MacFrame::markMisspellings):
        (MacFrame::respondToChangedSelection):
        (MacFrame::setMarkedTextRange):
        (MacFrame::dashboardRegionsDictionary):
        (MacFrame::shouldClose):
        * bridge/mac/WebCoreFrameBridge.mm:
        (updateRenderingForBindings):
        (frameHasSelection):
        (-[WebCoreFrameBridge addData:]):
        (-[WebCoreFrameBridge didNotOpenURL:pageCache:]):
        (-[WebCoreFrameBridge saveDocumentState]):
        (-[WebCoreFrameBridge restoreDocumentState]):
        (-[WebCoreFrameBridge saveDocumentToPageCache]):
        (-[WebCoreFrameBridge _documentTypeString]):
        (-[WebCoreFrameBridge deselectAll]):
        (-[WebCoreFrameBridge reapplyStylesForDeviceType:]):
        (nowPrinting):
        (-[WebCoreFrameBridge _setupRootForPrinting:]):
        (-[WebCoreFrameBridge computePageRectsWithPrintWidthScaleFactor:printHeight:]):
        (-[WebCoreFrameBridge copyDOMTree:]):
        (-[WebCoreFrameBridge URLWithAttributeString:]):
        (-[WebCoreFrameBridge unmarkAllMisspellings]):
        (-[WebCoreFrameBridge nextKeyView]):
        (-[WebCoreFrameBridge previousKeyView]):
        (-[WebCoreFrameBridge nextKeyViewInsideWebFrameViews]):
        (-[WebCoreFrameBridge previousKeyViewInsideWebFrameViews]):
        (-[WebCoreFrameBridge DOMDocument]):
        (-[WebCoreFrameBridge baseURL]):
        (-[WebCoreFrameBridge domain]):
        (-[WebCoreFrameBridge numPendingOrLoadingRequests]):
        (-[WebCoreFrameBridge doneProcessingData]):
        (-[WebCoreFrameBridge selectionColor]):
        (-[WebCoreFrameBridge accessibilityTree]):
        (-[WebCoreFrameBridge setSelectedDOMRange:affinity:closeTyping:]):
        (-[WebCoreFrameBridge convertToNSRange:]):
        (-[WebCoreFrameBridge convertToDOMRange:]):
        (-[WebCoreFrameBridge replaceMarkedTextWithText:]):
        (-[WebCoreFrameBridge smartDeleteRangeForProposedRange:]):
        (-[WebCoreFrameBridge documentFragmentWithMarkupString:baseURLString:]):
        (-[WebCoreFrameBridge documentFragmentWithText:]):
        (-[WebCoreFrameBridge documentFragmentWithNodesAsParagraphs:]):
        (-[WebCoreFrameBridge replaceSelectionWithFragment:selectReplacement:smartReplace:matchStyle:]):
        (-[WebCoreFrameBridge insertLineBreak]):
        (-[WebCoreFrameBridge insertParagraphSeparator]):
        (-[WebCoreFrameBridge insertParagraphSeparatorInQuotedContent]):
        (-[WebCoreFrameBridge insertText:selectInsertedText:]):
        (-[WebCoreFrameBridge moveSelectionToDragCaret:smartMove:]):
        (-[WebCoreFrameBridge deleteSelectionWithSmartDelete:]):
        (-[WebCoreFrameBridge deleteKeyPressedWithSmartDelete:]):
        (-[WebCoreFrameBridge forwardDeleteKeyPressedWithSmartDelete:]):
        * khtml/ecma/kjs_html.cpp:
        (KJS::KJS::HTMLDocument::putValueProperty):
        * khtml/ecma/kjs_window.cpp:
        (KJS::createNewWindow):
        (KJS::Window::getValueProperty):
        (KJS::Window::namedItemGetter):
        (KJS::Window::getOwnPropertySlot):
        (KJS::Window::put):
        (KJS::Window::isSafeScript):
        (KJS::Window::setListener):
        (KJS::Window::getListener):
        (KJS::WindowFunc::callAsFunction):
        (KJS::Window::updateLayout):
        (KJS::ScheduledAction::execute):
        (KJS::Location::put):
        (KJS::LocationFunc::callAsFunction):
        * khtml/ecma/xmlhttprequest.cpp:
        (KJS::XMLHttpRequestProtoFunc::callAsFunction):
        * khtml/editing/jsediting.cpp:
        * khtml/html/html_baseimpl.cpp:
        (WebCore::HTMLFrameElementImpl::contentDocument):
        * khtml/html/htmltokenizer.cpp:
        (WebCore::HTMLTokenizer::scriptExecution):
        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::parentDocument):
        * khtml/xsl/xslt_processorimpl.cpp:
        (DOM::XSLTProcessorImpl::createDocumentFromSource):
        * kwq/KWQAccObject.mm:
        (-[KWQAccObject textUnderElement]):
        (-[KWQAccObject doAXTextMarkerForPosition:]):
        (-[KWQAccObject rendererForView:]):
        * kwq/KWQKJavaAppletWidget.mm:
        (KJavaAppletWidget::KJavaAppletWidget):
        * page/Frame.cpp:
        (Frame::document):
        (Frame::setDocument):
        (Frame::setFocusNodeIfNeeded):
        (Frame::isPointInsideSelection):
        (Frame::computeAndSetTypingStyle):
        (Frame::applyStyle):
        (Frame::applyParagraphStyle):
        (Frame::selectionComputedStyle):
        (Frame::selectFrameElementInParentIfFullySelected):
        (Frame::renderer):
        (Frame::scrollOverflow):
        (Frame::paint):
        (Frame::adjustPageHeight):
        (Frame::updatePolicyBaseURL):
        (Frame::setPolicyBaseURL):
        (Frame::forceLayoutWithPageWidthRange):
        (Frame::sendScrollEvent):
        (Frame::clearTimers):
        (Frame::styleForSelectionStart):
        (Frame::setSelectionFromNone):
        (Frame::setWindowHasFocus):
        (Frame::backslashAsCurrencySymbol):
        * page/Frame.h:
        * page/FrameView.cpp:
        (FrameView::~FrameView):
        (FrameView::clear):
        (FrameView::resizeEvent):
        (FrameView::adjustViewSize):
        (FrameView::layout):
        (FrameView::updateDashboardRegions):
        (FrameView::viewportMousePressEvent):
        (FrameView::viewportMouseDoubleClickEvent):
        (FrameView::viewportMouseMoveEvent):
        (FrameView::viewportMouseReleaseEvent):
        (FrameView::keyPressEvent):
        (FrameView::dispatchDragEvent):
        (FrameView::updateDragAndDrop):
        (FrameView::focusNextPrevNode):
        (FrameView::dispatchMouseEvent):
        (FrameView::viewportWheelEvent):
        (FrameView::timerEvent):
        (FrameView::scheduleRelayout):
        (FrameView::unscheduleRelayout):
        * rendering/render_frames.cpp:
        (WebCore::RenderPartObject::updateWidget):

2006-01-20  mrmacwow  <cpetersen@apple.com>

        Reviewed by eseidel.

        Build fix.

        * khtml/xml/DocumentImpl.cpp:

2006-01-20  Eric Seidel  <eseidel@apple.com>

        Reviewed by beth.

        Unbreak build (partial commit of animation patch)

        * khtml/xml/DocumentImpl.cpp:
        (WebCore::DocumentImpl::implicitClose):
        * khtml/xml/DocumentImpl.h:

2006-01-20  Eric Seidel  <eseidel@apple.com>

        Reviewed by beth.

        Missed the kcanvas directory in my previous commit.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6683

        * kcanvas/KCanvasContainer.h:
        * kcanvas/RenderForeignObject.h:
        * kcanvas/RenderSVGText.h:

2006-01-20  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Test: fast/overflow/image-selection-highlight.html

        Reviewed by Darin, committed by Adele.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6673
          Selection highlight doesn't scroll along with an image contained in an overflow:scroll block

        * rendering/render_replaced.cpp:
        (WebCore::RenderReplaced::selectionRect): Subtract the containing block's scroll offset.

2006-01-19  Eric Seidel  <eseidel@apple.com>

        Reviewed by beth.

        Break classes in render_table out into separate files.
        Move render_block to RenderBlock.
        Move render_container to RenderContainer.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6683

        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/MacFrame.mm:
        * kcanvas/KCanvasContainer.h:
        * kcanvas/RenderForeignObject.h:
        * kcanvas/RenderSVGText.h:
        * khtml/editing/visible_units.cpp:
        * khtml/html/html_tableimpl.cpp:
        (WebCore::HTMLTableElementImpl::insertRow):
        * khtml/xml/dom2_rangeimpl.cpp:
        * khtml/xml/dom_position.cpp:
        * kwq/KWQRenderTreeDebug.cpp:
        * page/Frame.cpp:
        * rendering/InlineTextBox.cpp:
        * rendering/RenderBlock.cpp: Added.
        * rendering/RenderBlock.h: Added.
        * rendering/RenderContainer.cpp: Added.
        (WebCore::RenderContainer::addChild):
        * rendering/RenderContainer.h: Added.
        * rendering/RenderTable.cpp: Added.
        (WebCore::RenderTable::RenderTable):
        (WebCore::RenderTable::updateFirstLetter):
        * rendering/RenderTable.h: Added.
        * rendering/RenderTableCell.cpp: Added.
        (WebCore::RenderTableCell::RenderTableCell):
        (WebCore::RenderTableCell::updateFromElement):
        * rendering/RenderTableCell.h: Added.
        * rendering/RenderTableCol.cpp: Added.
        (WebCore::RenderTableCol::RenderTableCol):
        (WebCore::RenderTableCol::updateFromElement):
        * rendering/RenderTableCol.h: Added.
        * rendering/RenderTableRow.cpp: Added.
        (WebCore::RenderTableRow::RenderTableRow):
        * rendering/RenderTableRow.h: Added.
        * rendering/RenderTableSection.cpp: Added.
        (WebCore::RenderTableSection::RenderTableSection):
        * rendering/RenderTableSection.h: Added.
        * rendering/RenderText.cpp:
        * rendering/bidi.cpp:
        * rendering/render_block.cpp: Removed.
        * rendering/render_block.h: Removed.
        * rendering/render_box.cpp:
        * rendering/render_canvas.h:
        * rendering/render_container.cpp: Removed.
        * rendering/render_container.h: Removed.
        * rendering/render_flexbox.h:
        * rendering/render_flow.cpp:
        * rendering/render_flow.h:
        * rendering/render_form.h:
        * rendering/render_frames.h:
        * rendering/render_inline.cpp:
        * rendering/render_inline.h:
        * rendering/render_line.cpp:
        * rendering/render_list.h:
        * rendering/render_object.cpp:
        * rendering/render_replaced.h:
        * rendering/render_table.cpp: Removed.
        * rendering/render_table.h: Removed.
        * rendering/table_layout.cpp:

2006-01-19  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        <embed> and <object> tags show up blank when going back/forward.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6679

        No test currently possible.

        * page/Frame.cpp:
        (Frame::canCachePage):

2006-01-19  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        Split html_miscimpl.* into separate files and move html_elementimpl
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6670

        * WebCore.xcodeproj/project.pbxproj:
        * bindings/objc/DOM.mm:
        * bindings/objc/DOMHTML.mm:
        * bridge/mac/WebCoreFrameBridge.mm:
        * css/css_valueimpl.cpp:
        * css/cssstyleselector.cpp:
        (WebCore::CSSStyleSelector::applyProperty):
        * khtml/ecma/kjs_dom.cpp:
        * khtml/ecma/kjs_html.cpp:
        * khtml/editing/apply_style_command.cpp:
        * khtml/editing/markup.cpp:
        * khtml/editing/replace_selection_command.cpp:
        * khtml/html/HTMLBaseFontElementImpl.cpp: Added.
        * khtml/html/HTMLBaseFontElementImpl.h: Added.
        * khtml/html/HTMLButtonElementImpl.cpp:
        * khtml/html/HTMLCollectionImpl.cpp: Added.
        (WebCore::HTMLCollectionImpl::traverseNextItem):
        * khtml/html/HTMLCollectionImpl.h: Added.
        * khtml/html/HTMLElementImpl.cpp: Added.
        * khtml/html/HTMLElementImpl.h: Added.
        * khtml/html/HTMLFieldSetElementImpl.cpp:
        * khtml/html/HTMLFormCollectionImpl.cpp: Added.
        * khtml/html/HTMLFormCollectionImpl.h: Added.
        * khtml/html/HTMLFormElementImpl.cpp:
        * khtml/html/HTMLFormElementImpl.h:
        * khtml/html/HTMLGenericFormElementImpl.cpp:
        * khtml/html/HTMLGenericFormElementImpl.h:
        * khtml/html/HTMLInputElementImpl.cpp:
        * khtml/html/HTMLIsIndexElementImpl.cpp:
        * khtml/html/HTMLLabelElementImpl.h:
        * khtml/html/HTMLLegendElementImpl.cpp:
        * khtml/html/HTMLNameCollectionImpl.cpp: Added.
        * khtml/html/HTMLNameCollectionImpl.h: Added.
        * khtml/html/HTMLOptGroupElementImpl.cpp:
        * khtml/html/HTMLOptGroupElementImpl.h:
        * khtml/html/HTMLOptionElementImpl.h:
        * khtml/html/HTMLSelectElementImpl.cpp:
        * khtml/html/HTMLTextAreaElementImpl.cpp:
        * khtml/html/html_baseimpl.cpp:
        * khtml/html/html_baseimpl.h:
        * khtml/html/html_blockimpl.cpp:
        * khtml/html/html_blockimpl.h:
        * khtml/html/html_canvasimpl.cpp:
        * khtml/html/html_documentimpl.cpp:
        * khtml/html/html_documentimpl.h:
        * khtml/html/html_elementimpl.cpp: Removed.
        * khtml/html/html_elementimpl.h: Removed.
        * khtml/html/html_headimpl.cpp:
        (WebCore::HTMLLinkElementImpl::setStyleSheet):
        (WebCore::HTMLLinkElementImpl::isLoading):
        * khtml/html/html_headimpl.h:
        * khtml/html/html_imageimpl.cpp:
        * khtml/html/html_inlineimpl.cpp:
        * khtml/html/html_inlineimpl.h:
        * khtml/html/html_listimpl.h:
        * khtml/html/html_miscimpl.cpp: Removed.
        * khtml/html/html_miscimpl.h: Removed.
        * khtml/html/html_objectimpl.cpp:
        * khtml/html/html_tableimpl.h:
        * khtml/html/htmlfactory.cpp:
        * khtml/html/htmlparser.cpp:
        * khtml/html/htmltokenizer.cpp:
        (WebCore::HTMLTokenizer::scriptHandler):
        (WebCore::HTMLTokenizer::scriptExecution):
        * khtml/xml/DocumentImpl.cpp:
        * khtml/xml/dom2_rangeimpl.cpp:
        * khtml/xml/dom_elementimpl.cpp:
        * kwq/KWQAccObject.mm:
        * loader/loader.cpp:
        * page/Frame.cpp:
        (Frame::restoreURL):
        (Frame::stopLoading):
        (Frame::receivedFirstData):
        (Frame::gotoAnchor):
        (Frame::requestObject):
        (Frame::processObjectRequest):
        (Frame::submitForm):
        (Frame::slotParentCompleted):
        (Frame::findFrame):
        (Frame::executeScript):
        * page/FrameView.cpp:
        (FrameView::useSlowRepaints):
        * rendering/render_applet.cpp:
        * rendering/render_applet.h:
        * rendering/render_box.cpp:
        (WebCore::RenderBox::contentWidth):
        (WebCore::RenderBox::paintRootBoxDecorations):
        (WebCore::RenderBox::paintBoxDecorations):
        (WebCore::RenderBox::getClipRect):
        (WebCore::RenderBox::calcWidth):
        (WebCore::RenderBox::calcHeight):
        * rendering/render_canvasimage.cpp:
        * rendering/render_canvasimage.h:
        * rendering/render_frames.cpp:
        * rendering/render_image.cpp:
        * rendering/render_image.h:
        * rendering/render_layer.cpp:

2006-01-19  Anders Carlsson  <andersca@mac.com>

        Reviewed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6653
        CSSStyleDeclaration returns empty string when trying to access shorthand 
        properties using JS accessors.
        
        * khtml/ecma/kjs_css.cpp:
        (KJS::DOMCSSStyleDeclaration::cssPropertyGetter):
        if getCSSPropertyValue returns 0 (which is true for shorthand properties), 
        try getPropertyValue instead.

2006-01-19  Adele Peterson  <adele@apple.com>

        Reviewed by Hyatt and Darin.

        http://bugzilla.opendarwin.org/show_bug.cgi?id=6665
        Implement NSView-less version of <input type="text">
        
        Initial implementation of new and improved text fields.  
        This will only be turned on if an input element has khtml-appearance: textfield.

        * WebCore.xcodeproj/project.pbxproj: Added RenderTextField.h and RenderTextField.cpp
        * css/cssvalues.in: Fixed omitted button-bevel value.  
          This was causing an off-by-one error when getting khtml-appearance value.
        * khtml/html/HTMLInputElementImpl.cpp: Added checks for khtml-appearance to decide 
          when to use RenderTextField instead of RenderLineEdit.
        (DOM::HTMLInputElementImpl::selectionStart):
        (DOM::HTMLInputElementImpl::selectionEnd):
        (DOM::HTMLInputElementImpl::setSelectionStart):
        (DOM::HTMLInputElementImpl::setSelectionEnd):
        (DOM::HTMLInputElementImpl::select):
        (DOM::HTMLInputElementImpl::setSelectionRange):
        (DOM::HTMLInputElementImpl::createRenderer):
        (DOM::HTMLInputElementImpl::defaultEventHandler):
        * khtml/html/HTMLInputElementImpl.h:
        * khtml/html/html_elementimpl.cpp:
        (HTMLElementImpl::isFocusable): Also allow editable elements with no parent to be focusable.
        * khtml/xml/NodeImpl.h:
        (WebCore::NodeImpl::setAttached): Added to set m_attached without having to call attach().
        * rendering/RenderTextField.cpp: Added.
        (khtml:::RenderBlock):
        (khtml::RenderTextField::~RenderTextField):
        (khtml::RenderTextField::addChild):
        (khtml::RenderTextField::removeChild):
        (khtml::RenderTextField::setStyle):
        (khtml::RenderTextField::getDivStyle):
        (khtml::RenderTextField::updateFromElement):
        (khtml::RenderTextField::selectionStart):
        (khtml::RenderTextField::selectionEnd):
        (khtml::RenderTextField::setSelectionStart):
        (khtml::RenderTextField::setSelectionEnd):
        (khtml::RenderTextField::select):
        (khtml::RenderTextField::setSelectionRange):
        * rendering/RenderTextField.h: Added.
        (khtml::RenderTextField::removeLeftoverAnonymousBoxes):
        (khtml::RenderTextField::renderName):
        * rendering/render_container.cpp:
        (RenderContainer::destroy): use renamed destroyLeftoverChildren.
        (RenderContainer::destroyLeftoverChildren): renamed from destroyLeftoverAnonymousChildren.
        * rendering/render_container.h:
        * rendering/render_flow.cpp:
        (RenderFlow::destroy): use renamed destroyLeftoverChildren.

2006-01-18  Darin Adler  <darin@apple.com>

        Reviewed by Hyatt.

        - removed all use of QMap

        * ForwardingHeaders/qmap.h: Removed.
        * WebCore.xcodeproj/project.pbxproj: Removed KWQMap.h, KWQMapImpl.h, KWQMapImpl.cpp.
        * kwq/KWQMap.h: Removed.
        * kwq/KWQMapImpl.cpp: Removed.
        * kwq/KWQMapImpl.h: Removed.

        * bridge/BrowserExtension.h: (WebCore::URLArgs::metaData): Converted from QMap of QString
        to HashMap of DOMString.
        * bridge/mac/BrowserExtensionMac.mm: Ditto.
        * bridge/mac/MacFrame.mm:
        (MacFrame::openURLRequest): Ditto.
        (MacFrame::urlSelected): Ditto.
        (MacFrame::createPart): Ditto.
        * khtml/ecma/kjs_window.cpp:
        (KJS::parseModalDialogFeatures): Ditto.
        (KJS::boolFeature): Ditto.
        (KJS::intFeature): Ditto.
        (KJS::createNewWindow): Ditto.
        (KJS::showModalDialog): Ditto.
        (KJS::WindowFunc::callAsFunction): Ditto.
        * khtml/html/html_objectimpl.cpp: (WebCore::HTMLAppletElementImpl::createRenderer): Ditto.
        * khtml/xml/dom_xmlimpl.cpp: (DOM::ProcessingInstructionImpl::checkStyleSheet): Ditto.
        * khtml/xml/xml_tokenizer.cpp:
        (WebCore::toString): Added. Converts to DOMString instead of QString.
        (WebCore::attributesStartElementNsHandler): Converted from QMap of QString to HashMap of DOMString.
        (WebCore::parseAttributes): Ditto.
        * khtml/xml/xml_tokenizer.h: (WebCore::Tokenizer::setTransformSource): Ditto.
        * ksvg2/misc/KSVGTimeScheduler.cpp: (KSVG::SVGTimer::notifyAll): Ditto.
        * kwq/KWQKJavaAppletWidget.h: Ditto.
        * kwq/KWQKJavaAppletWidget.mm: (KJavaAppletWidget::KJavaAppletWidget): Ditto.
        * kwq/KWQKJobClasses.h: Ditto.
        * kwq/KWQKJobClasses.mm: (KIO::TransferJob::addMetaData): Ditto.
        * page/Frame.cpp:
        (Frame::didOpenURL): Ditto.
        (Frame::changeLocation): Ditto.
        (Frame::mark): Ditto.
        (Frame::setMark): Ditto.
        (Frame::urlSelected): Ditto.
        (Frame::requestObject): Ditto.
        (Frame::processObjectRequest): Ditto.
        (Frame::submitForm): Ditto.
        * rendering/render_applet.cpp:
        (WebCore::RenderApplet::RenderApplet): Ditto.
        (WebCore::RenderApplet::createWidgetIfNecessary): Ditto.
        (WebCore::RenderApplet::layout): Ditto.
        * rendering/render_applet.h:
        (WebCore::RenderApplet::renderName): Ditto.
        (WebCore::RenderApplet::element): Ditto.
        (WebCore::RenderEmptyApplet::renderName): Ditto.

        * khtml/dom/dom_string.h:
        (WebCore::DOMString::createCFString): Added. Not yet implemented or used.
        (WebCore::DOMString::operator NSString*): Updated to call through to DOMStringImpl.
        Added hash functions and hash traits so you can use DOMString in hash tables.
        * khtml/xml/dom_stringimpl.h: Added conversion to and from CFStringRef/NSString.
        * khtml/xml/dom_stringimpl.cpp: Took out an excess "DOM::".

        * bindings/objc/DOMInternal.mm: (DOMStringImpl::operator NSString *): Moved from DOMString
        to DOMStringImpl.

        - changed the mark from a SelectionController to a Selection
          (maybe it can be a Position instead?)

        * page/Frame.h: Changed mark() and setMark() to use a Selection.
        * page/FramePrivate.h: Changed mark to a Selection.

        * bridge/mac/WebCoreFrameBridge.mm: (-[WebCoreFrameBridge setMarkDOMRange:]):
        Updated for change from SelectionController to Selection.

        - removed extraneous includes

        * kwq/KWQKHTMLSettings.h: Removed include of "KWQMap.h".
        * kwq/KWQKIOGlobal.h: Ditto.

        * khtml/editing/htmlediting.h: Removed extraneous includes and namespace prefixes.

        * khtml/html/html_canvasimpl.h: Removed extraneous includes and moved into the
        WebCore namespace.
        * khtml/html/html_canvasimpl.cpp: Ditto.
        * khtml/html/htmltokenizer.cpp: Ditto.
        * khtml/html/htmltokenizer.h: Ditto.
        * khtml/xml/DocumentImpl.cpp: Ditto.
        * kwq/KWQEditCommand.mm: Ditto.
        * rendering/render_canvasimage.h: Ditto.
        * rendering/render_image.h: Ditto.

        * khtml/editing/composite_edit_command.cpp: Updated includes because of ones
        that were removed from headers.
        * khtml/editing/htmlediting.cpp: Ditto.
        * khtml/editing/jsediting.cpp: Ditto.
        * khtml/editing/replace_selection_command.cpp: Ditto.
        * rendering/render_canvasimage.cpp: Ditto.
        * rendering/render_image.cpp: Ditto.

        * loader/loader.cpp: (WebCore::Loader::servePendingRequests): Removed code to add the
        cache control string, since that was hardcoded to empty string anyway.

2006-01-19  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin & anders.

        Fix opacity crasher for <text> and <image>.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6668
        Even though the crash is fixed, opacity still doesn't work.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6669

        * kcanvas/RenderSVGImage.cpp:
        (RenderSVGImage::paint):
        * kcanvas/RenderSVGText.cpp:
        (RenderSVGText::paint):

2006-01-19  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        Remove CFDictionary usage from KWQObject.*
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6468

        * kwq/KWQObject.cpp:
        (KWQObjectTimer::KWQObjectTimer):
        (QObject::restartTimer):
        (QObject::timerIntervals):
        (KWQObjectTimer::deleteTimer):
        (QObject::killTimer):
        (QObject::killTimers):
        (sendDeferredTimerEvent):

2006-01-18  David Hyatt <hyatt@apple.com

        Fix for bug 6657, remove all uses of MacFrame from cross-platform
        code.  Also remove uses of BrowserExtensionMac (and make the
        frame responsible for instantiation of the appropriate
        platform-specific object).

        Also #ifdef out all the Dashboard code in the engine for non-Apple
        platforms.

        Reviewed by anders

        * ForwardingHeaders/khtml_ext.h: Removed.
        * ForwardingHeaders/kparts/browserextension.h: Removed.
        * WebCore.vcproj/WebCore/WebCore.vcproj:
        * bridge/BrowserExtension.h: Added.
        (WebCore::BrowserExtension::BrowserExtension):
        * bridge/mac/BrowserExtensionMac.h: Added.
        * bridge/mac/BrowserExtensionMac.mm: Added.
        * bridge/mac/KWQKHTMLPartBrowserExtension.h: Removed.
        * bridge/mac/KWQKHTMLPartBrowserExtension.mm: Removed.
        * bridge/mac/KWQKPartsBrowserExtension.h: Removed.
        * bridge/mac/MacFrame.h:
        (MacFrame::createBrowserExtension):
        (MacFrame::markedTextRange):
        * css/css_computedstyle.cpp:
        (DOM::):
        (DOM::CSSComputedStyleDeclarationImpl::getPropertyCSSValue):
        * css/css_valueimpl.cpp:
        (WebCore::CSSPrimitiveValueImpl::cleanup):
        (WebCore::CSSPrimitiveValueImpl::cssText):
        * css/css_valueimpl.h:
        (DOM::CSSPrimitiveValueImpl::):
        * css/cssparser.cpp:
        (CSSParser::parseValue):
        * css/cssparser.h:
        * css/cssstyleselector.cpp:
        (WebCore::CSSStyleSelector::applyProperty):
        * khtml/ecma/kjs_events.cpp:
        (KJS::JSAbstractEventListener::handleEvent):
        * khtml/ecma/kjs_navigator.cpp:
        (KJS::Navigator::getValueProperty):
        * khtml/ecma/kjs_proxy.cpp:
        (KJSProxyImpl::evaluate):
        (KJSProxyImpl::initScript):
        * khtml/ecma/kjs_window.cpp:
        (KJS::canShowModalDialog):
        (KJS::canShowModalDialogNow):
        (KJS::showModalDialog):
        (KJS::Window::getValueProperty):
        (KJS::Window::scheduleClose):
        (KJS::Window::isSafeScript):
        (KJS::parseWindowFeatures):
        (KJS::constrainToVisible):
        (KJS::WindowFunc::callAsFunction):
        (KJS::ScheduledAction::execute):
        (KJS::BarInfo::getValueProperty):
        (KJS::History::getValueProperty):
        * khtml/editing/jsediting.cpp:
        * khtml/editing/typing_command.cpp:
        (khtml::TypingCommand::markMisspellingsAfterTyping):
        * khtml/html/HTMLFormElementImpl.cpp:
        (DOM::HTMLFormElementImpl::formData):
        (DOM::HTMLFormElementImpl::submit):
        * khtml/html/html_objectimpl.cpp:
        (DOM::HTMLAppletElementImpl::getAppletInstance):
        (DOM::HTMLEmbedElementImpl::getEmbedInstance):
        (DOM::HTMLObjectElementImpl::getObjectInstance):
        * khtml/xml/DocumentImpl.cpp:
        (DocumentImpl::DocumentImpl):
        (DocumentImpl::updateTitle):
        (DocumentImpl::implicitClose):
        (DocumentImpl::referrer):
        * khtml/xml/DocumentImpl.h:
        * khtml/xml/dom_elementimpl.cpp:
        (WebCore::ElementImpl::focus):
        * page/Frame.cpp:
        (Frame::init):
        (Frame::didOpenURL):
        (Frame::browserExtension):
        (Frame::begin):
        (Frame::scheduleHistoryNavigation):
        (Frame::changeLocation):
        (Frame::setSelection):
        (Frame::urlSelected):
        (Frame::requestFrameName):
        (Frame::requestObject):
        (Frame::processObjectRequest):
        (Frame::submitForm):
        (Frame::slotChildCompleted):
        (Frame::shouldChangeSelection):
        (Frame::appliedEditing):
        (Frame::unappliedEditing):
        (Frame::reappliedEditing):
        (Frame::copyToPasteboard):
        (Frame::cutToPasteboard):
        (Frame::pasteFromPasteboard):
        (Frame::pasteAndMatchStyle):
        (Frame::transpose):
        (Frame::redo):
        (Frame::undo):
        (Frame::paint):
        * page/Frame.h:
        * page/FramePrivate.h:
        * page/FrameView.cpp:
        (KHTMLView::layout):
        (KHTMLView::updateDashboardRegions):
        (KHTMLView::viewportMousePressEvent):
        (KHTMLView::viewportMouseDoubleClickEvent):
        (KHTMLView::viewportMouseMoveEvent):
        (KHTMLView::viewportMouseReleaseEvent):
        (KHTMLView::mediaType):
        (KHTMLView::viewportWheelEvent):
        * page/FrameView.h:
        * rendering/InlineTextBox.cpp:
        (khtml::InlineTextBox::paint):
        * rendering/render_form.cpp:
        * rendering/render_layer.cpp:
        (khtml::RenderLayer::scrollToOffset):
        (khtml::RenderLayer::updateScrollInfoAfterLayout):
        * rendering/render_object.cpp:
        (WebCore::RenderObject::setStyle):
        * rendering/render_replaced.cpp:

2006-01-18  Darin Adler  <darin@apple.com>

        Reviewed by Hyatt.

        - change KWQList to use qsort instead of CFArraySort

        * kwq/KWQListImpl.cpp:
        (compareFuncWrapper): Wrapper that uses global variables to overcome the lack
        of a "data" pointer in qsort. Could have used qsort_r but that would be less portable.
        (KWQListImpl::sort): Use qsort instead of CFArraySortValues.

2006-01-18  Darin Adler  <darin@apple.com>

        Reviewed by Beth.

        - changed the three signal/slot related files from ObjC++ to C++ files

        * WebCore.xcodeproj/project.pbxproj:
        * kwq/KWQSignal.cpp: Added.
        * kwq/KWQSignal.mm: Removed.
        * kwq/KWQSignalStubs.cpp: Added.
        * kwq/KWQSignalStubs.mm: Removed.
        * kwq/KWQSlot.cpp: Added.
        * kwq/KWQSlot.mm: Removed.

2006-01-18  David Hyatt <hyatt@apple.com>
        
        Make Win32 build again.  Update the scripts and deal
        with all the recent file moves.

        Reviewed by xenon

        * WebCore.vcproj/WebCore/WebCore.vcproj:
        * WebCore.vcproj/WebCore/build-generated-files.sh:
        * rendering/render_container.cpp:
        * rendering/render_object.cpp:

2006-01-18  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Test: fast/overflow/overflow-rtl-inline-scrollbar.html

        Reviewed by Hyatt.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6618
          Inline in RTL block with overflow:auto and left border makes scroll bar appear
        
        Inline flows were always returning 0 for leftmostPosition(). Their real leftmost
        edges are determined by their inline boxes, which
        RenderBlock::leftmostPosition already takes into account.

        * khtml/rendering/render_flow.cpp:
        (RenderFlow::lowestPosition): Don't descend into inline flows.
        (RenderFlow::rightmostPosition): Ditto.
        (RenderFlow::leftmostPosition): Ditto.

2006-01-18  Anders Carlsson  <andersca@mac.com>

        Fix build.
        
        * khtml/ecma/kjs_navigator.cpp:
        * page/FrameView.cpp:
        Remove kstandarddirs.h includes.
        
2006-01-18  Darin Adler  <darin@apple.com>

        Reviewed by Hyatt.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6646
          compile CSS sources in instead of reading them from disk

        * css/make-css-file-arrays.pl: Added. Used to generate C array forms of the ".css" files.
        * css/UserAgentStyleSheets.cpp: Added. Used to indirectly compile the generated file.

        * WebCore.xcodeproj/project.pbxproj: Added new source files. Added a build phase to
        invoke the make-css-file-arrays.pl script. Removed the .css files, which no longer need
        to be installed as part of the final package.

        * WebCore.vcproj/WebCore/WebCore.vcproj: Added new files.
        * WebCore.vcproj/WebCore/build-generated-files.sh: Added make-css-file-arrays.pl script
        section; not tested.

        * css/cssstyleselector.cpp: (WebCore::parseUASheet): Removed code to read user agent
        sheets from disk. Replaced with code that gets them from compiled-in arrays instead.
        Uses a pretty lame DOMString hack that could be reworked some day.
        (WebCore::CSSStyleSelector::loadDefaultStyle): Change to load from arrays intead of disk.

        * css/html4.css: Added missing license header, tweaked format a bit.
        * css/quirks.css: Added missing license header, tweaked format.
        * css/svg.css: Moved from ksvg2/css directory.
        * ksvg2/css/svg.css: Moved to top level css directory.

        * page/Frame.cpp: Removed includes of qfile.h and kstandarddirs.h.

        * ForwardingHeaders/kstandarddirs.h: Removed.
        * ForwardingHeaders/qfile.h: Removed.
        * kwq/KWQFile.h: Removed.
        * kwq/KWQFile.mm: Removed.
        * kwq/KWQKStandardDirs.h: Removed.
        * kwq/KWQKStandardDirs.mm: Removed.

2006-01-17  Alexander Kellett  <lypanov@kde.org>

        Reviewed by Maciej.

        - Remove the now-unused KRenderingPaintServerImage[Quartz].

        * WebCore.xcodeproj/project.pbxproj:
        * kcanvas/KCanvasTreeDebug.cpp:
        * kcanvas/device/KRenderingPaintServer.h:
        * kcanvas/device/KRenderingPaintServerImage.cpp: Removed.
        * kcanvas/device/KRenderingPaintServerImage.h: Removed.
        * kcanvas/device/quartz/KRenderingDeviceQuartz.mm:
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.h:
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.mm:
        * ksvg2/svg/SVGFEImageElementImpl.cpp:
        * kwq/KWQPainter.mm:

2006-01-17  Darin Adler  <darin@apple.com>

        Reviewed by John Sullivan.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6377
          <rdar://problem/4400315> All XML crashes in TOT with JavaScript disabled (6377)

        * bridge/mac/MacFrame.mm:
        (MacFrame::bindingRootObject): Assert that this is only called when JavaScript is enabled.
        (MacFrame::windowScriptObject): Return 0 if JavaScript is disabled.
        (MacFrame::windowScriptNPObject): Ditto.
        (MacFrame::partClearedInBegin): Don't call the "window script object available" call if
        JavaScript is disabled.

2006-01-17  Justin Garcia  <justin.garcia@apple.com>

        Reviewed by darin
        
        <http://bugzilla.opendarwin.org/show_bug.cgi?id=6632>
        REGRESSION: Selection includes spaces that it shouldn't
        <rdar://problem/4407845> 
        REGRESSION (TOT): blank space before found text selected at http://www.schepers.cc/comiclinks.html
        
        Layout test added:
        * editing/selection/after-line-wrap.html

        * khtml/editing/visible_position.cpp:
        (khtml::VisiblePosition::previous): Don't stop at the first candidate,
        it may be visually equivalent to the original position.
        * khtml/xml/dom_position.cpp:
        (DOM::Position::upstream): Don't move to a position on a different line.
        (DOM::Position::downstream): Ditto.

2006-01-17  Justin Garcia  <justin.garcia@apple.com>

        Reviewed by eric
        
        Deployment builds now use -O2

        * WebCore.xcodeproj/project.pbxproj:
        * khtml/html/htmltokenizer.cpp: Turned off inlining to fix
        link error.

2006-01-17  David Hyatt  <hyatt@apple.com>
       
        Move khtml/rendering to WebCore/rendering.

        * WebCore.xcodeproj/project.pbxproj:
        * khtml/rendering: Removed.
        * khtml/rendering/DataRef.h: Removed.
        * khtml/rendering/InlineTextBox.cpp: Removed.
        * khtml/rendering/InlineTextBox.h: Removed.
        * khtml/rendering/RenderText.cpp: Removed.
        * khtml/rendering/RenderText.h: Removed.
        * khtml/rendering/RenderTextFragment.cpp: Removed.
        * khtml/rendering/RenderTextFragment.h: Removed.
        * khtml/rendering/bidi.cpp: Removed.
        * khtml/rendering/bidi.h: Removed.
        * khtml/rendering/break_lines.cpp: Removed.
        * khtml/rendering/break_lines.h: Removed.
        * khtml/rendering/font.cpp: Removed.
        * khtml/rendering/font.h: Removed.
        * khtml/rendering/render_applet.cpp: Removed.
        * khtml/rendering/render_applet.h: Removed.
        * khtml/rendering/render_arena.cpp: Removed.
        * khtml/rendering/render_arena.h: Removed.
        * khtml/rendering/render_block.cpp: Removed.
        * khtml/rendering/render_block.h: Removed.
        * khtml/rendering/render_box.cpp: Removed.
        * khtml/rendering/render_box.h: Removed.
        * khtml/rendering/render_br.cpp: Removed.
        * khtml/rendering/render_br.h: Removed.
        * khtml/rendering/render_button.cpp: Removed.
        * khtml/rendering/render_button.h: Removed.
        * khtml/rendering/render_canvas.cpp: Removed.
        * khtml/rendering/render_canvas.h: Removed.
        * khtml/rendering/render_canvasimage.cpp: Removed.
        * khtml/rendering/render_canvasimage.h: Removed.
        * khtml/rendering/render_container.cpp: Removed.
        * khtml/rendering/render_container.h: Removed.
        * khtml/rendering/render_flexbox.cpp: Removed.
        * khtml/rendering/render_flexbox.h: Removed.
        * khtml/rendering/render_flow.cpp: Removed.
        * khtml/rendering/render_flow.h: Removed.
        * khtml/rendering/render_form.cpp: Removed.
        * khtml/rendering/render_form.h: Removed.
        * khtml/rendering/render_frames.cpp: Removed.
        * khtml/rendering/render_frames.h: Removed.
        * khtml/rendering/render_image.cpp: Removed.
        * khtml/rendering/render_image.h: Removed.
        * khtml/rendering/render_inline.cpp: Removed.
        * khtml/rendering/render_inline.h: Removed.
        * khtml/rendering/render_layer.cpp: Removed.
        * khtml/rendering/render_layer.h: Removed.
        * khtml/rendering/render_line.cpp: Removed.
        * khtml/rendering/render_line.h: Removed.
        * khtml/rendering/render_list.cpp: Removed.
        * khtml/rendering/render_list.h: Removed.
        * khtml/rendering/render_object.cpp: Removed.
        * khtml/rendering/render_object.h: Removed.
        * khtml/rendering/render_replaced.cpp: Removed.
        * khtml/rendering/render_replaced.h: Removed.
        * khtml/rendering/render_style.cpp: Removed.
        * khtml/rendering/render_style.h: Removed.
        * khtml/rendering/render_table.cpp: Removed.
        * khtml/rendering/render_table.h: Removed.
        * khtml/rendering/render_theme.cpp: Removed.
        * khtml/rendering/render_theme.h: Removed.
        * khtml/rendering/render_theme_mac.h: Removed.
        * khtml/rendering/render_theme_mac.mm: Removed.
        * khtml/rendering/table_layout.cpp: Removed.
        * khtml/rendering/table_layout.h: Removed.
        * rendering: Added.
        * rendering/DataRef.h: Added.
        * rendering/InlineTextBox.cpp: Added.
        * rendering/InlineTextBox.h: Added.
        * rendering/RenderText.cpp: Added.
        * rendering/RenderText.h: Added.
        * rendering/RenderTextFragment.cpp: Added.
        * rendering/RenderTextFragment.h: Added.
        * rendering/bidi.cpp: Added.
        * rendering/bidi.h: Added.
        * rendering/break_lines.cpp: Added.
        * rendering/break_lines.h: Added.
        * rendering/font.cpp: Added.
        * rendering/font.h: Added.
        * rendering/render_applet.cpp: Added.
        * rendering/render_applet.h: Added.
        * rendering/render_arena.cpp: Added.
        * rendering/render_arena.h: Added.
        * rendering/render_block.cpp: Added.
        * rendering/render_block.h: Added.
        * rendering/render_box.cpp: Added.
        * rendering/render_box.h: Added.
        * rendering/render_br.cpp: Added.
        * rendering/render_br.h: Added.
        * rendering/render_button.cpp: Added.
        * rendering/render_button.h: Added.
        * rendering/render_canvas.cpp: Added.
        * rendering/render_canvas.h: Added.
        * rendering/render_canvasimage.cpp: Added.
        * rendering/render_canvasimage.h: Added.
        * rendering/render_container.cpp: Added.
        * rendering/render_container.h: Added.
        * rendering/render_flexbox.cpp: Added.
        * rendering/render_flexbox.h: Added.
        * rendering/render_flow.cpp: Added.
        * rendering/render_flow.h: Added.
        * rendering/render_form.cpp: Added.
        * rendering/render_form.h: Added.
        * rendering/render_frames.cpp: Added.
        * rendering/render_frames.h: Added.
        * rendering/render_image.cpp: Added.
        * rendering/render_image.h: Added.
        * rendering/render_inline.cpp: Added.
        * rendering/render_inline.h: Added.
        * rendering/render_layer.cpp: Added.
        * rendering/render_layer.h: Added.
        * rendering/render_line.cpp: Added.
        * rendering/render_line.h: Added.
        * rendering/render_list.cpp: Added.
        * rendering/render_list.h: Added.
        * rendering/render_object.cpp: Added.
        * rendering/render_object.h: Added.
        * rendering/render_replaced.cpp: Added.
        * rendering/render_replaced.h: Added.
        * rendering/render_style.cpp: Added.
        * rendering/render_style.h: Added.
        * rendering/render_table.cpp: Added.
        * rendering/render_table.h: Added.
        * rendering/render_theme.cpp: Added.
        * rendering/render_theme.h: Added.
        * rendering/render_theme_mac.h: Added.
        * rendering/render_theme_mac.mm: Added.
        * rendering/table_layout.cpp: Added.
        * rendering/table_layout.h: Added.

2006-01-17  David Hyatt  <hyatt@apple.com>

        Land support for a style method on DOMAttr from JS that will
        allow the Web Inspector to include presentational attributes
        in the style list.
        
        Reviewed by xenon

        * khtml/ecma/kjs_dom.cpp:
        (KJS::DOMAttr::getValueProperty):
        * khtml/ecma/kjs_dom.h:
        (KJS::DOMAttr::):

2006-01-17  Beth Dakin  <bdakin@apple.com>

        Reviewed by Hyatt and Darin

        Fix for <rdar://problem/4405836> REGRESSION: crash at webmail.aol.com 
        when deleting mail in khtml::RenderTableCell::collapsedBottomBorder() const 
        + 232

        RenderTableCell::collapsedBottomBorder() gets nextCell by calling 
        table()->cellBelow(this). In the case of the crash, cellBelow() returns 
        a pointer to a table cell that was already destroyed. cellBelow() thinks 
        that the pointer is still good because the grid of cells has not been updated 
        because all of this code is called through the hitTest and the hitTest does 
        not update the layout. The fix that I have is simply it have the hitTest call 
        updateLayout(). This is the only change in behavior. The rest of the patch 
        preserves behavior for simulated clicks. fast/events/stopPropagation-submit 
        caught this problem that arose from calling updateLayout() in the hitTest; 
        we should always have an x and y position of 0 for simulated clicks. This 
        preserves that behavior by keeping track of whether a click is simulated or not.

        * khtml/html/HTMLInputElementImpl.cpp:
        (DOM::HTMLInputElementImpl::defaultEventHandler): If the click is simulated, 
        set xPos and yPos to 0.
        * khtml/html/html_elementimpl.cpp:
        (HTMLElementImpl::setContentEditable): Fix spacing.
        (HTMLElementImpl::click): It isn't necessary to check if there is a renderer.
        * khtml/rendering/render_layer.cpp:
        (khtml::RenderLayer::hitTest): Call updateLayout().
        * khtml/xml/NodeImpl.cpp:
        (WebCore::NodeImpl::dispatchSimulatedMouseEvent): Set isSimulated to true.
        (WebCore::NodeImpl::dispatchMouseEvent): Keep track of isSimulated.
        * khtml/xml/NodeImpl.h: Same.
        * khtml/xml/dom2_eventsimpl.cpp:
        (DOM::MouseRelatedEventImpl::MouseRelatedEventImpl): Add isSimulated to
        MouseRelatedEventImpl().
        (DOM::MouseRelatedEventImpl::computePositions): Only change the offsets if 
        it's not simulated.
        (DOM::MouseEventImpl::MouseEventImpl): Add isSimulated to MouseEventImpl()
        * khtml/xml/dom2_eventsimpl.h: 
        (DOM::MouseRelatedEventImpl::isSimulated): Declarations of isSimulated
        (DOM::MouseEventImpl::isSimulated): Same.

2006-01-17  Duncan Wilcox  <duncan@mclink.it>

        Reviewed by Darin, landed by ap.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6609
          Use Selection instead of SelectionController where possible

        This patch replaces the use of SelectionController with Selection in the edit commands.

        It also cleans up the relationship between Selection and SelectionController: 
        SelectionController used to need to be friend to Selection to call validate() 
        on it, now validation is enforced on every update of Selection.

        * khtml/editing/Selection.cpp:
        (WebCore::Selection::Selection):
        (WebCore::Selection::expandUsingGranularity):
        (WebCore::Selection::validate):
        * khtml/editing/Selection.h:
        (WebCore::Selection::setExtent):
        (WebCore::Selection::granularity):
        (WebCore::operator==):
        * khtml/editing/SelectionController.cpp:
        (WebCore::SelectionController::SelectionController):
        (WebCore::SelectionController::moveTo):
        (WebCore::SelectionController::expandUsingGranularity):
        (WebCore::SelectionController::clear):
        (WebCore::SelectionController::setBase):
        (WebCore::SelectionController::setExtent):
        * khtml/editing/SelectionController.h:
        (WebCore::SelectionController::selection):
        * khtml/editing/apply_style_command.cpp:
        (WebCore::ApplyStyleCommand::updateStartEnd):
        (WebCore::ApplyStyleCommand::doApply):
        * khtml/editing/break_blockquote_command.cpp:
        (khtml::BreakBlockquoteCommand::doApply):
        * khtml/editing/composite_edit_command.cpp:
        (WebCore::CompositeEditCommand::deleteSelection):
        (WebCore::CompositeEditCommand::rebalanceWhitespace):
        * khtml/editing/composite_edit_command.h:
        * khtml/editing/delete_selection_command.cpp:
        (WebCore::DeleteSelectionCommand::DeleteSelectionCommand):
        (WebCore::DeleteSelectionCommand::calculateTypingStyleAfterDelete):
        (WebCore::DeleteSelectionCommand::clearTransientState):
        (WebCore::DeleteSelectionCommand::doApply):
        * khtml/editing/delete_selection_command.h:
        * khtml/editing/edit_command.cpp:
        (WebCore::EditCommandPtr::startingSelection):
        (WebCore::EditCommandPtr::endingSelection):
        (WebCore::EditCommandPtr::setStartingSelection):
        (WebCore::EditCommandPtr::setEndingSelection):
        (WebCore::EditCommand::EditCommand):
        (WebCore::EditCommand::setStartingSelection):
        (WebCore::EditCommand::setEndingSelection):
        * khtml/editing/edit_command.h:
        (WebCore::EditCommand::startingSelection):
        (WebCore::EditCommand::endingSelection):
        * khtml/editing/insert_line_break_command.cpp:
        (khtml::InsertLineBreakCommand::doApply):
        * khtml/editing/insert_paragraph_separator_command.cpp:
        (khtml::InsertParagraphSeparatorCommand::doApply):
        * khtml/editing/insert_text_command.cpp:
        (khtml::InsertTextCommand::input):
        * khtml/editing/move_selection_command.cpp:
        (khtml::MoveSelectionCommand::doApply):
        * khtml/editing/replace_selection_command.cpp:
        (khtml::ReplaceSelectionCommand::doApply):
        (khtml::ReplaceSelectionCommand::completeHTMLReplacement):
        * khtml/editing/typing_command.cpp:
        (khtml::TypingCommand::deleteKeyPressed):
        (khtml::TypingCommand::forwardDeleteKeyPressed):
        * page/Frame.cpp:
        (Frame::appliedEditing):
        (Frame::unappliedEditing):
        (Frame::reappliedEditing):
        * page/Frame.h:

2006-01-17  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Test: fast/dom/generic-form-element-assert.html

        Reviewed and reworked by Darin.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5926
          Assertion failure in HTMLGenericFormElementImpl::removedFromTree

        * khtml/html/HTMLGenericFormElementImpl.cpp: Tweaked formatting and namespaces
        a bit. Removed unneeded includes.
        (WebCore::findRoot): Added helper function.
        (WebCore::HTMLGenericFormElementImpl::removedFromTree): Rewrote to do the check
        in a simpler way, since the two separate cases amounted to the same check.

2006-01-17  Mark Rowe  <opendarwin.org@bdash.net.nz>

        Reviewed by eseidel.

        Fix second part of WebCore-no-SVG fails to build.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6607

        * WebCore.xcodeproj/project.pbxproj:
        Mark three headers as private rather than project in the WebCore-no-SVG target.

2006-01-17  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by hyatt

        * kwq/KWQVectorImpl.cpp:
        (KWQVectorImpl::append): Assign the new item to index m_count, not m_size.

2006-01-17  Mark Rowe  <opendarwin.org@bdash.net.nz>

        Reviewed by eseidel.

        WebCore-no-SVG fails to build.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6607

        * WebCore.xcodeproj/project.pbxproj:
        Fix build of WebCore-no-SVG target.  Removes SVG specific files and adds new
        files omitted from the target.

2006-01-16  David Hyatt  <hyatt@apple.com>

        (1) Fix build bustage by properly marking the moved Obj-C
        bindings files as private.
        (2) Move khtml/css to WebCore/css.
        (3) Eliminate the kdom/css forwarding headers.

        * ForwardingHeaders/kdom/css: Removed.
        * ForwardingHeaders/kdom/css/CSSPrimitiveValueImpl.h: Removed.
        * ForwardingHeaders/kdom/css/CSSStyleDeclarationImpl.h: Removed.
        * ForwardingHeaders/kdom/css/CSSStyleRuleImpl.h: Removed.
        * ForwardingHeaders/kdom/css/CSSStyleSelector.h: Removed.
        * ForwardingHeaders/kdom/css/CSSStyleSheetImpl.h: Removed.
        * ForwardingHeaders/kdom/css/CSSValueImpl.h: Removed.
        * ForwardingHeaders/kdom/css/CSSValueListImpl.h: Removed.
        * ForwardingHeaders/kdom/css/KDOMCSSParser.h: Removed.
        * ForwardingHeaders/kdom/css/MediaListImpl.h: Removed.
        * ForwardingHeaders/kdom/css/RGBColorImpl.h: Removed.
        * ForwardingHeaders/kdom/css/RenderStyle.h: Removed.
        * ForwardingHeaders/kdom/css/StyleSheetListImpl.h: Removed.
        * WebCore+SVG/RGBColorImpl.cpp:
        * WebCore.xcodeproj/project.pbxproj:
        * css: Added.
        * css/css_base.cpp: Added.
        * css/css_base.h: Added.
        * css/css_computedstyle.cpp: Added.
        * css/css_computedstyle.h: Added.
        * css/css_grammar.y: Added.
        * css/css_ruleimpl.cpp: Added.
        * css/css_ruleimpl.h: Added.
        * css/css_stylesheetimpl.cpp: Added.
        * css/css_stylesheetimpl.h: Added.
        * css/css_valueimpl.cpp: Added.
        * css/css_valueimpl.h: Added.
        * css/csshelper.cpp: Added.
        * css/csshelper.h: Added.
        * css/cssparser.cpp: Added.
        * css/cssparser.h: Added.
        * css/cssproperties.in: Added.
        * css/cssstyleselector.cpp: Added.
        * css/cssstyleselector.h: Added.
        * css/cssvalues.in: Added.
        * css/html4.css: Added.
        * css/makeprop: Added.
        * css/maketokenizer: Added.
        * css/makevalues: Added.
        * css/quirks.css: Added.
        * css/tokenizer.flex: Added.
        * khtml/css: Removed.
        * khtml/css/css_base.cpp: Removed.
        * khtml/css/css_base.h: Removed.
        * khtml/css/css_computedstyle.cpp: Removed.
        * khtml/css/css_computedstyle.h: Removed.
        * khtml/css/css_grammar.y: Removed.
        * khtml/css/css_ruleimpl.cpp: Removed.
        * khtml/css/css_ruleimpl.h: Removed.
        * khtml/css/css_stylesheetimpl.cpp: Removed.
        * khtml/css/css_stylesheetimpl.h: Removed.
        * khtml/css/css_valueimpl.cpp: Removed.
        * khtml/css/css_valueimpl.h: Removed.
        * khtml/css/csshelper.cpp: Removed.
        * khtml/css/csshelper.h: Removed.
        * khtml/css/cssparser.cpp: Removed.
        * khtml/css/cssparser.h: Removed.
        * khtml/css/cssproperties.in: Removed.
        * khtml/css/cssstyleselector.cpp: Removed.
        * khtml/css/cssstyleselector.h: Removed.
        * khtml/css/cssvalues.in: Removed.
        * khtml/css/html4.css: Removed.
        * khtml/css/makeprop: Removed.
        * khtml/css/maketokenizer: Removed.
        * khtml/css/makevalues: Removed.
        * khtml/css/quirks.css: Removed.
        * khtml/css/tokenizer.flex: Removed.
        * ksvg2/css/SVGCSSStyleSelector.cpp:
        * ksvg2/ecma/Ecma.cpp:
        * ksvg2/misc/KCanvasRenderingStyle.cpp:
        * ksvg2/misc/KCanvasRenderingStyle.h:
        * ksvg2/svg/SVGAnimationElementImpl.cpp:
        * ksvg2/svg/SVGClipPathElementImpl.cpp:
        * ksvg2/svg/SVGColorImpl.cpp:
        * ksvg2/svg/SVGColorImpl.h:
        * ksvg2/svg/SVGDOMImplementationImpl.cpp:
        * ksvg2/svg/SVGDocumentImpl.cpp:
        * ksvg2/svg/SVGElementImpl.cpp:
        * ksvg2/svg/SVGGradientElementImpl.cpp:
        * ksvg2/svg/SVGMaskElementImpl.cpp:
        * ksvg2/svg/SVGStyleElementImpl.cpp:
        * ksvg2/svg/SVGStyledElementImpl.h:
        * ksvg2/svg/SVGTextElementImpl.cpp:

2006-01-16  David Hyatt  <hyatt@apple.com>

        Move the Objective-C dom bindings from kwq to bindings/objc.

        Reviewed by eseidel

        * WebCore.xcodeproj/project.pbxproj:
        * bindings: Added.
        * bindings/js: Added.
        * bindings/objc: Added.
        * bindings/objc/DOM.h: Added.
        * bindings/objc/DOM.mm: Added.
        * bindings/objc/DOMCSS.h: Added.
        * bindings/objc/DOMCSS.mm: Added.
        * bindings/objc/DOMCore.h: Added.
        * bindings/objc/DOMEvents.h: Added.
        * bindings/objc/DOMEvents.mm: Added.
        * bindings/objc/DOMEventsInternal.h: Added.
        * bindings/objc/DOMExtensions.h: Added.
        * bindings/objc/DOMHTML.h: Added.
        * bindings/objc/DOMHTML.mm: Added.
        * bindings/objc/DOMHTMLInternal.h: Added.
        * bindings/objc/DOMInternal.h: Added.
        * bindings/objc/DOMInternal.mm: Added.
        * bindings/objc/DOMPrivate.h: Added.
        * bindings/objc/DOMRange.h: Added.
        * bindings/objc/DOMStylesheets.h: Added.
        * bindings/objc/DOMTraversal.h: Added.
        * bindings/objc/DOMUtility.mm: Added.
        * bindings/objc/DOMViews.h: Added.
        * bindings/objc/DOMViews.mm: Added.
        * bindings/objc/DOMViewsInternal.h: Added.
        * kwq/DOM-CSS.mm: Removed.
        * kwq/DOM.h: Removed.
        * kwq/DOM.mm: Removed.
        * kwq/DOMCSS.h: Removed.
        * kwq/DOMCore.h: Removed.
        * kwq/DOMEvents.h: Removed.
        * kwq/DOMEvents.mm: Removed.
        * kwq/DOMEventsInternal.h: Removed.
        * kwq/DOMExtensions.h: Removed.
        * kwq/DOMHTML.h: Removed.
        * kwq/DOMHTML.mm: Removed.
        * kwq/DOMHTMLInternal.h: Removed.
        * kwq/DOMInternal.h: Removed.
        * kwq/DOMInternal.mm: Removed.
        * kwq/DOMPrivate.h: Removed.
        * kwq/DOMRange.h: Removed.
        * kwq/DOMStylesheets.h: Removed.
        * kwq/DOMTraversal.h: Removed.
        * kwq/DOMUtility.mm: Removed.
        * kwq/DOMViews.h: Removed.
        * kwq/DOMViews.mm: Removed.
        * kwq/DOMViewsInternal.h: Removed.

2006-01-16  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Hyatt, landed by ap.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6473
          REGRESSION: Serious painting problems on new iLife and iWorks pages

        * khtml/css/css_grammar.y:
        (DOM::getPropertyID): Undo the mapping of -moz-opacity and -moz-border-radius to
        opacity and border-radius, respectively.
        * khtml/rendering/render_box.cpp:
        (RenderBox::setStyle): Set the object's layer to 0 before removing the layer,
        to allow child layers to update their positions correctly.
        * khtml/rendering/render_layer.cpp:
        (khtml::RenderLayer::removeOnlyThisLayer): Update the positions of all children
        of the layer being removed.
        * manual-tests/bugzilla-6473.html: Added.

2006-01-16  Mark Rowe  <opendarwin.org@bdash.net.nz>

        Reviewed by Darin, landed by ap.

        Fix typo in CSSPrimitiveValueImpl::setStringValue.

        * khtml/css/css_valueimpl.cpp:
        (DOM::CSSPrimitiveValueImpl::setStringValue): Change >> to > and fix formatting.

2006-01-16  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Justin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5401
          [WebCoreBridge firstRectForDOMRange:] works incorrectly for the first character after a line wrap

        Test: editing/input/wrapped-line-char-rect.html

        * bridge/mac/WebCoreFrameBridge.mm: (-[WebCoreFrameBridge firstRectForDOMRange:]):
         Use DOWNSTREAM affinity for the range start

2006-01-16  Justin Garcia  <justin.garcia@apple.com>

        Reviewed by darin
        
        <http://bugzilla.opendarwin.org/show_bug.cgi?id=5127>
        REGRESSION: problems making selection with left edge at right edge of image
        <rdar://problem/4364427>
        triple-click includes first item on next line (www.apple.com, but I think I've seen it elsewhere)
        
        Don't paint the selection tint on replaced elements
        if the selections starts at the end or ends at the start.

        * khtml/rendering/render_image.cpp:
        (RenderImage::paint):
        * khtml/rendering/render_replaced.cpp:
        (WebCore::RenderReplaced::isSelected):
        (WebCore::RenderWidget::paint):
        * khtml/rendering/render_replaced.h:

2006-01-16  Tim Omernick  <timo@apple.com>

        Reviewed by John Sullivan.

        WebCore part of <rdar://problem/4211707> NPAPI ref count behavior differs with Mozilla

        * bridge/mac/MacFrame.mm:
        (MacFrame::setView):
        Call _NPN_DeallocateObject() instead of _NPN_ReleaseObject() so that we don't leak if a plugin fails to release
        the window script object properly.
        Our old NPN_GetValue() did not properly retain the returned window script object.  Because of this, many plugins
        have WebKit-specific workarounds to not release said window script object.  Forcibly deallocating it here
        should prevent any such issues.  This shouldn't cause any problems for plugins, since they should already be
        stopped and destroyed at this point.
        This also fixes a preexisting leak of the window script NPObject -- it was never actually being freed!

2006-01-16  Darin Adler  <darin@apple.com>

        - actually removed QPtrDict itself

        * ForwardingHeaders/qptrdict.h: Removed.
        * WebCore.xcodeproj/project.pbxproj: Removed KWQPtrDict* files.
        * kwq/KWQPtrDict.h: Removed.
        * kwq/KWQPtrDictImpl.cpp: Removed.
        * kwq/KWQPtrDictImpl.h: Removed.

2006-01-16  Darin Adler  <darin@apple.com>

        Reviewed by John Sullivan.

        - removed all uses of QPtrDict, most uses of QMap

        * khtml/ecma/kjs_dom.cpp: Converted tabs to spaces.
        (KJS::DOMNode::mark): Switched from QPtrDict to HashSet.
        * khtml/ecma/kjs_events.cpp: Converted tabs to spaces.
        (KJS::JSUnprotectedEventListener::JSUnprotectedEventListener): Use HashMap.
        (KJS::JSEventListener::JSEventListener): Use HashMap.
        (KJS::JSLazyEventListener::parseCode): Use HashMap.
        * khtml/ecma/kjs_html.cpp: Convert tabs to spaces.
        (KJS::KJS::HTMLElement::classInfo): Use HashMap.
        * khtml/ecma/kjs_window.cpp: Convert tabs to spaces.
        (KJS::Window::~Window): Use HashMap.
        (KJS::Window::getJSEventListener): Ditto.
        (KJS::Window::getJSUnprotectedEventListener): Ditto.
        (KJS::WindowQObject::parentDestroyed): Ditto.
        (KJS::WindowQObject::installTimeout): Ditto.
        (KJS::WindowQObject::pauseTimeouts): Ditto.
        (KJS::WindowQObject::resumeTimeouts): Ditto.
        (KJS::WindowQObject::clearTimeout): Ditto.
        (KJS::WindowQObject::timerEvent): Ditto.
        * khtml/ecma/kjs_window.h: Use HashMap.
        * khtml/ecma/xmlhttprequest.cpp: Convert tabs to spaces.
        (KJS::XMLHttpRequest::requestsByDocument): Use HashMap/Set.
        (KJS::XMLHttpRequest::addToRequestsByDocument): Ditto.
        (KJS::XMLHttpRequest::removeFromRequestsByDocument): Ditto.
        (KJS::XMLHttpRequest::cancelRequests): Ditto.
        * khtml/ecma/xmlhttprequest.h: Ditto.
        * khtml/editing/apply_style_command.cpp:
        (WebCore::ApplyStyleCommand::applyRelativeFontStyleChange): Use HashMap.
        * khtml/rendering/render_canvas.cpp:
        (RenderCanvas::selectionRect): Use HashMap.
        (RenderCanvas::setSelection): Ditto.
        * khtml/rendering/render_flow.cpp: (RenderFlow::paintLines): Use HashSet.
        * khtml/rendering/render_line.cpp: (khtml::InlineFlowBox::paint): Use HashSet.
        * khtml/rendering/render_object.h: Used HashSet.
        Converted tabs to spaces and did namespace changes too.
        * khtml/xml/DocumentImpl.cpp:
        (DocumentImpl::DocumentImpl): Use HashSet and HashMap.
        (DocumentImpl::~DocumentImpl): Ditto.
        (DocumentImpl::registerDisconnectedNodeWithEventListeners): Ditto.
        (DocumentImpl::unregisterDisconnectedNodeWithEventListeners): Ditto.
        (DocumentImpl::removeAllDisconnectedNodeEventListeners): Ditto.
        (DocumentImpl::addImageMap): Ditto.
        (DocumentImpl::removeImageMap): Ditto.
        (DocumentImpl::getImageMap): Ditto.
        (DocumentImpl::addMarker): Ditto.
        (DocumentImpl::copyMarkers): Ditto.
        (DocumentImpl::removeMarkers): Ditto.
        (DocumentImpl::markersForNode): Ditto.
        (DocumentImpl::shiftMarkers): Ditto.
        (DocumentImpl::radioButtonChecked): Ditto.
        (DocumentImpl::checkedRadioButtonForGroup): Ditto.
        (DocumentImpl::removeRadioButtonGroup): Ditto.
        * khtml/xml/DocumentImpl.h: Use HashSet and HashMap.
        * khtml/xml/NodeImpl.cpp:
        (WebCore::NodeImpl::registerNodeList): Use HashSet.
        (WebCore::NodeImpl::unregisterNodeList): Ditto.
        (WebCore::NodeImpl::notifyLocalNodeListsAttributeChanged): Ditto.
        (WebCore::NodeImpl::notifyNodeListsAttributeChanged): Ditto.
        (WebCore::NodeImpl::notifyLocalNodeListsChildrenChanged): Ditto.
        (WebCore::NodeImpl::notifyNodeListsChildrenChanged): Ditto.
        (WebCore::NodeImpl::getElementsByTagName): Moved here so we don't have
        to include NodeListImpl.h in the header.
        * khtml/xml/NodeImpl.h: Use HashSet. Reduced includes.
        * khtml/xml/dom_elementimpl.cpp:
        (WebCore::MappedAttributeKey): Added. Hash table key.
        (WebCore::MappedAttributeKeyTraits): Added. Hash table key traits.
        (WebCore::MappedAttributeHash): Added. Hash function.
        (WebCore::StyledElementImpl::getMappedAttributeDecl): Use HashMap.
        (WebCore::StyledElementImpl::setMappedAttributeDecl): Ditto.
        (WebCore::StyledElementImpl::removeMappedAttributeDecl): Ditto.
        (WebCore::MappedAttributeHash::hash): Added. Hash function.
        * khtml/xml/dom_elementimpl.h: Use HashMap.

        * khtml/html/html_imageimpl.cpp:
        (WebCore::HTMLMapElementImpl::parseMappedAttribute): Update m_name handling
        to use AtomicString.
        * khtml/html/html_imageimpl.h:
        (WebCore::HTMLMapElementImpl::getName): Change to return const AtomicString&.

        * khtml/dom/dom_string.h: Added a default argument to substring, also
        reduced includes and updated namespace.
        * khtml/xml/dom_stringimpl.h: Ditto.

        * bridge/mac/WebCoreFrameBridge.mm: Switched to new WebCore namespace.
        Updated includes for header changes.
        * kcanvas/RenderForeignObject.cpp: Ditto.
        * kcanvas/RenderForeignObject.h: Ditto.
        * kcanvas/RenderSVGImage.h: Ditto.
        * kcanvas/device/quartz/KCanvasResourcesQuartz.h: Ditto.
        * khtml/css/css_ruleimpl.cpp: Ditto.
        * khtml/css/css_valueimpl.h: Ditto.
        * khtml/ecma/kjs_dom.h: Ditto.
        * khtml/ecma/kjs_html.h: Ditto.
        * khtml/editing/composite_edit_command.cpp: Ditto.
        * khtml/editing/delete_selection_command.cpp: Ditto.
        * khtml/html/html_tableimpl.cpp: Ditto.
        * khtml/khtml_events.cpp: Ditto.
        * khtml/rendering/RenderText.cpp: Ditto.
        * khtml/rendering/render_block.cpp: Ditto.
        * khtml/rendering/render_br.cpp: Ditto.
        * khtml/rendering/render_inline.cpp: Ditto.
        * khtml/rendering/render_object.cpp: Ditto.
        * khtml/rendering/render_replaced.cpp: Ditto.
        * khtml/xml/dom2_rangeimpl.cpp: Ditto.
        * kwq/DOM.mm: Ditto.
        * page/Frame.cpp: Ditto.

        * kcanvas/KCanvasResources.cpp: (KCanvasMarker::draw): Updated because a
        constant moved into the WebCore namespace.
        * kcanvas/RenderSVGText.cpp: (RenderSVGText::nodeAtPoint): Ditto.
        * kcanvas/RenderSVGText.h: Ditto.
        * kcanvas/device/quartz/KCanvasItemQuartz.h: Ditto.
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (KCanvasItemQuartz::paint): Ditto.
        (KCanvasItemQuartz::nodeAtPoint): Ditto.
        * kcanvas/device/quartz/KCanvasResourcesQuartz.mm:
        (KCanvasContainerQuartz::paint): Ditto.

        * khtml/xbl/xbl_binding_manager.cpp: Removed include of qptrddict.h.
        * khtml/xbl/xbl_binding_manager.h: Removed include of qptrddict.h.
        * khtml/xbl/xbl_docimpl.h: Removed include of qptrddict.h.

        * khtml/xml/dom_xmlimpl.cpp: Changed to use RefPtr for strings.
        * khtml/xml/dom_xmlimpl.h: Ditto.

        * ksvg2/css/SVGRenderStyle.h: Reduced includes a bit and added newly-needed ones.
        * ksvg2/misc/KSVGTimeScheduler.cpp: Ditto.
        * ksvg2/svg/SVGPointImpl.cpp: Ditto.

        * kwq/KWQNamespace.h: Removed QColor, QCursor, and redundant declaration of QRgb
        (now in qcolor.h). Also converted tabs to spaces.

        * kwq/KWQPainter.h: Added newly-needed include.

        * kwq/KWQPtrVector.h: Added append function.
        * kwq/KWQVectorImpl.cpp: (KWQVectorImpl::append): Added.
        * kwq/KWQVectorImpl.h: Added append.

        * kwq/KWQRenderTreeDebug.cpp: Updated to no longer use transparentColor constant.

        * kwq/KWQWMatrix.cpp: Changed name to QMatrix to allow forward declarations.
        * kwq/KWQWMatrix.h: Ditto.

        * loader/Cache.cpp: (khtml::Cache::clear): Use deleteAllValues for clearer code.

        * loader/CachedCSSStyleSheet.cpp: Reduced includes a lot, moving them from .h to .cpp.
        * loader/CachedCSSStyleSheet.h: Ditto.
        * loader/CachedImage.cpp: Ditto.
        * loader/CachedImage.h: Ditto.
        * loader/CachedImageCallback.cpp: Ditto.
        * loader/CachedObject.cpp: Ditto.
        * loader/CachedObject.h: Ditto.
        * loader/CachedObjectClient.h: Ditto.
        * loader/CachedObjectClientWalker.cpp: Ditto.
        * loader/CachedObjectClientWalker.h: Ditto.
        * loader/CachedScript.cpp: Ditto.
        * loader/CachedScript.h: Ditto.
        * loader/CachedXSLStyleSheet.cpp: Ditto.

        * loader/loader.cpp:
        (WebCore::Loader::Loader): Changed to use HashMap.
        (WebCore::Loader::~Loader): Ditto.
        (WebCore::Loader::servePendingRequests): Ditto.
        (WebCore::Loader::slotFinished): Ditto.
        (WebCore::Loader::slotReceivedResponse): Ditto.
        (WebCore::Loader::slotData): Ditto.
        (WebCore::Loader::numRequests): Ditto.
        (WebCore::Loader::cancelRequests): Ditto.
        (WebCore::Loader::jobForRequest): Ditto.
        * loader/loader.h: Ditto.

2006-01-16  Darin Adler  <darin@apple.com>

        * WebCore.xcodeproj/project.pbxproj: Move config.h in project file to match
        where it is in the source tree.

2006-01-15  Timothy Hatcher  <timothy@apple.com>

        Reviewed by Darin.

        Support for the new DOM Inspector.

        * khtml/ecma/kjs_dom.cpp: exposes scrollIntoViewIfNeeded to JS
        * khtml/ecma/kjs_dom.h:
        * khtml/rendering/RenderText.cpp:
        (RenderText::lineBoxRects): returns text run rects
        * khtml/rendering/RenderText.h:
        * khtml/rendering/render_container.cpp:
        (RenderContainer::lineBoxRects): returns all child line box rects
        * khtml/rendering/render_container.h:
        * khtml/rendering/render_object.cpp:
        (RenderObject::lineBoxRects): returns an empty list
        * khtml/rendering/render_object.h:
        * khtml/xml/dom_elementimpl.cpp:
        (ElementImpl::scrollIntoViewIfNeeded): scrolls only if needed, bool decides to center to align to nearest edge
        * khtml/xml/dom_elementimpl.h: Ditto
        * kwq/DOM.mm:
        (-[DOMNode boundingBox]): returns the bounding box for a node
        (-[DOMNode lineBoxRects]): returns text runs for a node
        * kwq/DOMCore.h: added missing @protocol DOMEventListener and @class DOMEvent
        * kwq/DOMExtensions.h: removes methods that haven't been API reviewed
        * kwq/DOMPrivate.h: new pending public API added for the Inspector

2006-01-15  Darin Adler  <darin@apple.com>

        Reviewed by Eric.

        - changed WebCore namespace change to work on Win32 as well as Mac OS X

        * WebCorePrefix.h: Removed things needed cross-platform.

        * config.h: Moved from khtml subdirectory. Added defines from
        WebCorePrefix.h, and added a define that makes KSVG a synonym for WebCore.
        * khtml/config.h: Removed.

        * khtml/css/css_grammar.y: Changed SVG functions to use function name rather
        than namespace to avoid collision with the XML and HTML DOM. Changes tabs to spaces.
        * khtml/css/css_valueimpl.cpp:
        (WebCore::propertyID): Add SVG properties ot the ones understood here.
        This allows us to set SVG properties from JavaScript.

        * ksvg2/scripts/cssmakeprops: Put functions inside the namespace to avoid compiler
        warning, and renamed functions to include CSS and SVG.
        * ksvg2/scripts/cssmakevalues: Ditto.

        * ksvg2/svg/SVGStyledElementImpl.cpp: (SVGStyledElementImpl::parseMappedAttribute):
        Use property ID function by its new name.

        * ksvg2/ksvg.h: Renamed ExceptionCode to SVGExceptionCode.

        * khtml/ecma/XSLTProcessor.cpp: Moved "config.h" header up above the ifdef so that
        the ifdef works.
        * khtml/xbl/xbl_binding.cpp: Ditto.
        * khtml/xbl/xbl_binding_manager.cpp: Ditto.
        * khtml/xbl/xbl_docimpl.cpp: Ditto.
        * khtml/xbl/xbl_protobinding.cpp: Ditto.
        * khtml/xbl/xbl_tokenizer.cpp: Ditto.
        * khtml/xsl/xsl_stylesheetimpl.cpp: Ditto.
        * khtml/xsl/xslt_processorimpl.cpp: Ditto.
        * loader/CachedXBLDocument.cpp: Ditto.

        * ksvg2/svg/SVGFELightElementImpl.h: Removed include of "config.h". That's supposed
        to only be included by code files, not headers.

        * ksvg2/svg/SVGFEDistantLightElementImpl.cpp: Added missing include of "config.h".
        Did a few other tweaks to the file.
        * ksvg2/svg/SVGFEPointLightElementImpl.cpp: Ditto.
        * ksvg2/svg/SVGFESpotLightElementImpl.cpp: Ditto.

2006-01-15  Eric Seidel  <eseidel@apple.com>

        Rubber-stamped by darin.

        Updated files w/ missing copyrights from Oliver.

        * kcanvas/device/quartz/filters/WKArithmeticFilter.cikernel:
        * kcanvas/device/quartz/filters/WKDistantLightFilter.cikernel:
        * kcanvas/device/quartz/filters/WKPointLightFilter.cikernel:
        * kcanvas/device/quartz/filters/WKSpotLightFilter.cikernel:
        * ksvg2/svg/SVGAnimatedColorImpl.cpp:
        * ksvg2/svg/SVGAnimatedColorImpl.h:
        * ksvg2/svg/SVGFEDiffuseLightingElementImpl.cpp:
        * ksvg2/svg/SVGFEDiffuseLightingElementImpl.h:
        * ksvg2/svg/SVGFEDistantLightElementImpl.cpp:
        * ksvg2/svg/SVGFEDistantLightElementImpl.h:
        * ksvg2/svg/SVGFELightElementImpl.cpp:
        * ksvg2/svg/SVGFELightElementImpl.h:
        * ksvg2/svg/SVGFEPointLightElementImpl.cpp:
        * ksvg2/svg/SVGFEPointLightElementImpl.h:
        * ksvg2/svg/SVGFESpecularLightingElementImpl.cpp:
        * ksvg2/svg/SVGFESpecularLightingElementImpl.h:
        * ksvg2/svg/SVGFESpotLightElementImpl.cpp:
        * ksvg2/svg/SVGFESpotLightElementImpl.h:

2006-01-15  Duncan Wilcox  <duncan@mclink.it>

        Reviewed and tweaked a bit by Darin.

        Fix for <http://bugzilla.opendarwin.org/show_bug.cgi?id=6523>
        "Extract data from SelectionController"

        This patch refactors the data portions of SelectionController into its
        own class, "Selection".

        The extracted data are the base/extent/start/end positions and cursor
        affinity. Also a couple cached values generated by validation are kept around
        in the new class.

        This patch does away with all the different affinities
        (start/end/base/extent) that were never implemented properly, since affinity
        only makes sense when the selection is a caret (as per discussion with mjs and
        darin on #webkit).

        No test cases added because this is a refactoring.

        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/MacFrame.mm:
        (MacFrame::findString):
        (MacFrame::advanceToNextMisspelling):
        (MacFrame::baseWritingDirectionForSelectionStart):
        (MacFrame::respondToChangedSelection):
        * bridge/mac/WebCoreFrameBridge.mm:
        (-[WebCoreFrameBridge selectionState]):
        (-[WebCoreFrameBridge selectNSRange:]):
        (-[WebCoreFrameBridge selectionAffinity]):
        (-[WebCoreFrameBridge setMarkDOMRange:]):
        (-[WebCoreFrameBridge ensureSelectionVisible]):
        (-[WebCoreFrameBridge rangeOfCharactersAroundCaret]):
        * khtml/editing/Selection.cpp: Added.
        (khtml::Selection::Selection):
        (khtml::Selection::clear):
        (khtml::Selection::toRange):
        (khtml::Selection::validate):
        (khtml::Selection::adjustForEditableContent):
        (khtml::Selection::debugPosition):
        * khtml/editing/Selection.h: Added.
        (khtml::Selection::):
        (khtml::Selection::state):
        (khtml::Selection::setAffinity):
        (khtml::Selection::affinity):
        (khtml::Selection::setBase):
        (khtml::Selection::setExtent):
        (khtml::Selection::setStart):
        (khtml::Selection::setEnd):
        (khtml::Selection::base):
        (khtml::Selection::extent):
        (khtml::Selection::start):
        (khtml::Selection::end):
        (khtml::Selection::isNone):
        (khtml::Selection::isCaret):
        (khtml::Selection::isRange):
        (khtml::Selection::isCaretOrRange):
        (khtml::Selection::isBaseFirst):
        (khtml::operator==):
        (khtml::operator!=):
        * khtml/editing/SelectionController.cpp:
        (khtml::SelectionController::SelectionController):
        (khtml::SelectionController::operator=):
        (khtml::SelectionController::moveTo):
        (khtml::SelectionController::setModifyBias):
        (khtml::SelectionController::modifyExtendingRightForward):
        (khtml::SelectionController::modifyMovingRightForward):
        (khtml::SelectionController::modifyExtendingLeftBackward):
        (khtml::SelectionController::modifyMovingLeftBackward):
        (khtml::SelectionController::modify):
        (khtml::SelectionController::expandUsingGranularity):
        (khtml::SelectionController::xPosForVerticalArrowNavigation):
        (khtml::SelectionController::clear):
        (khtml::SelectionController::setBase):
        (khtml::SelectionController::setExtent):
        (khtml::SelectionController::toString):
        (khtml::SelectionController::getRangeAt):
        (khtml::SelectionController::frame):
        (khtml::SelectionController::collapseToEnd):
        (khtml::SelectionController::collapseToStart):
        (khtml::SelectionController::layout):
        (khtml::SelectionController::caretRect):
        (khtml::SelectionController::needsCaretRepaint):
        (khtml::SelectionController::paintCaret):
        (khtml::SelectionController::debugRenderer):
        (khtml::SelectionController::formatForDebugger):
        (khtml::SelectionController::showTree):
        * khtml/editing/SelectionController.h:
        (khtml::SelectionController::state):
        (khtml::SelectionController::affinity):
        (khtml::SelectionController::base):
        (khtml::SelectionController::extent):
        (khtml::SelectionController::start):
        (khtml::SelectionController::end):
        (khtml::SelectionController::isNone):
        (khtml::SelectionController::isCaret):
        (khtml::SelectionController::isRange):
        (khtml::SelectionController::isCaretOrRange):
        (khtml::SelectionController::toRange):
        (khtml::SelectionController::baseNode):
        (khtml::SelectionController::extentNode):
        (khtml::SelectionController::baseOffset):
        (khtml::SelectionController::extentOffset):
        (khtml::SelectionController::anchorNode):
        (khtml::SelectionController::anchorOffset):
        (khtml::SelectionController::focusNode):
        (khtml::SelectionController::focusOffset):
        (khtml::operator==):
        * khtml/editing/apply_style_command.cpp:
        (khtml::ApplyStyleCommand::updateStartEnd):
        * khtml/editing/break_blockquote_command.cpp:
        (khtml::BreakBlockquoteCommand::doApply):
        * khtml/editing/delete_selection_command.cpp:
        (khtml::DeleteSelectionCommand::initializePositionData):
        (khtml::DeleteSelectionCommand::handleGeneralDelete):
        (khtml::DeleteSelectionCommand::doApply):
        * khtml/editing/insert_line_break_command.cpp:
        (khtml::InsertLineBreakCommand::doApply):
        * khtml/editing/insert_paragraph_separator_command.cpp:
        (khtml::InsertParagraphSeparatorCommand::doApply):
        * khtml/editing/insert_text_command.cpp:
        (khtml::InsertTextCommand::input):
        * khtml/editing/move_selection_command.cpp:
        (khtml::MoveSelectionCommand::doApply):
        * khtml/editing/replace_selection_command.cpp:
        (khtml::ReplaceSelectionCommand::doApply):
        (khtml::ReplaceSelectionCommand::completeHTMLReplacement):
        * khtml/editing/typing_command.cpp:
        (khtml::TypingCommand::deleteKeyPressed):
        (khtml::TypingCommand::forwardDeleteKeyPressed):
        (khtml::TypingCommand::markMisspellingsAfterTyping):
        * khtml/xml/DocumentImpl.cpp:
        (DocumentImpl::updateSelection):
        * kwq/KWQAccObject.mm:
        (-[KWQAccObject accessibilityAttributeValue:]):
        (-[KWQAccObject doAXTextMarkerRangeForLine:]):
        * kwq/KWQRenderTreeDebug.cpp:
        (writeSelection):
        * page/Frame.cpp:
        (Frame::selectContentsOfNode):
        (Frame::shouldChangeSelection):
        (Frame::computeAndSetTypingStyle):
        (Frame::applyStyle):
        (Frame::applyParagraphStyle):
        (Frame::selectFrameElementInParentIfFullySelected):
        (Frame::revealSelection):
        (Frame::centerSelectionInVisibleArea):
        (Frame::styleForSelectionStart):
        
        * <a few other files, including editing ones>: Added includes since Selection.h and
        SelectionController.h now include fewer things.

2006-01-15  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Test: fast/text/whitespace/pre-wrap-overflow-selection.html
        
        Reviewed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5619
          CSS2: pre-wrap has overflow/selection problems

        * khtml/rendering/InlineTextBox.cpp:
        (khtml::InlineTextBox::selectionRect): Clip selection rect to the text box
        (khtml::InlineTextBox::paintSelection): Clip selection painting to the text box.
        * khtml/rendering/bidi.cpp: (khtml::RenderBlock::computeHorizontalPositionsForLine):
        Remove code that re-added border width, since it is already included in availableWidth.

2006-01-15  Darin Adler  <darin@apple.com>

        Reviewed by Anders.

        - fix regression in duplicate ID layout test

        * khtml/xml/DocumentImpl.cpp:
        (DocumentImpl::getElementById): Change to take AtomicString, so we can use
        the string pointer as a hash key and not worry about ref'ing the pointer or
        about object lifetime since the string will be stored for the lifetime of the
        ID attribute. Also update for the counted set formerly named m_idCount to use
        its new name, m_duplicateIds.
        (DocumentImpl::addElementById): Ditto.
        (DocumentImpl::removeElementById): Ditto.
        (DocumentImpl::recalcStyleSelector): Pass a DOMStringImpl* (see below).
        * khtml/xml/DocumentImpl.h: Change functions to take AtomicString.

        * kcanvas/KCanvasFilters.cpp: (getFilterById): Use AtomicString.
        * kcanvas/KCanvasFilters.h: Ditto.
        * kcanvas/KCanvasResources.cpp:
        (getResourceById): Ditto.
        (getMarkerById): Ditto.
        (getClipperById): Ditto.
        (getMaskerById): Ditto.
        (getPaintServerById): Ditto.
        * kcanvas/KCanvasResources.h: Ditto.
        * khtml/ecma/kjs_window.cpp: (KJS::Window::getOwnPropertySlot): Ditto.
        * khtml/html/HTMLLabelElementImpl.cpp:
        (DOM::HTMLLabelElementImpl::formElement): Ditto.
        * khtml/xml/NodeListImpl.cpp: (DOM::NodeListImpl::itemById): Ditto.
        * khtml/xml/NodeListImpl.h: Ditto. Also removed unnecessary "virtual".

        * khtml/ecma/kjs_css.cpp:
        (KJS::DOMStyleSheetList::nameGetter): Pass a DOMStringImpl*, which gets
        converted to an AtomicString implicitly, rather than a DOMString, which
        does not. (But that's a crazy rule -- we should change this around long term.)
        (KJS::DOMStyleSheetList::getOwnPropertySlot): Ditto.
        * khtml/ecma/kjs_dom.cpp:
        (KJS::DOMNodeList::nameGetter): Ditto.
        (KJS::DOMNodeList::getOwnPropertySlot): Ditto.
        (KJS::DOMDocumentProtoFunc::callAsFunction): Ditto.

        - Merge khtml, DOM, and KDOM into one big namespace, WebCore.

        * WebCorePrefix.h: Use defined to map the old namespace names to WebCore.
        Now that this is done in the prefix, we can start actually calling it by
        that name, phase out the old names, then remove the defines.

        - other changes

        * khtml/xml/DocumentTypeImpl.cpp: Converted tabs to spaces.
        * khtml/xml/dom2_eventsimpl.cpp: Ditto.

2006-01-15  Alexander Kellett  <lypanov@kde.org>

        Reviewed and landed by Anders.

        http://bugzilla.opendarwin.org/show_bug.cgi?id=6553
        Remove KCanvasCommonArgs and pass around RenderPath objects instead.

        * WebCore.xcodeproj/project.pbxproj:
        * kcanvas/KCanvasCreator.h:
        * kcanvas/KCanvasItem.cpp:
        * kcanvas/KCanvasItem.h:
        * kcanvas/KCanvasTypes.h: Removed.
        * kcanvas/device/KRenderingDevice.cpp:
        * kcanvas/device/KRenderingDevice.h:
        * kcanvas/device/KRenderingFillPainter.h:
        * kcanvas/device/KRenderingPaintServer.h:
        * kcanvas/device/KRenderingStrokePainter.h:
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (KCanvasItemQuartz::paint):
        * kcanvas/device/quartz/KRenderingDeviceQuartz.h:
        * kcanvas/device/quartz/KRenderingPaintServerGradientQuartz.mm:
        (drawShadingWithStyle):
        (KRenderingPaintServerLinearGradientQuartz::draw):
        (KRenderingPaintServerRadialGradientQuartz::draw):
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.h:
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.mm:
        (KRenderingPaintServerSolidQuartz::draw):
        (KRenderingPaintServerPatternQuartz::draw):
        (KRenderingPaintServerImageQuartz::draw):
        * ksvg2/misc/KCanvasRenderingStyle.cpp:
        * ksvg2/svg/SVGPatternElementImpl.h:

2006-01-15  Darin Adler  <darin@apple.com>

        Reviewed by Hyatt.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6528
          remove all use of QDict from WebCore

        I ran performance tests and the change results in a slight improvement.

        * bridge/mac/MacFrame.h: Removed include of KWQDict.h. Changed didTellBridgeAboutLoad
        and haveToldBridgeAboutLoad functions to take DOMString instead of QString. Changed
        urlsBridgeKnowsAbout from a QDict to a HashMap.
        * bridge/mac/MacFrame.mm:
        (MacFrame::didTellBridgeAboutLoad): Updated to use QDict and DOMString.
        (MacFrame::haveToldBridgeAboutLoad): Ditto.

        * khtml/editing/jsediting.h: Removed include of qdict.h.

        * khtml/rendering/render_frames.cpp: Removed include of qdict.h. Put file inside the
        khtml namespace instead of just using the namespace. Changed tabs to spaces.
        (khtml::RenderPartObject::updateWidget): Changed the local variable uniqueParamNames
        to be a HashSet instead of a QDict.

        * khtml/xml/DocumentImpl.h: Removed include of qdict.h, changed m_elementsById, m_idCount,
        and m_elementsByAccessKey to use HashMap and HashCountedSet instead of QDict.
        * khtml/xml/DocumentImpl.cpp: Changed tabs to spaces.
        (DocumentImpl::getElementById): Updated to use HashMap for m_elementsById and HashCountedSet
        for m_idCount.
        (DocumentImpl::addElementById): Ditto. Remove code to clear m_accessKeyDictValid,
        since setDocumentChanged already takes care of that.
        (DocumentImpl::removeElementById): Ditto.
        (DocumentImpl::getElementByAccessKey): Updated to use HashMap for m_elementsByAccessKey.
        (DocumentImpl::setDocumentChanged): Rearranged to do a couple fewer branches. Clear out
        the m_elementsByAccessKey map when clearing m_accessKeyMapValid to avoid keeping stale
        pointers around.

        * ksvg2/svg/SVGDocumentImpl.cpp: Removed include of q3dict.h.

        * WebCore.vcproj/WebCore/WebCore.vcproj: Removed obsolete QDict sources.
        * WebCore.xcodeproj/project.pbxproj: Ditto.

        * ForwardingHeaders/q3dict.h: Removed.
        * ForwardingHeaders/qdict.h: Removed.
        * kwq/KWQDict.h: Removed.
        * kwq/KWQDictImpl.cpp: Removed.
        * kwq/KWQDictImpl.h: Removed.

        * WebCore+SVG/SVGNamesWrapper.cpp: Touched this file just so I could build again.

        * kwq/KWQKURL.h: Removed unused canonicalURL, _path, _user, _pass, and _host functions.
        * kwq/KWQKURL.mm: Changed tabs to spaces, removed unused functions, replaced NULL with 0.

        * kwq/KWQLoader.mm: Changed tabs to spaces.
        (KWQServeRequest): Removed QString conversion from call to didTellBridgeAboutLoad.
        (KWQServeSynchronousRequest): Ditto.
        (KWQCheckCacheObjectStatus): Ditto. Same for haveToldBridgeAboutLoad.

        * loader/Cache.h: Removed include of qdict.h. Changed declaration of the LRUList struct
        to just be a forward declaration. Changed tabs to spaces. Removed the static data member
        called "cache". Added a static member function called get. Renamed removeCacheEntry to remove.
        * loader/Cache.cpp: Put file inside the khtml namespace instead of just using the
        namespace. Changed tabs to spaces. Changed the main cache itself to a HashMap and
        made it a static variable local to this file instead of a static data member of Cache
        to hide its type from the header. Also made the LRUList type private to this file.
        (khtml::Cache::init): Create a HashMap instead of a QDict.
        (khtml::Cache::clear): To replace the use of setAutoDelete, write a loop to delete all the
        items in the cache map.
        (khtml::Cache::requestImage): Change code to use HashMap functions instead of QDict.
        (khtml::Cache::requestStyleSheet): Ditto.
        (khtml::Cache::preloadStyleSheet): Ditto.
        (khtml::Cache::requestScript): Ditto.
        (khtml::Cache::preloadScript): Ditto.
        (khtml::Cache::requestXSLStyleSheet): Ditto.
        (khtml::Cache::requestXBLDocument): Ditto.
        (khtml::Cache::removeCacheEntry): Ditto.
        (khtml::Cache::FastLog2): Fixed this for 64-bit compiles.
        (khtml::Cache::getStatistics): Ditto.
        (khtml::Cache::flushAll): Ditto.
        (khtml::Cache::get): Added. Function used by the loader.

        * loader/CachedObject.h: Removed include of qdict.h.

        * loader/DocLoader.h: Removed include of qdict.h.
        * loader/DocLoader.cpp: (khtml::DocLoader::needReload): Changed to use new get function of
        Cache instead of getting at the map directly. Also changed call to removeCacheEntry
        to remove because it was renamed.

        * loader/CachedImage.cpp: (khtml::CachedImage::data): Changed call to removeCacheEntry
        to remove because it was renamed.
        * loader/CachedImageCallback.cpp: (khtml::CachedImageCallback::handleError): Ditto.
        * loader/loader.cpp:
        (khtml::Loader::slotFinished): Ditto.
        (khtml::Loader::cancelRequests): Ditto.

2006-01-15  Alexander Kellett  <lypanov@kde.org>

        Reviewed by eseidel.

        <mask> inside <defs> crashes Safari.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6548

        * ksvg2/svg/SVGMaskElementImpl.cpp:
        (KSVG::SVGMaskElementImpl::drawMaskerContent):

2006-01-15  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Add basic <tspan> support using RenderInline.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6428
        Also fix <text transform=""> while we're at it.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6552

        * ksvg2/svg/SVGGradientElementImpl.cpp:
        (SVGGradientElementImpl::parseMappedAttribute): code cleanup
        * ksvg2/svg/SVGPatternElementImpl.cpp:
        (SVGPatternElementImpl::parseMappedAttribute): code cleanup
        * ksvg2/svg/SVGStyledTransformableElementImpl.cpp:
        (SVGStyledTransformableElementImpl::parseMappedAttribute): cleanup
        * ksvg2/svg/SVGTSpanElementImpl.cpp:
        (SVGTSpanElementImpl::childShouldCreateRenderer): added.
        (SVGTSpanElementImpl::createRenderer): added.
        * ksvg2/svg/SVGTSpanElementImpl.h:
        (KSVG::SVGTSpanElementImpl::rendererIsNeeded): added.
        * ksvg2/svg/SVGTextElementImpl.cpp:
        (SVGTextElementImpl::transform): added.
        (SVGTextElementImpl::localMatrix): added.
        (SVGTextElementImpl::parseMappedAttribute): support transform.
        (SVGTextElementImpl::updateLocalTransform): added.
        (SVGTextElementImpl::attach): added.
        (SVGTextElementImpl::childShouldCreateRenderer): allow tspan.
        * ksvg2/svg/SVGTextElementImpl.h:
        * ksvg2/svg/SVGTransformableImpl.cpp:
        (SVGTransformableImpl::parseTransformAttribute): code cleanup.
        * ksvg2/svg/SVGTransformableImpl.h:

2006-01-14  David Hyatt  <hyatt@apple.com>

        Move arena.cpp/.h out of khtml/misc and into platform/Arena.cpp/h.  Also removed another unused
        header, khtmldata.h.

        * WebCore.xcodeproj/project.pbxproj:
        * khtml/misc/arena.cpp: Removed.
        * khtml/misc/arena.h: Removed.
        * khtml/misc/khtmldata.h: Removed.
        * khtml/rendering/render_arena.h:
        * platform/Arena.cpp: Added.
        * platform/Arena.h: Added.

2006-01-14  David Hyatt  <hyatt@apple.com>

        Rename TokenizerString to SegmentedString and place it in the platform directory.

        * WebCore.xcodeproj/project.pbxproj:
        * khtml/html/htmltokenizer.cpp:
        (khtml::HTMLTokenizer::processListing):
        (khtml::HTMLTokenizer::parseSpecial):
        (khtml::HTMLTokenizer::scriptHandler):
        (khtml::HTMLTokenizer::scriptExecution):
        (khtml::HTMLTokenizer::parseComment):
        (khtml::HTMLTokenizer::parseServer):
        (khtml::HTMLTokenizer::parseProcessingInstruction):
        (khtml::HTMLTokenizer::parseText):
        (khtml::HTMLTokenizer::parseEntity):
        (khtml::HTMLTokenizer::parseTag):
        (khtml::HTMLTokenizer::write):
        (khtml::HTMLTokenizer::timerEvent):
        (khtml::HTMLTokenizer::notifyFinished):
        (khtml::HTMLTokenizer::setSrc):
        * khtml/html/htmltokenizer.h:
        * khtml/misc/stringit.cpp: Removed.
        * khtml/misc/stringit.h: Removed.
        * khtml/xml/xml_tokenizer.cpp:
        (khtml::XMLTokenizer::write):
        * khtml/xml/xml_tokenizer.h:
        * platform/SegmentedString.cpp: Added.
        (WebCore::SegmentedString::length):
        (WebCore::SegmentedString::clear):
        (WebCore::SegmentedString::append):
        (WebCore::SegmentedString::prepend):
        (WebCore::SegmentedString::advanceSubstring):
        (WebCore::SegmentedString::toString):
        * platform/SegmentedString.h: Added.
        (WebCore::SegmentedSubstring::SegmentedSubstring):
        (WebCore::SegmentedString::SegmentedString):

2006-01-14  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - added bridging infrastructure for Page class
        
        The Page class itself is coming very soon.

        * WebCore.exp: Export WebCorePageBridge.
        * WebCore.xcodeproj/project.pbxproj: Add new files.
        * bridge/mac/WebCorePageBridge.h: Added.
        * bridge/mac/WebCorePageBridge.mm: Added.
        (-[WebCorePageBridge initWithMainFrame:]): Added new class, obvious
        (-[WebCorePageBridge dealloc]): ditto
        (-[WebCorePageBridge mainFrame]): ditto
        * bridge/mac/WebCoreFrameBridge.mm:
        (-[WebCoreFrameBridge init]): Fixed style a bit.

2006-01-14  David Hyatt  <hyatt@apple.com>

        Win32 finds more khtml namespace issues with the movement
        of Shared that gcc missed.

        * WebCore.vcproj/WebCore/WebCore.vcproj:
        * khtml/xml/dom2_rangeimpl.cpp:
        (DOM::RangeImpl::text):
        * khtml/xml/dom_position.cpp:

2006-01-14  David Hyatt  <hyatt@apple.com>

        Move shared.h from khtml/misc into the platform directory and move it into the WebCore namespace.

        Reviewed by eseidel

        * ForwardingHeaders/kdom/Shared.h: Removed.
        * WebCore+SVG/DOMList.h:
        * WebCore+SVG/KDOMHeaders.h:
        * WebCore+SVG/RGBColorImpl.h:
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/WebCoreFrameBridge.mm:
        * kcanvas/KCanvasPath.h:
        * khtml/css/css_base.h:
        * khtml/css/css_ruleimpl.h:
        * khtml/css/css_stylesheetimpl.h:
        * khtml/css/css_valueimpl.h:
        * khtml/dom/dom2_events.h:
        * khtml/dom/dom2_traversal.h:
        * khtml/ecma/kjs_dom.h:
        * khtml/ecma/kjs_window.cpp:
        * khtml/ecma/xmlserializer.cpp:
        (KJS::XMLSerializerProtoFunc::callAsFunction):
        * khtml/editing/SelectionController.h:
        * khtml/editing/edit_command.h:
        * khtml/editing/htmlediting.h:
        * khtml/editing/visible_position.h:
        * khtml/html/HTMLOptionsCollectionImpl.h:
        * khtml/html/html_miscimpl.h:
        * khtml/misc/shared.h: Removed.
        * khtml/rendering/render_line.h:
        * khtml/rendering/render_style.h:
        * khtml/xml/DOMImplementationImpl.h:
        * khtml/xml/DocumentImpl.h:
        * khtml/xml/NamedNodeMapImpl.h:
        * khtml/xml/NodeImpl.h:
        * khtml/xml/NodeListImpl.h:
        * khtml/xml/dom2_eventsimpl.h:
        * khtml/xml/dom2_rangeimpl.h:
        * khtml/xml/dom2_traversalimpl.h:
        * khtml/xml/dom2_viewsimpl.h:
        * khtml/xml/dom_elementimpl.h:
        * khtml/xml/dom_qname.h:
        * khtml/xml/dom_stringimpl.h:
        * khtml/xsl/xslt_processorimpl.h:
        * ksvg2/css/SVGRenderStyle.cpp:
        (SVGRenderStyle::SVGRenderStyle):
        * ksvg2/css/SVGRenderStyle.h:
        * ksvg2/css/SVGRenderStyleDefs.cpp:
        (StyleFillData::StyleFillData):
        (StyleStrokeData::StyleStrokeData):
        (StyleStopData::StyleStopData):
        (StyleClipData::StyleClipData):
        (StyleMaskData::StyleMaskData):
        (StyleMarkerData::StyleMarkerData):
        (StyleMiscData::StyleMiscData):
        * ksvg2/css/SVGRenderStyleDefs.h:
        * ksvg2/svg/SVGAngleImpl.cpp:
        (SVGAngleImpl::SVGAngleImpl):
        * ksvg2/svg/SVGAngleImpl.h:
        * ksvg2/svg/SVGAnimatedBooleanImpl.cpp:
        (SVGAnimatedBooleanImpl::SVGAnimatedBooleanImpl):
        * ksvg2/svg/SVGAnimatedBooleanImpl.h:
        * ksvg2/svg/SVGAnimatedEnumerationImpl.cpp:
        (SVGAnimatedEnumerationImpl::SVGAnimatedEnumerationImpl):
        * ksvg2/svg/SVGAnimatedEnumerationImpl.h:
        * ksvg2/svg/SVGAnimatedIntegerImpl.cpp:
        (SVGAnimatedIntegerImpl::SVGAnimatedIntegerImpl):
        * ksvg2/svg/SVGAnimatedIntegerImpl.h:
        * ksvg2/svg/SVGAnimatedLengthListImpl.h:
        * ksvg2/svg/SVGAnimatedNumberImpl.cpp:
        (SVGAnimatedNumberImpl::SVGAnimatedNumberImpl):
        * ksvg2/svg/SVGAnimatedNumberImpl.h:
        * ksvg2/svg/SVGAnimatedNumberListImpl.h:
        * ksvg2/svg/SVGAnimatedPreserveAspectRatioImpl.h:
        * ksvg2/svg/SVGAnimatedTemplate.h:
        (KSVG::SVGAnimatedTemplate::SVGAnimatedTemplate):
        * ksvg2/svg/SVGAnimatedTransformListImpl.h:
        * ksvg2/svg/SVGDocumentImpl.cpp:
        * ksvg2/svg/SVGLengthImpl.cpp:
        (SVGLengthImpl::SVGLengthImpl):
        * ksvg2/svg/SVGLengthImpl.h:
        * ksvg2/svg/SVGMatrixImpl.cpp:
        (SVGMatrixImpl::SVGMatrixImpl):
        * ksvg2/svg/SVGMatrixImpl.h:
        * ksvg2/svg/SVGNumberImpl.cpp:
        (SVGNumberImpl::SVGNumberImpl):
        * ksvg2/svg/SVGNumberImpl.h:
        * ksvg2/svg/SVGPathSegImpl.cpp:
        (SVGPathSegImpl::SVGPathSegImpl):
        * ksvg2/svg/SVGPathSegImpl.h:
        * ksvg2/svg/SVGPointImpl.cpp:
        (SVGPointImpl::SVGPointImpl):
        * ksvg2/svg/SVGPointImpl.h:
        * ksvg2/svg/SVGPreserveAspectRatioImpl.cpp:
        (SVGPreserveAspectRatioImpl::SVGPreserveAspectRatioImpl):
        * ksvg2/svg/SVGPreserveAspectRatioImpl.h:
        * ksvg2/svg/SVGRectImpl.cpp:
        (SVGRectImpl::SVGRectImpl):
        * ksvg2/svg/SVGRectImpl.h:
        * ksvg2/svg/SVGTransformImpl.cpp:
        (SVGTransformImpl::SVGTransformImpl):
        * ksvg2/svg/SVGTransformImpl.h:
        * kwq/DOM-CSS.mm:
        * kwq/KWQFontMetrics.mm:
        * kwq/KWQMapImpl.cpp:
        * kwq/KWQRegExp.cpp:
        * kwq/KWQValueListImpl.cpp:
        (KWQValueListImpl::KWQValueListPrivate::KWQValueListPrivate):
        * kwq/KWQVariant.cpp:
        * platform/ArrayImpl.h:
        * platform/Shared.h: Added.

2006-01-14  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        Implement basic <foreignObject> support:
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5974
        Also fixed <image> to support clip, filter and mask
        Updated <text> to support hit testing and clip, filter, mask

        * WebCore.xcodeproj/project.pbxproj: added files.
        * kcanvas/RenderForeignObject.cpp: Added.
        (RenderForeignObject::RenderForeignObject):
        (RenderForeignObject::translationForAttributes):
        (RenderForeignObject::paint):
        (RenderForeignObject::nodeAtPoint):
        * kcanvas/RenderForeignObject.h: Added.
        (RenderForeignObject::renderName): added.
        (RenderForeignObject::localTransform): added.
        (RenderForeignObject::setLocalTransform): added.
        * kcanvas/RenderSVGImage.cpp:
        (RenderSVGImage::paint): added filter, clip mask support
        * kcanvas/RenderSVGImage.h:
        (KSVG::RenderSVGImage::localTransform): added.
        (KSVG::RenderSVGImage::setLocalTransform): added.
        * kcanvas/RenderSVGText.cpp:
        (RenderSVGText::translationTopToBaseline): return qmatrix
        (RenderSVGText::translationForAttributes): return qmatrix
        (RenderSVGText::paint): added filter, clip, mask support
        (RenderSVGText::nodeAtPoint): added.
        * kcanvas/RenderSVGText.h:
        (RenderSVGText::localTransform): added.
        (RenderSVGText::setLocalTransform): added.
        * khtml/rendering/render_object.h:
        (khtml::RenderObject::setLocalTransform): added assert(0)
        * ksvg2/css/svg.css: added foreignObject display: block
        * ksvg2/svg/SVGForeignObjectElementImpl.cpp: Added.
        (KSVG::SVGForeignObjectElementImpl::SVGForeignObjectElementImpl):
        (KSVG::SVGForeignObjectElementImpl::~SVGForeignObjectElementImpl):
        (KSVG::SVGForeignObjectElementImpl::x):
        (KSVG::SVGForeignObjectElementImpl::y):
        (KSVG::SVGForeignObjectElementImpl::width):
        (KSVG::SVGForeignObjectElementImpl::height):
        (KSVG::SVGForeignObjectElementImpl::parseMappedAttribute):
        (KSVG::SVGForeignObjectElementImpl::createRenderer):
        (KSVG::SVGForeignObjectElementImpl::childShouldCreateRenderer):
        * ksvg2/svg/SVGForeignObjectElementImpl.h: Added.
        (KSVG::SVGForeignObjectElementImpl::isValid): added
        (KSVG::SVGForeignObjectElementImpl::rendererIsNeeded): added
        * ksvg2/svg/SVGImageElementImpl.cpp:
        (SVGImageElementImpl::attach): fixed static_cast
        * ksvg2/svg/SVGLocatableImpl.cpp:
        (SVGLocatableImpl::nearestViewportElement): foreignObject support
        (SVGLocatableImpl::farthestViewportElement): foreignObject support
        * ksvg2/svg/svgtags.in: added foreignObject
        * kwq/KWQWMatrix.cpp:
        (QWMatrix::isInvertible): fixed

2006-01-14  Eric Seidel  <eseidel@apple.com>

        Fix build break. (oops!)

        * khtml/xml/xml_tokenizer.cpp:
        (khtml::XMLTokenizer::XMLTokenizer):

2006-01-14  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Initialize m_isXHTMLDocument(false) properly.
        No tests possible, random failure only.

        * khtml/xml/xml_tokenizer.cpp:
        (khtml::XMLTokenizer::XMLTokenizer):

2006-01-15  Alexander Kellett  <lypanov@kde.org>

        Reviewed by eseidel.

        Add support for svg css property writing-mode.

        * ksvg2/css/SVGCSSStyleSelector.cpp:
        (KDOM::CSSStyleSelector::applySVGProperty):
        * ksvg2/css/SVGRenderStyle.h:
        (KSVG::SVGRenderStyle::InheritedFlags::):
        (KSVG::SVGRenderStyle::setBitDefaults):
        * ksvg2/css/SVGRenderStyleDefs.h:
        (KSVG::):

2006-01-14  Alexander Kellett  <lypanov@kde.org>

        Reviewed by eseidel.

        Refactor out cases of KCanvasRenderingStyle used as an instance to
        store the current style. Temporarily unify the data passing via 
        KCanvasCommonArgs.

        * kcanvas/KCanvasItem.cpp: Removing override of setStyle used to hook
        into KCanvasRenderingStyle::updateStyle.
        (RenderPath::commonArgs): 
        * kcanvas/KCanvasItem.h:
        * kcanvas/KCanvasTreeDebug.cpp:
        (writeStyle):
        * kcanvas/KCanvasTypes.h:
        * kcanvas/device/KRenderingDevice.cpp:
        (KCanvasCommonArgs::KCanvasCommonArgs):
        (KCanvasCommonArgs::renderStyle):
        (KCanvasCommonArgs::setRenderStyle):
        (KCanvasCommonArgs::renderPath):
        (KCanvasCommonArgs::setRenderPath):
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (KCanvasItemQuartz::paint):
        (KCanvasItemQuartz::bboxForPath):
        (KCanvasItemQuartz::hitsPath):
        * kcanvas/device/quartz/KRenderingPaintServerGradientQuartz.mm:
        (drawShadingWithStyle):
        (KRenderingPaintServerLinearGradientQuartz::draw):
        (KRenderingPaintServerRadialGradientQuartz::draw):
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.mm:
        (KRenderingPaintServerSolidQuartz::draw):
        (KRenderingPaintServerPatternQuartz::draw):
        * kcanvas/device/quartz/QuartzSupport.h:
        * kcanvas/device/quartz/QuartzSupport.mm:
        (applyStrokeStyleToContext):
        * ksvg2/misc/KCanvasRenderingStyle.cpp: Remove overrideFillPaintServer
        and overrideStrokePaintServer hacks and make most other methods
        static, remove most instance variables.
        (KCanvasRenderingStyle::KCanvasRenderingStyle):
        (KCanvasRenderingStyle::isFilled):
        (KCanvasRenderingStyle::fillPaintServer):
        (KCanvasRenderingStyle::isStroked):
        (KCanvasRenderingStyle::strokePaintServer):
        (KCanvasRenderingStyle::strokePainter): Merged stroke logic in from
        updateStyle.
        (KCanvasRenderingStyle::fillPainter): Merged fill logic in from
        updateStyle.
        * ksvg2/misc/KCanvasRenderingStyle.h:

2006-01-14  David Hyatt  <hyatt@apple.com>

        Move loader_client.h to CachedObjectClient.h.

        * WebCore.xcodeproj/project.pbxproj:
        * khtml/css/css_ruleimpl.h:
        * khtml/css/css_valueimpl.h:
        * khtml/ecma/kjs_html.h:
        * khtml/html/html_documentimpl.h:
        * khtml/html/html_headimpl.h:
        * khtml/html/htmltokenizer.h:
        * khtml/rendering/render_object.h:
        * khtml/xbl/xbl_binding.h:
        * khtml/xml/dom_xmlimpl.h:
        * khtml/xsl/xsl_stylesheetimpl.h:
        * loader/CachedObject.h:
        * loader/CachedObjectClient.h: Added.
        * loader/CachedObjectClientWalker.h:
        * loader/loader_client.h: Removed.

2006-01-14  Anders Carlsson  <andersca@mac.com>

        Reviewed by Eric and Hyatt.

        - http://bugzilla.opendarwin.org/show_bug.cgi?id=6544
        Remove unused headers.

        * ForwardingHeaders/kglobalsettings.h: Removed.
        * ForwardingHeaders/kimageio.h: Removed.
        * ForwardingHeaders/qasyncio.h: Removed.
        * ForwardingHeaders/qstylesheet.h: Removed.
        * kwq/KWQAsyncIO.h: Removed.
        * kwq/KWQKGlobalSettings.h: Removed.
        * kwq/KWQKImageIO.h: Removed.
        * kwq/KWQStyleSheet.h: Removed.
        
        * WebCore.xcodeproj/project.pbxproj:
        * khtml/ecma/kjs_window.cpp:
        * khtml/html/html_documentimpl.cpp:
        * khtml/xml/DocumentImpl.cpp:
        (DocumentImpl::recalcStyle):        
        * loader/CachedImageCallback.cpp:
        * loader/CachedObject.cpp:
        * page/Frame.cpp:
        * page/FrameView.cpp:
        (KHTMLView::KHTMLView):
        Remove header inclusions
        
2006-01-14  David Hyatt  <hyatt@apple.com>

        Shift the loader-related files out of the khtml/misc directory and into a new loader directory.
        Remove the use of paths when including files from misc.

        * WebCore+SVG/KDOMHeaders.h:
        * WebCore.xcodeproj/project.pbxproj:
        * kcanvas/KCanvasPath.h:
        * khtml/css/css_base.h:
        * khtml/css/css_ruleimpl.cpp:
        * khtml/css/css_ruleimpl.h:
        * khtml/css/css_stylesheetimpl.cpp:
        * khtml/css/css_valueimpl.h:
        * khtml/css/csshelper.cpp:
        * khtml/css/cssparser.cpp:
        * khtml/css/cssstyleselector.cpp:
        * khtml/dom/dom2_events.h:
        * khtml/dom/dom2_traversal.h:
        * khtml/ecma/kjs_dom.h:
        * khtml/ecma/kjs_html.h:
        * khtml/ecma/kjs_window.cpp:
        * khtml/editing/SelectionController.h:
        * khtml/editing/edit_command.h:
        * khtml/editing/visible_position.h:
        * khtml/editing/visible_units.cpp:
        * khtml/html/HTMLOptionsCollectionImpl.h:
        * khtml/html/html_baseimpl.cpp:
        * khtml/html/html_baseimpl.h:
        * khtml/html/html_canvasimpl.h:
        * khtml/html/html_documentimpl.h:
        * khtml/html/html_headimpl.cpp:
        * khtml/html/html_headimpl.h:
        * khtml/html/html_imageimpl.h:
        * khtml/html/html_miscimpl.h:
        * khtml/html/htmltokenizer.h:
        * khtml/misc/Cache.cpp: Removed.
        * khtml/misc/Cache.h: Removed.
        * khtml/misc/CachedCSSStyleSheet.cpp: Removed.
        * khtml/misc/CachedCSSStyleSheet.h: Removed.
        * khtml/misc/CachedImage.cpp: Removed.
        * khtml/misc/CachedImage.h: Removed.
        * khtml/misc/CachedImageCallback.cpp: Removed.
        * khtml/misc/CachedImageCallback.h: Removed.
        * khtml/misc/CachedObject.cpp: Removed.
        * khtml/misc/CachedObject.h: Removed.
        * khtml/misc/CachedObjectClientWalker.cpp: Removed.
        * khtml/misc/CachedObjectClientWalker.h: Removed.
        * khtml/misc/CachedScript.cpp: Removed.
        * khtml/misc/CachedScript.h: Removed.
        * khtml/misc/CachedXBLDocument.cpp: Removed.
        * khtml/misc/CachedXBLDocument.h: Removed.
        * khtml/misc/CachedXSLStyleSheet.cpp: Removed.
        * khtml/misc/CachedXSLStyleSheet.h: Removed.
        * khtml/misc/DocLoader.cpp: Removed.
        * khtml/misc/DocLoader.h: Removed.
        * khtml/misc/Request.cpp: Removed.
        * khtml/misc/Request.h: Removed.
        * khtml/misc/loader.cpp: Removed.
        * khtml/misc/loader.h: Removed.
        * khtml/misc/loader_client.h: Removed.
        * khtml/rendering/render_box.h:
        * khtml/rendering/render_canvasimage.cpp:
        * khtml/rendering/render_form.cpp:
        * khtml/rendering/render_image.cpp:
        * khtml/rendering/render_line.h:
        * khtml/rendering/render_list.cpp:
        * khtml/rendering/render_object.h:
        * khtml/rendering/render_style.h:
        * khtml/rendering/render_table.h:
        * khtml/rendering/table_layout.h:
        * khtml/xbl/xbl_binding.cpp:
        * khtml/xbl/xbl_binding.h:
        * khtml/xml/DOMImplementationImpl.h:
        * khtml/xml/DocumentImpl.cpp:
        * khtml/xml/DocumentImpl.h:
        * khtml/xml/dom2_eventsimpl.h:
        * khtml/xml/dom2_rangeimpl.h:
        * khtml/xml/dom2_traversalimpl.h:
        * khtml/xml/dom2_viewsimpl.h:
        * khtml/xml/dom_elementimpl.h:
        * khtml/xml/dom_nodeimpl.h:
        * khtml/xml/dom_stringimpl.h:
        * khtml/xml/dom_xmlimpl.h:
        * khtml/xml/xml_tokenizer.h:
        * khtml/xsl/xsl_stylesheetimpl.cpp:
        * khtml/xsl/xslt_processorimpl.h:
        * kwq/KWQFontMetrics.mm:
        * kwq/KWQMapImpl.cpp:
        * kwq/KWQRegExp.cpp:
        * kwq/KWQValueListImpl.cpp:
        * kwq/KWQVariant.cpp:
        * loader: Added.
        * loader/Cache.cpp: Added.
        * loader/Cache.h: Added.
        * loader/CachedCSSStyleSheet.cpp: Added.
        * loader/CachedCSSStyleSheet.h: Added.
        * loader/CachedImage.cpp: Added.
        * loader/CachedImage.h: Added.
        * loader/CachedImageCallback.cpp: Added.
        * loader/CachedImageCallback.h: Added.
        * loader/CachedObject.cpp: Added.
        * loader/CachedObject.h: Added.
        * loader/CachedObjectClientWalker.cpp: Added.
        * loader/CachedObjectClientWalker.h: Added.
        * loader/CachedScript.cpp: Added.
        * loader/CachedScript.h: Added.
        * loader/CachedXBLDocument.cpp: Added.
        * loader/CachedXBLDocument.h: Added.
        * loader/CachedXSLStyleSheet.cpp: Added.
        * loader/CachedXSLStyleSheet.h: Added.
        * loader/DocLoader.cpp: Added.
        * loader/DocLoader.h: Added.
        * loader/Request.cpp: Added.
        * loader/Request.h: Added.
        * loader/loader.cpp: Added.
        * loader/loader.h: Added.
        * loader/loader_client.h: Added.
        * page/Frame.cpp:
        * page/FramePrivate.h:
        * page/FrameView.cpp:

2006-01-14  Eric Seidel  <eseidel@apple.com>

        Reviewed by hyatt

        break classes in dom_nodeimpl.* into separate files (one per class)
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6543

        * ForwardingHeaders/kdom/core/NodeImpl.h: Removed.
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/MacFrame.h:
        * bridge/mac/WebCoreFrameBridge.mm:
        * khtml/css/css_base.h:
        * khtml/css/css_stylesheetimpl.cpp:
        * khtml/css/css_valueimpl.cpp:
        * khtml/css/css_valueimpl.h:
        * khtml/ecma/kjs_binding.cpp:
        * khtml/ecma/kjs_dom.cpp:
        * khtml/ecma/kjs_dom.h:
        * khtml/ecma/kjs_events.cpp:
        * khtml/ecma/kjs_html.cpp:
        * khtml/ecma/kjs_traversal.cpp:
        * khtml/editing/SelectionController.cpp:
        * khtml/editing/append_node_command.cpp:
        * khtml/editing/htmlediting.cpp:
        * khtml/editing/htmlediting.h:
        * khtml/editing/insert_node_before_command.cpp:
        * khtml/editing/remove_node_attribute_command.h:
        * khtml/editing/remove_node_command.cpp:
        * khtml/editing/remove_node_preserving_children_command.cpp:
        * khtml/editing/set_node_attribute_command.h:
        * khtml/editing/visible_position.cpp:
        * khtml/editing/visible_text.cpp:
        * khtml/html/HTMLOptionElementImpl.cpp:
        * khtml/html/html_headimpl.cpp:
        * khtml/html/htmlparser.cpp:
        * khtml/khtml_events.cpp:
        * khtml/rendering/render_block.cpp:
        * khtml/rendering/render_box.cpp:
        * khtml/rendering/render_flow.cpp:
        * khtml/rendering/render_frames.h:
        * khtml/rendering/render_line.cpp:
        * khtml/rendering/render_object.h:
        * khtml/xml/ChildNodeListImpl.cpp: Added.
        * khtml/xml/ChildNodeListImpl.h: Added.
        * khtml/xml/ContainerNodeImpl.cpp: Added.
        (DOM::ContainerNodeImpl::removeAllChildren):
        (DOM::ContainerNodeImpl::checkSameDocument):
        (DOM::ContainerNodeImpl::getRect):
        (DOM::ContainerNodeImpl::dispatchChildRemovalEvents):
        * khtml/xml/ContainerNodeImpl.h: Added.
        * khtml/xml/DocumentFragmentImpl.cpp:
        * khtml/xml/DocumentFragmentImpl.h:
        * khtml/xml/DocumentImpl.cpp:
        * khtml/xml/DocumentImpl.h:
        (DOM::DocumentImpl::setTextColor):
        * khtml/xml/DocumentTypeImpl.cpp:
        * khtml/xml/DocumentTypeImpl.h:
        * khtml/xml/NameNodeListImpl.cpp: Added.
        * khtml/xml/NameNodeListImpl.h: Added.
        * khtml/xml/NamedNodeMapImpl.h: Added.
        (DOM::NamedNodeMapImpl::NamedNodeMapImpl):
        (DOM::NamedNodeMapImpl::~NamedNodeMapImpl):
        * khtml/xml/NodeImpl.cpp: Added.
        (DOM::TagNodeListImpl::TagNodeListImpl):
        (DOM::TagNodeListImpl::length):
        (DOM::TagNodeListImpl::item):
        (DOM::TagNodeListImpl::nodeMatches):
        (DOM::NodeImpl::getRect):
        * khtml/xml/NodeImpl.h: Added.
        * khtml/xml/NodeListImpl.cpp: Added.
        * khtml/xml/NodeListImpl.h: Added.
        * khtml/xml/dom2_eventsimpl.h:
        * khtml/xml/dom_elementimpl.h:
        * khtml/xml/dom_nodeimpl.cpp: Removed.
        * khtml/xml/dom_nodeimpl.h: Removed.
        * khtml/xml/dom_position.cpp:
        * khtml/xml/dom_textimpl.h:
        * khtml/xml/dom_xmlimpl.cpp:
        * khtml/xml/dom_xmlimpl.h:
        * khtml/xml/xml_tokenizer.cpp:
        * khtml/xsl/xsl_stylesheetimpl.cpp:
        * khtml/xsl/xslt_processorimpl.h:
        * ksvg2/svg/SVGURIReferenceImpl.cpp:
        * kwq/DOM.mm:
        * kwq/DOMHTML.mm:
        * kwq/DOMUtility.mm:
        * kwq/KWQClipboard.h:
        * page/FrameView.cpp:

2006-01-14  David Hyatt  <hyatt@apple.com>

        Convert QMemArray to Array.  QByteArray becomes ByteArray.
        KWQArrayImpl becomes ArrayImpl.

        Reviewed by anders

        * ForwardingHeaders/qmemarray.h: Removed.
        * WebCore.xcodeproj/project.pbxproj:
        * khtml/css/cssstyleselector.h:
        * khtml/ecma/xmlhttprequest.cpp:
        (KJS::XMLHttpRequest::send):
        (KJS::XMLHttpRequest::processSyncLoadResults):
        * khtml/ecma/xmlhttprequest.h:
        * khtml/html/HTMLOptionElementImpl.cpp:
        (DOM::HTMLOptionElementImpl::index):
        * khtml/html/HTMLSelectElementImpl.cpp:
        (DOM::HTMLSelectElementImpl::selectedIndex):
        (DOM::HTMLSelectElementImpl::setSelectedIndex):
        (DOM::HTMLSelectElementImpl::length):
        (DOM::HTMLSelectElementImpl::remove):
        (DOM::HTMLSelectElementImpl::value):
        (DOM::HTMLSelectElementImpl::setValue):
        (DOM::HTMLSelectElementImpl::state):
        (DOM::HTMLSelectElementImpl::restoreState):
        (DOM::HTMLSelectElementImpl::appendFormData):
        (DOM::HTMLSelectElementImpl::optionToListIndex):
        (DOM::HTMLSelectElementImpl::listToOptionIndex):
        (DOM::HTMLSelectElementImpl::reset):
        (DOM::HTMLSelectElementImpl::notifyOptionSelected):
        * khtml/html/HTMLSelectElementImpl.h:
        (DOM::HTMLSelectElementImpl::listItems):
        * khtml/misc/formdata.cpp:
        (khtml::FormData::flatten):
        (khtml::FormData::flattenToString):
        * khtml/misc/formdata.h:
        (khtml::FormDataElement::FormDataElement):
        * khtml/rendering/bidi.cpp:
        (khtml::RenderBlock::layoutInlineChildren):
        * khtml/rendering/render_form.cpp:
        (RenderSelect::updateFromElement):
        (RenderSelect::layout):
        (RenderSelect::slotSelected):
        (RenderSelect::slotSelectionChanged):
        (RenderSelect::updateSelection):
        * khtml/rendering/render_table.cpp:
        (RenderTableSection::addCell):
        (RenderTableSection::setCellWidths):
        * khtml/rendering/render_table.h:
        * khtml/rendering/table_layout.cpp:
        (FixedTableLayout::layout):
        * khtml/rendering/table_layout.h:
        * khtml/xsl/xslt_processorimpl.cpp:
        (DOM::docLoaderFunc):
        * kwq/KWQArrayImpl.cpp: Removed.
        * kwq/KWQArrayImpl.h: Removed.
        * kwq/KWQBuffer.cpp:
        (QBuffer::setBuffer):
        * kwq/KWQBuffer.h:
        (QBuffer::QBuffer):
        (QBuffer::buffer):
        * kwq/KWQCString.cpp:
        (QCString::QCString):
        (QCString::resize):
        (QCString::append):
        * kwq/KWQCString.h:
        * kwq/KWQKURL.mm:
        (findHostnamesInMailToURL):
        (encodeHostnames):
        * kwq/KWQLoader.h:
        * kwq/KWQLoader.mm:
        (KWQServeSynchronousRequest):
        * kwq/KWQMemArray.h: Removed.
        * kwq/KWQPixmap.h:
        * kwq/KWQPixmap.mm:
        (QPixmap::QPixmap):
        (QPixmap::receivedData):
        * kwq/KWQString.h:
        * kwq/KWQString.mm:
        (QString::QString):
        * kwq/KWQTextCodec.cpp:
        (QTextCodec::toUnicode):
        * kwq/KWQTextCodec.h:
        * kwq/KWQTextStream.cpp:
        (QTextStream::QTextStream):
        * kwq/KWQTextStream.h:
        * page/Frame.h:
        * platform/Array.h: Added.
        (WebCore::Array::Array):
        (WebCore::Array::duplicate):
        (WebCore::Array::assign):
        (WebCore::Array::operator==):
        (WebCore::Array::operator!=):
        * platform/ArrayImpl.cpp: Added.
        (WebCore::ArrayImpl::ArrayPrivate::ArrayPrivate):
        (WebCore::ArrayImpl::ArrayPrivate::~ArrayPrivate):
        (WebCore::ArrayImpl::ArrayImpl):
        (WebCore::ArrayImpl::~ArrayImpl):
        (WebCore::ArrayImpl::operator=):
        (WebCore::ArrayImpl::data):
        (WebCore::ArrayImpl::resize):
        (WebCore::ArrayImpl::duplicate):
        (WebCore::ArrayImpl::detach):
        (WebCore::ArrayImpl::fill):
        (WebCore::ArrayImpl::operator==):
        * platform/ArrayImpl.h: Added.
        (WebCore::ArrayImpl::size):
        * platform/IntPointArray.cpp:
        (IntPointArray::setPoint):
        * platform/IntPointArray.h:
        (WebCore::IntPointArray::IntPointArray):

2006-01-14  David Hyatt  <hyatt@apple.com>

        Convert QRect/QRectF -> IntRect/FloatRect.  Same drill as point
        and size.

        Reviewed by mjs

        * ForwardingHeaders/qrect.h: Removed.
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/MacFrame.mm:
        (MacFrame::snapshotDragImage):
        (MacFrame::setDisplaysWithFocusAttributes):
        * bridge/mac/WebCoreFrameBridge.mm:
        (-[WebCoreFrameBridge drawRect:withPainter:]):
        (-[WebCoreFrameBridge firstRectForDOMRange:]):
        (-[WebCoreFrameBridge ensureSelectionVisible]):
        * kcanvas/KCanvasContainer.cpp:
        (KCanvasContainer::relativeBBox):
        (KCanvasContainer::getAspectRatio):
        * kcanvas/KCanvasContainer.h:
        * kcanvas/KCanvasFilters.cpp:
        (KCanvasFilterEffect::subRegion):
        (KCanvasFilterEffect::setSubRegion):
        * kcanvas/KCanvasFilters.h:
        (KCanvasFilter::filterRect):
        (KCanvasFilter::setFilterRect):
        * kcanvas/KCanvasItem.cpp:
        (RenderPath::relativeBBox):
        * kcanvas/KCanvasItem.h:
        * kcanvas/KCanvasResources.cpp:
        (KCanvasMarker::draw):
        * kcanvas/KCanvasResources.h:
        * kcanvas/KCanvasTreeDebug.cpp:
        (operator<<):
        * kcanvas/KCanvasTreeDebug.h:
        * kcanvas/RenderSVGImage.cpp:
        (RenderSVGImage::paint):
        * kcanvas/device/KRenderingDevice.h:
        * kcanvas/device/KRenderingPaintServerPattern.cpp:
        (KRenderingPaintServerPattern::setBbox):
        (KRenderingPaintServerPattern::bbox):
        * kcanvas/device/KRenderingPaintServerPattern.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.mm:
        (KCanvasFilterQuartz::prepareFilter):
        (KCanvasFilterQuartz::applyFilter):
        * kcanvas/device/quartz/KCanvasItemQuartz.h:
        (KCanvasItemQuartz::getAbsoluteRepaintRect):
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (drawMarkerWithData):
        (KCanvasItemQuartz::drawMarkersIfNeeded):
        (KCanvasItemQuartz::bboxForPath):
        * kcanvas/device/quartz/KCanvasMaskerQuartz.h:
        * kcanvas/device/quartz/KCanvasMaskerQuartz.mm:
        (KCanvasMaskerQuartz::applyMask):
        * kcanvas/device/quartz/KCanvasResourcesQuartz.h:
        (KCanvasContainerQuartz::getAbsoluteRepaintRect):
        * kcanvas/device/quartz/KCanvasResourcesQuartz.mm:
        (KCanvasContainerQuartz::layout):
        (KCanvasContainerQuartz::paint):
        (KCanvasContainerQuartz::setViewport):
        (KCanvasContainerQuartz::viewport):
        (KCanvasContainerQuartz::setViewBox):
        (KCanvasContainerQuartz::viewBox):
        (KCanvasContainerQuartz::absoluteTransform):
        (KCanvasClipperQuartz::applyClip):
        * kcanvas/device/quartz/KRenderingDeviceQuartz.h:
        * kcanvas/device/quartz/KRenderingDeviceQuartz.mm:
        (KRenderingDeviceContextQuartz::mapFromVisual):
        (KRenderingDeviceContextQuartz::mapToVisual):
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.mm:
        (KRenderingPaintServerImageQuartz::draw):
        * kcanvas/device/quartz/QuartzSupport.h:
        * khtml/ecma/kjs_window.cpp:
        (KJS::Screen::getValueProperty):
        (KJS::showModalDialog):
        (KJS::Window::getValueProperty):
        (KJS::constrainToVisible):
        (KJS::WindowFunc::callAsFunction):
        * khtml/editing/SelectionController.cpp:
        (khtml::caretY):
        (khtml::SelectionController::layout):
        (khtml::SelectionController::caretRect):
        (khtml::SelectionController::caretRepaintRect):
        (khtml::SelectionController::paintCaret):
        * khtml/editing/SelectionController.h:
        * khtml/html/html_imageimpl.cpp:
        (DOM::HTMLAreaElementImpl::getRect):
        * khtml/html/html_imageimpl.h:
        * khtml/html/html_inlineimpl.cpp:
        (DOM::HTMLAnchorElementImpl::isFocusable):
        * khtml/misc/CachedImage.cpp:
        (khtml::CachedImage::valid_rect):
        (khtml::CachedImage::do_notify):
        (khtml::CachedImage::error):
        * khtml/misc/CachedImage.h:
        * khtml/misc/khtmllayout.h:
        (khtml::GapRects::left):
        (khtml::GapRects::center):
        (khtml::GapRects::right):
        (khtml::GapRects::uniteLeft):
        (khtml::GapRects::uniteCenter):
        (khtml::GapRects::uniteRight):
        (khtml::GapRects::operator IntRect):
        * khtml/misc/loader_client.h:
        (khtml::CachedObjectClient::setPixmap):
        * khtml/rendering/InlineTextBox.cpp:
        (khtml::InlineTextBox::selectionRect):
        (khtml::InlineTextBox::nodeAtPoint):
        * khtml/rendering/InlineTextBox.h:
        * khtml/rendering/RenderText.cpp:
        (khtml::RenderText::absoluteRects):
        (khtml::RenderText::caretRect):
        (khtml::RenderText::getAbsoluteRepaintRect):
        (khtml::RenderText::selectionRect):
        * khtml/rendering/RenderText.h:
        * khtml/rendering/bidi.cpp:
        (khtml::RenderBlock::layoutInlineChildren):
        * khtml/rendering/font.cpp:
        (khtml::Font::selectionRectForText):
        * khtml/rendering/font.h:
        * khtml/rendering/render_block.cpp:
        (khtml::RenderBlock::overflowRect):
        (khtml::RenderBlock::layoutBlock):
        (khtml::RenderBlock::getAbsoluteRepaintRectIncludingFloats):
        (khtml::RenderBlock::paint):
        (khtml::RenderBlock::fillHorizontalSelectionGap):
        (khtml::RenderBlock::fillVerticalSelectionGap):
        (khtml::RenderBlock::fillLeftSelectionGap):
        (khtml::RenderBlock::fillRightSelectionGap):
        (khtml::RenderBlock::floatRect):
        (khtml::RenderBlock::isPointInScrollbar):
        (khtml::RenderBlock::nodeAtPoint):
        * khtml/rendering/render_block.h:
        (khtml::RenderBlock::selectionRect):
        * khtml/rendering/render_box.cpp:
        (RenderBox::nodeAtPoint):
        (RenderBox::paintBoxDecorations):
        (RenderBox::paintBackgroundExtended):
        (RenderBox::getOverflowClipRect):
        (RenderBox::getClipRect):
        (RenderBox::getAbsoluteRepaintRect):
        (RenderBox::computeAbsoluteRepaintRect):
        (RenderBox::caretRect):
        * khtml/rendering/render_box.h:
        (khtml::RenderBox::borderBox):
        * khtml/rendering/render_br.cpp:
        (khtml::RenderBR::caretRect):
        * khtml/rendering/render_br.h:
        (khtml::RenderBR::selectionRect):
        * khtml/rendering/render_button.cpp:
        (khtml::RenderButton::paintObject):
        * khtml/rendering/render_canvas.cpp:
        (RenderCanvas::repaintViewRectangle):
        (RenderCanvas::getAbsoluteRepaintRect):
        (RenderCanvas::computeAbsoluteRepaintRect):
        (RenderCanvas::absoluteRects):
        (RenderCanvas::selectionRect):
        (RenderCanvas::viewRect):
        * khtml/rendering/render_canvas.h:
        (khtml::RenderCanvas::printRect):
        (khtml::RenderCanvas::setPrintRect):
        * khtml/rendering/render_canvasimage.cpp:
        (RenderCanvasImage::paint):
        (RenderCanvasImage::layout):
        * khtml/rendering/render_flexbox.cpp:
        (khtml::RenderFlexibleBox::layoutBlock):
        * khtml/rendering/render_flow.cpp:
        (RenderFlow::getAbsoluteRepaintRect):
        (RenderFlow::caretRect):
        (RenderFlow::paintOutlines):
        (RenderFlow::paintOutlineForLine):
        * khtml/rendering/render_flow.h:
        * khtml/rendering/render_frames.cpp:
        (RenderFrameSet::userResize):
        (RenderPart::updateWidgetPosition):
        * khtml/rendering/render_image.cpp:
        (RenderImage::setImage):
        (RenderImage::setPixmap):
        (RenderImage::paint):
        (RenderImage::layout):
        * khtml/rendering/render_image.h:
        * khtml/rendering/render_inline.cpp:
        (RenderInline::absoluteRects):
        * khtml/rendering/render_inline.h:
        * khtml/rendering/render_layer.cpp:
        (khtml::RenderLayer::updateLayerPositions):
        (khtml::RenderLayer::scrollRectToVisible):
        (khtml::RenderLayer::getRectToExpose):
        (khtml::RenderLayer::positionScrollbars):
        (khtml::RenderLayer::updateScrollInfoAfterLayout):
        (khtml::RenderLayer::paintScrollbars):
        (khtml::RenderLayer::paint):
        (khtml::setClip):
        (khtml::restoreClip):
        (khtml::RenderLayer::paintLayer):
        (khtml::RenderLayer::hitTest):
        (khtml::RenderLayer::hitTestLayer):
        (khtml::RenderLayer::calculateClipRects):
        (khtml::RenderLayer::calculateRects):
        (khtml::mustExamineRenderer):
        (khtml::RenderLayer::intersectsDamageRect):
        (khtml::RenderLayer::containsPoint):
        * khtml/rendering/render_layer.h:
        (khtml::ClipRects::m_refCnt):
        (khtml::ClipRects::overflowClipRect):
        (khtml::ClipRects::fixedClipRect):
        (khtml::ClipRects::posClipRect):
        (khtml::RenderLayer::repaintRect):
        * khtml/rendering/render_line.cpp:
        (khtml::InlineBox::canAccommodateEllipsis):
        (khtml::InlineFlowBox::nodeAtPoint):
        (khtml::InlineFlowBox::paintBackground):
        (khtml::InlineFlowBox::paintBackgroundAndBorder):
        (khtml::EllipsisBox::nodeAtPoint):
        * khtml/rendering/render_list.cpp:
        (RenderListItem::getAbsoluteRepaintRect):
        (RenderListMarker::setPixmap):
        * khtml/rendering/render_list.h:
        * khtml/rendering/render_object.cpp:
        (RenderObject::paintBorderImage):
        (RenderObject::paintBorder):
        (RenderObject::absoluteRects):
        (RenderObject::absoluteBoundingBoxRect):
        (RenderObject::addAbsoluteRectForLayer):
        (RenderObject::paintingRootRect):
        (RenderObject::repaintRectangle):
        (RenderObject::repaintAfterLayoutIfNeeded):
        (RenderObject::getAbsoluteRepaintRectWithOutline):
        (RenderObject::getAbsoluteRepaintRect):
        (RenderObject::getAbsoluteRepaintRectIncludingFloats):
        (RenderObject::computeAbsoluteRepaintRect):
        (RenderObject::viewRect):
        (RenderObject::caretRect):
        (RenderObject::addDashboardRegions):
        (RenderObject::setPixmap):
        * khtml/rendering/render_object.h:
        (khtml::RenderObject::getOverflowClipRect):
        (khtml::RenderObject::getClipRect):
        (khtml::RenderObject::relativeBBox):
        (khtml::RenderObject::PaintInfo::PaintInfo):
        (khtml::RenderObject::RepaintInfo::m_repaintRect):
        (khtml::RenderObject::borderBox):
        (khtml::RenderObject::overflowRect):
        (khtml::RenderObject::floatRect):
        (khtml::RenderObject::selectionRect):
        (khtml::RenderObject::SelectionInfo::rect):
        * khtml/rendering/render_replaced.cpp:
        (RenderReplaced::selectionRect):
        (RenderWidget::paint):
        (RenderWidget::updateWidgetPosition):
        * khtml/rendering/render_replaced.h:
        * khtml/rendering/render_table.cpp:
        (RenderTable::layout):
        (RenderTableRow::getAbsoluteRepaintRect):
        (RenderTableCell::computeAbsoluteRepaintRect):
        (RenderTableCell::getAbsoluteRepaintRect):
        (RenderTableCell::paintBoxDecorations):
        * khtml/rendering/render_table.h:
        * khtml/rendering/render_theme.cpp:
        (khtml::RenderTheme::paint):
        * khtml/rendering/render_theme.h:
        (khtml::RenderTheme::adjustRepaintRect):
        * khtml/rendering/render_theme_mac.h:
        * khtml/rendering/render_theme_mac.mm:
        (khtml::RenderThemeMac::adjustRepaintRect):
        (khtml::RenderThemeMac::inflateRect):
        (khtml::RenderThemeMac::paintCheckbox):
        (khtml::RenderThemeMac::setCheckboxCellState):
        (khtml::RenderThemeMac::paintRadio):
        (khtml::RenderThemeMac::setRadioCellState):
        (khtml::RenderThemeMac::setButtonCellState):
        (khtml::RenderThemeMac::paintButton):
        * khtml/xml/dom_elementimpl.cpp:
        (ElementImpl::scrollIntoView):
        * khtml/xml/dom_nodeimpl.cpp:
        (DOM::NodeImpl::getRect):
        (DOM::ContainerNodeImpl::getRect):
        * khtml/xml/dom_nodeimpl.h:
        * ksvg2/css/SVGRenderStyle.h:
        * ksvg2/svg/SVGFilterElementImpl.cpp:
        (SVGFilterElementImpl::canvasResource):
        * ksvg2/svg/SVGFilterPrimitiveStandardAttributesImpl.cpp:
        (SVGFilterPrimitiveStandardAttributesImpl::setStandardAttributes):
        * ksvg2/svg/SVGLengthImpl.cpp:
        (SVGLengthImpl::value):
        * ksvg2/svg/SVGLocatableImpl.cpp:
        (SVGLocatableImpl::getBBox):
        * ksvg2/svg/SVGMaskElementImpl.cpp:
        (KSVG::SVGMaskElementImpl::drawMaskerContent):
        * ksvg2/svg/SVGPatternElementImpl.cpp:
        (SVGPatternElementImpl::drawPatternContentIntoTile):
        * ksvg2/svg/SVGSVGElementImpl.cpp:
        (SVGSVGElementImpl::checkIntersection):
        (SVGSVGElementImpl::checkEnclosure):
        (SVGSVGElementImpl::createRenderer):
        * kwq/KWQAccObject.mm:
        (boundingBoxRect):
        (-[KWQAccObject position]):
        (-[KWQAccObject size]):
        (-[KWQAccObject doAXBoundsForTextMarkerRange:]):
        * kwq/KWQApplication.h:
        * kwq/KWQApplication.mm:
        (QDesktopWidget::screenGeometry):
        (QDesktopWidget::availableGeometry):
        * kwq/KWQComboBox.h:
        * kwq/KWQComboBox.mm:
        (QComboBox::frameGeometry):
        (QComboBox::setFrameGeometry):
        * kwq/KWQFileButton.h:
        * kwq/KWQFileButton.mm:
        (KWQFileButton::frameGeometry):
        (KWQFileButton::setFrameGeometry):
        * kwq/KWQFontMetrics.h:
        * kwq/KWQFontMetrics.mm:
        (QFontMetrics::selectionRectForText):
        (QFontMetrics::boundingRect):
        * kwq/KWQKWinModule.h:
        * kwq/KWQKWinModule.mm:
        (KWinModule::workArea):
        * kwq/KWQObject.h:
        * kwq/KWQPainter.h:
        * kwq/KWQPainter.mm:
        (QPainter::xForm):
        (QPainter::drawPixmap):
        (QPainter::fillRect):
        (QPainter::addClip):
        (QPainter::addRoundedRectClip):
        * kwq/KWQPixmap.h:
        * kwq/KWQPixmap.mm:
        (QPixmap::setAnimationRect):
        (QPixmap::rect):
        * kwq/KWQRect.h: Removed.
        * kwq/KWQRect.mm: Removed.
        * kwq/KWQRectF.h: Removed.
        * kwq/KWQRectF.mm: Removed.
        * kwq/KWQRegion.cpp:
        (QRegion::QRegion):
        (QRegion::boundingRect):
        * kwq/KWQRegion.h:
        * kwq/KWQRenderTreeDebug.cpp:
        (operator<<):
        (write):
        (writeLayers):
        (externalRepresentation):
        * kwq/KWQScrollView.h:
        * kwq/KWQScrollView.mm:
        (QScrollView::updateContents):
        * kwq/KWQWMatrix.cpp:
        (QWMatrix::mapRect):
        * kwq/KWQWMatrix.h:
        * kwq/KWQWidget.h:
        * kwq/KWQWidget.mm:
        (QWidget::resize):
        (QWidget::move):
        (QWidget::frameGeometry):
        (QWidget::setFrameGeometry):
        (QWidget::paint):
        * kwq/KWQWindowWidget.h:
        * kwq/KWQWindowWidget.mm:
        (KWQWindowWidget::frameGeometry):
        (KWQWindowWidget::setFrameGeometry):
        * page/Frame.cpp:
        (Frame::gotoAnchor):
        (Frame::paintCaret):
        (Frame::paintDragCaret):
        (Frame::selectionRect):
        (Frame::revealSelection):
        (Frame::paint):
        (Frame::adjustPageHeight):
        (Frame::centerSelectionInVisibleArea):
        * page/Frame.h:
        * page/FrameView.cpp:
        (KHTMLView::addRepaintInfo):
        (KHTMLView::scrollTo):
        (KHTMLView::focusNextPrevNode):
        (KHTMLView::repaintRectangle):
        * page/FrameView.h:
        * platform/FloatRect.cpp: Added.
        (WebCore::FloatRect::FloatRect):
        (WebCore::FloatRect::isNull):
        (WebCore::FloatRect::isValid):
        (WebCore::FloatRect::isEmpty):
        (WebCore::FloatRect::right):
        (WebCore::FloatRect::bottom):
        (WebCore::FloatRect::topLeft):
        (WebCore::FloatRect::topRight):
        (WebCore::FloatRect::bottomRight):
        (WebCore::FloatRect::bottomLeft):
        (WebCore::FloatRect::size):
        (WebCore::FloatRect::unite):
        (WebCore::FloatRect::normalize):
        (WebCore::FloatRect::intersects):
        (WebCore::FloatRect::intersect):
        (WebCore::FloatRect::inflate):
        (WebCore::operator==):
        (WebCore::operator!=):
        * platform/FloatRect.h: Added.
        (WebCore::FloatRect::contains):
        (WebCore::FloatRect::operator&):
        (WebCore::enclosingIntRect):
        * platform/IntPointArray.cpp:
        (IntPointArray::IntPointArray):
        (IntPointArray::boundingRect):
        * platform/IntPointArray.h:
        * platform/IntRect.cpp: Added.
        (WebCore::IntRect::IntRect):
        (WebCore::IntRect::isNull):
        (WebCore::IntRect::isValid):
        (WebCore::IntRect::isEmpty):
        (WebCore::IntRect::right):
        (WebCore::IntRect::bottom):
        (WebCore::IntRect::topLeft):
        (WebCore::IntRect::topRight):
        (WebCore::IntRect::bottomRight):
        (WebCore::IntRect::bottomLeft):
        (WebCore::IntRect::size):
        (WebCore::IntRect::unite):
        (WebCore::IntRect::normalize):
        (WebCore::IntRect::intersects):
        (WebCore::IntRect::intersect):
        (WebCore::IntRect::inflate):
        (WebCore::operator==):
        (WebCore::operator!=):
        * platform/IntRect.h: Added.
        (WebCore::IntRect::contains):
        (WebCore::IntRect::operator&):
        * platform/mac/FloatRect.mm: Added.
        (WebCore::FloatRect::FloatRect):
        (WebCore::FloatRect::operator NSRect):
        (WebCore::FloatRect::operator CGRect):
        * platform/mac/IntRect.mm: Added.
        (WebCore::IntRect::IntRect):
        (WebCore::IntRect::operator NSRect):
        (WebCore::IntRect::operator CGRect):

2006-01-13  David Hyatt  <hyatt@apple.com>

        Convert QPointF to FloatPoint and move it to the platform
        directory.

        * WebCore.xcodeproj/project.pbxproj:
        * kcanvas/KCanvasContainer.cpp:
        (KCanvasContainer::fillContains):
        (KCanvasContainer::strokeContains):
        * kcanvas/KCanvasContainer.h:
        * kcanvas/KCanvasFilters.h:
        (KCanvasFEConvolveMatrix::kernelUnitLength):
        (KCanvasFEConvolveMatrix::setKernelUnitLength):
        * kcanvas/KCanvasItem.cpp:
        (RenderPath::fillContains):
        (RenderPath::strokeContains):
        * kcanvas/KCanvasItem.h:
        * kcanvas/KCanvasTreeDebug.cpp:
        (operator<<):
        * kcanvas/KCanvasTreeDebug.h:
        * kcanvas/device/KRenderingPaintServerGradient.cpp:
        (KRenderingPaintServerLinearGradient::gradientStart):
        (KRenderingPaintServerLinearGradient::setGradientStart):
        (KRenderingPaintServerLinearGradient::gradientEnd):
        (KRenderingPaintServerLinearGradient::setGradientEnd):
        (KRenderingPaintServerRadialGradient::gradientCenter):
        (KRenderingPaintServerRadialGradient::setGradientCenter):
        (KRenderingPaintServerRadialGradient::gradientFocal):
        (KRenderingPaintServerRadialGradient::setGradientFocal):
        * kcanvas/device/KRenderingPaintServerGradient.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.mm:
        (ciVector):
        * kcanvas/device/quartz/KCanvasItemQuartz.h:
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (KCanvasItemQuartz::nodeAtPoint):
        (KCanvasItemQuartz::hitsPath):
        * ksvg2/svg/SVGLinearGradientElementImpl.cpp:
        (SVGLinearGradientElementImpl::buildGradient):
        * ksvg2/svg/SVGRadialGradientElementImpl.cpp:
        (SVGRadialGradientElementImpl::buildGradient):
        * kwq/KWQPointF.h: Removed.
        * kwq/KWQPointF.mm: Removed.
        * kwq/KWQRectF.h:
        (QRectF::contains):
        * kwq/KWQRectF.mm:
        (QRectF::QRectF):
        (QRectF::topLeft):
        (QRectF::topRight):
        (QRectF::bottomRight):
        (QRectF::bottomLeft):
        * platform/FloatPoint.cpp: Added.
        (WebCore::FloatPoint::FloatPoint):
        (WebCore::yCoord):
        (WebCore::operator+):
        (WebCore::operator-):
        (WebCore::operator*):
        * platform/FloatPoint.h: Added.
        (WebCore::FloatPoint::operator -=):
        * platform/mac/FloatPoint.mm: Added.
        (WebCore::FloatPoint::FloatPoint):
        (WebCore::FloatPoint::operator NSPoint):
        (WebCore::FloatPoint::operator CGPoint):

2006-01-13  David Hyatt  <hyatt@apple.com>

        Convert QPoint and QPointArray to IntPoint and IntPointArray.
        Factor out the Objective-C-specific logic into a .mm file
        for IntPoint.
        
        * ForwardingHeaders/qpoint.h: Removed.
        * ForwardingHeaders/qpointarray.h: Removed.
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/KWQKHTMLView.cpp:
        (KHTMLView::viewportToGlobal):
        * bridge/mac/KWQKPartsBrowserExtension.h:
        * bridge/mac/MacFrame.h:
        * bridge/mac/MacFrame.mm:
        (MacFrame::khtmlMouseMoveEvent):
        (MacFrame::dragSourceMovedTo):
        (MacFrame::dragSourceEndedAt):
        (MacFrame::dispatchDragSrcEvent):
        * bridge/mac/WebCoreFrameBridge.mm:
        (-[WebCoreFrameBridge elementAtPoint:]):
        (-[WebCoreFrameBridge dragOperationForDraggingInfo:]):
        (-[WebCoreFrameBridge dragExitedWithDraggingInfo:]):
        (-[WebCoreFrameBridge concludeDragForDraggingInfo:]):
        (-[WebCoreFrameBridge dragSourceMovedTo:]):
        (-[WebCoreFrameBridge dragSourceEndedAt:operation:]):
        * kcanvas/KCanvasItem.h:
        * kcanvas/KCanvasTreeDebug.cpp:
        (operator<<):
        * kcanvas/KCanvasTreeDebug.h:
        * kcanvas/device/KRenderingPaintServerGradient.cpp:
        * kcanvas/device/KRenderingPaintServerPattern.h:
        * khtml/ecma/kjs_events.cpp:
        (KJS::ClipboardProtoFunc::callAsFunction):
        * khtml/ecma/kjs_window.cpp:
        (KJS::WindowFunc::callAsFunction):
        * khtml/editing/SelectionController.cpp:
        (khtml::SelectionController::layout):
        (khtml::SelectionController::caretRect):
        * khtml/editing/SelectionController.h:
        * khtml/html/html_canvasimpl.cpp:
        * khtml/html/html_imageimpl.cpp:
        (DOM::HTMLAreaElementImpl::mapMouseEvent):
        (DOM::HTMLAreaElementImpl::getRegion):
        * khtml/rendering/render_image.cpp:
        (RenderImage::paint):
        * khtml/rendering/render_list.cpp:
        (RenderListMarker::paint):
        * khtml/rendering/render_object.cpp:
        (RenderObject::drawBorder):
        * khtml/xml/dom2_eventsimpl.h:
        * ksvg2/svg/SVGPointImpl.cpp:
        (SVGPointImpl::SVGPointImpl):
        * ksvg2/svg/SVGPointImpl.h:
        * ksvg2/svg/SVGSVGElementImpl.cpp:
        (SVGSVGElementImpl::createSVGPoint):
        * ksvg2/svg/SVGSVGElementImpl.h:
        * kwq/KWQClipboard.h:
        * kwq/KWQClipboard.mm:
        (KWQClipboard::dragLocation):
        (KWQClipboard::setDragImage):
        (KWQClipboard::setDragImageElement):
        * kwq/KWQCursor.h:
        * kwq/KWQEvent.h:
        (QMouseEvent::pos):
        (QWheelEvent::QWheelEvent):
        (QWheelEvent::pos):
        (QWheelEvent::globalPos):
        * kwq/KWQEvent.mm:
        (positionForEvent):
        (globalPositionForEvent):
        * kwq/KWQPainter.h:
        * kwq/KWQPainter.mm:
        (QPainter::drawConvexPolygon):
        (QPainter::drawPixmap):
        * kwq/KWQPixmap.mm:
        (QPixmap::rect):
        * kwq/KWQPoint.mm: Removed.
        * kwq/KWQPointArray.cpp: Removed.
        * kwq/KWQPointArray.h: Removed.
        * kwq/KWQPointF.h:
        * kwq/KWQPointF.mm:
        (yCoord):
        * kwq/KWQRect.h:
        (QRect::moveTopLeft):
        (QRect::contains):
        * kwq/KWQRect.mm:
        (QRect::QRect):
        (QRect::topLeft):
        (QRect::topRight):
        (QRect::bottomRight):
        (QRect::bottomLeft):
        * kwq/KWQRegion.cpp:
        (QRegion::QRegion):
        (QRegion::contains):
        * kwq/KWQRegion.h:
        * kwq/KWQScrollView.h:
        * kwq/KWQScrollView.mm:
        (QScrollView::contentsToViewport):
        * kwq/KWQWidget.h:
        * kwq/KWQWidget.mm:
        (QWidget::pos):
        (QWidget::move):
        (QWidget::mapFromGlobal):
        * kwq/KWQWindowWidget.h:
        * kwq/KWQWindowWidget.mm:
        (KWQWindowWidget::mapFromGlobal):
        (KWQWindowWidget::viewportToGlobal):
        * page/Frame.h:
        * page/FramePrivate.h:
        * page/FrameView.cpp:
        (KHTMLView::dispatchDragEvent):
        (KHTMLView::updateDragAndDrop):
        (KHTMLView::cancelDragAndDrop):
        (KHTMLView::performDragAndDrop):
        * page/FrameView.h:
        * platform/IntPoint.cpp: Added.
        (WebCore::IntPoint::IntPoint):
        (WebCore::operator+):
        (WebCore::operator-):
        (WebCore::operator*):
        * platform/IntPoint.h: Added.
        (WebCore::IntPoint::x):
        (WebCore::IntPoint::y):
        (WebCore::IntPoint::setX):
        (WebCore::IntPoint::setY):
        (WebCore::IntPoint::isNull):
        (WebCore::IntPoint::operator -=):
        * platform/IntPointArray.cpp: Added.
        (IntPointArray::IntPointArray):
        (IntPointArray::copy):
        (IntPointArray::boundingRect):
        (IntPointArray::point):
        (IntPointArray::setPoint):
        (IntPointArray::setPoints):
        * platform/IntPointArray.h: Added.
        (WebCore::IntPointArray::IntPointArray):

2006-01-13  David Hyatt  <hyatt@apple.com>
        
        Convert QSizeF to FloatSize and move it to the platform
        directory.
        
        * WebCore.xcodeproj/project.pbxproj:
        * kcanvas/KCanvasFilters.h:
        (KCanvasFEConvolveMatrix::kernelSize):
        (KCanvasFEConvolveMatrix::setKernelSize):
        (KCanvasFEConvolveMatrix::targetOffset):
        (KCanvasFEConvolveMatrix::setTargetOffset):
        * kcanvas/KCanvasTreeDebug.cpp:
        (operator<<):
        * kcanvas/KCanvasTreeDebug.h:
        * kwq/KWQRectF.h:
        * kwq/KWQRectF.mm:
        (QRectF::QRectF):
        (QRectF::size):
        * kwq/KWQSizeF.h: Removed.
        * kwq/KWQSizeF.mm: Removed.
        * platform/FloatSize.cpp: Added.
        (FloatSize::FloatSize):
        (FloatSize::isValid):
        (FloatSize::expandedTo):
        (operator+):
        (operator==):
        (operator!=):
        * platform/FloatSize.h: Added.
        * platform/mac/FloatSize.mm: Added.
        (FloatSize::FloatSize):
        (FloatSize::operator NSSize):
        (FloatSize::operator CGSize):

2006-01-13  David Hyatt  <hyatt@apple.com>

        Fix build bustage from QSize -> IntSize change.
        
        Reviewed by darin

        * kwq/KWQObject.h:
        * kwq/KWQSizeF.h:

2006-01-13  David Hyatt  <hyatt@apple.com>

        Eliminate QSize and add the new class IntSize in the
        platform subdirectory.  Factor out the Objective-C portion
        of IntSize into a platform-specific IntSize.mm that resides
        in the mac subdirectory.

        Win32 can just compile IntSize.cpp and doesn't need any
        platform-specific extension here.
        
        Reviewed by darin

        * WebCore.xcodeproj/project.pbxproj:
        * kcanvas/KCanvasImage.h:
        * kcanvas/device/quartz/KCanvasResourcesQuartz.h:
        (KCanvasImageQuartz::init):
        (KCanvasImageQuartz::size):
        * kcanvas/device/quartz/KRenderingDeviceQuartz.mm:
        (KRenderingDeviceQuartz::contextForImage):
        * khtml/css/cssstyleselector.cpp:
        (khtml::CSSStyleSelector::applyProperty):
        * khtml/ecma/kjs_html.cpp:
        (KJS::Image::getValueProperty):
        * khtml/ecma/kjs_window.cpp:
        (KJS::WindowFunc::callAsFunction):
        * khtml/misc/CachedImage.cpp:
        (khtml::CachedImage::pixmap_size):
        (khtml::CachedImage::data):
        * khtml/misc/CachedImage.h:
        * khtml/misc/CachedImageCallback.cpp:
        (khtml::CachedImageCallback::notifyUpdate):
        (khtml::CachedImageCallback::notifyFinished):
        * khtml/rendering/render_applet.cpp:
        (RenderApplet::createWidgetIfNecessary):
        * khtml/rendering/render_form.cpp:
        (RenderLineEdit::calcMinMaxWidth):
        (RenderFileButton::calcMinMaxWidth):
        (RenderSelect::layout):
        (RenderTextArea::calcMinMaxWidth):
        (RenderSlider::calcMinMaxWidth):
        * khtml/rendering/render_image.cpp:
        (RenderImage::paint):
        * khtml/rendering/render_object.cpp:
        (RenderObject::paintBorder):
        * khtml/rendering/render_style.h:
        (khtml::RenderStyle::borderTopLeftRadius):
        (khtml::RenderStyle::borderTopRightRadius):
        (khtml::RenderStyle::borderBottomLeftRadius):
        (khtml::RenderStyle::borderBottomRightRadius):
        (khtml::RenderStyle::setBorderTopLeftRadius):
        (khtml::RenderStyle::setBorderTopRightRadius):
        (khtml::RenderStyle::setBorderBottomLeftRadius):
        (khtml::RenderStyle::setBorderBottomRightRadius):
        (khtml::RenderStyle::setBorderRadius):
        (khtml::RenderStyle::initialBorderRadius):
        * khtml/rendering/render_theme_mac.h:
        * khtml/rendering/render_theme_mac.mm:
        (khtml::RenderThemeMac::inflateRect):
        (khtml::RenderThemeMac::setControlSize):
        (khtml::RenderThemeMac::sizeForFont):
        (khtml::RenderThemeMac::setSizeFromFont):
        (khtml::RenderThemeMac::checkboxSizes):
        (khtml::RenderThemeMac::setCheckboxCellState):
        (khtml::RenderThemeMac::radioSizes):
        (khtml::RenderThemeMac::setRadioCellState):
        (khtml::RenderThemeMac::buttonSizes):
        (khtml::RenderThemeMac::setButtonCellState):
        (khtml::RenderThemeMac::paintButton):
        * ksvg2/svg/SVGMaskElementImpl.cpp:
        (KSVG::SVGMaskElementImpl::attributeChanged):
        (KSVG::SVGMaskElementImpl::drawMaskerContent):
        * ksvg2/svg/SVGPatternElementImpl.cpp:
        (SVGPatternElementImpl::drawPatternContentIntoTile):
        (SVGPatternElementImpl::notifyAttributeChange):
        * ksvg2/svg/SVGPatternElementImpl.h:
        * kwq/KWQComboBox.h:
        * kwq/KWQComboBox.mm:
        (QComboBox::sizeHint):
        * kwq/KWQFileButton.h:
        * kwq/KWQFileButton.mm:
        (KWQFileButton::sizeForCharacterWidth):
        * kwq/KWQFontMetrics.h:
        * kwq/KWQFontMetrics.mm:
        (QFontMetrics::size):
        * kwq/KWQKJavaAppletWidget.h:
        * kwq/KWQKJavaAppletWidget.mm:
        (KJavaAppletWidget::KJavaAppletWidget):
        * kwq/KWQLineEdit.h:
        * kwq/KWQLineEdit.mm:
        (QLineEdit::sizeForCharacterWidth):
        * kwq/KWQListBox.h:
        * kwq/KWQListBox.mm:
        (QListBox::sizeForNumberOfLines):
        * kwq/KWQObject.h:
        * kwq/KWQPainter.h:
        * kwq/KWQPainter.mm:
        (QPainter::addRoundedRectClip):
        * kwq/KWQPixmap.h:
        * kwq/KWQPixmap.mm:
        (QPixmap::QPixmap):
        (QPixmap::size):
        (QPixmap::resize):
        * kwq/KWQRect.h:
        * kwq/KWQRect.mm:
        (QRect::QRect):
        (QRect::size):
        * kwq/KWQSize.h: Removed.
        * kwq/KWQSize.mm: Removed.
        * kwq/KWQSizeF.h:
        * kwq/KWQSizeF.mm:
        (QSizeF::QSizeF):
        * kwq/KWQSlider.h:
        * kwq/KWQSlider.mm:
        (QSlider::sizeHint):
        * kwq/KWQStyle.cpp:
        (QStyle::sizeFromContents):
        * kwq/KWQStyle.h:
        * kwq/KWQTextEdit.h:
        * kwq/KWQTextEdit.mm:
        (QTextEdit::sizeWithColumnsAndRows):
        * kwq/KWQWidget.h:
        * kwq/KWQWidget.mm:
        (QWidget::sizeHint):
        (QWidget::size):
        (QWidget::resize):
        * kwq/KWQWindowWidget.h:
        * kwq/KWQWindowWidget.mm:
        (KWQWindowWidget::sizeHint):
        * platform: Added.
        * platform/IntSize.cpp: Added.
        (WebCore::IntSize::IntSize):
        (WebCore::IntSize::isValid):
        (WebCore::IntSize::expandedTo):
        (WebCore::operator+):
        (WebCore::operator==):
        (WebCore::operator!=):
        * platform/IntSize.h: Added.
        * platform/mac: Added.
        * platform/mac/IntSize.mm: Added.
        (WebCore::IntSize::IntSize):
        (WebCore::IntSize::operator NSSize):
        (WebCore::IntSize::operator CGSize):

2006-01-13  Maks Orlovich <maksim@kde.org>

        Reviewed, redone a bit, and landed by Darin (help from Eric too).

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=4586
          rowIndex calculation doesn't consider head to come before body.

        Test: fast/table/rowindex.html

        * khtml/html/html_tableimpl.cpp: (DOM::HTMLTableRowElementImpl::rowIndex):
        Change algorithm so the rows are numbered in this order: (a) all rows in the
        table header section, (b) all rows in all table body sections, (c) all rows
        in the table footer section. Rows in extra table header or footer sections
        don't get row numbers (rowIndex returns -1). This matches Firefox.

2006-01-13  Mark Rowe  <opendarwin.org@bdash.net.nz>

        Reviewed, tweaked, and landed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6509
          content property with supported value followed by currently unsupported open-quote displays duplicated content

        Test: fast/css-generated-content/no-openclose-quote.html

        * khtml/css/cssparser.cpp: (CSSParser::parseContent): Make sure parsedValue
        is always initialized to 0 (in particular for the CSS_IDENT case which is
        currently unimplemented).

2006-01-13  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed and landed by Darin.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6418
          Incorrect scrollbar when using overflow:auto and word-wrap:break-word; in some cases
        
        Test: fast/text/basic/015.html

        * khtml/rendering/bidi.cpp:
        (khtml::RenderBlock::findNextLineBreak):
        Avoid inconsistent width measurement when breaking in the middle of a
        word is allowed. Eliminate the relaxation by 1 of the width overflow
        check that was supposed to compensate for the inconsistency but didn't
        always work, and on the other hand sometimes resulted in allowing text
        to overflow its container by one pixel.
        Also applied start and end width correctly in the break-words case.

2006-01-12  Maciej Stachowiak  <mjs@apple.com>

        Rubber stamped by Eric.

        - rename WebCoreBridge to WebCoreFrameBridge

        * WebCore.exp:
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/KWQKHTMLPartBrowserExtension.mm:
        (KHTMLPartBrowserExtension::createNewWindow):
        * bridge/mac/MacFrame.h:
        (MacFrame::bridge):
        * bridge/mac/MacFrame.mm:
        (MacFrame::submitForm):
        (MacFrame::createPart):
        (MacFrame::bridgeForWidget):
        (MacFrame::documentViewForNode):
        (MacFrame::setBridge):
        * bridge/mac/WebCoreBridge.h: Removed.
        * bridge/mac/WebCoreBridge.mm: Removed.
        * bridge/mac/WebCoreFrameBridge.h: Added.
        * bridge/mac/WebCoreFrameBridge.mm: Added.
        (-[WebCoreFrameBridge executionContextForView:]):
        (frameHasSelection):
        (-[WebCoreFrameBridge firstChild]):
        (-[WebCoreFrameBridge lastChild]):
        (-[WebCoreFrameBridge previousSibling]):
        (-[WebCoreFrameBridge nextSibling]):
        (-[WebCoreFrameBridge isDescendantOfFrame:]):
        (-[WebCoreFrameBridge traverseNextFrameStayWithin:]):
        (-[WebCoreFrameBridge appendChild:]):
        (-[WebCoreFrameBridge removeChild:]):
        (-[WebCoreFrameBridge childFrameNamed:]):
        (-[WebCoreFrameBridge _deepLastChildFrame]):
        (-[WebCoreFrameBridge nextFrameWithWrap:]):
        (-[WebCoreFrameBridge previousFrameWithWrap:]):
        (-[WebCoreFrameBridge _shouldAllowAccessFrom:]):
        (-[WebCoreFrameBridge _descendantFrameNamed:sourceFrame:]):
        (-[WebCoreFrameBridge _frameInAnyWindowNamed:sourceFrame:]):
        (-[WebCoreFrameBridge findFrameNamed:]):
        (+[WebCoreFrameBridge bridgeForDOMDocument:]):
        (-[WebCoreFrameBridge setParent:]):
        (-[WebCoreFrameBridge parent]):
        (nowPrinting):
        (-[WebCoreFrameBridge opener]):
        (-[WebCoreFrameBridge setOpener:]):
        (+[WebCoreFrameBridge stringWithData:textEncodingName:]):
        * kwq/KWQAccObject.mm:
        (-[KWQAccObject rendererForView:]):
        * kwq/KWQComboBox.mm:
        (-[KWQPopUpButtonCell trackMouse:inRect:ofView:untilMouseUp:]):
        * kwq/KWQFileButton.mm:
        (KWQFileButton::focusPolicy):
        * kwq/KWQFrame.mm:
        * kwq/KWQKJavaAppletWidget.mm:
        * kwq/KWQLineEdit.mm:
        * kwq/KWQListBox.mm:
        (-[KWQTableView keyDown:]):
        (-[KWQTableView keyUp:]):
        * kwq/KWQLoader.mm:
        (KWQServeRequest):
        (KWQServeSynchronousRequest):
        (KWQCheckCacheObjectStatus):
        (KWQCacheObjectExpiresTime):
        * kwq/KWQSlider.mm:
        (QSlider::focusPolicy):
        * kwq/KWQTextArea.mm:
        (-[KWQTextAreaTextView textDidChange:]):
        (-[KWQTextAreaTextView _trackResizeFromMouseDown:]):
        (-[KWQTextAreaTextView keyDown:]):
        (-[KWQTextAreaTextView keyUp:]):
        * kwq/KWQTextField.mm:
        (-[KWQTextFieldController controlTextDidBeginEditing:]):
        (-[KWQTextFieldController controlTextDidEndEditing:]):
        (-[KWQTextFieldController controlTextDidChange:]):
        (-[KWQTextFieldController control:textView:doCommandBySelector:]):
        (-[KWQTextFieldController textView:shouldHandleEvent:]):
        * kwq/KWQWidget.mm:
        (QWidget::setFocus):
        * kwq/KWQWindowWidget.h:
        * kwq/KWQWindowWidget.mm:
        (KWQWindowWidget::KWQWindowWidget):
        * kwq/WebCoreFrameNamespaces.h:
        * kwq/WebCoreFrameNamespaces.m:
        (+[WebCoreFrameNamespaces addFrame:toNamespace:]):
        * kwq/WebCoreFrameView.h:
        * kwq/WebCoreSettings.mm:
        * kwq/WebCoreTextRendererFactory.mm:
        * kwq/WebCoreViewFactory.h:

2006-01-13  Darin Adler  <darin@apple.com>

        - Replaced tabs with spaces in source files that had less than 10 lines with tabs.
        - Set allow-tabs Subversion property in source files that have more than 10 lines with tabs.

2006-01-13  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Remove CG dependencies from kcanvas/device/quartz
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6521
        Adding file omitted from last commit.

        * kcanvas/RenderSVGImage.cpp:
        (RenderSVGImage::paint): removed cg calls

2006-01-13  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Remove CG dependencies from kcanvas/device/quartz
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6521

        * kcanvas/KCanvasFilters.h:
        * kcanvas/KCanvasResources.h:
        * kcanvas/device/KRenderingDevice.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.mm:
        (KCanvasFilterQuartz::prepareFilter): removed parameter
        (KCanvasFilterQuartz::applyFilter): removed parameter
        * kcanvas/device/quartz/KCanvasItemQuartz.h:
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (KCanvasItemQuartz::drawMarkersIfNeeded): removed cg call
        (KCanvasItemQuartz::paint): removed cg calls
        (getSharedContext): spacing
        * kcanvas/device/quartz/KCanvasMaskerQuartz.h:
        * kcanvas/device/quartz/KCanvasMaskerQuartz.mm:
        (KCanvasMaskerQuartz::applyMask): removed parameter
        * kcanvas/device/quartz/KCanvasResourcesQuartz.h:
        (KCanvasClipperQuartz::KCanvasClipperQuartz):
        (KCanvasImageQuartz::KCanvasImageQuartz):
        * kcanvas/device/quartz/KCanvasResourcesQuartz.mm:
        (KCanvasContainerQuartz::paint): removed CG calls
        (KCanvasClipperQuartz::applyClip): removed parameter
        (KCanvasImageQuartz::~KCanvasImageQuartz):
        (KCanvasImageQuartz::cgLayer): spacing
        (KCanvasImageQuartz::setCGLayer): spacing
        * kcanvas/device/quartz/KRenderingDeviceQuartz.h:
        * kcanvas/device/quartz/KRenderingDeviceQuartz.mm:
        (KRenderingDeviceContextQuartz::clearPath): added.
        (KRenderingDeviceContextQuartz::addPath): added.
        (KRenderingDeviceQuartz::quartzContext): spacing

2006-01-13  Darin Adler  <darin@apple.com>

        Reviewed by Hyatt.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6508
          retire APPLE_CHANGES

        * WebCore.vcproj/WebCore/WebCore.vcproj: Don't set APPLE_CHANGES or
        HAVE_CONFIG_H any more.

        * WebCore.xcodeproj/project.pbxproj: Don't set APPLE_CHANGES or
        KHTML_NO_CPLUSPLUS_DOM any more.

        * kcanvas/KCanvasFilters.h:
        Use __APPLE__ instead of APPLE_CHANGES.

        * bridge/mac/MacFrame.mm: (MacFrame::respondToChangedContents):
        * kcanvas/KCanvasTreeDebug.cpp:
        * ksvg2/svg/SVGAElementImpl.cpp: (SVGAElementImpl::defaultEventHandler):
        * ksvg2/svg/SVGElementImpl.h: (KSVG::svg_dynamic_cast):
        * ksvg2/svg/SVGScriptElementImpl.cpp: (SVGScriptElementImpl::executeScript):
        * page/Frame.cpp: (Frame::paint):
        Make some APPLE_CHANGES code unconditional.

        * WebCore+SVG/kdom.h:
        * ksvg2/ecma/Ecma.cpp: (Ecma::setupDocument):
        * ksvg2/svg/SVGCursorElementImpl.cpp:
        * ksvg2/svg/SVGImageElementImpl.cpp:
        Remove some !APPLE_CHANGES code.

        * ksvg2/svg/SVGDocumentImpl.h:
        Remove some unneeded APPLE_CHANGES code.

        * khtml/rendering/render_flexbox.cpp: (khtml::RenderFlexibleBox::layoutVerticalBox):
        Remove a misleading mention of APPLE_CHANGES in a comment.

        Also changed tabs to spaces in files I am committing.

2006-01-12  David Hyatt <hyatt@apple.com>

        Get the misc directory compiling on Win32.

        * ForwardingHeaders/kio/jobclasses.h:
        * ForwardingHeaders/qasyncio.h:
        * WebCore.vcproj/WebCore/WebCore.vcproj:
        * khtml/misc/CachedImage.cpp:
        (khtml::CachedImage::data):
        * khtml/misc/decoder.cpp:
        (KanjiCode::):

2006-01-12  David Hyatt <hyatt@apple.com>

        Make the ecma directory compile on Win32.

        * ForwardingHeaders/kconfig.h:
        * ForwardingHeaders/kwinmodule.h:
        * ForwardingHeaders/qguardedptr.h:
        * ForwardingHeaders/qstylesheet.h:
        * WebCore.vcproj/WebCore/WebCore.vcproj:
        * WebCore.vcproj/WebCore/build-generated-files.sh:
        * khtml/ecma/XSLTProcessor.cpp:
        * khtml/ecma/kjs_binding.cpp:
        (KJS::ScriptInterpreter::createLanguageInstanceForValue):
        * khtml/ecma/kjs_css.h:
        * khtml/ecma/kjs_dom.cpp:
        (KJS::getRuntimeObject):
        * khtml/ecma/kjs_html.cpp:
        (KJS::KJS::Context2DFunction::callAsFunction):
        (KJS::Context2D::setShadow):
        (KJS::Context2D::updateFillImagePattern):
        (KJS::Context2D::updateStrokeImagePattern):
        (KJS::Context2D::putValueProperty):
        (KJS::Gradient::commonInit):
        (KJS::Gradient::~Gradient):
        (KJS::_rh):
        * khtml/ecma/kjs_html.h:
        * khtml/ecma/kjs_window.cpp:
        (KJS::intFeature):

2006-01-12  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Dave Hyatt.

        - removed leftover files from form split, fix remaining include of the header.

        * khtml/html/html_formimpl.cpp: Removed.
        * khtml/html/html_formimpl.h: Removed.
        * page/Frame.cpp:

2006-01-12  David Hyatt <hyatt@apple.com>

        Make the editing directory compile on Win32.

        * WebCore.vcproj/WebCore/WebCore.vcproj:
        * khtml/editing/jsediting.cpp:

2006-01-12  David Hyatt <hyatt@apple.com>

        Get the HTML, XML, and Rendering directories compiling on
        Win32.  Add the bash script for generated files as well.

        * ForwardingHeaders/kio/job.h:
        * ForwardingHeaders/ksslkeygen.h:
        * ForwardingHeaders/qpoint.h:
        * ForwardingHeaders/qpointarray.h:
        * ForwardingHeaders/qtextstream.h:
        * WebCore.vcproj/WebCore/WebCore.vcproj:
        * khtml/html/HTMLSelectElementImpl.cpp:
        (DOM::HTMLSelectElementImpl::state):
        * khtml/html/html_canvasimpl.cpp:
        (HTMLCanvasElementImpl::createRenderer):
        * khtml/html/html_imageimpl.h:
        (DOM::):
        * khtml/rendering/render_object.h:
        * khtml/xml/DocumentImpl.cpp:
        (DocumentImpl::detach):
        (DocumentImpl::getAccObjectCache):
        (DocumentImpl::updateSelection):
        (DocumentImpl::implicitClose):
        (DocumentImpl::setFocusNode):
        * kwq/KWQAccObjectCache.h:
        * kwq/KWQKJobClasses.h:

2006-01-12  Anders Carlsson  <andersca@mac.com>

        Reviewed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5153
        deleteRule and insertRule do not work
        
        This also makes updating the disabled flag on style sheets work.
        It also adds the IE-only removeRule which is the counterpart to
        the already existing addRule.
        
        * khtml/css/css_stylesheetimpl.cpp:
        (CSSStyleSheetImpl::insertRule):
        (CSSStyleSheetImpl::deleteRule):
        Call styleSheetChanged()
        
        (CSSStyleSheetImpl::styleSheetChanged):
        Call DocumentImpl::updateStyleSelector()
        
        * khtml/css/css_stylesheetimpl.h:        
        (DOM::StyleSheetImpl::setDisabled):
        Call styleSheetChanged();
        
        (DOM::StyleSheetImpl::styleSheetChanged):
        New function.
        
        (DOM::CSSStyleSheetImpl::removeRule):
        New IE extension function, simply calls deleteRule.
        
        * khtml/css/cssstyleselector.cpp:
        (khtml::CSSStyleSelector::CSSStyleSelector):
        Ignore disabled style sheets.
        
        * khtml/ecma/kjs_css.cpp:
        (KJS::DOMCSSStyleSheetProtoFunc::callAsFunction):
        * khtml/ecma/kjs_css.h:
        (KJS::DOMCSSStyleSheet::):
        Add removeRule.

2006-01-12  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed and landed by Darin.
        
        Test: fast/css/rtl-ordering.html
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6334
          REGRESSION: <input type="button"> text is reversed on "visual Hebrew" pages

        * khtml/css/cssparser.cpp: (CSSParser::parseValue): Parse the new -khtml-rtl-ordering property.
        * khtml/css/cssproperties.in: Added -khtml-rtl-ordering property.
        * khtml/css/cssstyleselector.cpp: (CSSStyleSelector::applyProperty): Apply the new property.
        * khtml/css/cssvalues.in: Added "logical" and "visual" values for the -khtml-rtl-ordering property.
        * khtml/css/html4.css: Force logical ordering in input-buttons.
        * khtml/css/makeprop: Fixed maximum property length computation.
        * khtml/rendering/render_style.h: Added initial value for visuallyOrdered.
        * ksvg2/scripts/cssmakeprops: Ensure no overlap between KHTML and SVG CSS properties.
        * ksvg2/scripts/cssmakevalues: Ensure no overlap between KHTML and SVG CSS values.

2006-01-12  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed and landed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6219
          Perf regression: -[NSImage initWithData:] called repeatedly while
          moving the cursor over an image

        * khtml/rendering/render_image.h: (khtml::RenderImage::pixmap):
        Return a const QPixmap&.
        * kwq/WebCoreBridge.mm: (-[WebCoreBridge elementAtPoint:]):
        Avoid copying the QPixmap and its renderer.

2006-01-12  Justin Haygood  <justin@xiondigital.net>

        Reviewed, tweaked, and landed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6497
          Use #include, not #import, in KWQ C++ files

        * bridge/mac/KWQKHTMLView.cpp:
        * kcanvas/RenderSVGText.cpp:
        * khtml/css/css_computedstyle.cpp:
        * kwq/KWQArrayImpl.cpp:
        * kwq/KWQBuffer.cpp:
        * kwq/KWQCString.cpp:
        * kwq/KWQCharsets.cpp:
        * kwq/KWQDateTime.cpp:
        * kwq/KWQDictImpl.cpp:
        * kwq/KWQGuardedPtr.cpp:
        * kwq/KWQKHTMLFactory.cpp:
        * kwq/KWQKPartsEvent.cpp:
        * kwq/KWQListImpl.cpp:
        * kwq/KWQMapImpl.cpp:
        * kwq/KWQObject.cpp:
        * kwq/KWQPen.cpp:
        * kwq/KWQPointArray.cpp:
        * kwq/KWQPtrDictImpl.cpp:
        * kwq/KWQRegion.cpp:
        * kwq/KWQStyle.cpp:
        * kwq/KWQTextCodec.cpp:
        * kwq/KWQTextStream.cpp:
        * kwq/KWQTimer.cpp:
        * kwq/KWQValueListImpl.cpp:
        * kwq/KWQVariant.cpp:
        * kwq/KWQVectorImpl.cpp:
        * kwq/KWQWMatrix.cpp:
        Replaced #import with #include.

        * kwq/KWQRegExp.cpp: Replaced #import with #include.
        Also changed <JavaScriptCore/pcre.h> to <pcre/pcre.h>.
        * ForwardingHeaders/pcre: Added.
        * ForwardingHeaders/pcre/pcre.h: Added.

2006-01-12  Eric Seidel  <eseidel@apple.com>

        Reviewed by anders & mjs.

        Split dom_docimpl.* out into separate files (one per class):
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6502

        * ForwardingHeaders/kdom/core/DOMImplementationImpl.h: Removed.
        * ForwardingHeaders/kdom/core/DocumentImpl.h: Removed.
        * ForwardingHeaders/kdom/core/DocumentTypeImpl.h: Removed.
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/WebCoreBridge.mm:
        * kcanvas/KCanvasResources.cpp:
        * kcanvas/RenderSVGText.h:
        * khtml/css/css_base.cpp:
        * khtml/css/css_computedstyle.cpp:
        * khtml/css/css_ruleimpl.cpp:
        * khtml/css/css_valueimpl.cpp:
        * khtml/css/cssparser.cpp:
        * khtml/css/parser.y:
        * khtml/ecma/XSLTProcessor.cpp:
        * khtml/ecma/domparser.cpp:
        * khtml/ecma/kjs_css.cpp:
        * khtml/ecma/kjs_dom.cpp:
        * khtml/ecma/kjs_events.cpp:
        * khtml/ecma/kjs_range.cpp:
        * khtml/ecma/kjs_traversal.cpp:
        * khtml/ecma/kjs_views.cpp:
        * khtml/ecma/kjs_window.cpp:
        * khtml/ecma/xmlhttprequest.cpp:
        * khtml/ecma/xmlserializer.cpp:
        * khtml/editing/SelectionController.cpp:
        * khtml/editing/apply_style_command.cpp:
        * khtml/editing/composite_edit_command.cpp:
        * khtml/editing/delete_selection_command.cpp:
        * khtml/editing/edit_command.cpp:
        * khtml/editing/htmlediting.cpp:
        * khtml/editing/insert_line_break_command.cpp:
        * khtml/editing/insert_paragraph_separator_command.cpp:
        * khtml/editing/insert_text_command.cpp:
        * khtml/editing/join_text_nodes_command.cpp:
        * khtml/editing/jsediting.cpp:
        * khtml/editing/markup.cpp:
        * khtml/editing/markup.h:
        * khtml/editing/merge_identical_elements_command.cpp:
        * khtml/editing/move_selection_command.cpp:
        * khtml/editing/rebalance_whitespace_command.cpp:
        * khtml/editing/replace_selection_command.cpp:
        * khtml/editing/split_text_node_command.cpp:
        * khtml/editing/typing_command.cpp:
        * khtml/editing/visible_position.cpp:
        * khtml/editing/visible_text.cpp:
        * khtml/editing/visible_units.cpp:
        * khtml/html/HTMLGenericFormElementImpl.cpp:
        * khtml/html/HTMLInputElementImpl.cpp:
        * khtml/html/HTMLKeygenElementImpl.cpp:
        * khtml/html/HTMLLabelElementImpl.cpp:
        * khtml/html/HTMLOptionElementImpl.cpp:
        * khtml/html/HTMLSelectElementImpl.cpp:
        * khtml/html/HTMLTextAreaElementImpl.cpp:
        * khtml/html/html_documentimpl.cpp:
        * khtml/html/html_documentimpl.h:
        * khtml/html/html_listimpl.cpp:
        * khtml/html/html_objectimpl.cpp:
        * khtml/html/htmlfactory.cpp:
        * khtml/html/htmlparser.cpp:
        * khtml/html/htmltokenizer.cpp:
        * khtml/misc/Cache.cpp:
        * khtml/misc/DocLoader.cpp:
        * khtml/rendering/InlineTextBox.cpp:
        * khtml/rendering/bidi.cpp:
        * khtml/rendering/render_applet.cpp:
        * khtml/rendering/render_block.cpp:
        * khtml/rendering/render_box.cpp:
        * khtml/rendering/render_br.cpp:
        * khtml/rendering/render_button.cpp:
        * khtml/rendering/render_canvas.cpp:
        * khtml/rendering/render_container.cpp:
        * khtml/rendering/render_flow.cpp:
        * khtml/rendering/render_form.cpp:
        * khtml/rendering/render_frames.cpp:
        * khtml/rendering/render_inline.cpp:
        * khtml/rendering/render_layer.cpp:
        * khtml/rendering/render_line.cpp:
        * khtml/rendering/render_list.cpp:
        * khtml/rendering/render_object.cpp:
        * khtml/rendering/render_replaced.cpp:
        * khtml/rendering/render_table.cpp:
        * khtml/rendering/render_theme.cpp:
        * khtml/rendering/render_theme_mac.mm:
        * khtml/xml/DOMImplementationImpl.cpp: Added.
        * khtml/xml/DOMImplementationImpl.h: Added.
        * khtml/xml/DocumentFragmentImpl.cpp: Added.
        * khtml/xml/DocumentFragmentImpl.h: Added.
        * khtml/xml/DocumentImpl.cpp: Added.
        (DocumentImpl::setDocType):
        (DocumentImpl::getElementsByName):
        * khtml/xml/DocumentImpl.h: Added.
        * khtml/xml/DocumentTypeImpl.cpp: Added.
        * khtml/xml/DocumentTypeImpl.h: Added.
        * khtml/xml/dom2_eventsimpl.cpp:
        * khtml/xml/dom2_rangeimpl.cpp:
        * khtml/xml/dom2_traversalimpl.cpp:
        * khtml/xml/dom2_viewsimpl.cpp:
        * khtml/xml/dom_docimpl.cpp: Removed.
        * khtml/xml/dom_docimpl.h: Removed.
        * khtml/xml/dom_elementimpl.cpp:
        * khtml/xml/dom_nodeimpl.cpp:
        * khtml/xml/dom_textimpl.cpp:
        * khtml/xml/dom_xmlimpl.cpp:
        * khtml/xml/xml_tokenizer.cpp:
        * khtml/xsl/xslt_processorimpl.cpp:
        * ksvg2/misc/KCanvasRenderingStyle.cpp:
        * ksvg2/misc/KSVGTimeScheduler.cpp:
        * ksvg2/misc/SVGImageLoader.cpp:
        * ksvg2/svg/SVGAElementImpl.cpp:
        * ksvg2/svg/SVGAnimationElementImpl.cpp:
        * ksvg2/svg/SVGClipPathElementImpl.cpp:
        * ksvg2/svg/SVGCursorElementImpl.cpp:
        * ksvg2/svg/SVGDOMImplementationImpl.cpp:
        * ksvg2/svg/SVGDOMImplementationImpl.h:
        * ksvg2/svg/SVGDocumentImpl.h:
        * ksvg2/svg/SVGElementImpl.cpp:
        * ksvg2/svg/SVGFEImageElementImpl.cpp:
        * ksvg2/svg/SVGGradientElementImpl.cpp:
        * ksvg2/svg/SVGHelper.cpp:
        * ksvg2/svg/SVGPatternElementImpl.cpp:
        * ksvg2/svg/SVGPolyElementImpl.cpp:
        * ksvg2/svg/SVGSVGElementImpl.cpp:
        * ksvg2/svg/SVGStopElementImpl.cpp:
        * ksvg2/svg/SVGStyleElementImpl.cpp:
        * ksvg2/svg/SVGStyledElementImpl.cpp:
        * ksvg2/svg/SVGUseElementImpl.cpp:
        * kwq/DOM-CSS.mm:
        * kwq/DOM.mm:
        * kwq/DOMEvents.mm:
        * kwq/DOMHTML.mm:
        * kwq/DOMInternal.mm:
        * kwq/DOMViews.mm:
        * kwq/KWQAccObject.mm:
        * kwq/KWQAccObjectCache.mm:
        * kwq/KWQKJavaAppletWidget.mm:
        * kwq/KWQPageState.mm:
        * kwq/KWQRenderTreeDebug.cpp:
        * kwq/KWQSlot.mm:
        * page/Frame.cpp:

2006-01-12  Maciej Stachowiak  <mjs@apple.com>

        Not reviewed.
        
        - fixed build breakage

        * ksvg2/misc/SVGImageLoader.cpp: Add dom_docimpl.h include

2006-01-12  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - remove dom_documentimpl.h include from other headers where possible,
        move down to impl files instead, so less rebuilds when you touch it

        * bridge/mac/MacFrame.mm:
        (MacFrame::openURLFromPageCache):
        * kcanvas/KCanvasResources.cpp:
        * khtml/css/css_computedstyle.cpp:
        * khtml/editing/SelectionController.cpp:
        (khtml::SelectionController::frame):
        * khtml/editing/SelectionController.h:
        * khtml/editing/composite_edit_command.cpp:
        * khtml/editing/delete_selection_command.cpp:
        * khtml/editing/jsediting.cpp:
        * khtml/editing/jsediting.h:
        * khtml/editing/markup.h:
        * khtml/editing/visible_position.cpp:
        * khtml/editing/visible_text.cpp:
        * khtml/html/HTMLGenericFormElementImpl.cpp:
        * khtml/html/HTMLInputElementImpl.cpp:
        * khtml/html/HTMLLabelElementImpl.cpp:
        * khtml/html/HTMLOptionElementImpl.cpp:
        * khtml/html/HTMLSelectElementImpl.cpp:
        * khtml/html/HTMLTextAreaElementImpl.cpp:
        * khtml/html/htmltokenizer.h:
        * khtml/rendering/InlineTextBox.cpp:
        * khtml/rendering/bidi.cpp:
        * khtml/rendering/render_br.cpp:
        * khtml/rendering/render_button.cpp:
        * khtml/rendering/render_object.cpp:
        (RenderObject::documentBeingDestroyed):
        * khtml/rendering/render_object.h:
        * khtml/rendering/render_theme.cpp:
        * khtml/rendering/render_theme_mac.mm:
        * khtml/xbl/xbl_docimpl.h:
        * khtml/xml/dom2_rangeimpl.cpp:
        * ksvg2/svg/SVGAElementImpl.cpp:
        * ksvg2/svg/SVGClipPathElementImpl.cpp:
        * ksvg2/svg/SVGFEImageElementImpl.cpp:
        * ksvg2/svg/SVGHelper.cpp:
        * ksvg2/svg/SVGSVGElementImpl.cpp:
        * ksvg2/svg/SVGUseElementImpl.cpp:
        * kwq/KWQAccObjectCache.mm:
        * kwq/KWQPageState.h:
        * kwq/KWQPageState.mm:

2006-01-12  Anders Carlsson  <andersca@mac.com>

        Fix build

        * khtml/ecma/kjs_window.cpp:
        Remove include.

2006-01-12  Anders Carlsson  <andersca@mac.com>

        Reviewed by Maciej

        http://bugzilla.opendarwin.org/show_bug.cgi?id=6501
        - Merge KParts::BrowserInterface with KParts::BrowserExtension.
        
        * ForwardingHeaders/kparts/browserinterface.h: Removed.
        * bridge/mac/KWQKPartsBrowserInterface.mm: Removed.
        * kwq/KWQKPartsBrowserInterface.h: Removed.

        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/KWQKHTMLPartBrowserExtension.h:
        * bridge/mac/KWQKHTMLPartBrowserExtension.mm:
        (KHTMLPartBrowserExtension::KHTMLPartBrowserExtension):
        (KHTMLPartBrowserExtension::getHistoryLength):
        (KHTMLPartBrowserExtension::goBackOrForward):        
        * bridge/mac/KWQKPartsBrowserExtension.h:
        (KParts::BrowserExtension::BrowserExtension):
        * khtml/ecma/kjs_window.cpp:
        (KJS::History::getValueProperty):
        * khtml/xml/xml_tokenizer.cpp:
        * page/Frame.cpp:
        (Frame::slotRedirect):
        * page/FrameView.cpp:
        Add getHistoryLength and goBackOrForward to BrowserExtension and
        use them.

2006-01-12  Eric Seidel  <eseidel@apple.com>

        Build fix, files missing from previous <image> commit:
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5965 

        * kcanvas/RenderSVGImage.cpp: Added.
        (RenderSVGImage::RenderSVGImage):
        (RenderSVGImage::~RenderSVGImage):
        (RenderSVGImage::paint):
        (RenderSVGImage::translateForAttributes):
        * kcanvas/RenderSVGImage.h: Added.
        * ksvg2/misc/SVGImageLoader.cpp: Added.
        (SVGImageLoader::SVGImageLoader):
        (SVGImageLoader::~SVGImageLoader):
        (SVGImageLoader::updateFromElement):
        * ksvg2/misc/SVGImageLoader.h: Added.

2006-01-12  Anders Carlsson  <andersca@mac.com>

        Reviewed by Maciej.

        http://bugzilla.opendarwin.org/show_bug.cgi?id=6496
        - Merge KParts::Part with KParts::ReadOnly part and rename it to
        ObjectContents.
        
        * ForwardingHeaders/kparts/part.h: Removed.
        * kwq/KWQKPartsPart.h: Removed.
        * kwq/KWQKPartsPart.mm: Removed.
        * kwq/KWQObject.cpp:
        
        page/ObjectContents.h: Added
        (ObjectContents::ObjectContents):
        (ObjectContents::url):
        (ObjectContents::setName):
        (ObjectContents::widget):
        (ObjectContents::setWidget):
        (ObjectContents::ref):
        (ObjectContents::deref):
        (ObjectContents::event):
        (ObjectContents::customEvent):
        (ObjectContents::isObjectContents):

        Renames:
        
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/KWQKHTMLPartBrowserExtension.h:
        * bridge/mac/KWQKHTMLPartBrowserExtension.mm:
        (KHTMLPartBrowserExtension::createNewWindow):
        * bridge/mac/KWQKPartsBrowserExtension.h:
        * bridge/mac/MacFrame.h:
        * bridge/mac/MacFrame.mm:
        (MacFrame::createPart):
        * bridge/mac/WebCoreBridge.mm:
        (-[WebCoreBridge saveDocumentToPageCache]):
        * khtml/ecma/kjs_events.cpp:
        (KJS::JSLazyEventListener::parseCode):
        * khtml/ecma/kjs_window.cpp:
        (KJS::createNewWindow):
        (KJS::Window::indexGetter):
        (KJS::Window::getOwnPropertySlot):
        (KJS::WindowFunc::callAsFunction):
        (KJS::FrameArray::getValueProperty):
        (KJS::FrameArray::indexGetter):
        (KJS::FrameArray::nameGetter):
        (KJS::FrameArray::getOwnPropertySlot):
        (QObject::inherits):
        (QObject::isObjectContents):
        * kwq/KWQObject.h:
        * page/Frame.cpp:
        (Frame::stopLoading):
        (Frame::stopAnimations):
        (Frame::checkEmitLoadEvent):
        (Frame::processObjectRequest):
        (Frame::childFrame):
        (Frame::findFrame):
        (Frame::setZoomFactor):
        (Frame::frames):
        (Frame::customEvent):
        (Frame::slotPartRemoved):
        (Frame::connectChild):
        (Frame::disconnectChild):
        (Frame::setPolicyBaseURL):
        (Frame::setName):
        * page/Frame.h:
        (Frame::Frame):
        * page/FramePrivate.h:

2006-01-12  Alexander Kellett  <lypanov@kde.org>

        Reviewed by eseidel.

        Refactor HTMLImageLoader to make subclassing possible. Implement
        RenderSVGText-style RenderImage subclass. Use this to reimplement
        SVGImageElementImpl.

        As a side effect, this should fix:
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5965 

        * WebCore.xcodeproj/project.pbxproj:
        * kcanvas/RenderSVGImage.cpp: Added.
        (RenderSVGImage::RenderSVGImage):
        (~RenderSVGImage::RenderSVGImage):
        (RenderSVGImage::paint):
        (RenderSVGImage::translateForAttributes):
        * kcanvas/RenderSVGImage.h: Added.
        * khtml/html/html_imageimpl.cpp:
        (DOM::HTMLImageLoader::setLoadingImage): trivial method extraction
        (DOM::HTMLImageLoader::updateFromElement): make virtual
        * khtml/html/html_imageimpl.h:
        (DOM::):
        * ksvg2/misc/SVGImageLoader.cpp: Added.
        (SVGImageLoader::SVGImageLoader):
        (~SVGImageLoader:SVGImageLoader):
        (SVGImageLoader::updateFromElement):
        * ksvg2/misc/SVGImageLoader.h: Added.
        * ksvg2/svg/SVGImageElementImpl.cpp:
        (SVGImageElementImpl::SVGImageElementImpl):
        (SVGImageElementImpl::parseMappedAttribute):
        (SVGImageElementImpl::createRenderer):
        (SVGImageElementImpl::attach):
        * ksvg2/svg/SVGImageElementImpl.h:

2006-01-11  David Hyatt  <hyatt@apple.com>

        Changes to get the XML directory nearly compiling on Win32.
        Down to just the gperf of cssvalues.in and a need to replace
        usleep.

        Reviewed by darin

        * WebCore.vcproj/WebCore/WebCore.vcproj:
        * khtml/config.h:
        * khtml/xml/dom_stringimpl.cpp:
        (DOM::DOMStringImpl::toCoordsArray):
        * khtml/xml/xml_tokenizer.cpp:
        (khtml::XMLTokenizer::error):

2006-01-11  Justin Garcia  <justin.garcia@apple.com>

        Replaced two asserts that I accidently removed in
        the build bustage fix.

        * page/Frame.cpp:
        (Frame::revealSelection):
        (Frame::centerSelectionInVisibleArea):

2006-01-11  Justin Garcia  <justin.garcia@apple.com>

        Reviewed by kevin

        The removal of Frame::clearSelection() broke a layout 
        test. clearSelection did setSelection(SelectionController()), which
        is not the same as selection().clear().  setSelection() notifies
        the editing delegate of a selection change.  This is non obvious
        and should be fixed.  Filed:
        <http://bugzilla.opendarwin.org/show_bug.cgi?id=6498>
        SelectionController's setters should notify delegates of selection changes

        * bridge/mac/WebCoreBridge.mm:
        (-[WebCoreBridge deselectText]):
        * khtml/editing/jsediting.cpp:
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::clearSelectionIfNeeded):

2006-01-11  Justin Garcia  <justin.garcia@apple.com>

        Reviewed by darin
        
        <http://bugzilla.opendarwin.org/show_bug.cgi?id=5870>
        Double-clicking on an SVG dies in HTML editing code
        <rdar://problem/4393815>
        Assertion failure: result != *this (khtml::VisiblePosition::previous())
        + build bustage fix from previous checkin

        Tests added (+ expected results):
        * editing/selection/iframe.html: Added.
        * editing/selection/inline-table.html: Added.
        * editing/selection/select-box.html: Added.
        
        Test results changed (change looks funny but is correct):
        * editing/inserting/editing-empty-divs.html
        
        Account for replaced elements with children in isCandidate and maxDeepOffset
        Stop at candidates in VisiblePosition::deepEquivalent, descending will
        yield positions that aren't visually equivalent.
        Fixed a caret painting regression (removed downstreamDeepEquivalent)
        Moved isAtomicNode and maxDeepOffset out of NodeImpl
        Removed redundant code
        
        Todo: 
        Move more editing functions out of NodeImpl
        Improve the selection of VP candidates to fix 6476

        * khtml/editing/SelectionController.cpp:
        (khtml::SelectionController::SelectionController):
        (khtml::SelectionController::xPosForVerticalArrowNavigation):
        (khtml::SelectionController::getRangeAt):
        (khtml::SelectionController::layout):
        (khtml::SelectionController::adjustForEditableContent):
        * khtml/editing/apply_style_command.cpp:
        (khtml::ApplyStyleCommand::mergeStartWithPreviousIfIdentical):
        (khtml::ApplyStyleCommand::mergeEndWithNextIfIdentical):
        * khtml/editing/delete_selection_command.cpp:
        (khtml::DeleteSelectionCommand::handleSpecialCaseBRDelete):
        (khtml::DeleteSelectionCommand::handleGeneralDelete):
        * khtml/editing/htmlediting.cpp:
        (khtml::isAtomicNode):
        (khtml::maxDeepOffset):
        (khtml::isLastVisiblePositionInSpecialElement):
        (khtml::positionAfterContainingSpecialElement):
        * khtml/editing/htmlediting.h:
        * khtml/editing/insert_line_break_command.cpp:
        (khtml::InsertLineBreakCommand::doApply):
        * khtml/editing/replace_selection_command.cpp:
        (khtml::ReplaceSelectionCommand::fixupNodeStyles):
        (khtml::ReplaceSelectionCommand::doApply):
        * khtml/editing/visible_position.cpp:
        (khtml::VisiblePosition::previousVisiblePosition):
        (khtml::VisiblePosition::isCandidate):
        (khtml::VisiblePosition::deepEquivalent):
        (khtml::VisiblePosition::character):
        (khtml::makeRange):
        (khtml::setStart):
        (khtml::setEnd):
        (khtml::enclosingBlockFlowElement):
        (khtml::isFirstVisiblePositionInNode):
        (khtml::isLastVisiblePositionInNode):
        * khtml/editing/visible_position.h:
        (khtml::VisiblePosition::setAffinity):
        * khtml/editing/visible_units.cpp:
        (khtml::previousLinePosition):
        (khtml::nextLinePosition):
        * khtml/xml/dom2_rangeimpl.cpp:
        (DOM::RangeImpl::editingStartPosition):
        * khtml/xml/dom_nodeimpl.cpp:
        (DOM::NodeImpl::previousNodeConsideringAtomicNodes):
        (DOM::NodeImpl::nextNodeConsideringAtomicNodes):
        (DOM::NodeImpl::previousLeafNode):
        (DOM::NodeImpl::nextLeafNode):
        (DOM::NodeImpl::isBlockFlowOrBlockTable):
        (DOM::NodeImpl::enclosingBlockFlowOrTableElement):
        * khtml/xml/dom_nodeimpl.h:
        * khtml/xml/dom_position.cpp:
        (DOM::Position::previous):
        (DOM::Position::next):
        (DOM::Position::atEnd):
        (DOM::isStreamer):
        (DOM::Position::upstream):
        (DOM::Position::downstream):
        * khtml/xml/dom_position.h:
        * kwq/KWQAccObject.mm:
        (-[KWQAccObject doAXUIElementForTextMarker:]):
        * page/Frame.cpp:
        (Frame::selectContentsOfNode):
        
2006-01-11  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        - remove some selection-related methods on Frame that are just simple wrappers
        of Selection methods.

        * bridge/mac/MacFrame.mm:
        (MacFrame::findString):
        (MacFrame::advanceToNextMisspelling):
        * bridge/mac/WebCoreBridge.mm:
        (-[WebCoreBridge deselectText]):
        (-[WebCoreBridge selectedAttributedString]):
        (-[WebCoreBridge attributedStringFrom:startOffset:to:endOffset:]):
        * khtml/editing/jsediting.cpp:
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::clearSelectionIfNeeded):
        * page/Frame.cpp:
        (Frame::selection):
        (Frame::currentForm):
        (Frame::revealSelection):
        (Frame::centerSelectionInVisibleArea):
        * page/Frame.h:
        * page/FrameView.cpp:
        (KHTMLView::clear):

2006-01-11  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        - reduce the number of files that rebuild when you touch Frame.h

        * ForwardingHeaders/ksvg2/KSVGView.h:
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/MacFrame.mm:
        (convertAttributesToUnderlines):
        * khtml/ecma/kjs_window.cpp:
        * khtml/editing/htmlediting.cpp:
        * khtml/editing/typing_command.cpp:
        * khtml/html/HTMLKeygenElementImpl.cpp:
        (DOM::HTMLKeygenElementImpl::appendFormData):
        * khtml/html/html_imageimpl.cpp:
        * khtml/rendering/InlineTextBox.cpp:
        (khtml::InlineTextBox::paint):
        (khtml::InlineTextBox::paintMarkedTextUnderline):
        * khtml/rendering/InlineTextBox.h:
        * khtml/rendering/render_layer.cpp:
        * khtml/xml/dom_docimpl.cpp:
        * kwq/KWQAccObject.mm:
        (-[KWQAccObject value]):
        * kwq/KWQFileButton.h:
        * kwq/KWQLineEdit.mm:
        * kwq/KWQRenderTreeDebug.cpp:
        (write):
        * page/Frame.cpp:
        (Frame::markedTextUnderlines):
        * page/Frame.h:
        (MarkedTextUnderline::MarkedTextUnderline):

2006-01-11  Anders Carlsson  <andersca@mac.com>

        Build fix.
        
        * ForwardingHeaders/ksvg2/KSVGView.h:
        Rename KHTMLView to FrameView and include FrameView.h

2006-01-11  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Anders.

        - renamed KHTMLPartPrivate to FramePrivate and KHTMLView to FrameView
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6490

        (also corresponding header renames, remove headers where not
        needed, and a few substantive changes to allow more header removal)

        * khtml/xml/dom_docimpl.h: moved m_selectedStylesheetSet here from
        KHTMLPartPrivate, since this was the only class using it.
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::processHttpEquiv): ditto
        (DocumentImpl::selectedStylesheetSet): ditto
        (DocumentImpl::setSelectedStylesheetSet): ditto
        (DocumentImpl::recalcStyleSelector): ditto
        * khtml/ecma/kjs_dom.cpp:
        (KJS::DOMDocument::getValueProperty): Use new isCompleted method
        on Frame instead of accessing private field directly.
        (KJS::getDOMDocumentNode): remove gratuitous use of view()
        
        Just the renames:
        
        * WebCore.xcodeproj/project.pbxproj:
        * bridge/mac/KWQKHTMLView.cpp:
        * bridge/mac/MacFrame.h:
        * bridge/mac/MacFrame.mm:
        * bridge/mac/WebCoreBridge.mm:
        * khtml/css/cssstyleselector.cpp:
        * khtml/ecma/kjs_html.cpp:
        * khtml/ecma/kjs_traversal.cpp:
        * khtml/ecma/kjs_window.cpp:
        * khtml/ecma/xmlhttprequest.cpp:
        * khtml/editing/SelectionController.cpp:
        * khtml/editing/htmlediting.cpp:
        * khtml/html/html_baseimpl.cpp:
        * khtml/html/html_canvasimpl.cpp:
        * khtml/html/html_documentimpl.cpp:
        * khtml/html/html_elementimpl.cpp:
        * khtml/html/html_headimpl.cpp:
        * khtml/html/html_imageimpl.cpp:
        * khtml/html/html_inlineimpl.cpp:
        (DOM::HTMLAnchorElementImpl::defaultEventHandler):
        * khtml/html/html_objectimpl.cpp:
        * khtml/html/html_tableimpl.cpp:
        * khtml/html/htmlparser.cpp:
        * khtml/html/htmltokenizer.cpp:
        * khtml/rendering/bidi.cpp:
        * khtml/rendering/render_applet.cpp:
        * khtml/rendering/render_block.cpp:
        * khtml/rendering/render_box.cpp:
        * khtml/rendering/render_canvas.cpp:
        * khtml/rendering/render_flow.cpp:
        * khtml/rendering/render_form.cpp:
        * khtml/rendering/render_frames.cpp:
        * khtml/rendering/render_layer.cpp:
        * khtml/rendering/render_line.cpp:
        * khtml/rendering/render_object.cpp:
        * khtml/rendering/render_replaced.cpp:
        * khtml/rendering/render_table.cpp:
        * khtml/rendering/render_theme_mac.mm:
        * khtml/xml/dom2_eventsimpl.cpp:
        * khtml/xml/dom_elementimpl.cpp:
        * khtml/xml/dom_nodeimpl.cpp:
        * khtml/xml/xml_tokenizer.cpp:
        * khtml/xsl/xslt_processorimpl.cpp:
        * kwq/KWQAccObject.mm:
        * kwq/KWQFrame.mm:
        * kwq/KWQKJavaAppletWidget.mm:
        * kwq/KWQPageState.mm:
        * kwq/KWQRenderTreeDebug.cpp:
        * kwq/KWQSignalStubs.mm:
        * kwq/KWQWidget.mm:
        * page/Frame.cpp:
        (Frame::init):
        (Frame::submitForm):
        (Frame::isComplete):
        * page/Frame.h:
        * page/FramePrivate.h: Added.
        (FramePrivate::FramePrivate):
        (FramePrivate::~FramePrivate):
        * page/FrameView.cpp: Added.
        * page/FrameView.h: Added.
        * page/khtmlpart_p.h: Removed.
        * page/khtmlview.cpp: Removed.
        * page/khtmlview.h: Removed.

2006-01-10  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        - moved files related to the Frame class and the forthcoming Page class
        to WebCore/page
        
        - moved files related to the MacFrame class and other bridging-related classes
        to WebCore/bridge/mac

        * ForwardingHeaders/ksvg2/KSVGPart.h:
        * ForwardingHeaders/ksvg2/KSVGView.h:
        * WebCore.xcodeproj/project.pbxproj:
        * bridge: Added.
        * bridge/mac: Added.
        * bridge/mac/KWQKHTMLPartBrowserExtension.h: Added.
        * bridge/mac/KWQKHTMLPartBrowserExtension.mm: Added.
        * bridge/mac/KWQKHTMLView.cpp: Added.
        * bridge/mac/KWQKPartsBrowserExtension.h: Added.
        * bridge/mac/KWQKPartsBrowserInterface.mm: Added.
        * bridge/mac/MacFrame.h: Added.
        * bridge/mac/MacFrame.mm: Added.
        * bridge/mac/WebCoreBridge.h: Added.
        * bridge/mac/WebCoreBridge.mm: Added.
        * khtml/Frame.cpp: Removed.
        * khtml/Frame.h: Removed.
        * khtml/khtmlpart_p.h: Removed.
        * khtml/khtmlview.cpp: Removed.
        * khtml/khtmlview.h: Removed.
        * kwq/KWQKHTMLPartBrowserExtension.h: Removed.
        * kwq/KWQKHTMLPartBrowserExtension.mm: Removed.
        * kwq/KWQKHTMLView.cpp: Removed.
        * kwq/KWQKPartsBrowserExtension.h: Removed.
        * kwq/KWQKPartsBrowserInterface.mm: Removed.
        * kwq/MacFrame.h: Removed.
        * kwq/MacFrame.mm: Removed.
        * kwq/WebCoreBridge.h: Removed.
        * kwq/WebCoreBridge.mm: Removed.
        * page: Added.
        * page/Frame.cpp: Added.
        * page/Frame.h: Added.
        * page/khtmlpart_p.h: Added.
        * page/khtmlview.cpp: Added.
        * page/khtmlview.h: Added.

2006-01-10  David Hyatt  <hyatt@apple.com>

        #if Win32 the KWQMemArray overloads, since they're working around
        a Windows compiler bug.
        
        * kwq/KWQMemArray.h:

2006-01-10  David Hyatt  <hyatt@apple.com>

        Fix the broken ifdef in KWQString.h

        * kwq/KWQString.h:

2006-01-10  hyatt@apple.com

        Fix for bugzilla bug 6458, get rendering dir of WebCore
        compiling on Windows.
        
        Reviewed by darin

        * ForwardingHeaders/QRectF:
        * ForwardingHeaders/java/kjavaappletwidget.h:
        * ForwardingHeaders/kcursor.h:
        * ForwardingHeaders/kdebug.h:
        * ForwardingHeaders/kglobalsettings.h:
        * ForwardingHeaders/khtml_ext.h:
        * ForwardingHeaders/khtml_factory.h:
        * ForwardingHeaders/khtml_settings.h:
        * ForwardingHeaders/kio/global.h:
        * ForwardingHeaders/klocale.h:
        * ForwardingHeaders/kparts/browserextension.h:
        * ForwardingHeaders/kparts/event.h:
        * ForwardingHeaders/kparts/part.h:
        * ForwardingHeaders/kurl.h:
        * ForwardingHeaders/qapplication.h:
        * ForwardingHeaders/qbuffer.h:
        * ForwardingHeaders/qcolor.h:
        * ForwardingHeaders/qdatetime.h:
        * ForwardingHeaders/qdict.h:
        * ForwardingHeaders/qevent.h:
        * ForwardingHeaders/qfont.h:
        * ForwardingHeaders/qfontmetrics.h:
        * ForwardingHeaders/qlist.h:
        * ForwardingHeaders/qmap.h:
        * ForwardingHeaders/qmemarray.h:
        * ForwardingHeaders/qobject.h:
        * ForwardingHeaders/qpaintdevicemetrics.h:
        * ForwardingHeaders/qpainter.h:
        * ForwardingHeaders/qpalette.h:
        * ForwardingHeaders/qpen.h:
        * ForwardingHeaders/qpixmap.h:
        * ForwardingHeaders/qptrdict.h:
        * ForwardingHeaders/qptrlist.h:
        * ForwardingHeaders/qptrqueue.h:
        * ForwardingHeaders/qptrstack.h:
        * ForwardingHeaders/qptrvector.h:
        * ForwardingHeaders/qrect.h:
        * ForwardingHeaders/qregexp.h:
        * ForwardingHeaders/qregion.h:
        * ForwardingHeaders/qscrollbar.h:
        * ForwardingHeaders/qscrollview.h:
        * ForwardingHeaders/qsortedlist.h:
        * ForwardingHeaders/qstring.h:
        * ForwardingHeaders/qstringlist.h:
        * ForwardingHeaders/qstyle.h:
        * ForwardingHeaders/qtextcodec.h:
        * ForwardingHeaders/qtextedit.h:
        * ForwardingHeaders/qtimer.h:
        * ForwardingHeaders/qvaluelist.h:
        * ForwardingHeaders/qvariant.h:
        * ForwardingHeaders/qwidget.h:
        * ForwardingHeaders/qwmatrix.h:
        * khtml/config.h:
        * khtml/css/css_ruleimpl.h:
        * khtml/ecma/kjs_binding.h:
        * khtml/html/html_objectimpl.h:
        * khtml/rendering/RenderText.cpp:
        * khtml/rendering/bidi.cpp:
        * khtml/rendering/break_lines.cpp:
        (khtml::nextBreakablePosition):
        * khtml/rendering/font.h:
        (khtml::Font::width):
        * khtml/rendering/render_arena.cpp:
        * khtml/rendering/render_canvasimage.cpp:
        * khtml/rendering/render_canvasimage.h:
        * khtml/rendering/render_container.cpp:
        (RenderContainer::removeChildNode):
        (RenderContainer::appendChildNode):
        (RenderContainer::insertChildNode):
        * khtml/rendering/render_image.cpp:
        (RenderImage::paint):
        * khtml/rendering/render_object.cpp:
        (RenderObject::remove):
        * khtml/xml/dom_elementimpl.h:
        (DOM::ElementImpl::mouseEventHandler):
        * khtml/xml/dom_nodeimpl.cpp:
        (DOM::NodeImpl::dispatchEvent):
        * khtml/xml/dom_stringimpl.cpp:
        (DOM::DOMStringImpl::endsWith):
        * kwq/KWQAccObjectCache.h:
        * kwq/KWQArrayImpl.h:
        (KWQArrayImpl::size):
        * kwq/KWQCharsets.h:
        * kwq/KWQDateTime.h:
        (CFAbsoluteTimeGetCurrent):
        * kwq/KWQDef.h:
        * kwq/KWQFontFamily.h:
        * kwq/KWQKPartsPart.h:
        * kwq/KWQKURL.h:
        * kwq/KWQLogging.h:
        * kwq/KWQMapImpl.h:
        * kwq/KWQMemArray.h:
        (QMemArray::operator[]):
        * kwq/KWQPainter.h:
        * kwq/KWQPixmap.h:
        * kwq/KWQPixmap.mm:
        * kwq/KWQPtrDictImpl.h:
        * kwq/KWQRegExp.h:
        * kwq/KWQString.h:
        * kwq/KWQTextCodec.h:
        * kwq/KWQTimer.h:
        (QTimer::QTimer):
        (QTimer::isActive):
        * kwq/KWQValueListImpl.h:
        * kwq/KWQVariant.h:
        * kwq/KWQWMatrix.h:
        * kwq/MacFrame.h:

2006-01-10  Eric Seidel  <eseidel@apple.com>

        No review needed, build (linking deployment) fix only.

        * kwq/MacFrame.h: remove bogus KHTMLView *view() const delcaration

2006-01-10  Eric Seidel  <eseidel@apple.com>

        Roll out local changes committed by accident w/ Mitz's patch.

        * kwq/KWQAccObjectCache.h:
        * kwq/KWQAccObjectCache.mm:
        (KWQAccObjectCache::KWQAccObjectCache):
        (KWQAccObjectCache::~KWQAccObjectCache):
        (KWQAccObjectCache::accObject):
        (KWQAccObjectCache::setAccObject):
        (KWQAccObjectCache::removeAccObject):
        (KWQAccObjectCache::getAccObjectID):
        (KWQAccObjectCache::removeAccObjectID):
        (KWQAccObjectCache::textMarkerForVisiblePosition):
        (KWQAccObjectCache::visiblePositionForTextMarker):
        (KWQAccObjectCache::childrenChanged):
        * kwq/KWQObject.cpp:
        (QObject::restartTimer):
        (QObject::timerIntervals):
        (deleteTimer):
        (QObject::killTimer):
        (deleteOneTimer):
        (QObject::killTimers):
        (sendDeferredTimerEvent):

2006-01-10  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        No tests possible, no functionality changes.

        Reviewed by darin.  Committed by eseidel.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6410
          Performance regression in text relayout due to bad BidiContext
          equality testing

        * khtml/rendering/bidi.cpp:
        (khtml::operator==): Return true if BidiContexts match and both
        don't have a parent.

2006-01-10  Eric Seidel  <eseidel@apple.com>

        Removed broken links in project file, no review need.

        * WebCore.xcodeproj/project.pbxproj:

2006-01-09  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - move C++-only methods down from Frame to MacFrame

        * WebCore.xcodeproj/project.pbxproj:
        * khtml/Frame.cpp:
        (Frame::init):
        (Frame::setSettings):
        (Frame::provisionalLoadStarted):
        (Frame::userGestureHint):
        (Frame::renderer):
        (Frame::selectionRect):
        (Frame::isFrameSet):
        (Frame::openURL):
        (Frame::didNotOpenURL):
        (Frame::selectionStart):
        (scanForForm):
        (Frame::currentForm):
        (Frame::setEncoding):
        (Frame::addData):
        (Frame::revealSelection):
        (Frame::scrollOverflow):
        (Frame::paint):
        (Frame::adjustPageHeight):
        (Frame::pauseTimeouts):
        (Frame::resumeTimeouts):
        (Frame::canCachePage):
        (Frame::saveWindowProperties):
        (Frame::saveLocationProperties):
        (Frame::restoreWindowProperties):
        (Frame::restoreLocationProperties):
        (Frame::saveInterpreterBuiltins):
        (Frame::restoreInterpreterBuiltins):
        (Frame::frameForWidget):
        (Frame::frameForNode):
        (Frame::nodeForWidget):
        (Frame::setDocumentFocus):
        (Frame::clearDocumentFocus):
        (Frame::mutableInstances):
        (Frame::updatePolicyBaseURL):
        (Frame::setPolicyBaseURL):
        (Frame::forceLayout):
        (Frame::forceLayoutWithPageWidthRange):
        (Frame::sendResizeEvent):
        (Frame::sendScrollEvent):
        (Frame::scrollbarsVisible):
        (Frame::addMetaData):
        (Frame::scrollToAnchor):
        (Frame::closeURL):
        (Frame::canMouseDownStartSelect):
        (Frame::khtmlMouseDoubleClickEvent):
        (Frame::passWidgetMouseDownEventToWidget):
        (Frame::clearTimers):
        (Frame::centerSelectionInVisibleArea):
        (Frame::styleForSelectionStart):
        (Frame::selectionStartOffset):
        (Frame::selectionEndOffset):
        (Frame::selectionEnd):
        (Frame::setMediaType):
        (Frame::setSelectionFromNone):
        (Frame::displaysWithFocusAttributes):
        (Frame::setWindowHasFocus):
        (Frame::backslashAsCurrencySymbol):
        (Frame::setName):
        (Frame::markedTextUsesUnderlines):
        (Frame::markedTextUnderlines):
        (Frame::prepareForUserAction):
        (Frame::isFrame):
        (Frame::mousePressNode):
        * khtml/Frame.h:
        (Frame::instances):
        (Frame::MarkedTextUnderline::MarkedTextUnderline):
        * kwq/MacFrame.cpp: Removed.
        * kwq/MacFrame.h:
        (MacFrame::markedTextRange):
        * kwq/MacFrame.mm: - humped a bunch of stuff down to Frame
        * kwq/WebCoreSettings.mm:
        (-[WebCoreSettings _updateAllViews]): use Mac calls
        * kwq/WebCoreTextRendererFactory.mm:
        (-[WebCoreTextRendererFactory clearCaches]): ditto

2006-01-10  Eric Seidel  <eseidel@apple.com>

        Rubber-stamped by mjs.

        Split html_formimpl.{cpp,h} into multiple files (one per class)
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6461

        * WebCore.xcodeproj/project.pbxproj: added files
        * khtml/ecma/kjs_html.cpp: updated includes
        * khtml/html/FormDataList.h: Added.
        * khtml/html/FormDataList.cpp: Added.
        * khtml/html/HTMLButtonElementImpl.cpp: Added.
        * khtml/html/HTMLButtonElementImpl.h: Added.
        * khtml/html/HTMLFieldSetElementImpl.cpp: Added.
        * khtml/html/HTMLFieldSetElementImpl.h: Added.
        * khtml/html/HTMLFormElementImpl.cpp: Added.
        * khtml/html/HTMLFormElementImpl.h: Added.
        * khtml/html/HTMLGenericFormElementImpl.cpp: Added.
        * khtml/html/HTMLGenericFormElementImpl.h: Added.
        * khtml/html/HTMLInputElementImpl.cpp: Added.
        * khtml/html/HTMLInputElementImpl.h: Added.
        * khtml/html/HTMLIsIndexElementImpl.cpp: Added.
        * khtml/html/HTMLIsIndexElementImpl.h: Added.
        * khtml/html/HTMLKeygenElementImpl.cpp: Added.
        * khtml/html/HTMLKeygenElementImpl.h: Added.
        * khtml/html/HTMLLabelElementImpl.cpp: Added.
        * khtml/html/HTMLLabelElementImpl.h: Added.
        * khtml/html/HTMLLegendElementImpl.cpp: Added.
        * khtml/html/HTMLLegendElementImpl.h: Added.
        * khtml/html/HTMLOptGroupElementImpl.cpp: Added.
        * khtml/html/HTMLOptGroupElementImpl.h: Added.
        * khtml/html/HTMLOptionElementImpl.cpp: Added.
        * khtml/html/HTMLOptionElementImpl.h: Added.
        * khtml/html/HTMLOptionsCollectionImpl.h: Added.
        * khtml/html/HTMLSelectElementImpl.cpp: Added.
        * khtml/html/HTMLSelectElementImpl.h: Added.
        * khtml/html/HTMLTextAreaElementImpl.cpp: Added.
        * khtml/html/HTMLTextAreaElementImpl.h: Added.
        * khtml/html/html_documentimpl.cpp: updated includes
        * khtml/html/html_imageimpl.cpp: updated includes
        * khtml/html/html_miscimpl.cpp: updated includes
        * khtml/html/html_objectimpl.cpp: updated includes
        * khtml/html/htmlfactory.cpp: updated includes
        * khtml/html/htmlparser.cpp: updated includes
        * khtml/khtmlview.cpp: updated includes
        * khtml/rendering/render_block.cpp: updated includes
        * khtml/rendering/render_button.cpp: updated includes
        * khtml/rendering/render_canvasimage.cpp: updated includes
        * khtml/rendering/render_flow.cpp: updated includes
        * khtml/rendering/render_form.cpp: updated includes
        * khtml/rendering/render_form.h: updated includes
        * khtml/rendering/render_image.cpp: updated includes
        * khtml/rendering/render_line.cpp: updated includes
        * khtml/rendering/render_theme.cpp: updated includes
        * khtml/xml/dom_docimpl.cpp: updated includes
        * kwq/DOMHTML.mm: updated includes
        * kwq/KWQAccObject.mm: updated includes
        * kwq/MacFrame.mm: updated includes
        * kwq/WebCoreBridge.mm: updated includes

2006-01-09  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6446
          Allow surrogate pairs in numeric entities

        Test case: fast/parser/entity-surrogate-pairs.html

        * khtml/html/htmltokenizer.cpp:
        (khtml::HTMLTokenizer::parseEntity): Don't check if we got a surrogate.

2006-01-09  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Further code removal (and build fix!)

        * khtml/Frame.cpp:
        (Frame::init):
        (Frame::~Frame):
        (Frame::restoreURL):
        (Frame::didOpenURL):
        (Frame::baseURL):
        (Frame::baseTarget):
        * khtml/Frame.h:
        (Frame::khtmlMouseDoubleClickEvent):
        (Frame::khtmlDrawContentsEvent):
        * kwq/KWQLoader.mm:
        (KWQServeRequest):
        * kwq/KWQSlot.mm:
        (KWQSlot::KWQSlot):
        (KWQSlot::call):

2006-01-09  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Remove unused code from Frame.

        * khtml/Frame.cpp:
        (Frame::clear):
        (Frame::receivedFirstData):
        (Frame::checkCompleted):
        (Frame::completeURL):
        (Frame::khtmlMousePressEvent):
        (Frame::handleMouseMoveEventSelection):
        (Frame::khtmlMouseReleaseEvent):
        * khtml/Frame.h:
        * khtml/khtmlpart_p.h:
        * khtml/khtmlview.cpp:
        (KHTMLView::viewportWheelEvent):
        (KHTMLView::focusOutEvent):

2006-01-09  Eric Seidel  <eseidel@apple.com>

        Reviewed by hyatt.

        Remove khtml-specific forwarding headers.

        * ForwardingHeaders/css: Removed.
        * ForwardingHeaders/css/css_base.h: Removed.
        * ForwardingHeaders/css/css_computedstyle.h: Removed.
        * ForwardingHeaders/css/css_ruleimpl.h: Removed.
        * ForwardingHeaders/css/css_stylesheetimpl.h: Removed.
        * ForwardingHeaders/css/css_valueimpl.h: Removed.
        * ForwardingHeaders/css/csshelper.h: Removed.
        * ForwardingHeaders/css/cssparser.h: Removed.
        * ForwardingHeaders/css/cssproperties.h: Removed.
        * ForwardingHeaders/css/cssstyleselector.h: Removed.
        * ForwardingHeaders/css/cssvalues.h: Removed.
        * ForwardingHeaders/dom: Removed.
        * ForwardingHeaders/dom/css_rule.h: Removed.
        * ForwardingHeaders/dom/css_stylesheet.h: Removed.
        * ForwardingHeaders/dom/css_value.h: Removed.
        * ForwardingHeaders/dom/dom2_events.h: Removed.
        * ForwardingHeaders/dom/dom2_range.h: Removed.
        * ForwardingHeaders/dom/dom2_traversal.h: Removed.
        * ForwardingHeaders/dom/dom_exception.h: Removed.
        * ForwardingHeaders/dom/dom_node.h: Removed.
        * ForwardingHeaders/dom/dom_string.h: Removed.
        * ForwardingHeaders/ecma: Removed.
        * ForwardingHeaders/ecma/kjs_binding.h: Removed.
        * ForwardingHeaders/ecma/kjs_dom.h: Removed.
        * ForwardingHeaders/ecma/kjs_proxy.h: Removed.
        * ForwardingHeaders/editing: Removed.
        * ForwardingHeaders/editing/SelectionController.h: Removed.
        * ForwardingHeaders/editing/edit_actions.h: Removed.
        * ForwardingHeaders/editing/html_interchange.h: Removed.
        * ForwardingHeaders/editing/htmlediting.h: Removed.
        * ForwardingHeaders/editing/jsediting.h: Removed.
        * ForwardingHeaders/editing/markup.h: Removed.
        * ForwardingHeaders/editing/text_affinity.h: Removed.
        * ForwardingHeaders/editing/text_granularity.h: Removed.
        * ForwardingHeaders/editing/visible_position.h: Removed.
        * ForwardingHeaders/editing/visible_text.h: Removed.
        * ForwardingHeaders/editing/visible_units.h: Removed.
        * ForwardingHeaders/html: Removed.
        * ForwardingHeaders/html/html_baseimpl.h: Removed.
        * ForwardingHeaders/html/html_blockimpl.h: Removed.
        * ForwardingHeaders/html/html_canvasimpl.h: Removed.
        * ForwardingHeaders/html/html_documentimpl.h: Removed.
        * ForwardingHeaders/html/html_elementimpl.h: Removed.
        * ForwardingHeaders/html/html_formimpl.h: Removed.
        * ForwardingHeaders/html/html_headimpl.h: Removed.
        * ForwardingHeaders/html/html_imageimpl.h: Removed.
        * ForwardingHeaders/html/html_inlineimpl.h: Removed.
        * ForwardingHeaders/html/html_listimpl.h: Removed.
        * ForwardingHeaders/html/html_miscimpl.h: Removed.
        * ForwardingHeaders/html/html_objectimpl.h: Removed.
        * ForwardingHeaders/html/html_tableimpl.h: Removed.
        * ForwardingHeaders/html/htmlparser.h: Removed.
        * ForwardingHeaders/html/htmltokenizer.h: Removed.
        * ForwardingHeaders/misc: Removed.
        * ForwardingHeaders/misc/decoder.h: Removed.
        * ForwardingHeaders/misc/formdata.h: Removed.
        * ForwardingHeaders/misc/helper.h: Removed.
        * ForwardingHeaders/misc/khtmllayout.h: Removed.
        * ForwardingHeaders/misc/loader.h: Removed.
        * ForwardingHeaders/misc/loader_client.h: Removed.
        * ForwardingHeaders/misc/shared.h: Removed.
        * ForwardingHeaders/misc/stringit.h: Removed.
        * ForwardingHeaders/rendering: Removed.
        * ForwardingHeaders/rendering/font.h: Removed.
        * ForwardingHeaders/rendering/render_applet.h: Removed.
        * ForwardingHeaders/rendering/render_block.h: Removed.
        * ForwardingHeaders/rendering/render_box.h: Removed.
        * ForwardingHeaders/rendering/render_br.h: Removed.
        * ForwardingHeaders/rendering/render_canvas.h: Removed.
        * ForwardingHeaders/rendering/render_canvasimage.h: Removed.
        * ForwardingHeaders/rendering/render_flow.h: Removed.
        * ForwardingHeaders/rendering/render_form.h: Removed.
        * ForwardingHeaders/rendering/render_frames.h: Removed.
        * ForwardingHeaders/rendering/render_image.h: Removed.
        * ForwardingHeaders/rendering/render_layer.h: Removed.
        * ForwardingHeaders/rendering/render_line.h: Removed.
        * ForwardingHeaders/rendering/render_list.h: Removed.
        * ForwardingHeaders/rendering/render_object.h: Removed.
        * ForwardingHeaders/rendering/render_replaced.h: Removed.
        * ForwardingHeaders/rendering/render_style.h: Removed.
        * ForwardingHeaders/rendering/render_table.h: Removed.
        * ForwardingHeaders/rendering/table_layout.h: Removed.
        * ForwardingHeaders/xbl: Removed.
        * ForwardingHeaders/xbl/xbl_binding_manager.h: Removed.
        * ForwardingHeaders/xml: Removed.
        * ForwardingHeaders/xml/EventNames.h: Removed.
        * ForwardingHeaders/xml/dom2_eventsimpl.h: Removed.
        * ForwardingHeaders/xml/dom2_rangeimpl.h: Removed.
        * ForwardingHeaders/xml/dom2_traversalimpl.h: Removed.
        * ForwardingHeaders/xml/dom2_viewsimpl.h: Removed.
        * ForwardingHeaders/xml/dom_atomicstring.h: Removed.
        * ForwardingHeaders/xml/dom_docimpl.h: Removed.
        * ForwardingHeaders/xml/dom_elementimpl.h: Removed.
        * ForwardingHeaders/xml/dom_nodeimpl.h: Removed.
        * ForwardingHeaders/xml/dom_position.h: Removed.
        * ForwardingHeaders/xml/dom_stringimpl.h: Removed.
        * ForwardingHeaders/xml/dom_textimpl.h: Removed.
        * ForwardingHeaders/xml/dom_xmlimpl.h: Removed.
        * ForwardingHeaders/xml/xml_tokenizer.h: Removed.
        * WebCore.xcodeproj/project.pbxproj:
        * khtml/css/css_valueimpl.cpp:
        * khtml/css/cssstyleselector.cpp:
        * khtml/editing/apply_style_command.cpp:
        * khtml/editing/jsediting.cpp:
        * khtml/editing/replace_selection_command.cpp:
        * khtml/html/html_baseimpl.cpp:
        * khtml/html/html_blockimpl.cpp:
        * khtml/html/html_canvasimpl.cpp:
        * khtml/html/html_documentimpl.cpp:
        * khtml/html/html_elementimpl.cpp:
        * khtml/html/html_formimpl.cpp:
        * khtml/html/html_imageimpl.cpp:
        * khtml/html/html_inlineimpl.cpp:
        * khtml/html/html_listimpl.cpp:
        * khtml/html/html_objectimpl.cpp:
        * khtml/html/html_tableimpl.cpp:
        * khtml/html/htmlparser.cpp:
        * khtml/khtml_part.cpp:
        * khtml/misc/decoder.cpp:
        * khtml/rendering/render_frames.cpp:
        * khtml/xml/dom_elementimpl.cpp:

2006-01-10  Anders Carlsson  <andersca@mac.com>

        Reviewed by Maciej.

        - renamed ChildFrame::m_frame to m_renderer and
        ChildFrame::m_part to m_frame which makes more sense.
        
        This also fixes some bugs which were introduced in Maciej's
        previous commit.
        
        * khtml/Frame.cpp:
        (Frame::stopLoading):
        (Frame::clear):
        (Frame::stopAnimations):
        (Frame::checkEmitLoadEvent):
        (Frame::requestFrame):
        (Frame::requestObject):
        (Frame::processObjectRequest):
        (Frame::childFrame):
        (Frame::findFrame):
        (Frame::frameExists):
        (Frame::setZoomFactor):
        (Frame::frames):
        (Frame::childFrameNamed):
        (Frame::connectChild):
        (Frame::disconnectChild):
        (Frame::handleFallbackContent):
        * khtml/khtmlpart_p.h:
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::ownerElement):
        * kwq/MacFrame.mm:
        (Frame::frameDetached):
        (MacFrame::createPart):
        (MacFrame::nextKeyViewInFrameHierarchy):
        (MacFrame::setPolicyBaseURL):

2006-01-09  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        http://bugzilla.opendarwin.org/show_bug.cgi?id=6450
        - renamed KHTMLPart to Frame (and KWQKHTMLPart to MacFrame for now)

        * ForwardingHeaders/ksvg2/KSVGPart.h:
        * WebCore.xcodeproj/project.pbxproj:
        * khtml/Frame.cpp: Added.
        (khtml::PartStyleSheetLoader::PartStyleSheetLoader):
        (khtml::PartStyleSheetLoader::setStyleSheet):
        (Frame::Frame):
        (Frame::init):
        (Frame::~Frame):
        (Frame::restoreURL):
        (Frame::didOpenURL):
        (Frame::didExplicitOpen):
        (Frame::stopLoading):
        (Frame::closeURL):
        (Frame::browserExtension):
        (Frame::view):
        (Frame::setJScriptEnabled):
        (Frame::jScriptEnabled):
        (Frame::setMetaRefreshEnabled):
        (Frame::metaRefreshEnabled):
        (Frame::jScript):
        (Frame::replaceContentsWithScriptResult):
        (Frame::executeScript):
        (Frame::scheduleScript):
        (Frame::executeScheduledScript):
        (Frame::setJavaEnabled):
        (Frame::javaEnabled):
        (Frame::setPluginsEnabled):
        (Frame::pluginsEnabled):
        (Frame::slotDebugDOMTree):
        (Frame::slotDebugRenderTree):
        (Frame::setAutoloadImages):
        (Frame::autoloadImages):
        (Frame::clear):
        (Frame::openFile):
        (Frame::xmlDocImpl):
        (Frame::replaceDocImpl):
        (Frame::receivedFirstData):
        (Frame::slotFinished):
        (Frame::childBegin):
        (Frame::begin):
        (Frame::write):
        (Frame::end):
        (Frame::endIfNotLoading):
        (Frame::stop):
        (Frame::stopAnimations):
        (Frame::gotoAnchor):
        (Frame::slotFinishedParsing):
        (Frame::slotLoaderRequestStarted):
        (Frame::slotLoaderRequestDone):
        (Frame::checkCompleted):
        (Frame::checkEmitLoadEvent):
        (Frame::settings):
        (Frame::baseURL):
        (Frame::baseTarget):
        (Frame::completeURL):
        (Frame::scheduleRedirection):
        (Frame::scheduleLocationChange):
        (Frame::isScheduledLocationChangePending):
        (Frame::scheduleHistoryNavigation):
        (Frame::cancelRedirection):
        (Frame::changeLocation):
        (Frame::slotRedirect):
        (Frame::slotRedirection):
        (Frame::encoding):
        (Frame::setUserStyleSheet):
        (Frame::setStandardFont):
        (Frame::setFixedFont):
        (Frame::urlCursor):
        (Frame::onlyLocalReferences):
        (Frame::setOnlyLocalReferences):
        (Frame::selectedText):
        (Frame::hasSelection):
        (Frame::selection):
        (Frame::selectionGranularity):
        (Frame::setSelectionGranularity):
        (Frame::dragCaret):
        (Frame::mark):
        (Frame::setMark):
        (Frame::setSelection):
        (Frame::setDragCaret):
        (Frame::clearSelection):
        (Frame::invalidateSelection):
        (Frame::setCaretVisible):
        (Frame::clearCaretRectIfNeeded):
        (isFrameElement):
        (Frame::setFocusNodeIfNeeded):
        (Frame::selectionLayoutChanged):
        (Frame::setXPosForVerticalArrowNavigation):
        (Frame::xPosForVerticalArrowNavigation):
        (Frame::timerEvent):
        (Frame::paintCaret):
        (Frame::paintDragCaret):
        (Frame::urlSelected):
        (Frame::requestFrame):
        (Frame::requestFrameName):
        (Frame::requestObject):
        (Frame::processObjectRequest):
        (Frame::submitFormAgain):
        (Frame::submitForm):
        (Frame::slotParentCompleted):
        (Frame::slotChildStarted):
        (Frame::slotChildCompleted):
        (Frame::childFrame):
        (Frame::findFrame):
        (Frame::frameExists):
        (Frame::parentFrame):
        (Frame::zoomFactor):
        (Frame::slotIncZoom):
        (Frame::slotDecZoom):
        (Frame::setZoomFactor):
        (Frame::setJSStatusBarText):
        (Frame::setJSDefaultStatusBarText):
        (Frame::jsStatusBarText):
        (Frame::jsDefaultStatusBarText):
        (Frame::referrer):
        (Frame::lastModified):
        (Frame::reparseConfiguration):
        (Frame::frameNames):
        (Frame::frames):
        (Frame::childFrameNamed):
        (Frame::setDNDEnabled):
        (Frame::dndEnabled):
        (Frame::shouldDragAutoNode):
        (Frame::customEvent):
        (Frame::isPointInsideSelection):
        (Frame::selectClosestWordFromMouseEvent):
        (Frame::handleMousePressEventDoubleClick):
        (Frame::handleMousePressEventTripleClick):
        (Frame::handleMousePressEventSingleClick):
        (Frame::khtmlMousePressEvent):
        (Frame::khtmlMouseDoubleClickEvent):
        (Frame::handleMouseMoveEventSelection):
        (Frame::khtmlMouseMoveEvent):
        (Frame::khtmlMouseReleaseEvent):
        (Frame::khtmlDrawContentsEvent):
        (Frame::startAutoScroll):
        (Frame::stopAutoScroll):
        (Frame::selectAll):
        (Frame::selectContentsOfNode):
        (Frame::shouldChangeSelection):
        (Frame::shouldBeginEditing):
        (Frame::shouldEndEditing):
        (Frame::isContentEditable):
        (Frame::lastEditCommand):
        (Frame::appliedEditing):
        (Frame::unappliedEditing):
        (Frame::reappliedEditing):
        (Frame::typingStyle):
        (Frame::setTypingStyle):
        (Frame::clearTypingStyle):
        (Frame::slotPartRemoved):
        (Frame::createHTMLEventListener):
        (Frame::opener):
        (Frame::setOpener):
        (Frame::openedByJS):
        (Frame::setOpenedByJS):
        (Frame::preloadStyleSheet):
        (Frame::preloadScript):
        (Frame::restored):
        (Frame::incrementFrameCount):
        (Frame::decrementFrameCount):
        (Frame::topLevelFrameCount):
        (Frame::tabsToLinks):
        (Frame::tabsToAllControls):
        (Frame::copyToPasteboard):
        (Frame::cutToPasteboard):
        (Frame::pasteFromPasteboard):
        (Frame::pasteAndMatchStyle):
        (Frame::transpose):
        (Frame::redo):
        (Frame::undo):
        (Frame::computeAndSetTypingStyle):
        (Frame::applyStyle):
        (Frame::applyParagraphStyle):
        (updateState):
        (Frame::selectionHasStyle):
        (Frame::selectionStartHasStyle):
        (Frame::selectionStartStylePropertyValue):
        (Frame::selectionComputedStyle):
        (Frame::applyEditingStyleToBodyElement):
        (Frame::removeEditingStyleFromBodyElement):
        (Frame::applyEditingStyleToElement):
        (Frame::removeEditingStyleFromElement):
        (Frame::isCharacterSmartReplaceExempt):
        (Frame::connectChild):
        (Frame::disconnectChild):
        (Frame::keepAlive):
        (Frame::slotEndLifeSupport):
        (Frame::selectFrameElementInParentIfFullySelected):
        (Frame::handleFallbackContent):
        * khtml/Frame.h: Added.
        * khtml/css/cssstyleselector.cpp:
        (khtml::CSSStyleSelector::CSSStyleSelector):
        (khtml::CSSStyleSelector::initForStyleResolve):
        (khtml::CSSStyleSelector::checkOneSelector):
        (khtml::CSSStyleSelector::applyProperty):
        (khtml::CSSStyleSelector::getComputedSizeFromSpecifiedSize):
        * khtml/css/cssstyleselector.h:
        * khtml/ecma/kjs_binding.cpp:
        (KJS::ScriptInterpreter::ScriptInterpreter):
        (KJS::ScriptInterpreter::~ScriptInterpreter):
        * khtml/ecma/kjs_binding.h:
        (KJS::ScriptInterpreter::frame):
        * khtml/ecma/kjs_dom.cpp:
        (KJS::DOMDocument::getValueProperty):
        (KJS::getDOMDocumentNode):
        (KJS::checkNodeSecurity):
        * khtml/ecma/kjs_events.cpp:
        (KJS::JSAbstractEventListener::handleEvent):
        (KJS::JSLazyEventListener::parseCode):
        * khtml/ecma/kjs_html.cpp:
        (KJS::KJS::HTMLDocFunction::callAsFunction):
        (KJS::HTMLDocument::namedItemGetter):
        (KJS::HTMLDocument::getValueProperty):
        (KJS::KJS::HTMLDocument::putValueProperty):
        (KJS::HTMLElement::framesetNameGetter):
        (KJS::HTMLElement::frameWindowPropertyGetter):
        (KJS::HTMLElement::getOwnPropertySlot):
        (KJS::KJS::HTMLElement::implementsCall):
        (KJS::Image::notifyFinished):
        * khtml/ecma/kjs_navigator.cpp:
        (KJS::Navigator::Navigator):
        (KJS::Navigator::getValueProperty):
        (KJS::NavigatorFunc::callAsFunction):
        * khtml/ecma/kjs_navigator.h:
        (KJS::Navigator::frame):
        * khtml/ecma/kjs_proxy.cpp:
        (KJSProxyImpl::KJSProxyImpl):
        (KJSProxyImpl::evaluate):
        (KJSProxyImpl::clear):
        (KJSProxyImpl::createHTMLEventHandler):
        (KJSProxyImpl::interpreter):
        (KJSProxyImpl::initScript):
        * khtml/ecma/kjs_proxy.h:
        * khtml/ecma/kjs_traversal.cpp:
        (KJS::JSNodeFilterCondition::acceptNode):
        * khtml/ecma/kjs_window.cpp:
        (KJS::History::History):
        (KJS::FrameArray::FrameArray):
        (KJS::Screen::getValueProperty):
        (KJS::Window::Window):
        (KJS::Window::interpreter):
        (KJS::Window::retrieveWindow):
        (KJS::Window::retrieve):
        (KJS::Window::location):
        (KJS::Window::selection):
        (KJS::Window::locationbar):
        (KJS::Window::menubar):
        (KJS::Window::personalbar):
        (KJS::Window::statusbar):
        (KJS::Window::toolbar):
        (KJS::Window::scrollbars):
        (KJS::allowPopUp):
        (KJS::createNewWindow):
        (KJS::canShowModalDialog):
        (KJS::canShowModalDialogNow):
        (KJS::showModalDialog):
        (KJS::Window::getValueProperty):
        (KJS::Window::childFrameGetter):
        (KJS::Window::namedFrameGetter):
        (KJS::Window::indexGetter):
        (KJS::Window::namedItemGetter):
        (KJS::Window::getOwnPropertySlot):
        (KJS::Window::put):
        (KJS::Window::toBoolean):
        (KJS::Window::scheduleClose):
        (KJS::Window::isSafeScript):
        (KJS::Window::setListener):
        (KJS::Window::getListener):
        (KJS::Window::setCurrentEvent):
        (KJS::WindowFunc::callAsFunction):
        (KJS::Window::updateLayout):
        (KJS::ScheduledAction::execute):
        (KJS::WindowQObject::WindowQObject):
        (KJS::FrameArray::getValueProperty):
        (KJS::FrameArray::indexGetter):
        (KJS::FrameArray::nameGetter):
        (KJS::FrameArray::getOwnPropertySlot):
        (KJS::Location::Location):
        (KJS::Location::getValueProperty):
        (KJS::Location::getOwnPropertySlot):
        (KJS::Location::put):
        (KJS::Location::toString):
        (KJS::LocationFunc::callAsFunction):
        (KJS::Selection::Selection):
        (KJS::Selection::getValueProperty):
        (KJS::Selection::getOwnPropertySlot):
        (KJS::Selection::toString):
        (KJS::SelectionFunc::callAsFunction):
        (KJS::BarInfo::BarInfo):
        (KJS::BarInfo::getValueProperty):
        (KJS::BarInfo::getOwnPropertySlot):
        (KJS::History::getValueProperty):
        (KJS::HistoryFunc::callAsFunction):
        * khtml/ecma/kjs_window.h:
        (KJS::Window::frame):
        (KJS::Location::frame):
        (KJS::Selection::frame):
        (KJS::BarInfo::frame):
        * khtml/ecma/xmlhttprequest.cpp:
        (KJS::XMLHttpRequest::changeState):
        (KJS::XMLHttpRequestProtoFunc::callAsFunction):
        * khtml/editing/SelectionController.cpp:
        (khtml::SelectionController::modify):
        (khtml::SelectionController::xPosForVerticalArrowNavigation):
        * khtml/editing/SelectionController.h:
        (khtml::SelectionController::frame):
        * khtml/editing/delete_selection_command.cpp:
        (khtml::DeleteSelectionCommand::calculateTypingStyleAfterDelete):
        * khtml/editing/edit_command.cpp:
        (khtml::EditCommand::EditCommand):
        (khtml::EditCommand::apply):
        (khtml::EditCommand::unapply):
        (khtml::EditCommand::reapply):
        (khtml::EditCommand::styleAtPosition):
        * khtml/editing/htmlediting.cpp:
        * khtml/editing/insert_line_break_command.cpp:
        (khtml::InsertLineBreakCommand::doApply):
        * khtml/editing/insert_text_command.cpp:
        (khtml::InsertTextCommand::input):
        * khtml/editing/jsediting.cpp:
        (DOM::JSEditor::execCommand):
        (DOM::JSEditor::queryCommandEnabled):
        (DOM::JSEditor::queryCommandIndeterm):
        (DOM::JSEditor::queryCommandState):
        (DOM::JSEditor::queryCommandValue):
        * khtml/editing/jsediting.h:
        * khtml/editing/replace_selection_command.cpp:
        (khtml::ReplaceSelectionCommand::doApply):
        * khtml/editing/text_granularity.h:
        * khtml/editing/typing_command.cpp:
        (khtml::TypingCommand::deleteKeyPressed):
        (khtml::TypingCommand::forwardDeleteKeyPressed):
        (khtml::TypingCommand::insertText):
        (khtml::TypingCommand::insertLineBreak):
        (khtml::TypingCommand::insertParagraphSeparatorInQuotedContent):
        (khtml::TypingCommand::insertParagraphSeparator):
        (khtml::TypingCommand::markMisspellingsAfterTyping):
        (khtml::TypingCommand::typingAddedToOpenCommand):
        (khtml::TypingCommand::insertTextRunWithoutNewlines):
        * khtml/html/html_baseimpl.cpp:
        (HTMLFrameElementImpl::isURLAllowed):
        (HTMLFrameElementImpl::openURL):
        (HTMLFrameElementImpl::attach):
        (HTMLFrameElementImpl::close):
        (HTMLFrameElementImpl::contentPart):
        (HTMLFrameElementImpl::contentDocument):
        (HTMLIFrameElementImpl::attach):
        * khtml/html/html_baseimpl.h:
        * khtml/html/html_canvasimpl.cpp:
        * khtml/html/html_documentimpl.cpp:
        (DOM::HTMLDocumentImpl::lastModified):
        * khtml/html/html_elementimpl.cpp:
        (HTMLElementImpl::isContentEditable):
        (HTMLElementImpl::setContentEditable):
        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLFormElementImpl::formData):
        (DOM::HTMLFormElementImpl::prepareSubmit):
        (DOM::HTMLFormElementImpl::submit):
        (DOM::HTMLFormElementImpl::reset):
        (DOM::HTMLGenericFormElementImpl::isKeyboardFocusable):
        (DOM::HTMLKeygenElementImpl::appendFormData):
        * khtml/html/html_headimpl.cpp:
        (HTMLBaseElementImpl::process):
        (HTMLLinkElementImpl::process):
        (HTMLScriptElementImpl::parseMappedAttribute):
        (HTMLScriptElementImpl::insertedIntoDocument):
        (HTMLScriptElementImpl::evaluateScript):
        * khtml/html/html_imageimpl.cpp:
        * khtml/html/html_inlineimpl.cpp:
        (DOM::HTMLAnchorElementImpl::isKeyboardFocusable):
        (DOM::HTMLAnchorElementImpl::defaultEventHandler):
        * khtml/html/html_objectimpl.cpp:
        (DOM::HTMLAppletElementImpl::createRenderer):
        (DOM::HTMLAppletElementImpl::getAppletInstance):
        (DOM::HTMLEmbedElementImpl::getEmbedInstance):
        (DOM::HTMLEmbedElementImpl::rendererIsNeeded):
        (DOM::HTMLObjectElementImpl::getObjectInstance):
        (DOM::HTMLObjectElementImpl::rendererIsNeeded):
        * khtml/html/html_tableimpl.cpp:
        * khtml/html/htmlparser.cpp:
        (HTMLParser::noscriptCreateErrorCheck):
        * khtml/html/htmltokenizer.cpp:
        (khtml::HTMLTokenizer::scriptHandler):
        (khtml::HTMLTokenizer::scriptExecution):
        (khtml::HTMLTokenizer::parseTag):
        (khtml::HTMLTokenizer::write):
        (khtml::HTMLTokenizer::stopParsing):
        (khtml::HTMLTokenizer::timerEvent):
        (khtml::HTMLTokenizer::processToken):
        * khtml/khtml_part.cpp: Removed.
        * khtml/khtml_part.h: Removed.
        * khtml/khtmlpart_p.h:
        (KHTMLPartPrivate::KHTMLPartPrivate):
        * khtml/khtmlview.cpp:
        (KHTMLView::KHTMLView):
        (KHTMLView::~KHTMLView):
        (KHTMLView::clearPart):
        (KHTMLView::clear):
        (KHTMLView::resizeEvent):
        (KHTMLView::adjustViewSize):
        (KHTMLView::layout):
        (KHTMLView::updateDashboardRegions):
        (KHTMLView::viewportMousePressEvent):
        (KHTMLView::viewportMouseDoubleClickEvent):
        (selectCursor):
        (KHTMLView::viewportMouseMoveEvent):
        (KHTMLView::viewportMouseReleaseEvent):
        (KHTMLView::keyPressEvent):
        (KHTMLView::dispatchDragEvent):
        (KHTMLView::updateDragAndDrop):
        (KHTMLView::focusNextPrevNode):
        (KHTMLView::mediaType):
        (KHTMLView::dispatchMouseEvent):
        (KHTMLView::viewportWheelEvent):
        (KHTMLView::focusInEvent):
        (KHTMLView::focusOutEvent):
        (KHTMLView::timerEvent):
        (KHTMLView::scheduleRelayout):
        (KHTMLView::unscheduleRelayout):
        * khtml/khtmlview.h:
        (KHTMLView::frame):
        * khtml/misc/CachedImageCallback.cpp:
        (khtml::CachedImageCallback::notifyUpdate):
        (khtml::CachedImageCallback::notifyFinished):
        (khtml::CachedImageCallback::clear):
        * khtml/misc/CachedObject.h:
        * khtml/misc/DocLoader.cpp:
        (khtml::DocLoader::DocLoader):
        (khtml::DocLoader::requestImage):
        (khtml::DocLoader::requestStyleSheet):
        (khtml::DocLoader::requestScript):
        (khtml::DocLoader::requestXSLStyleSheet):
        (khtml::DocLoader::requestXBLDocument):
        * khtml/misc/DocLoader.h:
        (khtml::DocLoader::frame):
        * khtml/misc/loader.cpp:
        (khtml::Loader::slotReceivedResponse):
        * khtml/rendering/InlineTextBox.cpp:
        (khtml::InlineTextBox::paint):
        (khtml::InlineTextBox::paintMarkedTextUnderline):
        * khtml/rendering/InlineTextBox.h:
        * khtml/rendering/render_applet.cpp:
        (RenderApplet::createWidgetIfNecessary):
        * khtml/rendering/render_block.cpp:
        (khtml::RenderBlock::paintCaret):
        * khtml/rendering/render_canvas.cpp:
        * khtml/rendering/render_form.cpp:
        (RenderFileButton::RenderFileButton):
        * khtml/rendering/render_frames.cpp:
        (isURLAllowed):
        (RenderPartObject::updateWidget):
        * khtml/rendering/render_layer.cpp:
        * khtml/rendering/render_object.cpp:
        (RenderObject::draggableNode):
        * khtml/rendering/render_replaced.cpp:
        (RenderWidget::eventFilter):
        * khtml/xml/dom2_eventsimpl.h:
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::DocumentImpl):
        (DocumentImpl::updateTitle):
        (DocumentImpl::frame):
        (DocumentImpl::recalcStyle):
        (DocumentImpl::updateSelection):
        (DocumentImpl::open):
        (DocumentImpl::close):
        (DocumentImpl::implicitClose):
        (DocumentImpl::processHttpEquiv):
        (DocumentImpl::selectedStylesheetSet):
        (DocumentImpl::setSelectedStylesheetSet):
        (DocumentImpl::recalcStyleSelector):
        (DocumentImpl::relinquishesEditingFocus):
        (DocumentImpl::acceptsEditingFocus):
        (DocumentImpl::clearSelectionIfNeeded):
        (DocumentImpl::createHTMLEventListener):
        (DocumentImpl::ownerElement):
        (DocumentImpl::referrer):
        (DocumentImpl::parentDocument):
        * khtml/xml/dom_docimpl.h:
        * khtml/xml/dom_elementimpl.cpp:
        (ElementImpl::focus):
        * khtml/xml/dom_nodeimpl.cpp:
        (DOM::NodeImpl::dispatchEvent):
        * khtml/xml/dom_xmlimpl.cpp:
        (DOM::ProcessingInstructionImpl::checkStyleSheet):
        * khtml/xml/xml_tokenizer.cpp:
        (khtml::XMLTokenizer::processingInstruction):
        (khtml::XMLTokenizer::executeScripts):
        (khtml::XMLTokenizer::notifyFinished):
        * khtml/xsl/xslt_processorimpl.cpp:
        (DOM::XSLTProcessorImpl::createDocumentFromSource):
        * ksvg2/svg/SVGAElementImpl.cpp:
        (SVGAElementImpl::defaultEventHandler):
        * ksvg2/svg/SVGImageElementImpl.cpp:
        (SVGImageElementImpl::notifyFinished):
        * kwq/DOM.mm:
        (-[DOMNode KJS::Bindings::]):
        * kwq/DOMHTML.mm:
        * kwq/DOMInternal.mm:
        (-[WebScriptObject _initializeScriptDOMNodeImp]):
        * kwq/KWQAccObject.mm:
        (-[KWQAccObject textUnderElement]):
        (-[KWQAccObject value]):
        (-[KWQAccObject accessibilityPerformAction:]):
        (-[KWQAccObject accessibilityAttributeValue:]):
        (-[KWQAccObject doAXTextMarkerForPosition:]):
        (-[KWQAccObject rendererForView:]):
        (-[KWQAccObject doSetAXSelectedTextMarkerRange:]):
        * kwq/KWQClipboard.h:
        * kwq/KWQClipboard.mm:
        (KWQClipboard::KWQClipboard):
        (KWQClipboard::dragNSImage):
        * kwq/KWQComboBox.mm:
        (-[KWQPopUpButtonCell trackMouse:inRect:ofView:untilMouseUp:]):
        (-[KWQPopUpButton becomeFirstResponder]):
        (-[KWQPopUpButton resignFirstResponder]):
        (-[KWQPopUpButton nextKeyView]):
        (-[KWQPopUpButton previousKeyView]):
        * kwq/KWQFileButton.h:
        * kwq/KWQFileButton.mm:
        (KWQFileButton::KWQFileButton):
        (KWQFileButton::focusPolicy):
        (KWQFileButton::focusChanged):
        * kwq/KWQFrame.mm:
        (QFrame::setFrameStyle):
        * kwq/KWQKHTMLFactory.h:
        * kwq/KWQKHTMLPart.cpp: Removed.
        * kwq/KWQKHTMLPart.h: Removed.
        * kwq/KWQKHTMLPart.mm: Removed.
        * kwq/KWQKHTMLPartBrowserExtension.h:
        * kwq/KWQKHTMLPartBrowserExtension.mm:
        (KHTMLPartBrowserExtension::KHTMLPartBrowserExtension):
        (KHTMLPartBrowserExtension::openURLRequest):
        (KHTMLPartBrowserExtension::createNewWindow):
        (KHTMLPartBrowserExtension::setIconURL):
        (KHTMLPartBrowserExtension::setTypedIconURL):
        (KHTMLPartBrowserExtension::canRunModal):
        (KHTMLPartBrowserExtension::canRunModalNow):
        (KHTMLPartBrowserExtension::runModal):
        * kwq/KWQKHTMLView.cpp:
        (KHTMLView::topLevelWidget):
        * kwq/KWQKJavaAppletWidget.h:
        * kwq/KWQKJavaAppletWidget.mm:
        (KJavaAppletWidget::KJavaAppletWidget):
        * kwq/KWQKPartsBrowserInterface.h:
        (KParts::BrowserInterface::BrowserInterface):
        * kwq/KWQKPartsBrowserInterface.mm:
        (KParts::BrowserInterface::property):
        (KParts::BrowserInterface::callMethod):
        * kwq/KWQLineEdit.mm:
        * kwq/KWQListBox.mm:
        (-[KWQListBoxScrollView becomeFirstResponder]):
        (-[KWQTableView keyDown:]):
        (-[KWQTableView keyUp:]):
        (-[KWQTableView becomeFirstResponder]):
        (-[KWQTableView resignFirstResponder]):
        (-[KWQTableView nextKeyView]):
        (-[KWQTableView previousKeyView]):
        * kwq/KWQLoader.mm:
        (KWQServeRequest):
        (KWQServeSynchronousRequest):
        (KWQCheckIfReloading):
        (KWQCheckCacheObjectStatus):
        (KWQCacheObjectExpiresTime):
        * kwq/KWQObject.cpp:
        (QObject::inherits):
        (QObject::isFrame):
        * kwq/KWQObject.h:
        * kwq/KWQPageState.mm:
        (-[KWQPageState dealloc]):
        (-[KWQPageState finalize]):
        * kwq/KWQRegExp.cpp:
        (QRegExp::KWQRegExpPrivate::compile):
        * kwq/KWQRenderTreeDebug.cpp:
        (write):
        (writeSelection):
        * kwq/KWQSlider.mm:
        (-[KWQSlider becomeFirstResponder]):
        (-[KWQSlider resignFirstResponder]):
        (-[KWQSlider nextKeyView]):
        (-[KWQSlider previousKeyView]):
        (-[KWQSlider canBecomeKeyView]):
        (QSlider::focusPolicy):
        * kwq/KWQSlot.mm:
        (KWQSlot::KWQSlot):
        (KWQSlot::call):
        * kwq/KWQTextArea.mm:
        (-[KWQTextAreaTextView textDidChange:]):
        (-[KWQTextAreaTextView _isResizableByUser]):
        (-[KWQTextAreaTextView becomeFirstResponder]):
        (-[KWQTextAreaTextView nextKeyView]):
        (-[KWQTextAreaTextView previousKeyView]):
        (-[KWQTextAreaTextView _trackResizeFromMouseDown:]):
        (-[KWQTextAreaTextView drawRect:]):
        (-[KWQTextAreaTextView insertTab:]):
        (-[KWQTextAreaTextView insertBacktab:]):
        (-[KWQTextAreaTextView resignFirstResponder]):
        (-[KWQTextAreaTextView shouldDrawInsertionPoint]):
        (-[KWQTextAreaTextView selectedTextAttributes]):
        (-[KWQTextAreaTextView keyDown:]):
        (-[KWQTextAreaTextView keyUp:]):
        * kwq/KWQTextField.mm:
        (-[KWQTextFieldController controlTextDidBeginEditing:]):
        (-[KWQTextFieldController controlTextDidEndEditing:]):
        (-[KWQTextFieldController controlTextDidChange:]):
        (-[KWQTextFieldController control:textView:doCommandBySelector:]):
        (-[KWQTextFieldController textView:shouldHandleEvent:]):
        (-[KWQTextFieldController setHasFocus:]):
        (-[KWQTextField nextKeyView]):
        (-[KWQTextField previousKeyView]):
        (-[KWQSecureTextField nextKeyView]):
        (-[KWQSecureTextField previousKeyView]):
        (-[KWQSearchField nextKeyView]):
        (-[KWQSearchField previousKeyView]):
        * kwq/KWQTimer.h:
        * kwq/KWQWidget.mm:
        (QWidget::setActiveWindow):
        (QWidget::hasFocus):
        (QWidget::setFocus):
        (QWidget::clearFocus):
        (QWidget::isVisible):
        (QWidget::mapFromGlobal):
        (QWidget::setIsSelected):
        * kwq/MacFrame.cpp: Added.
        (MacFrame::isFrameSet):
        * kwq/MacFrame.h: Added.
        (MacFrame::instances):
        (Mac):
        * kwq/MacFrame.mm: Added.
        (Frame::completed):
        (Frame::openURL):
        (Frame::onURL):
        (Frame::setStatusBarText):
        (Frame::started):
        (redirectionTimerMonitor):
        (MacFrame::MacFrame):
        (MacFrame::~MacFrame):
        (MacFrame::freeClipboard):
        (MacFrame::setSettings):
        (MacFrame::generateFrameName):
        (MacFrame::provisionalLoadStarted):
        (MacFrame::userGestureHint):
        (MacFrame::openURL):
        (MacFrame::openURLRequest):
        (MacFrame::didNotOpenURL):
        (MacFrame::currentForm):
        (MacFrame::searchForLabelsAboveCell):
        (MacFrame::searchForLabelsBeforeElement):
        (MacFrame::matchLabelsAgainstElement):
        (MacFrame::findString):
        (MacFrame::clearRecordedFormValues):
        (MacFrame::recordFormValue):
        (MacFrame::submitForm):
        (MacFrame::setEncoding):
        (MacFrame::addData):
        (Frame::frameDetached):
        (MacFrame::urlSelected):
        (MacFrame::createPart):
        (MacFrame::setView):
        (MacFrame::view):
        (MacFrame::setTitle):
        (MacFrame::setStatusBarText):
        (MacFrame::scheduleClose):
        (MacFrame::unfocusWindow):
        (MacFrame::revealSelection):
        (MacFrame::advanceToNextMisspelling):
        (MacFrame::scrollOverflow):
        (MacFrame::wheelEvent):
        (MacFrame::redirectionTimerStartedOrStopped):
        (MacFrame::paint):
        (MacFrame::adjustPageHeight):
        (MacFrame::renderer):
        (MacFrame::userAgent):
        (MacFrame::mimeTypeForFileName):
        (MacFrame::nextKeyViewInFrame):
        (MacFrame::nextKeyViewInFrameHierarchy):
        (MacFrame::nextKeyView):
        (MacFrame::nextKeyViewForWidget):
        (MacFrame::currentEventIsMouseDownInWidget):
        (MacFrame::currentEventIsKeyboardOptionTab):
        (MacFrame::handleKeyboardOptionTabInView):
        (MacFrame::tabsToLinks):
        (MacFrame::tabsToAllControls):
        (MacFrame::executionContextForDOM):
        (MacFrame::bindingRootObject):
        (MacFrame::windowScriptObject):
        (MacFrame::windowScriptNPObject):
        (MacFrame::partClearedInBegin):
        (MacFrame::pauseTimeouts):
        (MacFrame::resumeTimeouts):
        (MacFrame::canCachePage):
        (MacFrame::saveWindowProperties):
        (MacFrame::saveLocationProperties):
        (MacFrame::restoreWindowProperties):
        (MacFrame::restoreLocationProperties):
        (MacFrame::saveInterpreterBuiltins):
        (MacFrame::restoreInterpreterBuiltins):
        (MacFrame::openURLFromPageCache):
        (MacFrame::frameForWidget):
        (MacFrame::bridgeForWidget):
        (MacFrame::frameForNode):
        (MacFrame::documentViewForNode):
        (MacFrame::nodeForWidget):
        (MacFrame::setDocumentFocus):
        (MacFrame::clearDocumentFocus):
        (MacFrame::saveDocumentState):
        (MacFrame::restoreDocumentState):
        (MacFrame::mutableInstances):
        (MacFrame::updatePolicyBaseURL):
        (MacFrame::setPolicyBaseURL):
        (MacFrame::requestedURLString):
        (MacFrame::incomingReferrer):
        (MacFrame::forceLayout):
        (MacFrame::forceLayoutWithPageWidthRange):
        (MacFrame::sendResizeEvent):
        (MacFrame::sendScrollEvent):
        (MacFrame::runJavaScriptAlert):
        (MacFrame::runJavaScriptConfirm):
        (MacFrame::runJavaScriptPrompt):
        (MacFrame::locationbarVisible):
        (MacFrame::menubarVisible):
        (MacFrame::personalbarVisible):
        (MacFrame::scrollbarsVisible):
        (MacFrame::statusbarVisible):
        (MacFrame::toolbarVisible):
        (MacFrame::addMessageToConsole):
        (MacFrame::createEmptyDocument):
        (MacFrame::addMetaData):
        (MacFrame::keyEvent):
        (MacFrame::scrollToAnchor):
        (MacFrame::closeURL):
        (MacFrame::canMouseDownStartSelect):
        (MacFrame::khtmlMousePressEvent):
        (MacFrame::khtmlMouseDoubleClickEvent):
        (MacFrame::passWidgetMouseDownEventToWidget):
        (MacFrame::lastEventIsMouseUp):
        (MacFrame::mouseDownViewIfStillGood):
        (MacFrame::dragHysteresisExceeded):
        (MacFrame::dispatchDragSrcEvent):
        (MacFrame::eventMayStartDrag):
        (MacFrame::khtmlMouseMoveEvent):
        (MacFrame::dragSourceMovedTo):
        (MacFrame::dragSourceEndedAt):
        (MacFrame::dispatchCPPEvent):
        (MacFrame::mayCut):
        (MacFrame::mayCopy):
        (MacFrame::mayPaste):
        (MacFrame::tryCut):
        (MacFrame::tryCopy):
        (MacFrame::tryPaste):
        (MacFrame::khtmlMouseReleaseEvent):
        (MacFrame::clearTimers):
        (MacFrame::passSubframeEventToSubframe):
        (MacFrame::passWheelEventToChildWidget):
        (MacFrame::mouseDown):
        (MacFrame::mouseDragged):
        (MacFrame::mouseUp):
        (MacFrame::sendFakeEventsAfterWidgetTracking):
        (MacFrame::mouseMoved):
        (MacFrame::shouldDragAutoNode):
        (MacFrame::sendContextMenuEvent):
        (MacFrame::fileWrapperForElement):
        (MacFrame::attributedString):
        (MacFrame::selectionRect):
        (MacFrame::visibleSelectionRect):
        (MacFrame::centerSelectionInVisibleArea):
        (MacFrame::imageFromRect):
        (MacFrame::selectionImage):
        (MacFrame::snapshotDragImage):
        (MacFrame::styleForSelectionStart):
        (MacFrame::fontForSelection):
        (MacFrame::fontAttributesForSelectionStart):
        (MacFrame::baseWritingDirectionForSelectionStart):
        (MacFrame::topLevelWidget):
        (MacFrame::tokenizerProcessedData):
        (MacFrame::selectionStartOffset):
        (MacFrame::selectionEndOffset):
        (MacFrame::selectionStart):
        (MacFrame::selectionEnd):
        (MacFrame::setBridge):
        (MacFrame::overrideMediaType):
        (MacFrame::setMediaType):
        (MacFrame::setSelectionFromNone):
        (MacFrame::setDisplaysWithFocusAttributes):
        (MacFrame::displaysWithFocusAttributes):
        (MacFrame::setWindowHasFocus):
        (MacFrame::backslashAsCurrencySymbol):
        (MacFrame::bodyBackgroundColor):
        (MacFrame::keyboardUIMode):
        (MacFrame::setName):
        (MacFrame::didTellBridgeAboutLoad):
        (MacFrame::haveToldBridgeAboutLoad):
        (MacFrame::clear):
        (Frame::print):
        (MacFrame::getAppletInstanceForWidget):
        (MacFrame::getEmbedInstanceForWidget):
        (MacFrame::getObjectInstanceForWidget):
        (MacFrame::addPluginRootObject):
        (MacFrame::cleanupPluginRootObjects):
        (MacFrame::registerCommandForUndoOrRedo):
        (MacFrame::registerCommandForUndo):
        (MacFrame::registerCommandForRedo):
        (MacFrame::clearUndoRedoOperations):
        (MacFrame::issueUndoCommand):
        (MacFrame::issueRedoCommand):
        (MacFrame::issueCutCommand):
        (MacFrame::issueCopyCommand):
        (MacFrame::issuePasteCommand):
        (MacFrame::issuePasteAndMatchStyleCommand):
        (MacFrame::issueTransposeCommand):
        (Frame::canUndo):
        (Frame::canRedo):
        (Frame::canPaste):
        (MacFrame::markMisspellingsInAdjacentWords):
        (MacFrame::markMisspellings):
        (MacFrame::respondToChangedSelection):
        (MacFrame::shouldChangeSelection):
        (MacFrame::respondToChangedContents):
        (MacFrame::isContentEditable):
        (MacFrame::shouldBeginEditing):
        (MacFrame::shouldEndEditing):
        (convertAttributesToUnderlines):
        (MacFrame::setMarkedTextRange):
        (MacFrame::markedTextUsesUnderlines):
        (MacFrame::markedTextUnderlines):
        (MacFrame::canGoBackOrForward):
        (MacFrame::prepareForUserAction):
        (MacFrame::didFirstLayout):
        (MacFrame::dashboardRegionsDictionary):
        (MacFrame::dashboardRegionsChanged):
        (MacFrame::isCharacterSmartReplaceExempt):
        (MacFrame::isFrame):
        (MacFrame::mousePressNode):
        (MacFrame::handledOnloadEvents):
        (MacFrame::shouldClose):
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (updateRenderingForBindings):
        (frameHasSelection):
        (+[WebCoreBridge bridgeForDOMDocument:]):
        (-[WebCoreBridge init]):
        (-[WebCoreBridge initializeSettings:]):
        (-[WebCoreBridge dealloc]):
        (-[WebCoreBridge finalize]):
        (-[WebCoreBridge part]):
        (-[WebCoreBridge setParent:]):
        (-[WebCoreBridge parent]):
        (-[WebCoreBridge provisionalLoadStarted]):
        (-[WebCoreBridge openURL:reload:contentType:refresh:lastModified:pageCache:]):
        (-[WebCoreBridge setEncoding:userChosen:]):
        (-[WebCoreBridge addData:]):
        (-[WebCoreBridge closeURL]):
        (-[WebCoreBridge stopLoading]):
        (-[WebCoreBridge didNotOpenURL:pageCache:]):
        (-[WebCoreBridge saveDocumentState]):
        (-[WebCoreBridge restoreDocumentState]):
        (-[WebCoreBridge scrollToAnchorWithURL:]):
        (-[WebCoreBridge scrollOverflowInDirection:granularity:]):
        (-[WebCoreBridge sendScrollWheelEvent:]):
        (-[WebCoreBridge saveDocumentToPageCache]):
        (-[WebCoreBridge canCachePage]):
        (-[WebCoreBridge clear]):
        (-[WebCoreBridge end]):
        (-[WebCoreBridge stop]):
        (-[WebCoreBridge handleFallbackContent]):
        (-[WebCoreBridge createKHTMLViewWithNSView:marginWidth:marginHeight:]):
        (-[WebCoreBridge scrollToAnchor:]):
        (-[WebCoreBridge isSelectionEditable]):
        (-[WebCoreBridge selectionState]):
        (-[WebCoreBridge _documentTypeString]):
        (-[WebCoreBridge selectedString]):
        (-[WebCoreBridge stringForRange:]):
        (-[WebCoreBridge selectAll]):
        (-[WebCoreBridge deselectAll]):
        (-[WebCoreBridge deselectText]):
        (-[WebCoreBridge isFrameSet]):
        (-[WebCoreBridge reapplyStylesForDeviceType:]):
        (nowPrinting):
        (-[WebCoreBridge _setupRootForPrinting:]):
        (-[WebCoreBridge forceLayoutAdjustingViewSize:]):
        (-[WebCoreBridge forceLayoutWithMinimumPageWidth:maximumPageWidth:adjustingViewSize:]):
        (-[WebCoreBridge sendResizeEvent]):
        (-[WebCoreBridge sendScrollEvent]):
        (-[WebCoreBridge drawRect:withPainter:]):
        (-[WebCoreBridge drawRect:]):
        (-[WebCoreBridge computePageRectsWithPrintWidthScaleFactor:printHeight:]):
        (-[WebCoreBridge adjustPageHeightNew:top:bottom:limit:]):
        (-[WebCoreBridge copyDOMTree:]):
        (-[WebCoreBridge copyRenderTree:]):
        (-[WebCoreBridge removeFromFrame]):
        (-[WebCoreBridge installInFrame:]):
        (-[WebCoreBridge setActivationEventNumber:]):
        (-[WebCoreBridge mouseDown:]):
        (-[WebCoreBridge mouseDragged:]):
        (-[WebCoreBridge mouseUp:]):
        (-[WebCoreBridge mouseMoved:]):
        (-[WebCoreBridge sendContextMenuEvent:]):
        (-[WebCoreBridge currentForm]):
        (-[WebCoreBridge searchForLabels:beforeElement:]):
        (-[WebCoreBridge matchLabels:againstElement:]):
        (-[WebCoreBridge elementAtPoint:]):
        (-[WebCoreBridge URLWithAttributeString:]):
        (-[WebCoreBridge searchFor:direction:caseSensitive:wrap:]):
        (-[WebCoreBridge advanceToNextMisspelling]):
        (-[WebCoreBridge advanceToNextMisspellingStartingJustBeforeSelection]):
        (-[WebCoreBridge unmarkAllMisspellings]):
        (-[WebCoreBridge setTextSizeMultiplier:]):
        (-[WebCoreBridge textEncoding]):
        (-[WebCoreBridge nextKeyView]):
        (-[WebCoreBridge previousKeyView]):
        (-[WebCoreBridge nextKeyViewInsideWebFrameViews]):
        (-[WebCoreBridge previousKeyViewInsideWebFrameViews]):
        (-[WebCoreBridge stringByEvaluatingJavaScriptFromString:forceUserGesture:]):
        (-[WebCoreBridge windowScriptObject]):
        (-[WebCoreBridge windowScriptNPObject]):
        (-[WebCoreBridge DOMDocument]):
        (-[WebCoreBridge selectedAttributedString]):
        (-[WebCoreBridge attributedStringFrom:startOffset:to:endOffset:]):
        (-[WebCoreBridge selectionRect]):
        (-[WebCoreBridge visibleSelectionRect]):
        (-[WebCoreBridge centerSelectionInVisibleArea]):
        (-[WebCoreBridge selectionImage]):
        (-[WebCoreBridge setName:]):
        (-[WebCoreBridge name]):
        (-[WebCoreBridge URL]):
        (-[WebCoreBridge baseURL]):
        (-[WebCoreBridge referrer]):
        (-[WebCoreBridge domain]):
        (-[WebCoreBridge opener]):
        (-[WebCoreBridge setOpener:]):
        (-[WebCoreBridge needsLayout]):
        (-[WebCoreBridge setNeedsLayout]):
        (-[WebCoreBridge interceptKeyEvent:toView:]):
        (-[WebCoreBridge renderTreeAsExternalRepresentation]):
        (-[WebCoreBridge setSelectionFromNone]):
        (-[WebCoreBridge setDisplaysWithFocusAttributes:]):
        (-[WebCoreBridge setWindowHasFocus:]):
        (-[WebCoreBridge numPendingOrLoadingRequests]):
        (-[WebCoreBridge doneProcessingData]):
        (-[WebCoreBridge shouldClose]):
        (-[WebCoreBridge bodyBackgroundColor]):
        (-[WebCoreBridge selectionColor]):
        (-[WebCoreBridge adjustViewSize]):
        (-[WebCoreBridge accessibilityTree]):
        (-[WebCoreBridge setDrawsBackground:]):
        (-[WebCoreBridge rangeByExpandingSelectionWithGranularity:]):
        (-[WebCoreBridge rangeByAlteringCurrentSelection:direction:granularity:]):
        (-[WebCoreBridge alterCurrentSelection:direction:granularity:]):
        (-[WebCoreBridge rangeByAlteringCurrentSelection:verticalDistance:]):
        (-[WebCoreBridge alterCurrentSelection:verticalDistance:]):
        (-[WebCoreBridge selectionGranularity]):
        (-[WebCoreBridge setSelectedDOMRange:affinity:closeTyping:]):
        (-[WebCoreBridge selectedDOMRange]):
        (-[WebCoreBridge convertToNSRange:DOM::]):
        (-[WebCoreBridge convertToDOMRange:]):
        (-[WebCoreBridge selectNSRange:]):
        (-[WebCoreBridge selectedNSRange]):
        (-[WebCoreBridge selectionAffinity]):
        (-[WebCoreBridge setMarkDOMRange:]):
        (-[WebCoreBridge markDOMRange]):
        (-[WebCoreBridge setMarkedTextDOMRange:customAttributes:ranges:]):
        (-[WebCoreBridge markedTextDOMRange]):
        (-[WebCoreBridge markedTextNSRange]):
        (-[WebCoreBridge replaceMarkedTextWithText:]):
        (-[WebCoreBridge smartDeleteRangeForProposedRange:]):
        (-[WebCoreBridge smartInsertForString:replacingRange:beforeString:afterString:]):
        (-[WebCoreBridge documentFragmentWithMarkupString:baseURLString:]):
        (-[WebCoreBridge documentFragmentWithText:]):
        (-[WebCoreBridge documentFragmentWithNodesAsParagraphs:]):
        (-[WebCoreBridge replaceSelectionWithFragment:selectReplacement:smartReplace:matchStyle:]):
        (-[WebCoreBridge insertLineBreak]):
        (-[WebCoreBridge insertParagraphSeparator]):
        (-[WebCoreBridge insertParagraphSeparatorInQuotedContent]):
        (-[WebCoreBridge insertText:selectInsertedText:]):
        (-[WebCoreBridge setSelectionToDragCaret]):
        (-[WebCoreBridge moveSelectionToDragCaret:smartMove:]):
        (-[WebCoreBridge _visiblePositionForPoint:]):
        (-[WebCoreBridge moveDragCaretToPoint:]):
        (-[WebCoreBridge removeDragCaret]):
        (-[WebCoreBridge dragCaretDOMRange]):
        (-[WebCoreBridge deleteSelectionWithSmartDelete:]):
        (-[WebCoreBridge deleteKeyPressedWithSmartDelete:]):
        (-[WebCoreBridge forwardDeleteKeyPressedWithSmartDelete:]):
        (-[WebCoreBridge typingStyle]):
        (-[WebCoreBridge setTypingStyle:withUndoAction:]):
        (-[WebCoreBridge applyStyle:withUndoAction:]):
        (-[WebCoreBridge applyParagraphStyle:withUndoAction:]):
        (-[WebCoreBridge selectionStartHasStyle:]):
        (-[WebCoreBridge selectionHasStyle:]):
        (-[WebCoreBridge applyEditingStyleToBodyElement]):
        (-[WebCoreBridge removeEditingStyleFromBodyElement]):
        (-[WebCoreBridge applyEditingStyleToElement:]):
        (-[WebCoreBridge removeEditingStyleFromElement:]):
        (-[WebCoreBridge fontForSelection:]):
        (-[WebCoreBridge fontAttributesForSelectionStart]):
        (-[WebCoreBridge baseWritingDirectionForSelectionStart]):
        (-[WebCoreBridge ensureSelectionVisible]):
        (-[WebCoreBridge eventMayStartDrag:]):
        (-[WebCoreBridge dragOperationForDraggingInfo:]):
        (-[WebCoreBridge dragExitedWithDraggingInfo:]):
        (-[WebCoreBridge concludeDragForDraggingInfo:]):
        (-[WebCoreBridge dragSourceMovedTo:]):
        (-[WebCoreBridge dragSourceEndedAt:operation:]):
        (-[WebCoreBridge mayDHTMLCut]):
        (-[WebCoreBridge mayDHTMLCopy]):
        (-[WebCoreBridge mayDHTMLPaste]):
        (-[WebCoreBridge tryDHTMLCut]):
        (-[WebCoreBridge tryDHTMLCopy]):
        (-[WebCoreBridge tryDHTMLPaste]):
        (-[WebCoreBridge rangeOfCharactersAroundCaret]):
        (-[WebCoreBridge dashboardRegions]):
        (-[WebCoreBridge executionContextForView:]):
        * kwq/WebCoreSettings.mm:
        (-[WebCoreSettings _updateAllViews]):
        * kwq/WebCoreTextRendererFactory.mm:
        (-[WebCoreTextRendererFactory clearCaches]):

2006-01-09  Darin Adler  <darin@apple.com>

        * Makefile.am: Removed.

2006-01-09  John Sullivan  <sullivan@apple.com>

        * khtml/misc/decoder.cpp:
        removed #include of recently-removed kcharsets.h to fix build

2006-01-08  Alexander Kellett  <lypanov@kde.org>

        Reviewed by eseidel.  Committed by eseidel.

        First set of refactors to fix
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5748.

        Refactors to delay paintserver creation until usage and thereby
        simplify much code in the process. Causes several changes in rendertree 
        output all of which are improvements rather than regressions.

        * kcanvas/KCanvasItem.cpp: setupForDraw() logic moved to KCanvasItemQuartz
        * kcanvas/KCanvasItem.h:
        * kcanvas/KCanvasResources.cpp:
        (KCanvasResource::addClient): const-ify
        * kcanvas/KCanvasResources.h:
        * kcanvas/KCanvasTreeDebug.cpp:
        (writeStyle): minor refactor/inline - keeps most output the same after
        patch, some minor const'ifications
        * kcanvas/device/KRenderingFillPainter.cpp:
        setter
        (KRenderingFillPainter::Private::Private):
        * kcanvas/device/KRenderingFillPainter.h: refactor out paintserver and
        draw()
        * kcanvas/device/KRenderingStrokePainter.cpp: refactor out paintserver
        and draw()
        (KRenderingStrokePainter::Private::Private):
        * kcanvas/device/KRenderingStrokePainter.h:
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (KCanvasItemQuartz::paint):
        (KCanvasItemQuartz::hitsPath):
        * ksvg2/misc/KCanvasRenderingStyle.cpp:
        (KCanvasRenderingStyle::KCanvasRenderingStyle):
        (KCanvasRenderingStyle::~KCanvasRenderingStyle):
        (KCanvasRenderingStyle::overrideFillPaintServer):
        (KCanvasRenderingStyle::isFilled):
        (KCanvasRenderingStyle::fillPaintServer):
        (KCanvasRenderingStyle::overrideStrokePaintServer):
        (KCanvasRenderingStyle::isStroked):
        (KCanvasRenderingStyle::strokePaintServer):
        (KCanvasRenderingStyle::updateStyle): remove paintserver constructions
        from update notification and instead create on usage, removing
        disable.*Painter() methods
        * ksvg2/misc/KCanvasRenderingStyle.h:
        * ksvg2/svg/SVGImageElementImpl.cpp:
        (SVGImageElementImpl::notifyFinished): use paintserver override logic

2006-01-09  Alexey Proskuryakov  <ap@nypop.com>

        Fix broken build (CachedObject.cpp was still including kcharsets.h).
        Proposed and reviewed by Eric Seidel.

2006-01-09  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Remove more unused code from kwq.

        * ForwardingHeaders/dcopclient.h: Removed.
        * ForwardingHeaders/kaction.h: Removed.
        * ForwardingHeaders/kcharsets.h: Removed.
        * ForwardingHeaders/kcombobox.h: Removed.
        * ForwardingHeaders/klineedit.h: Removed.
        * ForwardingHeaders/klistbox.h: Removed.
        * ForwardingHeaders/kwin.h: Removed.
        * ForwardingHeaders/qcombobox.h: Added.
        * ForwardingHeaders/qlineedit.h: Added.
        * WebCore.xcodeproj/project.pbxproj: remove files.
        * khtml/css/csshelper.cpp:
        * khtml/css/cssstyleselector.cpp:
        * khtml/ecma/kjs_window.cpp:
        (KJS::Window::getValueProperty):
        * khtml/html/html_documentimpl.cpp:
        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLOptionElementImpl::index):
        (DOM::HTMLOptionElementImpl::setIndex):
        * khtml/html/htmltokenizer.cpp:
        * khtml/html/htmltokenizer.h:
        * khtml/khtml_part.cpp:
        * khtml/khtmlpart_p.h:
        * khtml/rendering/render_form.cpp:
        (RenderLineEdit::RenderLineEdit):
        (RenderLineEdit::setStyle):
        (RenderLineEdit::updateFromElement):
        (RenderLineEdit::selectionStart):
        (RenderLineEdit::selectionEnd):
        (RenderLineEdit::setSelectionStart):
        (RenderLineEdit::setSelectionEnd):
        (RenderLineEdit::select):
        (RenderLineEdit::setSelectionRange):
        (ComboBoxWidget::ComboBoxWidget):
        (ComboBoxWidget::event):
        (ComboBoxWidget::eventFilter):
        (RenderSelect::setWidgetWritingDirection):
        (RenderSelect::updateFromElement):
        (RenderSelect::layout):
        (RenderSelect::slotSelectionChanged):
        (RenderSelect::createListBox):
        (RenderSelect::updateSelection):
        (RenderTextArea::RenderTextArea):
        * khtml/rendering/render_form.h:
        (khtml::RenderLineEdit::widget):
        * kwq/KWQDCOPClient.h: Removed.
        * kwq/KWQKCharsets.cpp: Removed.
        * kwq/KWQKCharsets.h: Removed.
        * kwq/KWQKComboBox.h: Removed.
        * kwq/KWQKKAction.h: Removed.
        * kwq/KWQKLineEdit.h: Removed.
        * kwq/KWQKListBox.h: Removed.
        * kwq/KWQKWin.cpp: Removed.
        * kwq/KWQKWin.h: Removed.
        * kwq/KWQWidget.h:
        * kwq/KWQWidget.mm:

2006-01-09  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Removing more unused parts of KWQ.

        * ForwardingHeaders/java/kjavaappletcontext.h: Removed.
        * ForwardingHeaders/khtml_find.h: Removed.
        * ForwardingHeaders/qimage.h: Removed.
        * ForwardingHeaders/rendering/break_lines.h: Removed.
        * ForwardingHeaders/rendering/render_text.h: Removed.
        * ForwardingHeaders/xbl/xbl_docimpl.h: Removed.
        * WebCore.xcodeproj/project.pbxproj:
        * khtml/html/html_canvasimpl.cpp:
        * khtml/html/html_imageimpl.cpp:
        * khtml/html/html_objectimpl.cpp:
        * khtml/html/html_objectimpl.h:
        * khtml/khtml_part.cpp:
        (KHTMLPart::init):
        (KHTMLPart::~KHTMLPart):
        (KHTMLPart::clear):
        * khtml/khtml_part.h:
        * khtml/khtmlpart_p.h:
        (KHTMLPartPrivate::KHTMLPartPrivate):
        (KHTMLPartPrivate::~KHTMLPartPrivate):
        * khtml/rendering/render_applet.cpp:
        (RenderApplet::RenderApplet):
        (RenderApplet::createWidgetIfNecessary):
        * khtml/rendering/render_applet.h:
        * ksvg2/svg/SVGFEImageElementImpl.cpp:
        * ksvg2/svg/SVGImageElementImpl.cpp:
        * kwq/DOMHTML.mm:
        * kwq/KWQDummyView.h: Removed.
        * kwq/KWQDummyView.m: Removed.
        * kwq/KWQImage.h: Removed.
        * kwq/KWQKHTMLFind.h: Removed.
        * kwq/KWQKHTMLPart.mm:
        * kwq/KWQKHTMLPartBrowserExtension.h:
        * kwq/KWQKJavaAppletContext.h: Removed.
        * kwq/KWQKJavaAppletWidget.h:
        * kwq/KWQKJavaAppletWidget.mm:
        (KJavaAppletWidget::KJavaAppletWidget):
        * kwq/KWQKPartsBrowserExtension.h:
        * kwq/KWQObject.h:
        * kwq/KWQRegion.h:

2006-01-09  Eric Seidel  <eseidel@apple.com>

        Rubber stamped by mjs.

        Broke out loader.{h,cpp} into multiple files, one per class.
        This patch also updates all files which previously included
        loader.h to only include the necessary renamed headers.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6444

        * ForwardingHeaders/kdom/cache/KDOMCachedDocument.h: Removed.
        * ForwardingHeaders/kdom/cache/KDOMCachedImage.h: updated include
        * ForwardingHeaders/kdom/cache/KDOMCachedObject.h: updated include
        * ForwardingHeaders/kdom/cache/KDOMCachedScript.h: updated include
        * WebCore.xcodeproj/project.pbxproj: added files
        * khtml/css/css_computedstyle.cpp: updated includes
        * khtml/css/css_ruleimpl.cpp: updated includes
        * khtml/css/css_stylesheetimpl.h: updated includes
        * khtml/css/css_valueimpl.cpp: updated includes
        * khtml/css/cssstyleselector.cpp: updated includes
        * khtml/ecma/kjs_events.cpp: updated includes
        * khtml/ecma/kjs_html.cpp: updated includes
        * khtml/ecma/xmlhttprequest.cpp: updated includes
        * khtml/html/html_headimpl.cpp: updated includes
        * khtml/html/html_imageimpl.cpp: updated includes
        * khtml/html/html_imageimpl.h: updated includes
        * khtml/html/htmltokenizer.cpp: updated includes
        * khtml/khtml_part.cpp: updated includes
        * khtml/khtmlview.cpp: updated includes
        * khtml/misc/Cache.cpp: Added.
        * khtml/misc/Cache.h: Added.
        * khtml/misc/CachedCSSStyleSheet.cpp: Added.
        * khtml/misc/CachedCSSStyleSheet.h: Added.
        * khtml/misc/CachedImage.cpp: Added.
        * khtml/misc/CachedImage.h: Added.
        * khtml/misc/CachedImageCallback.cpp: Added.
        * khtml/misc/CachedImageCallback.h: Added.
        * khtml/misc/CachedObject.cpp: Added.
        * khtml/misc/CachedObject.h: Added, fixed tabs -> spaces.
        * khtml/misc/CachedObjectClientWalker.cpp: Added.
        * khtml/misc/CachedObjectClientWalker.h: Added.
        * khtml/misc/CachedScript.cpp: Added.
        * khtml/misc/CachedScript.h: Added.
        * khtml/misc/CachedXBLDocument.cpp: Added.
        * khtml/misc/CachedXBLDocument.h: Added.
        * khtml/misc/CachedXSLStyleSheet.cpp: Added.
        * khtml/misc/CachedXSLStyleSheet.h: Added.
        * khtml/misc/DocLoader.cpp: Added.
        * khtml/misc/DocLoader.h: Added.
        * khtml/misc/Request.cpp: Added.
        * khtml/misc/Request.h: Added.
        * khtml/misc/loader.cpp: updated includes
        * khtml/misc/loader.h: updated includes
        * khtml/misc/loader_client.h: updated includes
        * khtml/rendering/render_box.cpp: updated includes
        * khtml/rendering/render_line.cpp: updated includes
        * khtml/rendering/render_list.cpp: updated includes
        * khtml/rendering/render_object.cpp: updated includes
        * khtml/xml/dom_docimpl.cpp: updated includes
        * khtml/xml/dom_xmlimpl.cpp: updated includes
        * khtml/xml/xml_tokenizer.cpp: updated includes
        * khtml/xsl/xsl_stylesheetimpl.cpp: updated includes
        * khtml/xsl/xsl_stylesheetimpl.h: updated includes
        * khtml/xsl/xslt_processorimpl.cpp: updated includes
        * ksvg2/svg/SVGCursorElementImpl.cpp: updated includes
        * ksvg2/svg/SVGDocumentImpl.cpp: updated includes
        * ksvg2/svg/SVGFEImageElementImpl.cpp: updated includes
        * ksvg2/svg/SVGImageElementImpl.cpp: updated includes
        * ksvg2/svg/SVGImageElementImpl.h: updated includes
        * kwq/KWQKHTMLPart.mm: updated includes
        * kwq/KWQLoader.mm: updated includes
        * kwq/KWQPixmap.mm: updated includes
        * kwq/KWQTextArea.mm: updated includes
        * kwq/WebCoreBridge.mm: updated includes
        * kwq/WebCoreCache.mm: updated includes

2006-01-09  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Maciej.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6402
          Implement frameElement.width and frameElement.height

        Test case: fast/frames/frameElement-widthheight.html

        * khtml/ecma/kjs_html.cpp:
        (KJS::HTMLElement::frameGetter):
        * khtml/ecma/kjs_html.h:
        Add FrameWidth, FrameHeight

        * khtml/html/html_baseimpl.cpp:
        (HTMLFrameElementImpl::frameWidth):
        (HTMLFrameElementImpl::frameHeight):
        * khtml/html/html_baseimpl.h:
        Add frameWidth, frameHeight

2006-01-09  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Maciej, landed by ap.
        
        Test: fast/replaced/inline-box-wrapper-handover.html
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6276
          Image thumbnails are misplaced on forum.2ostrov.ru
          
        * khtml/rendering/render_line.cpp:
        (khtml::InlineBox::deleteLine): Don't reset the inline box wrapper when
        deleting an extracted box.

2006-01-08  Eric Seidel  <eseidel@apple.com>

        Reviewed by ggaren.

        Remove all mention of NSView from khtml.

        * khtml/html/html_objectimpl.cpp:
        (DOM::HTMLAppletElementImpl::getAppletInstance): call w/ widget
        (DOM::HTMLEmbedElementImpl::getEmbedInstance): call w/ widget
        (DOM::HTMLObjectElementImpl::getObjectInstance): call w/ widget
        * kwq/KWQKHTMLPart.h:
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::getAppletInstanceForWidget): renamed.
        (KWQKHTMLPart::getEmbedInstanceForWidget): renamed.
        (KWQKHTMLPart::getObjectInstanceForWidget): renamed.

2006-01-08  Eric Seidel  <eseidel@apple.com>

        Rubber stamped by ggaren.

        * ForwardingHeaders/qsortedlist.h: Added. (a khtml file was referencing KWQ directly.)
        * WebCore.xcodeproj/project.pbxproj: added new files.
        * khtml/editing/SelectionController.cpp: updated includes
        * khtml/editing/composite_edit_command.cpp: updated includes
        * khtml/editing/htmlediting.cpp: updated includes
        * khtml/editing/markup.cpp: updated includes
        * khtml/editing/visible_position.cpp: updated includes
        * khtml/editing/visible_text.cpp: updated includes
        * khtml/editing/visible_text.h: updated includes
        * khtml/editing/visible_units.cpp: updated includes
        * khtml/khtml_part.cpp: updated includes
        * khtml/khtmlview.cpp: updated includes
        * khtml/rendering/InlineTextBox.cpp: Split out from render_text
        * khtml/rendering/InlineTextBox.h: Split out from render_text
        * khtml/rendering/RenderText.cpp: Split out from render_text
        (khtml::RenderText::position): removed DEBUG_LAYOUT
        * khtml/rendering/RenderText.h: Split out from render_text
        * khtml/rendering/RenderTextFragment.cpp: Split out from render_text
        * khtml/rendering/RenderTextFragment.h: Split out from render_text
        * khtml/rendering/bidi.cpp: updated includes
        * khtml/rendering/render_block.cpp: updated includes
        * khtml/rendering/render_br.cpp: updated includes
        * khtml/rendering/render_br.h: updated includes
        * khtml/rendering/render_button.cpp: updated includes
        * khtml/rendering/render_container.cpp: updated includes
        * khtml/rendering/render_flow.cpp: updated includes
        * khtml/rendering/render_line.cpp: updated includes
        * khtml/rendering/render_object.cpp: updated includes
        * khtml/rendering/render_text.cpp: Removed.
        * khtml/rendering/render_text.h: Removed.
        * khtml/xml/dom_docimpl.cpp: updated includes
        * khtml/xml/dom_nodeimpl.cpp: updated includes
        * khtml/xml/dom_position.cpp: updated includes
        * khtml/xml/dom_textimpl.cpp: updated includes
        * kwq/KWQAccObject.mm: updated includes
        * kwq/KWQKHTMLPart.mm: updated includes
        * kwq/KWQRenderTreeDebug.cpp: updated includes

2006-01-08  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs & xenon.

        Renamed a few in kwq/ from .mm to .cpp

        * WebCore.xcodeproj/project.pbxproj: updated paths
        * kwq/KWQDictImpl.cpp: Added.
        * kwq/KWQDictImpl.mm: Removed.
        * kwq/KWQKPartsEvent.cpp: Added.
        * kwq/KWQKPartsEvent.mm: Removed.
        * kwq/KWQListImpl.cpp: Added.
        * kwq/KWQListImpl.mm: Removed.

2006-01-08  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Renamed several files in kwq/ from .mm to .cpp
        Removed a few pieces of unused KWQ code.

        * WebCore.xcodeproj/project.pbxproj:
        * khtml/html/htmltokenizer.cpp:
        (khtml::HTMLTokenizer::continueProcessing): removed KWQUIEventTime
        (khtml::HTMLTokenizer::write): removed KWQUIEventTime
        * khtml/html/htmltokenizer.h:
        * khtml/khtml_part.cpp:
        (KHTMLPart::slotFinished): removed KWQUIEventTime
        * khtml/misc/loader.cpp:
        (CachedObject::finish): removed KWQUIEventTime
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::processHttpEquiv): removed KWQUIEventTime
        * kwq/KWQArrayImpl.cpp: Added.
        * kwq/KWQArrayImpl.mm: Removed.
        * kwq/KWQBuffer.cpp: Added.
        * kwq/KWQBuffer.mm: Removed.
        * kwq/KWQCString.cpp: Added.
        * kwq/KWQCString.mm: Removed.
        * kwq/KWQCharsets.cpp: Added.
        * kwq/KWQCharsets.mm: Removed.
        * kwq/KWQCollection.h:
        (QPtrCollection::~QPtrCollection): made inline
        * kwq/KWQCollection.mm: Removed.
        * kwq/KWQDateTime.cpp: Added, removed KWQUIEventTime
        * kwq/KWQDateTime.h:
        * kwq/KWQDateTime.mm: Removed.
        * kwq/KWQGlobal.cpp: Added.
        * kwq/KWQGlobal.mm: Removed.
        * kwq/KWQGuardedPtr.cpp: Added.
        * kwq/KWQGuardedPtr.mm: Removed.
        * kwq/KWQKCharsets.cpp: Added.
        * kwq/KWQKCharsets.mm: Removed.
        * kwq/KWQKGlobalSettings.h:
        (KGlobalSettings::generalFont): made inline
        (KGlobalSettings::windowTitleFont): made inline
        (KGlobalSettings::menuFont): made inline
        (KGlobalSettings::contrast): made inline
        * kwq/KWQKGlobalSettings.mm: Removed.
        * kwq/KWQKHTMLFactory.cpp: Added.
        * kwq/KWQKHTMLFactory.mm: Removed.
        * kwq/KWQKHTMLView.cpp: Added.
        * kwq/KWQKHTMLView.mm: Removed.
        * kwq/KWQKJob.h:
        * kwq/KWQKJob.mm: Removed.
        * kwq/KWQKWin.cpp: Added.
        * kwq/KWQKWin.mm: Removed.
        * kwq/KWQMapImpl.cpp: Added.
        * kwq/KWQMapImpl.mm: Removed.
        * kwq/KWQObject.cpp: Added.
        * kwq/KWQObject.mm: Removed.
        * kwq/KWQPen.cpp: Added.
        * kwq/KWQPen.mm: Removed.
        * kwq/KWQPointArray.cpp: Added.
        * kwq/KWQPointArray.mm: Removed.
        * kwq/KWQPtrDictImpl.cpp: Added.
        * kwq/KWQPtrDictImpl.mm: Removed.
        * kwq/KWQRegExp.cpp: Added.
        * kwq/KWQRegExp.mm: Removed.
        * kwq/KWQRegion.cpp: Added.
        * kwq/KWQRegion.mm: Removed.
        * kwq/KWQStyle.cpp: Added.
        * kwq/KWQStyle.mm: Removed.
        * kwq/KWQTextCodec.cpp: Added.
        * kwq/KWQTextCodec.mm: Removed.
        * kwq/KWQTextStream.cpp: Added.
        * kwq/KWQTextStream.mm: Removed.
        * kwq/KWQTimer.cpp: Added.
        * kwq/KWQTimer.mm: Removed.
        * kwq/KWQValueListImpl.cpp: Added.
        * kwq/KWQValueListImpl.mm: Removed.
        * kwq/KWQVariant.cpp: Added.
        * kwq/KWQVariant.mm: Removed.
        * kwq/KWQVectorImpl.cpp: Added.
        * kwq/KWQVectorImpl.mm: Removed.
        * kwq/KWQWMatrix.cpp: Added.
        * kwq/KWQWMatrix.mm: Removed.

2006-01-07  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - added basic SVG text support using CSS-based rendering
        http://bugzilla.opendarwin.org/show_bug.cgi?id=4883
 
        Affects many test results in LayoutTests/svg.

        * kcanvas/RenderSVGText.cpp: Added. Simple subclass of RenderBlock for SVG text.
        (RenderSVGText::RenderSVGText): just call superclass constructor.
        (RenderSVGText::translateTopToBaseline): helper to account for the fact that
        y coordinates for <text> give the baseline position, but the render tree expects
        current y to be the top.
        (RenderSVGText::translateForAttributes): translate to account for x and y
        attributes.
        (RenderSVGText::paint): Apply appropriate CTM transform and then just let
        RenderBlock paint.
        * kcanvas/RenderSVGText.h: Added.
        (RenderSVGText::renderName):
        * kcanvas/device/quartz/KRenderingDeviceQuartz.mm:
        (KRenderingDeviceContextQuartz::nsGraphicsContext): We want the context flipped.
        * ksvg2/css/svg.css: Give <svg:text> display: block
        * ksvg2/svg/SVGTextElementImpl.cpp:
        (SVGTextElementImpl::createRenderer): Create a RenderSVGText renderer.
        (SVGTextElementImpl::childShouldCreateRenderer): Let child text nodes make
        renderers, but nothing else (for now).
        * ksvg2/svg/SVGTextElementImpl.h:
        (KSVG::SVGTextElementImpl::rendererIsNeeded): It sure is! :-)
        * WebCore.xcodeproj/project.pbxproj: Add new files.

2006-01-07  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs

        Removed old, unneeded code.

        * WebCore+SVG/DrawCanvasItem.h: Removed.
        * WebCore+SVG/DrawCanvasItem.mm: Removed.
        * WebCore+SVG/DrawCanvasItemPrivate.h: Removed.
        * WebCore+SVG/DrawDocument.h: Removed.
        * WebCore+SVG/DrawDocument.mm: Removed.
        * WebCore+SVG/DrawDocumentPrivate.h: Removed.
        * WebCore+SVG/DrawView.h: Removed.
        * WebCore+SVG/DrawView.mm: Removed.
        * WebCore+SVG/DrawViewPrivate.h: Removed.
        * WebCore+SVG/NSSVGImageRep.h: Removed.
        * WebCore+SVG/NSSVGImageRep.m: Removed.
        * WebCore.xcodeproj/project.pbxproj: remove files

2006-01-07  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - fixed WebCore build
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6404

        * khtml/rendering/render_canvasimage.h: Remove unneeded extern declarations.

2006-01-07  Anders Carlsson  <andersca@mac.com>

        Reviewed by Maciej.

        - Fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6373
        REGRESSION: JavaScript hang when comparing large array to null
        
        * khtml/ecma/kjs_html.cpp:
        Remove toPrimitive.
        
        * khtml/ecma/kjs_html.h:
        (KJS::HTMLAllCollection::isEqualToNull):
        Implement isEqualToNull and have it return true.

2006-01-06  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        <rdar://problem/4386652> Crash: SVG filter crash at w3schools.com

        * kcanvas/device/quartz/KCanvasFilterQuartz.mm:
        (KCanvasFEDiffuseLightingQuartz::getCIFilter): nil check
        (KCanvasFESpecularLightingQuartz::getCIFilter): nil check

2006-01-06  Geoffrey Garen  <ggaren@apple.com>

        Patch by Mitz, reviwed by Darin, layout tested and landed by me.

        - Fixed http://bugzilla.opendarwin.org/show_bug.cgi?id=6382
        REGRESSION: Repro crash when clicking link with target="_blank"

        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::setName):
        * manual-tests/empty-link-target.html: Added.

2006-01-06  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5291
          FORM multipart/form-data with GET method issue

        Test cases: 
        * fast/forms/form-get-multipart.html
        * fast/forms/form-get-multipart2.html
        * fast/forms/form-get-multipart3.html
        * fast/forms/form-post-urlencoded.html

        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLFormElementImpl::submit):
        Reset m_multipart to false if not posting.
        (DOM::HTMLFormElementImpl::parseEnctype):
        multipart/form-data doesn't imply POST method.

2006-01-06  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5792
          Crasher on rendering-shapes from SVG 1.0 testsuite

        Test case: fast/parser/entity-ignorable-whitespace.xhtml

        * khtml/xml/xml_tokenizer.cpp:
        (khtml::XMLTokenizer::finish): install an ignorableWhitespace callback to
        work around a libxml2 bug
        (khtml::ignorableWhitespaceHandler): no-op

2006-01-06  Anders Carlsson  <andersca@mac.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5142
        parseXMLDocumentFragment can't parse fragments correctly
        
        * khtml/xml/xml_tokenizer.cpp:
        (khtml::balancedStartElementNsHandler):
        (khtml::balancedEndElementNsHandler):
        (khtml::balancedCharactersHandler):
        (khtml::balancedProcessingInstructionHandler):
        (khtml::balancedCdataBlockHandler):
        (khtml::balancedCommentHandler):
        (khtml::balancedWarningHandler):
        Add handlers.
        
        (khtml::parseXMLDocumentFragment):
        Change back into using xmlParseBalancedChunkMemory. 

2006-01-06  Alexander Kellett  <lypanov@kde.org>

        Reviewed by eseidel.

        Basic support for <mask> tag.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5969
        Still missing attribute support for: maskUnits, maskContentUnits.
        
        Mask pixel tests do not work in DumpRenderTree due to:
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6327
        Added test cases anyway.

        This also tickles a (known) gradient update issue:
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6052

        * WebCore.xcodeproj/project.pbxproj: added Mask files
        * kcanvas/KCanvasResources.cpp:
        (KCanvasMasker::KCanvasMasker): added.
        (KCanvasMasker::~KCanvasMasker): added.
        (KCanvasMasker::setMask): added.
        (KCanvasMasker::externalRepresentation): added.
        (getMaskerById): added.
        * kcanvas/KCanvasResources.h:
        (KCanvasResource::isMasker): added.
        (KCanvasMasker::isMasker): added.
        (KCanvasMasker::mask): added.
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (KCanvasItemQuartz::paint): added mask support
        * kcanvas/device/quartz/KCanvasMaskerQuartz.h: Added.
        (KCanvasMaskerQuartz::KCanvasMaskerQuartz): added.
        * kcanvas/device/quartz/KCanvasMaskerQuartz.mm: Added.
        (applyLuminanceToAlphaFilter): added.
        (applyExpandAlphatoGrayscaleFilter): added.
        (transformImageIntoGrayscaleMask): added.
        (KCanvasMaskerQuartz::applyMask): added.
        * kcanvas/device/quartz/KCanvasResourcesQuartz.mm:
        (KCanvasContainerQuartz::paint): added mask support.
        * kcanvas/device/quartz/KRenderingDeviceQuartz.mm:
        (KRenderingDeviceQuartz::createResource): added mask support.
        * kcanvas/device/quartz/KRenderingPaintServerGradientQuartz.mm:
        (KRenderingPaintServerRadialGradientQuartz::draw):
        * kcanvas/device/quartz/QuartzSupport.h:
        * kcanvas/device/quartz/QuartzSupport.mm:
        (debugDumpCGImageToFile): added, debug only.
        (debugDumpCGLayerToFile): added, debug only.
        (debugDumpCIImageToFile): added, debug only.
        * ksvg2/css/SVGCSSStyleSelector.cpp:
        (KDOM::CSSStyleSelector::applySVGProperty): added mask support.
        * ksvg2/css/SVGRenderStyle.cpp:
        (SVGRenderStyle::SVGRenderStyle): added mask support.
        (SVGRenderStyle::operator==): added mask support.
        * ksvg2/css/SVGRenderStyle.h:
        * ksvg2/css/SVGRenderStyleDefs.cpp:
        (StyleMaskData::StyleMaskData): added mask support.
        (StyleMaskData::operator==): added mask support.
        * ksvg2/css/SVGRenderStyleDefs.h:
        (KSVG::StyleMaskData::operator!=): added mask support.
        * ksvg2/ecma/Ecma.cpp:
        (Ecma::inheritedGetDOMNode): added mask support.
        * ksvg2/svg/SVGMaskElementImpl.cpp: Added.
        (KSVG::SVGMaskElementImpl::SVGMaskElementImpl): added.
        (KSVG::SVGMaskElementImpl::~SVGMaskElementImpl): added.
        (KSVG::SVGMaskElementImpl::x): added.
        (KSVG::SVGMaskElementImpl::y): added.
        (KSVG::SVGMaskElementImpl::width): added.
        (KSVG::SVGMaskElementImpl::height): added.
        (KSVG::SVGMaskElementImpl::attributeChanged): added.
        (KSVG::SVGMaskElementImpl::childrenChanged): added.
        (KSVG::SVGMaskElementImpl::parseMappedAttribute): added.
        (KSVG::SVGMaskElementImpl::drawMaskerContent): added.
        (KSVG::SVGMaskElementImpl::createRenderer): added.
        (KSVG::SVGMaskElementImpl::canvasResource): added.
        * ksvg2/svg/SVGMaskElementImpl.h: Added.
        (KSVG::SVGMaskElementImpl::isValid): added.
        (KSVG::SVGMaskElementImpl::rendererIsNeeded): added.
        * ksvg2/svg/svgtags.in: added <mask> support.

2006-01-04  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        - move frame management and finding code from WebKit to WebCore
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6368

        * WebCore.exp: export WebCoreFrameNamespace
        * WebCore.xcodeproj/project.pbxproj: add new files
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::setName): Don't call to bridge any more, not needed
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (isCaseSensitiveEqual): helper function
        (-[WebCoreBridge appendChild:]): remove excess braces
        (-[WebCoreBridge childFrameNamed:]): moved here from WebFrame
        (-[WebCoreBridge _deepLastChildFrame]): ditto
        (-[WebCoreBridge nextFrameWithWrap:]): ditto
        (-[WebCoreBridge previousFrameWithWrap:]): ditto
        (-[WebCoreBridge setFrameNamespace:]): ditto
        (-[WebCoreBridge frameNamespace]): ditto
        (-[WebCoreBridge _shouldAllowAccessFrom:]): ditto
        (-[WebCoreBridge _descendantFrameNamed:sourceFrame:]): ditto
        (-[WebCoreBridge _frameInAnyWindowNamed:sourceFrame:]): ditto
        (-[WebCoreBridge findFrameNamed:]): ditto
        (-[WebCoreBridge setName:]): don't call KHTMLPart setName directly,
        the kwq version is fine
        (-[WebCoreBridge _addFramePathToString:]): moved from WebFrame
        (-[WebCoreBridge generateFrameName]): ditto

2006-01-04  Anders Carlsson  <andersca@mac.com>

        Reviewed by Eric.

        Based on a patch by Eric.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6180
        "text" output in fragment produced by XSLTProccessor is wrong (has xhtml garbage)
        
        * khtml/xsl/xslt_processorimpl.cpp:
        (DOM::xsltParamArrayFromParameterMap):
        (DOM::freeXsltParamArray):
        Use fastMalloc/fastFree.
        
        (DOM::createFragmentFromSource):
        If the output is "text", just create a text node and add
        it to the fragment.

2006-01-04  Geoffrey Garen  <ggaren@apple.com>

        Reviewed by darin.

        - Fixed http://bugzilla.opendarwin.org/show_bug.cgi?id=6311
        document.plugins doesn't exist

        * khtml/ecma/kjs_html.cpp: Added 'plugins' as synonym for 'embeds'

2006-01-04  Geoffrey Garen  <ggaren@apple.com>
 
         Reviewed by darin.
 
         - Fixed <rdar://problem/4214080> document.embeds: embeds[0].Play() 
         undefined at languageguide.org prevents audio playing on mouseover
 
         - Layout test: fast/dom/object-embed-plugin-scripting.html
 
         A common idiom the kids like to use these days for plugins is to nest 
         an <embed> inside an <object>, and assume that IE will honor the first,
         Mozilla the second. We happen to honor both, but the rules dictate that
         only the outer <object> gets a plugin/renderer. (A plugin is a 
        renderer.) This is a problem because sites ID us as Mozilla and 
        therefore attempt to script their plugins through the <embed>, which 
        has no plugin/renderer. The fix here is to have an <embed> return its 
        parent node's plugin/renderer when queried, if and only if it has no 
        renderer of its own and its parent node is an <object>. We may decide
        to restrict this further in the future.

        One happy consequence of this patch is that all the apple.com Quicktime
        websites we had previously broken with TOT are now fixed. 

        * khtml/html/html_objectimpl.cpp:
        (DOM::HTMLEmbedElementImpl::getEmbedInstance): The "if (!r)" clause 
        implements the logic I just described. The code below it I changed 
        just for style, to match the style in getObjectInstance().

        (DOM::HTMLEmbedElementImpl::rendererIsNeeded): Assert that an <object>
        parent has a renderer because we're going to use it later.

        (DOM::HTMLObjectElementImpl::rendererIsNeeded): Changed to match style 
        of HTMLEmbedElementImpl counterpart.

2006-01-04  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Darin, landed by ap.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6301
          REGRESSION: Border repaint glitch

        * khtml/rendering/render_object.cpp:
        (RenderObject::repaintAfterLayoutIfNeeded): Repaint parts of the
        border that moved.
        * manual-tests/border-repaint-glitch.html: Added.

2005-12-30  Kimmo Kinnunen  <kimmo.kinnunen@nokia.com>

        Reviewed by eseidel.

        Changed use of QRect to QRectF in the points where SVG can have
        fractional numbers
        http://bugzilla.opendarwin.org/show_bug.cgi?id=4462

        Added test cases:
        * svg/custom/fractional-rects.svg: copy of rounded-rects.svg with
        fractional coordinates.

        * WebCore.xcodeproj/project.pbxproj:
        * kwq/KWQWMatrix.h:
        * kwq/KWQWMatrix.mm:
        (QWMatrix::mapRect): mapRect for QRectF
        * kwq/KWQRectF.h:
        * kwq/KWQRectF.mm:  Added. QRectF impl
        * kwq/KWQSizeF.h:
        * kwq/KWQSizeF.mm:  Added.QSizeF impl
        * kwq/KWQPointF.h:
        * kwq/KWQPointF.mm: Added. QPointF impl
        * kcanvas/KCanvasContainer.cpp:
        (KCanvasContainer::fillContains):
        (KCanvasContainer::strokeContains):
        (KCanvasContainer::relativeBBox):
        (KCanvasContainer::getAspectRatio): QRect -> QRectF
        * kcanvas/KCanvasContainer.h:
        * kcanvas/KCanvasFilters.cpp:
        (KCanvasFilterEffect::subRegion):
        (KCanvasFilterEffect::setSubRegion): QRect -> QRectF
        * kcanvas/KCanvasFilters.h:
        (KCanvasFilter::filterRect):
        (KCanvasFilter::setFilterRect): QRect -> QRectF
        (KCanvasFEConvolveMatrix::kernelSize):
        (KCanvasFEConvolveMatrix::setKernelSize):
        (KCanvasFEConvolveMatrix::targetOffset):
        (KCanvasFEConvolveMatrix::setTargetOffset): QSize -> QSizeF
        * kcanvas/KCanvasItem.cpp:
        (RenderPath::fillContains):
        (RenderPath::strokeContains):
        (RenderPath::relativeBBox): QRect -> QRectF
        * kcanvas/KCanvasItem.h:
        * kcanvas/KCanvasResources.cpp:
        (KCanvasMarker::draw): QRect -> QRectF
        * kcanvas/KCanvasResources.h:
        * kcanvas/KCanvasTreeDebug.cpp:
        (hasFractions): helper function
        (operator<<): QSizeF operator, QRectF operator
        * kcanvas/KCanvasTreeDebug.h:
        * kcanvas/device/KRenderingPaintServerGradient.cpp:
        (KRenderingPaintServerLinearGradient::gradientStart):
        (KRenderingPaintServerLinearGradient::setGradientStart):
        (KRenderingPaintServerLinearGradient::gradientEnd):
        (KRenderingPaintServerLinearGradient::setGradientEnd):
        (KRenderingPaintServerRadialGradient::gradientCenter):
        (KRenderingPaintServerRadialGradient::setGradientCenter):
        (KRenderingPaintServerRadialGradient::gradientFocal):
        (KRenderingPaintServerRadialGradient::setGradientFocal): QPoint -> QPointF
        * kcanvas/device/KRenderingPaintServerGradient.h:
        * kcanvas/device/KRenderingPaintServerPattern.cpp:
        (KRenderingPaintServerPattern::Private::Private): x, y, width, height -> QRectF
        (KRenderingPaintServerPattern::setBbox): replaced get/set methods
        (KRenderingPaintServerPattern::bbox): replaced get/set methods
        (KRenderingPaintServerPattern::externalRepresentation):
        * kcanvas/device/KRenderingPaintServerPattern.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.mm:
        (KCanvasFilterQuartz::prepareFilter):
        (KCanvasFilterQuartz::applyFilter): QRect -> QRectF
        * kcanvas/device/quartz/KCanvasItemQuartz.h:
        (KCanvasItemQuartz::getAbsoluteRepaintRect): QRect -> QRectF
        * kcanvas/device/quartz/KCanvasItemQuartz.mm:
        (drawMarkerWithData):
        (KCanvasItemQuartz::drawMarkersIfNeeded):
        (KCanvasItemQuartz::paint): QRect -> QRectF
        (KCanvasItemQuartz::nodeAtPoint): QPoint -> QPointF
        (KCanvasItemQuartz::bboxForPath) :QRect -> QRectF
        (KCanvasItemQuartz::hitsPath):
        * kcanvas/device/quartz/KCanvasResourcesQuartz.h:
        (KCanvasContainerQuartz::getAbsoluteRepaintRect): QRect -> QRectF
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.mm:
        (KRenderingPaintServerPatternQuartz::draw): QRect -> QRectF
        * khtml/rendering/render_object.h:
        (khtml::RenderObject::relativeBBox):QRect -> QRectF
        * ksvg2/svg/SVGFilterElementImpl.cpp:
        (SVGFilterElementImpl::canvasResource): QRect -> QRectF
        * ksvg2/svg/SVGFilterPrimitiveStandardAttributesImpl.cpp:
        (SVGFilterPrimitiveStandardAttributesImpl::setStandardAttributes):
        * ksvg2/svg/SVGLengthImpl.cpp:
        (SVGLengthImpl::value): QRect -> QRectF
        * ksvg2/svg/SVGLinearGradientElementImpl.cpp:
        (SVGLinearGradientElementImpl::buildGradient): QPoint -> QPointF, removed integer conversions
        * ksvg2/svg/SVGLocatableImpl.cpp:
        (SVGLocatableImpl::getBBox): Rect -> QRectF
        * ksvg2/svg/SVGPatternElementImpl.cpp:
        (SVGPatternElementImpl::drawPatternContentIntoTile): QRect -> QRectF
        * ksvg2/svg/SVGRadialGradientElementImpl.cpp:
        (SVGRadialGradientElementImpl::buildGradient): QPoint -> QPointF, removed integer conversions
        * ksvg2/svg/SVGSVGElementImpl.cpp:
        (SVGSVGElementImpl::checkIntersection): QRect -> QRectF, removed integer conversions
        (SVGSVGElementImpl::checkEnclosure): QRect -> QRectF, removed integer conversions

2006-01-03  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Vicki.

        - moved frame traversal code across from bridge, also dropped the children
        array

        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge firstChild]): Moved from WebBridge. Use new _firstChild
        pointer.
        (-[WebCoreBridge lastChild]): Moved from WebBridge. Use new _lastChild pointer.
        (-[WebCoreBridge childCount]): Moved from WebBridge. Use _childCount variable.
        (-[WebCoreBridge previousSibling]): Moved from WebBridge.
        (-[WebCoreBridge nextSibling]): ditt
        (-[WebCoreBridge isDescendantOfFrame:]): ditto
        (-[WebCoreBridge traverseNextFrameStayWithin:]): ditto
        (-[WebCoreBridge appendChild:]): Moved from WebBridge, maintain count and first/last
        pointers.
        (-[WebCoreBridge removeChild:]): Moved from WebBridge, maintain count and first/last
        pointers.

2006-01-03  Justin Garcia  <justin.garcia@apple.com>

        Reviewed by harrison

        <http://bugzilla.opendarwin.org/show_bug.cgi?id=4609>
        window.getSelection().toString() is undefined (range object 
        returned from window.getSelection() is useless)

        toString was defined as a method on the JS Selection object, 
        but it didn't return anything.

        Added layout test:
        * editing/selection/toString.html

        * khtml/ecma/kjs_window.cpp:
        (KJS::SelectionFunc::callAsFunction):

2006-01-03  Geoffrey Garen  <ggaren@apple.com>

        Reviewed by timo.

        - Fixed: http://bugzilla.opendarwin.org/show_bug.cgi?id=6318
        REGRESSION: Repro crash in JS called from Flash on bdash.net.nz

        Since we clear all the plugin data structures in setView, we need to
        clear the windowScriptObject as well. I had already done this in my
        previous patch, but I didn't realize there are two windowScriptObjects 
        -- one for Netscape PlugIns, and one for WebKit PlugIns.

        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::setView): Clear the Netscape PlugIn windowScriptObject
        as well.

2006-01-03  Anders Carlsson  <andersca@mac.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6358
        JS objects missing "prototype" properties
        
        * khtml/ecma/XSLTProcessor.cpp:
        (KJS::XSLTProcessorConstructorImp::XSLTProcessorConstructorImp):
        * khtml/ecma/XSLTProcessor.h:
        * khtml/ecma/domparser.cpp:
        (KJS::DOMParserConstructorImp::DOMParserConstructorImp):
        * khtml/ecma/xmlhttprequest.cpp:
        (KJS::XMLHttpRequestConstructorImp::XMLHttpRequestConstructorImp):
        * khtml/ecma/xmlserializer.cpp:
        (KJS::XMLSerializerConstructorImp::XMLSerializerConstructorImp):
        Add "prototype" property in constructors.

2006-01-03  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        REGRESSION: repro crash w/ invalid charset attribute on <script>
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6345
        I also made some small spacing cleanup here.
        I did *not* fix the usage in formData, as the move from KCharSet to
        QTextCodec actually fixed a bug whereby if the first listed charset
        in accept-charsets was invalid, we would assume latin1 instead of
        checking for the next valid one before assuming system encoding.

        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLFormElementImpl::formData): cleanup
        * khtml/misc/loader.cpp:
        (CachedCSSStyleSheet::CachedCSSStyleSheet): null check
        (CachedScript::CachedScript): cleanup
        (CachedXSLStyleSheet::CachedXSLStyleSheet): null check
        (CachedXBLDocument::CachedXBLDocument): cleanup

2006-01-03  Justin Garcia  <justin.garcia@apple.com>

        <http://bugzilla.opendarwin.org/show_bug.cgi?id=4904>
        Bug with baseOffset and extentOffset in selections (for writely.com)
        <rdar://problem/4259818>
        selection object incorrect after double-clicking a word
        
        Reviewed by harrison

        Changed the Selection object's anchor/focus properties to match 
        Mozilla's Selection object API, added getRangeAt and outlined the 
        rest of the API.
        Cleaned up the JS Selection object (to do less work in the DOM binding).
        Added an updateLayout call to VisiblePosition::init and removed some 
        updateLayout calls from other parts of the editing code.
        
        Added layout tests:
        * editing/selection/getRangeAt.html
        * editing/selection/anchor-focus1.html
        * editing/selection/anchor-focus2.html
        * editing/selection/anchor-focus3.html
        Updated expected results:
        * editing/selection/unrendered-001-expected.txt

        * khtml/ecma/kjs_window.cpp:
        (KJS::Selection::getValueProperty):
        (KJS::Selection::toString):
        (KJS::SelectionFunc::callAsFunction):
        * khtml/ecma/kjs_window.h:
        (KJS::Selection::):
        * khtml/editing/SelectionController.cpp:
        (khtml::SelectionController::modify):
        (khtml::SelectionController::type):
        (khtml::SelectionController::toString):
        (khtml::SelectionController::getRangeAt):
        (khtml::SelectionController::setBaseAndExtent):
        (khtml::SelectionController::setPosition):
        (khtml::SelectionController::collapse):
        (khtml::SelectionController::collapseToEnd):
        (khtml::SelectionController::collapseToStart):
        (khtml::SelectionController::empty):
        (khtml::SelectionController::extend):
        (khtml::SelectionController::validate):
        * khtml/editing/SelectionController.h:
        (khtml::SelectionController::part):
        (khtml::SelectionController::baseNode):
        (khtml::SelectionController::extentNode):
        (khtml::SelectionController::baseOffset):
        (khtml::SelectionController::extentOffset):
        (khtml::SelectionController::anchorNode):
        (khtml::SelectionController::anchorOffset):
        (khtml::SelectionController::focusNode):
        (khtml::SelectionController::focusOffset):
        (khtml::SelectionController::isCollapsed):
        * khtml/editing/visible_position.cpp:
        (khtml::VisiblePosition::init):
        (khtml::VisiblePosition::isCandidate):
        * khtml/khtml_part.cpp:
        (KHTMLPart::handleMousePressEventSingleClick):

2006-01-03  Anders Carlsson  <andersca@mac.com>

        Reviewed by Maciej.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5378
        createDocument fails with DOM Exception 5 when passed empty qname
        
        * khtml/ecma/kjs_dom.cpp:
        (KJS::DOMDOMImplementationProtoFunc::callAsFunction):
        When passing null to createDocument, pass a null DOMString, and not
        a DOMString containing the text "null".
        
        * khtml/xml/dom_docimpl.cpp:
        (DOMImplementationImpl::createDocument):
        Only validate the qualifiedName if it's not null or empty. Also, do not
        create the document element if the qualifiedName is null or empty.

2006-01-03  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        No functionality changes, no tests possible.

        khtml/editing should use RefPtr instead of manual ref/deref
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6109

        Results in a slight performance gain < 1% on the PLT.

        * khtml/editing/SelectionController.cpp:
        (khtml::SelectionController::toRange):
        * khtml/editing/SelectionController.h:
        * khtml/editing/append_node_command.cpp:
        (khtml::AppendNodeCommand::AppendNodeCommand):
        (khtml::AppendNodeCommand::doApply):
        (khtml::AppendNodeCommand::doUnapply):
        * khtml/editing/append_node_command.h:
        (khtml::AppendNodeCommand::~AppendNodeCommand):
        (khtml::AppendNodeCommand::appendChild):
        (khtml::AppendNodeCommand::parentNode):
        * khtml/editing/apply_style_command.cpp:
        (khtml::StyleChange::init):
        (khtml::ApplyStyleCommand::removeInlineStyle):
        * khtml/editing/apply_style_command.h:
        * khtml/editing/composite_edit_command.cpp:
        (khtml::CompositeEditCommand::deleteInsignificantText):
        * khtml/editing/delete_from_text_node_command.cpp:
        (khtml::DeleteFromTextNodeCommand::DeleteFromTextNodeCommand):
        * khtml/editing/delete_from_text_node_command.h:
        (khtml::DeleteFromTextNodeCommand::~DeleteFromTextNodeCommand):
        (khtml::DeleteFromTextNodeCommand::node):
        * khtml/editing/delete_selection_command.cpp:
        (khtml::DeleteSelectionCommand::initializePositionData):
        (khtml::DeleteSelectionCommand::saveTypingStyleState):
        (khtml::DeleteSelectionCommand::handleGeneralDelete):
        (khtml::DeleteSelectionCommand::calculateEndingPosition):
        (khtml::DeleteSelectionCommand::calculateTypingStyleAfterDelete):
        (khtml::DeleteSelectionCommand::clearTransientState):
        * khtml/editing/delete_selection_command.h:
        * khtml/editing/edit_command.cpp:
        (khtml::EditCommand::EditCommand):
        (khtml::EditCommand::~EditCommand):
        (khtml::EditCommand::setTypingStyle):
        (khtml::EditCommand::styleAtPosition):
        * khtml/editing/edit_command.h:
        (khtml::EditCommand::document):
        (khtml::EditCommand::typingStyle):
        * khtml/editing/insert_into_text_node_command.cpp:
        (khtml::InsertIntoTextNodeCommand::InsertIntoTextNodeCommand):
        * khtml/editing/insert_into_text_node_command.h:
        (khtml::InsertIntoTextNodeCommand::~InsertIntoTextNodeCommand):
        (khtml::InsertIntoTextNodeCommand::node):
        * khtml/editing/insert_node_before_command.cpp:
        (khtml::InsertNodeBeforeCommand::InsertNodeBeforeCommand):
        (khtml::InsertNodeBeforeCommand::doApply):
        (khtml::InsertNodeBeforeCommand::doUnapply):
        * khtml/editing/insert_node_before_command.h:
        (khtml::InsertNodeBeforeCommand::~InsertNodeBeforeCommand):
        (khtml::InsertNodeBeforeCommand::insertChild):
        (khtml::InsertNodeBeforeCommand::refChild):
        * khtml/editing/insert_paragraph_separator_command.cpp:
        (khtml::InsertParagraphSeparatorCommand::InsertParagraphSeparatorCommand):
        (khtml::InsertParagraphSeparatorCommand::~InsertParagraphSeparatorCommand):
        (khtml::InsertParagraphSeparatorCommand::calculateStyleBeforeInsertion):
        (khtml::InsertParagraphSeparatorCommand::applyStyleAfterInsertion):
        * khtml/editing/insert_paragraph_separator_command.h:
        * khtml/editing/join_text_nodes_command.cpp:
        (khtml::JoinTextNodesCommand::JoinTextNodesCommand):
        (khtml::JoinTextNodesCommand::doApply):
        (khtml::JoinTextNodesCommand::doUnapply):
        * khtml/editing/join_text_nodes_command.h:
        (khtml::JoinTextNodesCommand::~JoinTextNodesCommand):
        (khtml::JoinTextNodesCommand::firstNode):
        (khtml::JoinTextNodesCommand::secondNode):
        * khtml/editing/jsediting.cpp:
        * khtml/editing/markup.cpp:
        (khtml::createMarkup):
        (khtml::createFragmentFromMarkup):
        (khtml::createFragmentFromText):
        (khtml::createFragmentFromNodeList):
        * khtml/editing/markup.h:
        * khtml/editing/merge_identical_elements_command.cpp:
        (khtml::MergeIdenticalElementsCommand::MergeIdenticalElementsCommand):
        (khtml::MergeIdenticalElementsCommand::doApply):
        (khtml::MergeIdenticalElementsCommand::doUnapply):
        * khtml/editing/merge_identical_elements_command.h:
        (khtml::MergeIdenticalElementsCommand::~MergeIdenticalElementsCommand):
        * khtml/editing/move_selection_command.cpp:
        (khtml::MoveSelectionCommand::MoveSelectionCommand):
        (khtml::MoveSelectionCommand::~MoveSelectionCommand):
        (khtml::MoveSelectionCommand::doApply):
        * khtml/editing/move_selection_command.h:
        * khtml/editing/rebalance_whitespace_command.cpp:
        * khtml/editing/rebalance_whitespace_command.h:
        (khtml::RebalanceWhitespaceCommand::~RebalanceWhitespaceCommand):
        * khtml/editing/remove_css_property_command.cpp:
        (khtml::RemoveCSSPropertyCommand::RemoveCSSPropertyCommand):
        * khtml/editing/remove_css_property_command.h:
        (khtml::RemoveCSSPropertyCommand::~RemoveCSSPropertyCommand):
        (khtml::RemoveCSSPropertyCommand::styleDeclaration):
        * khtml/editing/remove_node_attribute_command.cpp:
        (khtml::RemoveNodeAttributeCommand::RemoveNodeAttributeCommand):
        * khtml/editing/remove_node_attribute_command.h:
        (khtml::RemoveNodeAttributeCommand::~RemoveNodeAttributeCommand):
        (khtml::RemoveNodeAttributeCommand::element):
        * khtml/editing/remove_node_command.cpp:
        (khtml::RemoveNodeCommand::RemoveNodeCommand):
        (khtml::RemoveNodeCommand::doApply):
        (khtml::RemoveNodeCommand::doUnapply):
        * khtml/editing/remove_node_command.h:
        (khtml::RemoveNodeCommand::~RemoveNodeCommand):
        (khtml::RemoveNodeCommand::node):
        * khtml/editing/remove_node_preserving_children_command.cpp:
        (khtml::RemoveNodePreservingChildrenCommand::RemoveNodePreservingChildrenCommand):
        * khtml/editing/remove_node_preserving_children_command.h:
        (khtml::RemoveNodePreservingChildrenCommand::~RemoveNodePreservingChildrenCommand):
        (khtml::RemoveNodePreservingChildrenCommand::node):
        * khtml/editing/replace_selection_command.cpp:
        (khtml::ReplacementFragment::ReplacementFragment):
        (khtml::ReplacementFragment::~ReplacementFragment):
        (khtml::ReplacementFragment::enclosingBlock):
        (khtml::ReplacementFragment::removeNodePreservingChildren):
        (khtml::ReplacementFragment::removeNode):
        (khtml::ReplacementFragment::insertFragmentForTestRendering):
        (khtml::ReplacementFragment::restoreTestRenderingNodesToFragment):
        (khtml::ReplaceSelectionCommand::fixupNodeStyles):
        (khtml::computeAndStoreNodeDesiredStyle):
        (khtml::NodeDesiredStyle::NodeDesiredStyle):
        (khtml::ReplaceSelectionCommand::ReplaceSelectionCommand):
        (khtml::ReplaceSelectionCommand::~ReplaceSelectionCommand):
        (khtml::ReplaceSelectionCommand::doApply):
        (khtml::ReplaceSelectionCommand::completeHTMLReplacement):
        (khtml::ReplaceSelectionCommand::updateNodesInserted):
        * khtml/editing/replace_selection_command.h:
        (khtml::NodeDesiredStyle::node):
        (khtml::NodeDesiredStyle::style):
        (khtml::ReplacementFragment::root):
        * khtml/editing/set_node_attribute_command.cpp:
        (khtml::SetNodeAttributeCommand::SetNodeAttributeCommand):
        * khtml/editing/set_node_attribute_command.h:
        (khtml::SetNodeAttributeCommand::~SetNodeAttributeCommand):
        (khtml::SetNodeAttributeCommand::element):
        * khtml/editing/split_element_command.cpp:
        (khtml::SplitElementCommand::SplitElementCommand):
        (khtml::SplitElementCommand::doApply):
        (khtml::SplitElementCommand::doUnapply):
        * khtml/editing/split_element_command.h:
        (khtml::SplitElementCommand::~SplitElementCommand):
        * khtml/editing/split_text_node_command.cpp:
        (khtml::SplitTextNodeCommand::SplitTextNodeCommand):
        (khtml::SplitTextNodeCommand::doApply):
        (khtml::SplitTextNodeCommand::doUnapply):
        * khtml/editing/split_text_node_command.h:
        (khtml::SplitTextNodeCommand::~SplitTextNodeCommand):
        (khtml::SplitTextNodeCommand::node):
        * khtml/editing/split_text_node_containing_element.cpp:
        (khtml::SplitTextNodeContainingElementCommand::SplitTextNodeContainingElementCommand):
        (khtml::SplitTextNodeContainingElementCommand::doApply):
        * khtml/editing/split_text_node_containing_element_command.h:
        (khtml::SplitTextNodeContainingElementCommand::~SplitTextNodeContainingElementCommand):
        * khtml/editing/visible_position.cpp:
        (khtml::makeRange):
        * khtml/editing/visible_position.h:
        * khtml/editing/visible_text.cpp:
        (khtml::TextIterator::range):
        (khtml::SimplifiedBackwardsTextIterator::range):
        (khtml::CharacterIterator::range):
        (khtml::findPlainText):
        * khtml/editing/visible_text.h:
        (khtml::WordAwareIterator::range):
        * khtml/editing/wrap_contents_in_dummy_span_command.cpp:
        (khtml::WrapContentsInDummySpanCommand::WrapContentsInDummySpanCommand):
        (khtml::WrapContentsInDummySpanCommand::doApply):
        (khtml::WrapContentsInDummySpanCommand::doUnapply):
        * khtml/editing/wrap_contents_in_dummy_span_command.h:
        (khtml::WrapContentsInDummySpanCommand::~WrapContentsInDummySpanCommand):
        * kwq/DOMHTML.mm:
        (-[DOMHTMLDocument _createDocumentFragmentWithMarkupString:baseURLString:]):
        (-[DOMHTMLDocument _createDocumentFragmentWithText:]):
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge documentFragmentWithMarkupString:baseURLString:]):
        (-[WebCoreBridge documentFragmentWithText:]):
        (-[WebCoreBridge documentFragmentWithNodesAsParagraphs:]):

2006-01-03  Anders Carlsson  <andersca@mac.com>

        Reviewed by Darin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5177
        Javascript cloneNode(deep) does not clone form elements correctly

        * khtml/html/html_elementimpl.cpp:
        (HTMLElementImpl::cloneNode):
        Call copyNonAttributeProperties on the new node.
        
        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLInputElementImpl::copyNonAttributeProperties):
        * khtml/html/html_formimpl.h:
        Copy m_value, m_checked and m_indeterminate here.
        
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::importNode):
        Call copyNonAttributeProperties on the new node.
        
        * khtml/xml/dom_elementimpl.cpp:
        (ElementImpl::cloneNode):
        Call copyNonAttributeProperties on the new node.
        
        * khtml/xml/dom_elementimpl.h:
        (DOM::ElementImpl::copyNonAttributeProperties):
        Add function declaration.

2006-01-02  Maciej Stachowiak  <mjs@apple.com>

        Rubber stamped by Eric.

        - remove the no longer used QIntDict

        * kwq/KWQIntDict.h: Removed.

2006-01-03  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5609
          XSLT document() doesn't handle relative paths

        Test case: fast/xsl/xslt-relative-path.xml

        * khtml/xsl/xslt_processorimpl.cpp:
        (DOM::docLoaderFunc): Renamed from stylesheetLoadFunc. Use base URL when constructing URLs.
        (DOM::XSLTProcessorImpl::transformToString):

2006-01-02  Vicki Murley  <vicki@apple.com>

        Reviewed by Maciej.
 
        - fix for <rdar://problem/4389622> *Pan EU2* iframe swallows events for overlapping elements (part 2)

        We originally added a call to passSubframeEventToSubframe here to fix the hand cursor updating problem
        reported in <rdar://problem/4316201> REGRESSION: cursor and text in status bar is not updated when 
        mousing over links in a frame (5509). However, when we return early after passSubframeEventToSubframe,
        we fail to fire onmouseout events.  Since the call to passSubframeEventToSubframe was originally added
        to fix the hand cursor updating problem, remove the early return and make cursor updating conditional
        on passSubframeEventToSubframe.

        * khtml/khtmlview.cpp:
        (KHTMLView::viewportMouseMoveEvent):

2005-12-30  Darin Adler  <darin@apple.com>

        Reviewed by Maciej.

        - http://bugzilla.opendarwin.org/show_bug.cgi?id=4557
          rename unusual strcmp and strcasecmp for DOMString family

        Added new functions named equal and equalIgnoringCase.

        * khtml/xml/dom_stringimpl.h: Changed the type of the length parameter to computeHash to unsigned
        to match the rest of the interface. Added equal and equalIgnoringCase functions. Added a
        version of the hash function that works on char* to CaseInsensitiveHash as preparation for an
        atomic string change.
        * khtml/xml/dom_stringimpl.cpp: Moved the QT_ALLOC_QCHAR_VEC and QT_DELETE_QCHAR_VEC macros
        here, and changed them into inline functions.
        (DOM::equal): Implemented.
        (DOM::equalIgnoringCase): Implemented.
        (DOM::DOMStringImpl::computeHash): Changed parameter type to unsigned to match other similar
        functions.

        * khtml/dom/dom_string.h: Removed unnecessary friend declarations. Changed operator
        overloads for == and != to call through inline to DOMStringImpl. Replaced strcasecmp
        with equalIgnoringCase, overloaded for one more combination of parameters. Removed strcmp.
        * khtml/dom/dom_string.cpp: Removed functions that are now implemented in DOMStringImpl*.

        * khtml/xml/dom_atomicstring.h: Removed a redundant const. Removed unnecessary
        friend declarations. Removed AtomicString::equal. Filled out a larger set of == and
        != operator implementations, mostly with inlines calling through to DOMStringImpl.
        Renamed equalsIgnoreCase to equalIgnoringCase and filled out a larger set as above.
        * khtml/xml/dom_atomicstring.cpp: Renamed AtomicString::equal to just ==.
        Removed some implementation of == and equalsIgnoreCase that are replaced by inlines.

        * khtml/html/html_listimpl.cpp:
        (DOM::HTMLOListElementImpl::parseMappedAttribute):
        (DOM::HTMLLIElementImpl::parseMappedAttribute):
        Use the "==" operator instead of strcmp.

        * khtml/css/cssstyleselector.cpp: (khtml::CSSStyleSelector::checkOneSelector):
        Use equalIgnoringCase instead of equalsIgnoreCase.

        * khtml/rendering/render_form.cpp:
        (RenderSlider::updateFromElement): Fixed bug where a temporary DOMString was put into
        a const DOMString&. Changed some DOMString to AtomicString as appropriate, and also
        used equalIgnoringCase instead of strcasecmp.
        (RenderSlider::slotSliderValueChanged): More of the same.

        * khtml/xml/dom_docimpl.cpp: (DocumentImpl::processHttpEquiv): Replaced use of strcasecmp
        with equalIgnoringCase. Added parentheses to fix incorrect operator precedence in one case
        (&& binds tighter than ||) which fixes a crash when using a http-equiv pragma when there
        is no part (not sure how to reproduce that).

        * khtml/khtml_part.cpp:
        (updateState):
        (KHTMLPart::selectionStartHasStyle):
        * khtml/ecma/kjs_html.cpp: (KJS::KJS::HTMLDocument::putValueProperty):
        * khtml/editing/apply_style_command.cpp:
        (khtml::StyleChange::checkForLegacyHTMLStyleChange):
        (khtml::StyleChange::currentlyHasStyle):
        (khtml::hasTextDecorationProperty):
        (khtml::ApplyStyleCommand::extractTextDecorationStyle):
        (khtml::ApplyStyleCommand::extractAndNegateTextDecorationStyle):
        * khtml/html/html_baseimpl.cpp:
        (HTMLBodyElementImpl::parseMappedAttribute):
        (HTMLFrameElementImpl::parseMappedAttribute):
        * khtml/html/html_blockimpl.cpp:
        (HTMLDivElementImpl::parseMappedAttribute):
        (HTMLHRElementImpl::parseMappedAttribute):
        (HTMLParagraphElementImpl::parseMappedAttribute):
        (HTMLMarqueeElementImpl::parseMappedAttribute):
        * khtml/html/html_elementimpl.cpp:
        (HTMLElementImpl::parseMappedAttribute):
        (HTMLElementImpl::addHTMLAlignment):
        (HTMLElementImpl::setContentEditable):
        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLFormElementImpl::parseMappedAttribute):
        (DOM::HTMLButtonElementImpl::parseMappedAttribute):
        (DOM::HTMLInputElementImpl::setInputType):
        (DOM::HTMLInputElementImpl::parseMappedAttribute):
        (DOM::HTMLKeygenElementImpl::appendFormData):
        (DOM::HTMLTextAreaElementImpl::parseMappedAttribute):
        * khtml/html/html_imageimpl.cpp: (DOM::HTMLAreaElementImpl::parseMappedAttribute):
        * khtml/html/html_inlineimpl.cpp: (DOM::HTMLBRElementImpl::parseMappedAttribute):
        * khtml/html/html_tableimpl.cpp: (DOM::HTMLTablePartElementImpl::parseMappedAttribute):
        * khtml/html/htmlparser.cpp: (HTMLParser::handleError):
        Use equalIgnoringCase instead of strcasecmp.

2005-12-30  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Darin, landed by ap.
        
        Test: fast/text/justified-text-rect.html
        
        - WebCore part of fix for
          http://bugzilla.opendarwin.org/show_bug.cgi?id=5461
          Text width measured incorrectly when text-align: justify

        * khtml/rendering/font.h:
        * khtml/rendering/font.cpp:
        (khtml::Font::selectionRectForText): Added.
        * khtml/rendering/render_text.cpp:
        (kthml::InlineTextBox::selectionRect): Use selectionRectForText. This
        works for justified text as well, and avoids intermediate rounding which
        resulted in selection rects narrower than AppKit's.
        (khtml::InlineTextBox::positionForOffset): Use selectionRectForText,
        which works for justified text as well.
        * kwq/KWQFontMetrics.h:
        * kwq/KWQFontMetrics.mm:
        (QFontMetrics::selectionRectForText): Added.
        * kwq/WebCoreTextRenderer.h:

2005-12-30  Alexey Proskuryakov  <ap@nypop.com>

        - Fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6289
        REGRESSION: firstCharacterForRange(0, 0) returns a 0x0 rect

        * khtml/editing/visible_text.cpp:
        (khtml::TextIterator::rangeFromLocationAndLength):
        Only special-case (0, 0) ranges for empty documents.

2005-12-30  Geoffrey Garen  <ggaren@apple.com>

        Added test case for <rdar://problem/4268278> Submitting a form in onUnload event
        handler causes crash in -[WebDataSource(WebPrivate) _commitIfReady:]

        * manual-tests/onunload-form-submit-crash.html: Added.

2005-12-30  Anders Carlsson  <andersca@mac.com>

        Reviewed by Eric.

        - Fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6297
        XMLSerializer should use createMarkup.

        * khtml/ecma/xmlserializer.cpp:
        (KJS::XMLSerializerProtoFunc::callAsFunction):
        Use createMarkup instead of NodeImpl::toString.

        * khtml/editing/markup.cpp:
        (khtml::startMarkup):
        escape attribute values and ignore document fragment nodes.

2005-12-30  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        No functional changes, thus no layout test.

        Just removes debug NSLog() calls from ksvg2/kcanvas.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6299

        * kcanvas/device/quartz/KCanvasFilterQuartz.mm:
        (KCanvasFilterQuartz::prepareFilter):
        (KCanvasFilterQuartz::applyFilter):
        (KCanvasFilterQuartz::getCIFilterStack):
        (KCanvasFilterQuartz::imageForName):
        (KCanvasFEBlendQuartz::getCIFilter):
        (KCanvasFEColorMatrixQuartz::getCIFilter):
        (KCanvasFEGaussianBlurQuartz::getCIFilter):
        * kcanvas/device/quartz/KCanvasResourcesQuartz.mm:
        (KCanvasClipperQuartz::applyClip):
        * kcanvas/device/quartz/KRenderingDeviceQuartz.mm:
        (KRenderingDeviceContextQuartz::mapFromVisual):
        (KRenderingDeviceContextQuartz::mapToVisual):
        (KRenderingDeviceQuartz::createResource):
        (KRenderingDeviceQuartz::createFilterEffect):
        * kcanvas/device/quartz/KRenderingPaintServerGradientQuartz.mm:
        (drawShadingWithStyle):
        (KRenderingPaintServerGradientQuartz::updateQuartzGradientCache):
        * kcanvas/device/quartz/KRenderingPaintServerQuartz.mm:
        (KRenderingPaintServerPatternQuartz::draw):
        * ksvg2/svg/svgpathparser.cpp:
        (SVGPathParser::parseSVG):

2005-12-29  Graham Dennis  <Graham.Dennis@gmail.com>

        Reviewed by Hyatt.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=3579
          In-place style-switching is leaving junk behind, messing up styles

        * khtml/rendering/render_block.h: (khtml::RenderBlock::initMaxMarginValues):
        Set all margin values in all cases.

2005-12-29  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        XML documents with "html" in dtd name use XHTML entities when they shouldn't
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6290

        * khtml/xml/xml_tokenizer.cpp:
        (khtml::externalSubsetHandler): check for exact xhtml types

2005-12-29  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Close leak in CollectionInfo due to HashMap migration
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6295

        * khtml/html/html_miscimpl.cpp:
        (DOM::HTMLCollectionImpl::CollectionInfo::~CollectionInfo):
        * khtml/html/html_miscimpl.h:

2005-12-29  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - finished frame traversal cleanup
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6293
        
        * kwq/WebCoreBridge.h: Removed childFrames method from WebCoreBridge protocol
        since it is not actually used.

2005-12-29  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Leaks in XSLTProcessorImpl due to early exit in failure case
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6101

        * khtml/xsl/xslt_processorimpl.cpp:
        (DOM::xmlDocPtrFromNode): add "shouldDelete" argument
        (DOM::XSLTProcessorImpl::transformToString): delete new'd xmlDoc

2005-12-29  Eric Seidel  <eseidel@apple.com>

        File accidentally omitted from previous commit.

        Remove QDict from khtml/html
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6230

        * khtml/ecma/kjs_html.cpp:
        (KJS::KJS::HTMLCollection::getNamedItems):

2005-12-29  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Remove QDict from khtml/html
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6230
        Uses HashMap instead.

        * khtml/html/html_miscimpl.cpp:
        (DOM::HTMLCollectionImpl::CollectionInfo::CollectionInfo):
        (DOM::HTMLCollectionImpl::CollectionInfo::reset):
        (DOM::HTMLCollectionImpl::namedItem):
        (DOM::HTMLCollectionImpl::updateNameCache):
        (DOM::HTMLCollectionImpl::namedItems):
        (DOM::HTMLCollectionImpl::nextNamedItem):
        (DOM::HTMLFormCollectionImpl::nextNamedItemInternal):
        (DOM::HTMLFormCollectionImpl::updateNameCache):
        * khtml/html/html_miscimpl.h:

2005-12-29  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        DOMString/DOMStringImpl/AtomicString need enhancements before replacing QString
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6228
        Added find(), contains(), startsWith() and endsWith() to DOMString
        Uses the above functions throughout the code.
        Small performance boost.

        * khtml/css/css_base.cpp:
        (CSSSelector::print):
        * khtml/css/css_ruleimpl.cpp:
        (DOM::CSSImportRuleImpl::init):
        * khtml/css/css_valueimpl.cpp:
        (DOM::CSSStyleDeclarationImpl::setProperty):
        * khtml/css/cssparser.cpp:
        (CSSParser::parseValue):
        (CSSParser::parseDeclaration):
        (CSSParser::parseContent):
        * khtml/css/cssstyleselector.cpp:
        (khtml::CSSStyleSelector::CSSStyleSelector):
        (khtml::CSSStyleSelector::setEncodedURL):
        (khtml::parseUASheet):
        (khtml::cleanpath):
        (khtml::CSSStyleSelector::checkSelector):
        (khtml::CSSStyleSelector::checkOneSelector):
        (khtml::CSSRuleSet::addRulesFromSheet):
        (khtml::CSSStyleSelector::applyProperty):
        * khtml/dom/dom_string.cpp:
        * khtml/dom/dom_string.h:
        (DOM::DOMString::contains):
        (DOM::DOMString::find):
        (DOM::DOMString::startsWith):
        (DOM::DOMString::endsWith):
        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLFormElementImpl::parseEnctype):
        * khtml/khtml_part.cpp:
        (KHTMLPart::requestFrame):
        (KHTMLPart::submitForm):
        * khtml/misc/decoder.cpp:
        (Decoder::decode):
        * khtml/xml/dom_atomicstring.h:
        (DOM::AtomicString::length):
        (DOM::AtomicString::operator []):
        (DOM::AtomicString::contains):
        (DOM::AtomicString::find):
        (DOM::AtomicString::startsWith):
        (DOM::AtomicString::endsWith):
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::processHttpEquiv):
        * khtml/xml/dom_stringimpl.cpp:
        (DOM::equal):
        (DOM::equalCaseInsensitive):
        (DOM::DOMStringImpl::find):
        (DOM::DOMStringImpl::endsWith):
        * khtml/xml/dom_stringimpl.h:
        (DOM::DOMStringImpl::startsWith):

2005-12-29  Rob Buis  <rwlbuis@xs4all.nl>

        Reviewed by eseidel.

        WebCore+SVG has some problems with rounded rectangles
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6157

        * ksvg2/svg/SVGRectElementImpl.cpp:
        (SVGRectElementImpl::toPathData): fixed round rect calculations

2005-12-29  Mark Rowe  <opendarwin.org@bdash.net.nz>

        Reviewed by eseidel, ggaren, darin.
        
        - http://bugzilla.opendarwin.org/show_bug.cgi?id=4301
        Support HTML entities on pages parsed as XHTML

        Added layout tests:
        * fast/parser/entities-in-xhtml.xhtml

        * khtml/xml/xml_tokenizer.cpp:
        (khtml::XMLTokenizer::setIsXHTMLDocument): Track whether the XML document is XHTML.
        (khtml::XMLTokenizer::isXHTMLDocument): Ditto.
        (khtml::externalSubsetHandler): Ditto.
        (khtml::XMLTokenizer::finish): Ditto.
        (khtml::getXHTMLEntity): Look up the HTML entity.
        (khtml::getEntityHandler): Look up the HTML entity if this is an XHTML document.
        * khtml/html/kentities.h: Added.
        * khtml/html/kentities.gperf: changed entity to Entity

2005-12-29  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by darin

        - WebCore part of fix for
          http://bugzilla.opendarwin.org/show_bug.cgi?id=3922
          Variable word/letter spacing and full justification not supported for
          ATSUI-rendered text

        * khtml/rendering/font.h:
        (khtml::Font::checkSelectionPoint): Make sure the complete run, used for
        counting spaces and determining padding per space does not go beyond the
        text box.

2005-12-28  Geoffrey Garen  <ggaren@apple.com>

        Reviewed by mjs.

        - Fixed <rdar://problem/4325722> crash in KJS::Bindings::dispatchJNICall
        due to liveconnect call from Java after Java PlugInView has been 
        deallocated @ www.binarybet.com
        AKA
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5518

        We had code that checked for whether a call came from a live PlugIn,
        but the live PlugIn dictionary would only get cleared when the 
        KWQKHTMLPart was destroyed. Since a single part can service multiple
        loads, the dictionary needs to clear after each one.

        No layout test because this bug is difficult to reproduce.

        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::~KWQKHTMLPart):
        (1) Unrelated cleanup: Removed manual clearing of form values,
        replaced with call to clearRecordedFormValues().
        (2) Replaced PlugIn dictionary cleanup code and view deref call
        with call to setView(0), since much of this code was duplicated in
        setView, and the stuff that wasn't duplicated needed to be.

        (KWQKHTMLPart::setView):
        (1) Removed some unnecessary braces.
        (2) Added PlugIn dictionary cleanup code.
        (3) New behavior: clear _bindingRoot and _windowScriptObject after
        each view change. This is needed because after a call to
        clenaupPluginRootObjects(), both objects have stale references.
        (4) Changed a NULL to a 0.

        (KWQKHTMLPart::cleanupPluginRootObjects): Removed extra space.

2005-12-28  Anders Carlsson  <andersca@mac.com>

        Reviewed by Maciej.

        - Fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6268
        Add undetectable document.all
        
        * khtml/ecma/kjs_html.cpp:
        (KJS::HTMLDocument::getValueProperty):
        If "all" has been set to a new value, return the new value.
        
        (KJS::KJS::HTMLDocument::putValueProperty):
        Allow "all" to be set to a new value.
        
        (KJS::HTMLAllCollection::toPrimitive):
        Return jsNull() if the preferred type is NullType.
        
        (KJS::getAllHTMLCollection):
        * khtml/ecma/kjs_html.h:
        (KJS::HTMLAllCollection::HTMLAllCollection):
        Add HTMLAllCollection, a subclass of HTMLCollection which should
        be undetectable.
        
        (KJS::HTMLAllCollection::toBoolean):
        Return false.

2005-12-28  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Eric, landed by ap.
        
        Test: fast/block/basic/text-indent-rtl.html

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6214
          text-indent in RTL block does the opposite

        * khtml/rendering/render_block.cpp:
        (khtml::RenderBlock::rightRelOffset): Subtract the indent instead of adding it.

2005-12-28  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Darin, landed by ap.

        Test: fast/dom/HTMLScriptElement/script-load-events.html

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5812
          Generate load events for <script> elements

        * khtml/html/html_headimpl.cpp:
        (HTMLScriptElementImpl::parseMappedAttribute): Parse the onload and onerror attributes.
        (HTMLScriptElementImpl::closeRenderer): Call base class's implementation.
        (HTMLScriptElementImpl::notifyFinished): Dispatch load and error events.
        * khtml/html/htmlparser.h:
        * khtml/html/htmlparser.cpp:
        (HTMLParser::parseToken): Return the node that was inserted.
        * khtml/html/htmltokenizer.h: Added scriptNode, a RefPtr to the node corresponding
        to the current load request.
        * khtml/html/htmltokenizer.cpp:
        (HTMLTokenizer::scriptHandler): Reset scriptNode if a load request was not made.
        (HTMLTokenizer::parseTag): Set scriptNode to the node created from the script tag.
        (HTMLTokenizer::processToken): Return the node that was inserted.
        (HTMLTokenizer::notifyFinished): Reset scriptNode and dispatch load and error events.
        * khtml/misc/loader.h:
        (CachedScript::errorOccurred): Added.
        * khtml/misc/loader.cpp:
        (CachedScript::CachedScript):
        (CachedScript::error):

2005-12-28  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Maciej.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6246
          TextIterator::rangeFromLocationAndLength() returns nil range for an 
          empty document

        Test: editing/input/range-for-empty-document.html

        * khtml/editing/visible_text.cpp:
        (khtml::TextIterator::rangeFromLocationAndLength):
        Handle the case of an empty document and (0, 0) requested range.

2005-12-28  Anders Carlsson  <andersca@mac.com>

        Reviewed and landed by Geoff.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6269
        ToT memory corruption
        
        * khtml/rendering/render_text.cpp:
        (khtml::RenderText::setText):
        Remove deref().
        
2005-12-27  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Hyatt, landed by Darin.
        
        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5699
          REGRESSION: incomplete repaint

        * khtml/rendering/render_object.cpp:
        (RenderObject::repaintAfterLayoutIfNeeded): Return false if only the
        size changed and not everything was repainted.
        * manual-tests/bugzilla-5699.html: Added.

2005-12-27  Sam Weinig  <sam.weinig@gmail.com>

        Reviewed by Maciej, landed by Darin.

        - fixed <http://bugzilla.opendarwin.org/show_bug.cgi?id=4101>
        CSS Fibonacci spiral using 4 images doesn't render correctly

        Added layout tests:
        * fast/replaced/absolute-image-sizing.html

        * khtml/rendering/render_box.cpp:
        (RenderBox::calcAbsoluteHorizontalValues): Use calcReplacedWidth() instead of intrinsicWidth()
        for replaced elements.
        (RenderBox::calcAbsoluteVerticalValues): Same thing for height.

2005-12-27  Darin Adler  <darin@apple.com>

        Reviewed by Geoff and Eric.

        - http://bugzilla.opendarwin.org/show_bug.cgi?id=6198
          use RefPtr a few places in RenderText and related classes

        * khtml/html/htmltokenizer.h: Use RefPtr for some data members in Token.
        Also removed use of bitfields in Token, since there's no need to optimize storage here.
        * khtml/html/htmlparser.cpp:
        (HTMLParser::parseToken): Update for use of RefPtr in Token.
        (HTMLParser::textCreateErrorCheck): Ditto.
        (HTMLParser::commentCreateErrorCheck): Ditto.
        (HTMLParser::handleIsindex): Ditto.
        * khtml/html/htmltokenizer.cpp:
        (khtml::Token::addAttribute): Ditto.
        (khtml::HTMLTokenizer::processToken): Ditto.

        * khtml/rendering/render_text.h: Reduce the number of includes, change
        SOFT_HYPHEN from a macro into a constant. Change originalString function
        to return a PassRefPtr instead of a RefPtr. Make str and m_generatedContentStr
        member be a RefPtr.
        * khtml/rendering/render_text.cpp:
        (khtml::RenderText::previousOffset): Update for use of RefPtr for str.
        (khtml::RenderText::nextOffset): Ditto.
        (khtml::RenderText::RenderText): Ditto.
        (khtml::RenderText::originalString): Change to return PassRefPtr, even though
        it's not necessary at this level (since it's a virtual function).
        (khtml::RenderText::posOfChar): Update for use of RefPtr for str.
        (khtml::RenderText::setText): Ditto.
        (khtml::RenderTextFragment::RenderTextFragment): Ditto.
        (khtml::RenderTextFragment::originalString): Change to return PassRefPtr.

        * khtml/html/html_inlineimpl.cpp: Re-sorted list of includes, added newly-needed ones.
        * kwq/KWQRenderTreeDebug.cpp: Added new include needed since QPtrVector is no longer
        included by render_text.h.

2005-12-27  Darin Adler  <darin@apple.com>

        Fix suggested by Mitz.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6240
          REGRESSION: scrollbars in overflows don't work

        * khtml/xml/dom2_eventsimpl.cpp: (DOM::MouseRelatedEventImpl::computePositions):
        Remove the code to compute pageX/Y from clientX/Y, because clientX/Y are not passed
        in correctly (in fact, what's passed in is pageX/Y)! I accidentally included part
        of my fix for clientX/Y in the original patch.

2005-12-27  Maks Orlovich <maksim@kde.org>

        Reviewed and landed by Maciej.

        - fixed 4405: <button> not listed in form collections.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=4405

        Test: fast/forms/button-in-forms-collection.html

        * khtml/html/html_formimpl.h:
        (DOM::HTMLButtonElementImpl::isEnumeratable): override to return true

2005-12-25  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Geoff.

        - Remove WebFrame's parent frame pointer, instead rely on WebCore's parent concept
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6241

        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge parent]): New method, relies on the KHTMLPart's
        parent pointer.

2005-12-24  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by eseidel.
        
        Test: fast/forms/domstring-replace-crash.html

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6236
          REGRESSION: Crash in DOMString::replace() in ToT (12/24/05)

        * khtml/dom/dom_string.h:
        (DOMString::replace): Added check for null m_impl.

2005-12-24  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - replaced QPtrDict for Accessors structs with HashMap (also renamed some
        stray getSetInfo methods)
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6223

        * khtml/ecma/kjs_html.cpp:
        (KJS::HTMLElement::accessors):
        (KJS::HTMLElement::getValueProperty):
        (KJS::HTMLElement::putValueProperty):
        * khtml/ecma/kjs_html.h:

2005-12-24  Geoffrey Garen  <ggaren@apple.com>

        Reviewed by eric.

        http://bugzilla.opendarwin.org/show_bug.cgi?id=6231

        - Fixed assertion failure in QString::mid caused by my last checkin. 
        parseWindowFeatures() sometimes called QString::mid() with a start 
        index past the end of the string but a length of 0. There were two 
        problems there. (1) parseWindowFeatures() shouldn't have gotten past 
        the end of the string. (2) QString had range truncating code that was 
        borked. So I fixed both.

        * khtml/ecma/kjs_window.cpp:
        (KJS::parseWindowFeatures): One of the "past the end" tests was > 
        instead of >=.
        * kwq/KWQString.mm:
        (QString::mid): Truncate length *before* deciding whether to return 
        early. Also, compare start and data._length before computing 
        data._length - start, because the error case we're trying to catch 
        will almost certainly cause unsigned overflow.
        * manual-tests/window-open-features-parsing.html: Added trailing ',' 
        to uber-test to catch this failure, too.

2005-12-24  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Maciej.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6221
          REGRESSION: Password field is blank error for secure websites using
          password field (ToT, 12/24/05)

        * khtml/kwq/KWQSlot.mm:
        (KWQSlot::KWQSlot): Changed the parameter type of slotTextChanged to const DOMString &
        * khtml/rendering/render_form.h:
        * khtml/rendering/render_form.cpp:
        (RenderLineEdit::RenderLineEdit): ditto.
        (RenderLineEdit::slotTextChanged): ditto.
        (RenderFileButton::RenderFileButton): ditto.
        (RenderFileButton::slotTextChanged): ditto.

2005-12-22  Geoffrey Garen  <ggaren@apple.com>
    
        Reviewed by vicki (yay!), eric.

        - Fixed: <rdar://problem/4377597> parsing of window.open features strings needs to be more forgiving

        Manual test case: WebCore/manual-tests/window-open-features-parsing.html
        Also fixed: WebCore/manual-tests/window-open-features.html, which had an incorrect URL in it.

        This patch is long. Luckily, it's also complicated.

        The main thing I've done is to change our parsing of the window.open 'features' argument to match Win IE.
        This is important because we now implement the correct defaults for window.open, and resizing and
        scrolling are turned off by default. So, if we parse the 'features' string incorrectly, we'll end
        up with an annoying, incorrectly sized window that can't resize or scroll.

        To honor a long-standing request by Eric, I factored out the parsing into two new functions:
        parseWindowFeatures and constrainToScreen. I also added support for "innerWidth" and "innerHeight,"
        since they're just synonyms for "width" and "height."

        * khtml/ecma/kjs_window.cpp: removed "emit" statements, since emit is #defined as ""
        (KJS::parseDialogFeatures): renamed from parseFeatures, since we now have a 'parseWindowFeatures'.
        (KJS::showModalDialog): ditto on parseFeatures. Also added some missing initializations for WindowArgs data members.
        (KJS::parseWindowFeatures): new function, all new functionality.
        (KJS::constrainToScreen): new function, no new functionality -- just cut and pasted code that used to run as
        part of our parsing routine.
        (KJS::WindowFunc::callAsFunction):
        (1) Factored out previous parsing code.
        (2) Factored 17 lines of custom popup-blocking code into 3 lines that use pre-existing 'allowPopUp' function.
            Gratuitous, but it cried out to me.
        (3) Changed URL parsing to substitute "" for undefined *and* null values (we already did this for undefined),
            to avoid trying to navigate to 'http://null'.
        (4) Factore a multiline if () { if () {}} into an if ( && )
        (4) Removed the main body of code from a giant 'else' block by inserting early returns for the exceptional cases.
            This caused some things to show up in the diff even though they're just whitespace changes.
            I didn't actually change any code past the line "if (!str.isEmpty() && activePart)"
        * kwq/KWQKHTMLPartBrowserExtension.mm:
        (KHTMLPartBrowserExtension::createNewWindow): Added code to set toolbars to visible if toolBarVisible is true *or*
        locationBarVisible is true. The parser used to do this for us, but it's really the browser that's responsible for
        saying that the toolbar and the locationbar are the same thing. Hopefully, we can add a setLocationBarVisible delegate
        in the future so that other webkit clients can make their own UI decisions.
        * kwq/KWQKPartsBrowserExtension.h: Added locationBarVisible data member to WindowArgs structure and renamed
        toolBarsVisible to toolBarVisible (see above). Removed initialization code from WindowArgs structure because
        this file is for platform-specific code, and what defaults to use for window arguments is purely engine stuff.

2005-12-23  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Remove many use of .qstring()
        Convert several instances of QStrings to DOMStrings
        Add DOMString::replace(QChar, QChar)
        Remove (unused) KWQLabel, KWQKGlobal
        Slight performance improvement.
        Also fixed ChangeLog line endings from previous commit.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6138

        No tests needed, no functionality changes.

        * ChangeLog: Fixed line endings
        * ForwardingHeaders/kglobal.h: Removed.
        * ForwardingHeaders/qlabel.h: Removed.
        * WebCore.xcodeproj/project.pbxproj: removed KWQLabel
        * khtml/css/css_base.cpp:
        (CSSSelector::selectorText):
        * khtml/css/css_stylesheetimpl.cpp:
        (MediaListImpl::setMediaText):
        * khtml/css/cssstyleselector.cpp:
        (khtml::checkPseudoState):
        * khtml/dom/dom_string.h:
        (DOM::DOMString::replace):
        * khtml/ecma/kjs_css.cpp:
        (KJS::DOMCSSStyleDeclaration::put):
        * khtml/ecma/kjs_dom.cpp:
        (KJS::DOMNode::put):
        (KJS::DOMAttr::put):
        (KJS::DOMDocument::put):
        * khtml/ecma/kjs_events.cpp:
        (KJS::JSAbstractEventListener::handleEvent):
        * khtml/ecma/kjs_html.cpp:
        (KJS::KJS::HTMLDocument::put):
        (KJS::KJS::HTMLElementFunction::callAsFunction):
        (KJS::KJS::HTMLElement::put):
        (KJS::KJS::Context2DFunction::callAsFunction):
        (KJS::Context2D::putValueProperty):
        * khtml/ecma/kjs_proxy.cpp:
        (KJSProxyImpl::evaluate):
        * khtml/ecma/kjs_window.cpp:
        (KJS::Window::isSafeScript):
        (KJS::WindowFunc::callAsFunction):
        (KJS::ScheduledAction::execute):
        * khtml/ecma/xmlhttprequest.cpp:
        (KJS::XMLHttpRequest::send):
        (KJS::XMLHttpRequestProtoFunc::callAsFunction):
        * khtml/ecma/xmlhttprequest.h:
        * khtml/editing/jsediting.cpp:
        (DOM::JSEditor::queryCommandSupported):
        * khtml/editing/markup.cpp:
        (khtml::stringValueForRange):
        (khtml::startMarkup):
        * khtml/html/html_baseimpl.cpp:
        (HTMLBodyElementImpl::parseMappedAttribute):
        * khtml/html/html_elementimpl.cpp:
        (HTMLElementImpl::addHTMLAlignment):
        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLFormElementImpl::formData):
        (DOM::HTMLInputElementImpl::appendFormData):
        (DOM::HTMLTextAreaElementImpl::updateValue):
        * khtml/html/html_headimpl.cpp:
        (HTMLLinkElementImpl::parseMappedAttribute):
        * khtml/html/html_imageimpl.cpp:
        (DOM::HTMLImageElementImpl::parseMappedAttribute):
        * khtml/html/html_objectimpl.cpp:
        (DOM::HTMLObjectElementImpl::parseMappedAttribute):
        (DOM::HTMLParamElementImpl::isURLAttribute):
        * khtml/html/html_objectimpl.h:
        * khtml/html/html_tableimpl.cpp:
        (DOM::HTMLTableElementImpl::addChild):
        (DOM::HTMLTableElementImpl::parseMappedAttribute):
        (DOM::HTMLTablePartElementImpl::parseMappedAttribute):
        (DOM::HTMLTableSectionElementImpl::addChild):
        (DOM::HTMLTableRowElementImpl::addChild):
        * khtml/html/htmltokenizer.cpp:
        (khtml::HTMLTokenizer::parseTag):
        * khtml/khtml_part.cpp:
        (KHTMLPart::executeScript):
        (KHTMLPart::checkEmitLoadEvent):
        * khtml/misc/loader.cpp:
        (CachedObject::finish):
        (CachedCSSStyleSheet::checkNotify):
        (CachedXSLStyleSheet::checkNotify):
        (CachedXBLDocument::checkNotify):
        (DocLoader::requestImage):
        (DocLoader::requestStyleSheet):
        (DocLoader::requestScript):
        (Loader::servePendingRequests):
        (Loader::cancelRequests):
        * khtml/rendering/render_applet.cpp:
        * khtml/rendering/render_block.cpp:
        (khtml::RenderBlock::updateFirstLetter):
        * khtml/rendering/render_box.cpp:
        (RenderBox::~RenderBox):
        * khtml/rendering/render_form.cpp:
        (RenderFormElement::slotTextChanged):
        (RenderLineEdit::updateFromElement):
        (RenderTextArea::updateFromElement):
        (RenderTextArea::text):
        * khtml/rendering/render_form.h:
        * khtml/rendering/render_frames.cpp:
        (RenderPartObject::updateWidget):
        * khtml/rendering/render_line.cpp:
        (khtml::EllipsisBox::paint):
        * khtml/rendering/render_list.cpp:
        (RenderListItem::paint):
        (RenderListMarker::paint):
        * khtml/rendering/render_text.cpp:
        (khtml::RenderText::RenderText):
        (khtml::RenderText::position):
        * khtml/xml/dom_docimpl.cpp:
        (DOMImplementationImpl::hasFeature):
        (DocumentImpl::getElementByAccessKey):
        (DocumentImpl::recalcStyleSelector):
        (DocumentImpl::defaultEventHandler):
        * khtml/xml/dom_elementimpl.cpp:
        (ElementImpl::recalcStyle):
        * khtml/xml/dom_nodeimpl.cpp:
        (DOM::NodeImpl::dump):
        (DOM::appendAttributeDesc):
        (DOM::NodeImpl::showNode):
        * khtml/xml/dom_stringimpl.cpp:
        (DOM::DOMStringImpl::lower):
        * khtml/xml/xml_tokenizer.cpp:
        (khtml::XMLTokenizer::executeScripts):
        * khtml/xsl/xsl_stylesheetimpl.cpp:
        (DOM::XSLStyleSheetImpl::loadChildSheets):
        * kwq/KWQKHTMLPart.h:
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::documentViewForNode):
        (KWQKHTMLPart::runJavaScriptAlert):
        (KWQKHTMLPart::runJavaScriptConfirm):
        (KWQKHTMLPart::runJavaScriptPrompt):
        (KWQKHTMLPart::addMessageToConsole):
        (KWQKHTMLPart::passWheelEventToChildWidget):
        (KWQKHTMLPart::shouldDragAutoNode):
        (KWQKHTMLPart::snapshotDragImage):
        (convertAttributesToUnderlines):
        (KWQKHTMLPart::setMarkedTextRange):
        (KWQKHTMLPart::mousePressNode):
        * kwq/KWQKGlobal.h: Removed.
        * kwq/KWQKGlobal.mm: Removed.
        * kwq/KWQLabel.h: Removed.
        * kwq/KWQLabel.mm: Removed.
        * kwq/KWQLineEdit.h:
        * kwq/KWQLineEdit.mm:
        (QLineEdit::setText):
        (QLineEdit::text):
        (QLineEdit::setAutoSaveName):
        (QLineEdit::setPlaceholderString):
        * kwq/KWQPainter.mm:
        (QPainter::compositeOperatorFromString):
        * kwq/KWQSignal.h:
        * kwq/KWQSignal.mm:
        (KWQSignal::call):
        * kwq/KWQSlot.h:
        * kwq/KWQSlot.mm:
        (KWQSlot::call):
        * kwq/KWQString.h:
        * kwq/KWQString.mm:
        * kwq/KWQTextEdit.h:
        * kwq/KWQTextEdit.mm:
        (QTextEdit::setText):
        (QTextEdit::text):
        (QTextEdit::textWithHardLineBreaks):
        * ksvg2/scripts/cssmakeprops: removed kglobal.h
        * ksvg2/scripts/cssmakevalues: removed kglobal.h

2005-12-23  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Eric Seidel.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5924
          Zero-length responses to XMLHTTPRequest mishandled

        * khtml/ecma/xmlhttprequest.cpp (KJS::XMLHttpRequest::slotFinished):
          Make sure to fetch response headers and set the state to Loaded, if
          this hasn't been done already.

2005-12-23  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Eric Seidel.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=3565
          Posting data via XML HTTP Request doesnt work

        * khtml/ecma/xmlhttprequest.cpp:
        (KJS::XMLHttpRequest::send): Set application/xml as a default Content-Type;
          use a proper codec for request body if a charset is specified.
        (KJS::XMLHttpRequest::getRequestHeader): Use getSpecificHeader.
        (KJS::XMLHttpRequest::getResponseHeader): Ditto.
        (KJS::XMLHttpRequest::getSpecificHeader): Factored out code from getResponseHeader.
        (KJS::XMLHttpRequestProtoFunc::callAsFunction): Removed a FIXME (this is done in send() now).
        * khtml/ecma/xmlhttprequest.h:

2005-12-22  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Darin Adler.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6118
        Investigate not using the frameset charset as a default for frames

        * khtml/khtml_part.cpp (KHTMLPart::write):
        Do not use the parent frame encoding as a default for sub-frames (revert
        rdar://3100151). 

2005-12-22  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Eric.

        - made RefPtr<DOMStringImpl> usable as a hashtable key/value
        - changed XSLTProcessorImpl to make use of this instead of a QDict.
        - partially fixed broken param handling for xslt

        See LayoutTests for updated test case.

        * khtml/xml/dom_stringimpl.cpp:
        * khtml/xml/dom_stringimpl.h:
        (KXMLCore::): Set things up so you can use RefPtr<DOMStringImpl> as
        a hashtable key (should already be usable as a value).
        * khtml/xsl/xslt_processorimpl.cpp:
        (DOM::xsltParamArrayFromParameterMap): Updated to use a HashMap of RefPtrs instead
        of QDict. Also, fixed bugs that would have kept this from ever working at all.
        (DOM::XSLTProcessorImpl::transformToString): ditto
        (DOM::XSLTProcessorImpl::setParameter): ditto
        (DOM::XSLTProcessorImpl::getParameter): ditto
        (DOM::XSLTProcessorImpl::removeParameter): ditto
        * khtml/xsl/xslt_processorimpl.h:

2005-12-21  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        - update for new HashTranslator stuff

        * khtml/xml/dom_atomicstring.cpp:
        (DOM::CStringTranslator::hash):
        (DOM::CStringTranslator::equal):
        (DOM::CStringTranslator::translate):
        (DOM::AtomicString::equal):
        (DOM::AtomicString::add):
        (DOM::QCharBufferTranslator::hash):
        (DOM::QCharBufferTranslator::equal):
        (DOM::QCharBufferTranslator::translate):
        * khtml/xml/dom_qname.cpp:
        (DOM::QNameComponentsTranslator::hash):
        (DOM::QNameComponentsTranslator::equal):
        (DOM::QNameComponentsTranslator::translate):
        (DOM::QualifiedName::QualifiedName):

2005-12-22  Adele Peterson  <adele@apple.com>

        Reviewed by Darin.

        Cleaned up a previous checkin by defining global const defaultForm.

        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::radioButtonChecked):
        (DocumentImpl::checkedRadioButtonForGroup):
        (DocumentImpl::removeRadioButtonGroup):

2005-12-22  Adele Peterson  <adele@apple.com>

        Reviewed by Tim Hatcher.

        Fixed <rdar://problem/4387433> Seed: Radio buttons behave incorrectly in Gmail settings

        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLFormElementImpl::registerFormElement): update radio button hash map when moving form elements around.
        (DOM::HTMLGenericFormElementImpl::insertedIntoTree): ditto.
        * khtml/html/html_formimpl.h:
        (DOM::HTMLGenericFormElementImpl::isRadioButton): Added.
        (DOM::HTMLInputElementImpl::isRadioButton): Added.
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::radioButtonChecked): 
        Added comment explaining that we use 1 for the default form.  We can't use a null pointer as a key for the hash map.
        (DocumentImpl::checkedRadioButtonForGroup): Added conversion of null form pointer to 1.
        (DocumentImpl::removeRadioButtonGroup): ditto.

2005-12-22  Anders Carlsson  <andersca@mac.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6196
        Would like to be able to define prototypes in headers

        * khtml/ecma/XSLTProcessor.cpp:
        * khtml/ecma/domparser.cpp:
        * khtml/ecma/kjs_css.cpp:
        * khtml/ecma/kjs_dom.cpp:
        * khtml/ecma/kjs_events.cpp:
        * khtml/ecma/kjs_html.cpp:
        * khtml/ecma/kjs_range.cpp:
        * khtml/ecma/kjs_traversal.cpp:
        * khtml/ecma/kjs_views.cpp:
        * khtml/ecma/xmlhttprequest.cpp:
        * khtml/ecma/xmlserializer.cpp:
        Update for changes to JSC.

2005-12-22  Darin Adler  <darin@apple.com>

        Reviewed by Geoff.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6198
          use RefPtr a few places in RenderText and related classes

        * khtml/html/htmlparser.cpp:
        (HTMLParser::parseToken): Use get since text pointer is RefPtr now.
        (HTMLParser::textCreateErrorCheck): Ditto.
        (HTMLParser::commentCreateErrorCheck): Ditto.
        (HTMLParser::handleIsindex): Get rid of explicit deref, no longer needed.

        * khtml/html/htmltokenizer.h: Make attrs and text fields of Token use
        RefPtr. Also stop using bit fields for the flags in Token -- there's no
        evidence this makes things faster.
        * khtml/html/htmltokenizer.cpp:
        (khtml::Token::addAttribute): Get rid of explicit ref, no longer needed.
        (khtml::HTMLTokenizer::processToken): Ditto.

        * khtml/rendering/render_block.cpp: (khtml::RenderBlock::updateFirstLetter):
        Use a PassRefPtr.

        * khtml/rendering/render_text.cpp:
        (khtml::RenderText::previousOffset): Use get since str pointer is RefPtr now.
        (khtml::RenderText::nextOffset): Ditto.
        (khtml::RenderText::RenderText): Get rid of explicit ref, no longer needed.
        Change to use initializer syntax instead of assignment.
        (khtml::RenderText::setStyle): Use PassRefPtr.
        (khtml::RenderText::originalString): Ditto.
        (khtml::RenderText::setText): Get rid of explicit ref, no longer needed.
        (khtml::RenderTextFragment::RenderTextFragment): Get rid of explicit ref,
        no longer needed.
        (khtml::RenderTextFragment::originalString): Use PassRefPtr.

        * khtml/rendering/render_text.h: Change SOFT_HYPEN to be a constant rather than
        a preprocessor macro. Used PassRefPtr in a couple places. Made RenderText's str
        and RenderTextFragment's m_generatedContentStr be RefPtr.

        * khtml/html/html_inlineimpl.cpp: Add a newly-needed include, sort them.
        * kwq/KWQRenderTreeDebug.cpp: Add a newly-needed include.

2005-12-22  Darin Adler  <darin@apple.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6193
          remove some unused KWQ code

        * kcanvas/KCanvasCreator.cpp: (KCanvasCreator::self): Don't use static deleter for
        two reasons: (1) We don't want any globals with constructors in any of our frameworks
        because they slow down framework load time. (2) There's no need to destroy this object at
        process termination time -- it's extra work with no benefit. Because of both these
        reasons, our KStaticDeleter implementation was basically a no-op.
        * ksvg2/svg/SVGDOMImplementationImpl.cpp: (SVGDOMImplementationImpl::self): Ditto.
        * khtml/xml/dom_docimpl.cpp: (DocumentImpl::setDocumentChanged): Ditto.

        * khtml/html/html_canvasimpl.cpp: Removed include of kstringhandler.h.
        * khtml/html/html_imageimpl.cpp: Ditto.

        * khtml/khtmlpart_p.h: Removed something that was in an "APPLE_CANGES" ifdef.

        * ForwardingHeaders/kstaticdeleter.h: Removed.
        * ForwardingHeaders/kstringhandler.h: Removed.
        * kwq/KWQKStaticDeleter.h: Removed.
        * kwq/KWQKStringHandler.h: Removed.
        * kwq/KWQKStringHandler.mm: Removed.

        * WebCore.xcodeproj/project.pbxproj: Removed files.

2005-12-22  Darin Adler  <darin@apple.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6192
          add support for non-standard &nsup; entity (implemented in other browsers)

        * khtml/html/kentities.gperf: Add "nsup" to table.
        * khtml/html/htmltokenizer.cpp: Removed old workaround for inlining issue that no
        longer seems to be necessary; also touches the file which is important because
        Xcode doesn't seem to understand the dependency on kentities.gperf and the need
        to recompile.

2005-12-22  Darin Adler  <darin@apple.com>

        Reviewed by Eric.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6167
          RenderStyle default constructor should initialize its members for speed

        * khtml/rendering/DataRef.h: (khtml::DataRef::operator=): Eliminate an extra
        branch by doing ref before deref instead of == check.

        * khtml/rendering/render_style.cpp:
        (khtml::initDefaultStyle): Added. Function to initialize the default style
        for use in constructor.
        (khtml::RenderStyle::RenderStyle): Changed constructor to initalize all the
        members with constructor syntax instead of using assignment on all of them.
        * khtml/rendering/render_style.h: Removed static data member _default --
        it's now a file scope global instead.

2005-12-21  Darin Adler  <darin@apple.com>

        Reviewed by Justin.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6142
          intermittent failures in some paste tests

        * khtml/editing/apply_style_command.cpp:
        (khtml::ApplyStyleCommand::applyBlockStyle): Call new updateLayout member function.
        (khtml::ApplyStyleCommand::applyInlineStyle): Ditto.
        (khtml::ApplyStyleCommand::pushDownTextDecorationStyleAtBoundaries): Ditto.
        * khtml/editing/composite_edit_command.cpp:
        (khtml::CompositeEditCommand::addBlockPlaceholderIfNeeded): Ditto.
        (khtml::CompositeEditCommand::findBlockPlaceholder): Ditto.
        (khtml::CompositeEditCommand::moveParagraphContentsToNewBlockIfNecessary): Ditto.
        * khtml/editing/delete_selection_command.cpp:
        (khtml::DeleteSelectionCommand::fixupWhitespace): Ditto.
        (khtml::DeleteSelectionCommand::moveNodesAfterNode): Ditto.
        * khtml/editing/edit_command.cpp:
        (khtml::EditCommand::apply): Ditto.
        (khtml::EditCommand::unapply): Ditto.
        (khtml::EditCommand::reapply): Ditto.
        (khtml::EditCommand::updateLayout): Added. Calls updateLayoutIgnorePendingStylesheets
        on the document.
        * khtml/editing/edit_command.h: Added updateLayout member function.
        * khtml/editing/insert_line_break_command.cpp:
        (khtml::InsertLineBreakCommand::doApply): Call new updateLayout member function.
        * khtml/editing/insert_paragraph_separator_command.cpp:
        (khtml::InsertParagraphSeparatorCommand::doApply): Ditto.
        * khtml/editing/jsediting.cpp:
        (DOM::JSEditor::execCommand): Call updateLayoutIgnorePendingStylesheets instead of updateLayout.
        (DOM::JSEditor::queryCommandEnabled): Ditto.
        (DOM::JSEditor::queryCommandIndeterm): Ditto.
        (DOM::JSEditor::queryCommandState): Ditto.
        (DOM::JSEditor::queryCommandValue): Ditto.
        * khtml/editing/markup.cpp: (khtml::createMarkup): Ditto.
        * khtml/editing/replace_selection_command.cpp:
        (khtml::ReplacementFragment::insertFragmentForTestRendering): Ditto.
        (khtml::ReplaceSelectionCommand::fixupNodeStyles): Call new updateLayout member function.
        (khtml::ReplacementFragment::computeStylesUsingTestRendering): Call
        updateLayoutIgnorePendingStylesheets instead of updateLayout.
        (khtml::ReplaceSelectionCommand::doApply): Call new updateLayout member function.
        (khtml::ReplaceSelectionCommand::removeLinePlaceholderIfNeeded): Ditto.
        (khtml::ReplaceSelectionCommand::completeHTMLReplacement): Ditto.
        * khtml/editing/visible_units.cpp:
        (khtml::previousLinePosition): Call updateLayoutIgnorePendingStylesheets instead of updateLayout.
        (khtml::nextLinePosition): Ditto.
        * khtml/html/html_elementimpl.cpp:
        (HTMLElementImpl::innerText): Ditto.
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge setSelectedDOMRange:affinity:closeTyping:]): Ditto.
        (-[WebCoreBridge smartDeleteRangeForProposedRange:]): Ditto.

2005-12-21  Darin Adler  <darin@apple.com>

        Reviewed by Geoff.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6177
          move event code from JavaScript binding into DOM implementation

        * khtml/ecma/kjs_events.cpp:
        (KJS::DOMMouseEvent::getValueProperty): Change everything to just call through instead of doing
        the work here.
        (KJS::DOMWheelEvent::getValueProperty): Ditto.

        * khtml/xml/dom2_eventsimpl.h:
        (DOM::MouseRelatedEventImpl::offsetX):
        (DOM::MouseRelatedEventImpl::offsetY):
        * khtml/xml/dom2_eventsimpl.cpp:
        (DOM::MouseRelatedEventImpl::MouseRelatedEventImpl): Initialize new m_pageX, m_pageY, m_layerX,
        m_layerY, m_offsetX, and m_offsetY.
        (DOM::MouseRelatedEventImpl::computePositions): Renamed from computeLayerPos since it handles
        page position andoffset position too now.
        (DOM::MouseRelatedEventImpl::pageX): Added. Not in header since it's virtual.
        (DOM::MouseRelatedEventImpl::pageY): Ditto.
        (DOM::MouseRelatedEventImpl::x): Added, with FIXME since it should change eventually.
        (DOM::MouseRelatedEventImpl::y): Ditto.
        (DOM::MouseEventImpl::initMouseEvent): Call computePositions instead of computeLayerPos.
        (DOM::MouseEventImpl::toElement): Added.
        (DOM::MouseEventImpl::fromElement): Added.

2005-12-21  Timothy Hatcher  <timothy@apple.com>

        * WebCore.xcodeproj/project.pbxproj:
          Set tab width to 8, indent width to 4 and uses tabs to false per file.

2005-12-21  John Sullivan  <sullivan@apple.com>

        Reviewed by Tim Omernick and Darin Adler.
        
        - fixed HiDPI problem with forms auto-fill menu width

        No test cases added; this code is used for "chrome" only.

        * kwq/DOMHTML.mm:
        (-[DOMHTMLInputElement _rectOnScreen]):
        convert entire rect to window coordinates, not just origin

2005-12-21  David Harrison  <harrison@apple.com>

        Reviewed by Justin.

        <rdar://problem/4039777> Pasting particular snippet of HTML containing list items and a link creates too many list items
        - Fixed paste crash by making calling RenderBox::deleteLineBoxWrapper() from RenderObject::remove(),
        so that the connection is broken before the InlineBox's parent gets deleted.
        - Fixed overzealous style changes when setting the style on a specific range of elements.  These specific
        ranges are derived programmatically, e.g. as a part of pasting, so they must be respected exactly rather
        than modified by converting the endpoints to VisiblePositions.
        
        Test cases coming soon.

        * khtml/editing/apply_style_command.cpp:
        (khtml::ApplyStyleCommand::ApplyStyleCommand):
        (khtml::ApplyStyleCommand::updateStartEnd):
        (khtml::ApplyStyleCommand::startPosition):
        (khtml::ApplyStyleCommand::endPosition):
        (khtml::ApplyStyleCommand::applyBlockStyle):
        (khtml::ApplyStyleCommand::applyRelativeFontStyleChange):
        (khtml::ApplyStyleCommand::applyInlineStyle):
        (khtml::ApplyStyleCommand::removeInlineStyle):
        (khtml::ApplyStyleCommand::splitTextAtStartIfNeeded):
        (khtml::ApplyStyleCommand::splitTextAtEndIfNeeded):
        (khtml::ApplyStyleCommand::splitTextElementAtStartIfNeeded):
        (khtml::ApplyStyleCommand::splitTextElementAtEndIfNeeded):
        (khtml::ApplyStyleCommand::mergeStartWithPreviousIfIdentical):
        (khtml::ApplyStyleCommand::mergeEndWithNextIfIdentical):
        (khtml::ApplyStyleCommand::joinChildTextNodes):
        * khtml/editing/apply_style_command.h:
        * khtml/editing/composite_edit_command.cpp:
        (khtml::CompositeEditCommand::applyStyle):
        * khtml/editing/composite_edit_command.h:
        * khtml/editing/insert_line_break_command.cpp:
        (khtml::InsertLineBreakCommand::doApply):
        * khtml/editing/replace_selection_command.cpp:
        (khtml::ReplaceSelectionCommand::fixupNodeStyles):
        (khtml::ReplaceSelectionCommand::completeHTMLReplacement):
        * khtml/rendering/render_box.cpp:
        (RenderBox::destroy):
        (RenderBox::deleteLineBoxWrapper):
        * khtml/rendering/render_box.h:
        * khtml/rendering/render_list.cpp:
        (RenderListMarker::~RenderListMarker):
        (RenderListMarker::setStyle):
        * khtml/rendering/render_object.cpp:
        (RenderObject::remove):
        * khtml/rendering/render_object.h:
        * khtml/rendering/render_replaced.cpp:
        (RenderWidget::destroy):

2005-12-20  Adele Peterson  <adele@apple.com>

        Reviewed by Darin.

        Fixed http://bugzilla.opendarwin.org/show_bug.cgi?id=5911
        REGRESSION: Page scroll position jumps when clicking on word in editable div

        I moved the scrolling code out of setFocusNode, and consolidated some of the focus code to scroll when necessary.

        * khtml/html/html_formimpl.cpp: Removed HTMLButtonElementImpl::blur, HTMLButtonElementImpl::focus, HTMLInputElementImpl::blur, HTMLInputElementImpl::focus.  
        New code in ElementImpl::focus will now handle these cases.  This allows tabbing through the elements to go through the same code path as calling focus() on an element.  
        Before, focus() would scroll to reveal for any form elements that had a RenderWidget, but wouldn't scroll for anchor elements, or any of the new form elements.  
        Now the behavior will be more consistent.
        (DOM::HTMLLabelElementImpl::focus): calls ElementImpl::focus.
        (DOM::HTMLLegendElementImpl::focus): ditto.
        * khtml/html/html_formimpl.h:
        * khtml/khtml_part.cpp:
        (KHTMLPart::selectAll): calls new function selectContentsOfNode
        (KHTMLPart::selectContentsOfNode): factored out code to selectAll for a particular node- which is useful for contenteditable elements.
        * khtml/khtml_part.h: added selectContentsOfNode
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::setFocusNode): removed scrolling code.
        * khtml/xml/dom_elementimpl.cpp:
        (ElementImpl::focus): Calls updateLayout in case focus() is called before there's a renderer.
        Makes a selection for editable elements (right now we select all, but this will change).
        Doesn't scroll if the renderer is a RenderWidget, since that is handled when the view becomes first responder.  This will go away when we convert the rest of our form elements.
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::revealSelection): Made this more like centerSelectionInVisibleArea  where we get the right rectangle if the selection is a caret.
        (KWQKHTMLPart::nextKeyViewInFrame): call ElementImpl::focus() for the node.  This will set the selection too, which used to be done here.

2005-12-20  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by justin
        
        <http://bugzilla.opendarwin.org/show_bug.cgi?id=4682>
        -[WebHTMLView firstRectForCharacterRange:] is using _selectedRange instead of the given range if no marked text

        Added layout tests:
        * editing/input/firstrectforcharacterrange-styled
        * editing/input/firstrectforcharacterrange-plain

        * khtml/editing/visible_text.cpp:
        (khtml::TextIterator::rangeFromLocationAndLength): 
        Return null if the range isn't found, instead of a startless/endless 
        range.  Set the end if the requested location+length is out of bounds.
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge convertToDOMRange:]): Handle larged unsigned values 
        before calling rangeWithLocationAndLength, which expects signed ints.

2005-12-20  Adele Peterson  <adele@apple.com>

        Reviewed by Darin.

        Fix for <rdar://problem/4387630> REGRESSION: <select> element's onClick event doesn't fire @ bugweb.apple.com

        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::passSubframeEventToSubframe): only pass mouse down for khtmlviews.

2005-12-20  Justin Garcia  <justin.garcia@apple.com>

        Reviewed by eric, thatcher
        
        <rdar://problem/4172984> KWQExceptions needs to use @try/@catch instead of relying on NSException.h internals
        
        Needed to undef try/catch because of 4333439.  Moved the 
        declarations of variables that are returned from within a @try 
        block outside the @try block (because of "might be clobbered by 
        a longjmp or vfork" warnings).  Moved some return statements
        inside the @try block to fix volatilization errors with gcc4.

        * WebCore.xcodeproj/project.pbxproj:
        * WebCorePrefix.h:
        * kcanvas/device/quartz/KCanvasFilterQuartz.mm:
        (KCanvasFEBlendQuartz::getCIFilter):
        (KCanvasFEColorMatrixQuartz::getCIFilter):
        (KCanvasFECompositeQuartz::getCIFilter):
        (getPointLightVectors):
        (getLightVectors):
        (getNormalMap):
        (KCanvasFEDiffuseLightingQuartz::getCIFilter):
        (KCanvasFEFloodQuartz::getCIFilter):
        (KCanvasFEImageQuartz::getCIFilter):
        (KCanvasFEMergeQuartz::getCIFilter):
        (KCanvasFESpecularLightingQuartz::getCIFilter):
        * kwq/KWQExceptions.h:
        * kwq/KWQExceptions.mm:
        (KWQReportBlockedException):
        * kwq/KWQFileButton.mm:
        (KWQFileButton::sizeForCharacterWidth):
        (KWQFileButton::frameGeometry):
        * kwq/KWQKCursor.mm:
        (+[NSCursor _WebCore_cursorWithName:hotSpot:_WebCore_cursorWithName:hotSpot:]):
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::createPart):
        (KWQKHTMLPart::nextKeyView):
        (KWQKHTMLPart::runJavaScriptPrompt):
        (KWQKHTMLPart::keyEvent):
        (KWQKHTMLPart::sendContextMenuEvent):
        (KWQKHTMLPart::fileWrapperForElement):
        (KWQKHTMLPart::attributedString):
        (KWQKHTMLPart::imageFromRect):
        * kwq/KWQKHTMLPartBrowserExtension.mm:
        * kwq/KWQLineEdit.mm:
        (QLineEdit::sizeForCharacterWidth):
        * kwq/KWQListBox.mm:
        (QListBox::sizeForNumberOfLines):
        * kwq/KWQLoader.mm:
        (KWQCheckCacheObjectStatus):
        * kwq/KWQWidget.mm:
        (QWidget::frameGeometry):
        (QWidget::mapFromGlobal):

2005-12-20  David Harrison  <harrison@apple.com>

        <rdar://problem/4294417> Cannot un-italicize some text after triple clicking it

        Reviewed by Justin.

        * khtml/editing/apply_style_command.cpp:
        (khtml::ApplyStyleCommand::addInlineStyleIfNeeded):
        Removed check for tab span because ApplyStyleCommand::removeCSSStyle() already makes the same check.

2005-12-20  Justin Garcia  <justin.garcia@apple.com>

        <rdar://problem/4387270> editing/deleting/delete-3800834-fix failing
        <http://bugzilla.opendarwin.org/show_bug.cgi?id=6160> REGRESSION: Crash when running editing/deleting/delete-3800834-fix.html
        <http://bugzilla.opendarwin.org/show_bug.cgi?id=6161> REGRESSION: crash when pressing tab in editable WebHTMLView

        Reviewed by darin
    
        Some callers call setAttribute on a floating element.  So, using 
        a RefPtr for the element inside addAttribute can destroy
        it.

        * khtml/xml/dom_elementimpl.cpp:
        (NamedAttrMapImpl::addAttribute):

2005-12-20  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        - fixed leak in createAttributeMap
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6162

        * khtml/xml/dom_elementimpl.cpp:
        (StyledElementImpl::createAttributeMap): the new attribute map
        is going in a RefPtr, don't also ref it manually.

2005-12-20  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        - change an assignment to a contructor declaration to build with PassRefPtr
        leak fix changes

        * ksvg2/svg/SVGTransformableImpl.cpp:
        (SVGTransformableImpl::parseTransformAttribute):

2005-12-20  Geoffrey Garen  <ggaren@apple.com>

        Reviewed by John.

        Fixed <rdar://problem/4310363> JavaScript window.open: Height is 1 
        pixel short, and related bugs.

        There were a few bugs here.
        (1) Our code took size arguments and applied them to the window's
            content rect. That's incorrect. The Rhino book says the arguments 
            should apply to the WebView. Other things that occupy the content 
            rect include the tab bar, the status bar, and the 1 pixel border 
            between brushed metal and document. All of these used to impinge 
            on the web page's display area.

            The fix is to calculate sizing based on the WebView instead of
            the content rect. This means that the webViewContentRect and 
            setContentRect delegate methods are obsolete and no longer called
            by any of our code. (setContentRect was never called in the 
            first place.)

        (2) None of our sizing accounted for scaled resolutions.

            The fix is to ask the WebView to scale all coordintes for us.

        (3) Our code assumed that all window accoutrements were on by default.
            Safari works that way, but other WebKit clients might not.

            The fix is always to explicitly set an on/off state.
        
        (a) To facilitate scaling, I added a new bridge method, webView, to 
        access the webView.

        (b) For internal consistency, I changed ___Bars to ___bars in bridge 
        methods, and ___bars to ___Bars in WinArgs data members. (Interestingly,
        the different classes in our code are evenly divided on which format to 
        use.)
        
        Added manual test:
        * manual-tests/window-open-features.html: Added.
        * manual-tests/resources/200x200.png: Added.
        * manual-tests/resources/popup200x200.html: Added.

        * khtml/ecma/kjs_window.cpp:
        (KJS::showModalDialog): see (b)
        (KJS::WindowFunc::callAsFunction): see (b)
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPart::statusbarVisible): see (b)
        * kwq/KWQKHTMLPartBrowserExtension.mm:
        (KHTMLPartBrowserExtension::createNewWindow):
        At the top of this method, I just did some formatting cleanup and
        moved the 'referrer' variable closer to where it's used.
        The changes in the middle of the method are (3), the bottom, (2).
        * kwq/KWQKPartsBrowserExtension.h:
        (KParts::WindowArgs::WindowArgs): see (b)
        * kwq/WebCoreBridge.h: see (a)

2005-12-20  Eric Seidel  <eseidel@apple.com>

        Reviewed by mjs.

        Leaks when running SVG tests
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6156
        No additional tests necessary, leaks already caught by other tests.

        * kcanvas/KCanvasFilters.cpp:
        (KCanvasFEDiffuseLighting::setLightSource): takes ownership
        (KCanvasFESpecularLighting::setLightSource): takes ownership
        * kcanvas/KCanvasFilters.h:
        (KCanvasFEDiffuseLighting::KCanvasFEDiffuseLighting): added
        (KCanvasFEDiffuseLighting::~KCanvasFEDiffuseLighting): added
        (KCanvasFEDiffuseLighting::lightSource): fixed spacing
        (KCanvasFESpecularLighting::KCanvasFESpecularLighting): added
        (KCanvasFESpecularLighting::~KCanvasFESpecularLighting): added
        (KCanvasFESpecularLighting::lightSource): fixed spacing
        * kcanvas/device/quartz/KRenderingDeviceQuartz.mm:
        (KRenderingDeviceQuartz::stringForPath): added missing CFRelease

2005-12-20  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        Remove additional bit-rotted DEBUG* ifdefs from WebCore.
        This removes PARSER_DEBUG, FORMS_DEBUG and CSS_STYLESHEET_DEBUG.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=5931
        No tests possible, only removing dead code.

        * khtml/css/css_stylesheetimpl.cpp:
        (CSSStyleSheetImpl::parseString):
        (CSSStyleSheetImpl::isLoading):
        * khtml/html/html_formimpl.cpp:
        (DOM::HTMLFormElementImpl::formData):
        (DOM::HTMLFormElementImpl::submit):
        (DOM::HTMLFormElementImpl::reset):
        (DOM::HTMLGenericFormElementImpl::getForm):
        * khtml/html/htmlparser.cpp:
        (HTMLParser::processCloseTag):
        (HTMLParser::createHead):

2005-12-20  Eric Seidel  <eseidel@apple.com>

        Reviewed by darin.

        Move Decoder onto Shared<T> and clients onto RefPtr.
        http://bugzilla.opendarwin.org/show_bug.cgi?id=6107
        No test cases possible, no functional changes.

        * khtml/ecma/XSLTProcessor.cpp:
        (KJS::XSLTProcessorProtoFunc::callAsFunction):
        * khtml/ecma/xmlhttprequest.cpp:
        (KJS::XMLHttpRequest::XMLHttpRequest):
        (KJS::XMLHttpRequest::~XMLHttpRequest):
        (KJS::XMLHttpRequest::changeState):
        (KJS::XMLHttpRequest::abort):
        (KJS::XMLHttpRequest::slotFinished):
        (KJS::XMLHttpRequest::slotData):
        * khtml/ecma/xmlhttprequest.h:
        * khtml/khtml_part.cpp:
        (KHTMLPart::clear):
        (KHTMLPart::begin):
        (KHTMLPart::write):
        * khtml/khtmlpart_p.h:
        (KHTMLPartPrivate::KHTMLPartPrivate):
        * khtml/misc/decoder.cpp:
        (Decoder::Decoder):
        (Decoder::~Decoder):
        * khtml/misc/decoder.h:
        * khtml/misc/loader.h:
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::DocumentImpl):
        (DocumentImpl::~DocumentImpl):
        (DocumentImpl::prepareMouseEvent):
        (DocumentImpl::setDecoder):
        * khtml/xml/dom_docimpl.h:
        (DOM::DocumentImpl::decoder):
        * khtml/xsl/xslt_processorimpl.cpp:
        (DOM::XSLTProcessorImpl::createDocumentFromSource):

2005-12-19  Darin Adler  <darin@apple.com>

        Reviewed by Maciej.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6143
          DOM::ElementImpl should use a RefPtr for the attribute map

        * khtml/xml/dom_elementimpl.cpp:
        (ElementImpl::ElementImpl): Remove code to initialize the pointer; not needed since
        RefPtr gets initialized to 0.
        (ElementImpl::~ElementImpl): Remove code to deref the pointer; RefPtr handles that.
        (ElementImpl::attributes): Add get() call to get raw pointer.
        (ElementImpl::setAttributeMap): Remove code to deref the old map and set the new map.
        But added code to clear the element pointer from the old map (missing in the old
        version). Also added a FIXME.
        (ElementImpl::createAttributeMap): Remove ref(); RefPtr handles that.
        (NamedAttrMapImpl::addAttribute): Use a RefPtr to guarantee the element does not go
        away in the middle of dispatching DOM events.
        (StyledElementImpl::attributeChanged): Clean up code by using the inline function
        mappedAttributes() instead of doing type casts.
        (StyledElementImpl::parseMappedAttribute): Ditto.
        (StyledElementImpl::getClassList): Ditto.

        * khtml/xml/dom_elementimpl.h: Make ElementImpl::namedAttrMap be a RefPtr instead
        of raw pointer. Added an overload of StyledElementImpl::mappedAttributes for both
        const and non-const.

        * khtml/xml/dom_nodeimpl.cpp: (DOM::NodeImpl::addChild): Use a RefPtr to ref/deref
        the child so that it doesn't leak.

        * khtml/html/htmlparser.h: Changed isindex to use a RefPtr.
        * khtml/html/htmlparser.cpp:
        (HTMLParser::~HTMLParser): Removed now-unneeded ref.
        (HTMLParser::isindexCreateErrorCheck): Remove now-unneeded deref/ref.
        (HTMLParser::handleIsindex): Put isindex element into a RefPtr. This prevents a
        crash that was otherwise happening during layout tests (caused indirectly by
        the changes above).
        (HTMLParser::startBody): Added call to get().

2005-12-19  Darin Adler  <darin@apple.com>

        Reviewed by Geoff Garen and Eric Seidel.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=4923
          stop using <ostream> in WebCore, eliminating the <cmath> troubles it causes

        * ForwardingHeaders/kxmlcore/AlwaysInline.h: Added.
        * WebCorePrefix.h: Removed the use of <ostream>.

        * kwq/KWQDef.h: Removed now-unused Q_INT64, Q_INT16, Q_UINT16, qRound, and _KWQ_IOSTREAM_.

        * kwq/KWQKHTMLPart.h: Removed some unneeded headers and added forward-declarations of classes
        instead. Corrected some incorrect member function declarations.
        * kwq/KWQKHTMLPart.mm: Added a now-needed header.

        * khtml/ecma/kjs_window.cpp: Removed the <cmath> workaround.
        * khtml/rendering/bidi.cpp: Added include of AlwaysInline.h and removed a
        lot of unnecessary includes.
        * khtml/rendering/render_canvasimage.cpp: Removed the <cmath> workaround.
        * khtml/rendering/render_image.cpp: Removed the <cmath> workaround.
        * khtml/rendering/render_text.cpp: Added include of AlwaysInline.h and removed a
        lot of unnecessary includes.

        * ksvg2/css/SVGCSSStyleSelector.cpp: (KDOM::CSSStyleSelector::applySVGProperty):
        * ksvg2/svg/SVGAnimateColorElementImpl.cpp: (SVGAnimateColorElementImpl::calculateColor):
        * ksvg2/svg/SVGAnimateTransformElementImpl.cpp: (SVGAnimateTransformElementImpl::handleTimerEvent):
        * ksvg2/svg/SVGAnimationElementImpl.cpp: (SVGAnimationElementImpl::closeRenderer):
        * ksvg2/svg/SVGLinearGradientElementImpl.cpp: (SVGLinearGradientElementImpl::buildGradient):
        * ksvg2/svg/SVGPatternElementImpl.cpp: (SVGPatternElementImpl::notifyAttributeChange):
        * ksvg2/svg/SVGRadialGradientElementImpl.cpp: (SVGRadialGradientElementImpl::buildGradient):
        Replaced use of qRound with use of lroundf or lround as appropriate.

        * kwq/KWQCString.h:
        * kwq/KWQCString.mm:
        * kwq/KWQDateTime.h:
        * kwq/KWQDateTime.mm:
        * kwq/KWQMap.h:
        * kwq/KWQMemArray.h:
        * kwq/KWQPoint.mm:
        * kwq/KWQPointArray.h:
        * kwq/KWQPtrList.h:
        * kwq/KWQPtrStack.h:
        * kwq/KWQPtrVector.h:
        * kwq/KWQRect.h:
        * kwq/KWQRect.mm:
        * kwq/KWQSize.h:
        * kwq/KWQSize.mm:
        * kwq/KWQValueList.h:
        Removed _KWQ_IOSTREAM_ code that was used at one time for unit tests, but is now unneeded,
        and requires <ostream>.

2005-12-19  Darin Adler  <darin@apple.com>

        Reviewed by Geoff Garen and John Sullivan.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=4312
          XMLHttpRequest headers that have two CRLF sequences lead to Obj-C exception

        I found this by code inspection after examining a security report about
        vulnerabilities in other browsers' XMLHttpRequest implementations.

        * kwq/KWQLoader.mm:
        (+[NSDictionary _webcore_dictionaryWithHeaderString:_webcore_dictionaryWithHeaderString:]):
        Check length of string before calling characterAtIndex:0 since it will fail for an empty string.

2005-12-19  Mitz Pettel  <opendarwin.org@mitzpettel.com>

        Reviewed by Beth

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=6149
          REGRESSION (WebCore-417.5): horizontal scrollbar in overflow with top
          border doesn't receive mouse events

        * khtml/rendering/render_block.cpp:
        (khtml::RenderBlock::isPointInScrollbar):
        Removed borderTop() from horizontal scrollbar rect computation.
        * manual-tests/scrollbar-hittest2.html: Added.

2005-12-19  Alexey Proskuryakov  <ap@nypop.com>

        Reviewed by Darin, committed by Adele.

        - fix http://bugzilla.opendarwin.org/show_bug.cgi?id=5744
          XMLHttpRequest does not apply page encoding after assigning via innerHtml

        * khtml/ecma/xmlhttprequest.cpp:
        (getMIMEType): A helper function to get MIME type from a Content-Type string.
        (getCharset): A helper function to get charset from a Content-Type string.
        (KJS::XMLHttpRequest::getValueProperty): Factored out responseIsXML().
        (KJS::XMLHttpRequest::getResponseHeader): Return QString instead of JSValue
          (to get rid of unnecessary JSLocks).
        (KJS::XMLHttpRequest::responseIsXML): A new method that analyses Content-Type.
        (KJS::XMLHttpRequest::slotData): Use a correct charset for responses, see bug for details.
        (KJS::XMLHttpRequestProtoFunc::callAsFunction): Update for getResponseHeader() changes
        * khtml/ecma/xmlhttprequest.h:

== Rolled over to ChangeLog-2005-12-19 ==
