#======================================================================
#
# Makefile
#
# $RCSfile$
# $Revision$
# $Author$
# $Date$
#
#======================================================================
# set top source dir relative to this directory
# include make vars boilerplate
#

TOPSRCDIR = ../../../../..
include $(TOPSRCDIR)/Makefile.vars

#----------------------------------------------------------------------
# Set variables for this directory

SOURCES = $(wildcard *.cpp)
HEADERS = $(wildcard *.h)
ALLOBJECTS = $(patsubst %.cpp,%.o,$(wildcard *.cpp))
SKIPOBJECTS = javaembed.o
CXXOBJECTS = $(filter-out $(SKIPOBJECTS),$(ALLOBJECTS))

EXPORT_HEADERS = $(HEADERS)

OBJECTS = $(CXXOBJECTS) 
EXPORT_OBJECTS = $(CXXOBJECTS)

EXPORT_HEADERS_DIR = $(TOPSRCDIR)/WebCore/include/private
EXPORT_OBJECTS_DIR = $(TOPSRCDIR)/WebCore/lib

LIBRARY = libkhtmljava.a

CLEAN_FILES = $(OBJECTS) \
	$(LIBRARY) \
	*.moc \
	$(NULL)

#----------------------------------------------------------------------
# Set flags for this directory

# FIXME: Need a hack here to give the xml tokenizer text stream
# defines from Qt. The NEED_BOGUS_TEXTSTREAMS symbol
# can be removed when we have Qt text streams implemented
CXXFLAGS = $(BASECXXFLAGS) \
	-DNEED_BOGUS_TEXTSTREAMS \
	-DNEED_BOGUS_X_DEFINES \
	-I$(TOPSRCDIR)/WebCore/src/kwq \
        -I$(TOPSRCDIR)/WebCore/src/kwq/kde \
        -I$(TOPSRCDIR)/WebCore/src/kwq/qt \
        -I$(TOPSRCDIR)/WebCore/src/kwq/kdecore \
        -I.. \
        -I. \
        $(NULL)

DEPFLAGS = $(CXXFLAGS)

#----------------------------------------------------------------------
# Set targets for this directory

all: $(OBJECTS) export-headers export-objects 

$(LIBRARY): $(CXXOBJECTS)
	$(AR) $(ARFLAGS) $(LIBRARY) $(CXXOBJECTS)
	$(RANLIB) $(LIBRARY)

kjavaapplet.cpp: kjavaapplet.moc
kjavaapplet.moc:
	touch $@

kjavaappletcontext.cpp: kjavaappletcontext.moc
kjavaappletcontext.moc:
	touch $@

kjavaappletserver.cpp: kjavaappletserver.moc
kjavaappletserver.moc:
	touch $@

kjavaappletwidget.cpp: kjavaappletwidget.moc
kjavaappletwidget.moc:
	touch $@

kjavadownloader.cpp: kjavadownloader.moc
kjavadownloader.moc:
	touch $@

kjavaprocess.cpp: kjavaprocess.moc
kjavaprocess.moc:
	touch $@

#----------------------------------------------------------------------
# include make rules boilerplate

include $(TOPSRCDIR)/Makefile.rules

#======================================================================
# end
#======================================================================
