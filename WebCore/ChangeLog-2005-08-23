2002-08-01  Maciej Stachowiak  <mjs@apple.com>

	Remove KWQKHTMLPartImpl's setBaseURL method and m_baseURL field,
	since nothing should really need them any more.
	
        * kwq/KWQKHTMLPartImpl.h:
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::begin): Set base URL on document, if it exists.
        (KWQKHTMLPartImpl::requestFrame): Get base URL from document.
        (KWQKHTMLPartImpl::requestObject): Ditto.
        (KWQKHTMLPartImpl::frames): Ditto.
        (KWQKHTMLPartImpl::setBaseURL): Removed.

2002-08-01  Richard Williamson (Local)  <rjw@apple.com>

        Added method to allow WebKit to direct khtml to
        goto to an anchor point.  Need for back/forward.
        
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::urlSelected):
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge gotoAnchor:]):

2002-08-01  Ken Kocienda  <kocienda@apple.com>

	Tweaked WebCore cache settings. The WebCore cache will now grow
	to 1 MB (was 512k). The maximum cacheable item is 16k instead of 40k.

        * khtml/misc/loader.cpp

=== Alexander-15 ===

2002-08-01  Maciej Stachowiak  <mjs@apple.com>

        Restored the original KHTMLPart::write() now that none of our
	changes in the impl version are beneficial in any way.

	* khtml/khtml_part.cpp:
        (KHTMLPart::write): Restore original code in lieue of calling impl
	version.
        * kwq/KWQKHTMLPartImpl.h:
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::openURL): Remove initialization of
	m_decodingStarted, since it is now gone.
	(KWQKHTMLPartImpl::write): Removed.

2002-08-01  Maciej Stachowiak  <mjs@apple.com>

	Removed m_documentSource and remaining ill-conceived uses thereof.
	
        * kwq/KWQKHTMLPartImpl.h:
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::openURL): Don't initialize it.
        (KWQKHTMLPartImpl::write): Don't use it.

2002-08-01  Maciej Stachowiak  <mjs@apple.com>

        Remove stuff formerly useful for "View Reconstructed Source"
	feature but now useless.

	* kwq/KWQKHTMLPartImpl.h:
        * kwq/KWQKHTMLPartImpl.mm:
	(KWQKHTMLPartImpl::documentSource): Removed.
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
	(-[WebCoreBridge documentTextFromDOM]): Removed.

2002-07-31  Darin Adler  <darin@apple.com>

        * kwq/qt/qptrvector.h:
        * kwq/qt/qvector.h:
        * kwq/KWQVectorImpl.h:
        * kwq/KWQVectorImpl.mm:
	* force-clean-timestamp:
	New implementation of QVector that does not use CFArray. Should fix some data()
	anomalies. Shares wierdnesses with the original Qt class.

        * WebCore-tests.exp: Remove old QVector entry points and add new ones.

        * kwq/KWQKHTMLPartImpl.mm: (KWQKHTMLPartImpl::write): Did a tiny optimization
	by initializing the QString rather than first assigning and then initializing.
	Also reworded some comments and rearranged code to make it clearer that
	m_decodingStarted is now used only to decide when to call determineParseMode.

        * khtml/css/cssparser.cpp: Removed the APPLE_CHANGES around a change that's
	fine for non-Apple use as well.

2002-07-30  Maciej Stachowiak  <mjs@apple.com>

	Fixes of various bugs that prevented Alexander from running the
	Mozilla page load test.

	- fixed 3008682 - Alexander cannot run Mozilla-PLT

        * khtml/misc/decoder.cpp:
        (Decoder::decode): Don't drop the accumulated buffer if the document
	happens to be unicode!
	* kwq/KWQCString.mm:
        (operator==): Fix reversed logic when comparing an empty QCString
	to a const char *.
        * kwq/KWQKHTMLPartImpl.mm:
	(KWQKHTMLPartImpl::slotData): Set complete flag later so that
	initializing it to false doesn't clobber setting it.
        (KWQKHTMLPartImpl::begin): Initialize complete flag to false.
        (KWQKHTMLPartImpl::write): Don't buffer things up for the decoder -
	the decoder does that internally.
        * kwq/WebCoreBridge.h, kwq/WebCoreBridge.mm: Remove setURL: method.

2002-07-30  Richard Williamson (local)  <rjw@apple.com>

        Don't create unnecessary unicode string.  Of the 
        95695 unnecessary unicode allocations we do loading
        the base test, this usage accounted for 7185.  Most
        of the others come from DOMString to QConstString to
        QString to unicode() conversion during parsing.  All
        that unnecessary work needs to be removed.
        
        * kwq/KWQColor.mm:
        (decodeColorFromHexColorString):

2002-07-30  David Hyatt  <hyatt@apple.com>

	Ok, this time i've got it.  I hope.  I think.  Fingers crossed.
	Putting the table recalc check back in one more time. :)
	
        * khtml/rendering/render_table.cpp:
        (RenderTable::addColumns):
        (RenderTable::addColInfo):

2002-07-30  David Hyatt  <hyatt@apple.com>

	Backing myself out again.  No crashes, but now pages stall.
	#*^&*#@^%*&!!!!
	
        * khtml/rendering/render_table.cpp:
        (RenderTable::recalcColInfo):
        (RenderTable::addColInfo):

2002-07-30  David Hyatt  <hyatt@apple.com>

	Putting my table patch back in.  Also optimizing the code
	to avoid deleting and recreating the same colinfo over
	and over again.  Now colinfos can recalc their own
	information.
	
        * khtml/rendering/render_table.cpp:
        (RenderTable::addColumns):
        (RenderTable::recalcColInfo):
        (RenderTable::addColInfo):
        (RenderTable::calcMinMaxWidth):
        * khtml/rendering/render_table.h:

2002-07-30  Richard Williamson (local)  <rjw@apple.com>

        Inline critical function.
        
        * kwq/KWQString.mm:
        (compareToLatinCharacter):

2002-07-30  Richard Williamson  <rjw@apple.com>

        Wow!  Avoid creation of unicode string when only a single character
        is needed.  Simple change for big gains, 7% - 10% improvement
        on cached pages.  Other similar gains may remain to be had.
        
        * khtml/css/cssparser.cpp:

2002-07-30  Darin Adler  <darin@apple.com>

        * khtml/css/makevalues: Fail if we don't find gperf.

2002-07-30  David Hyatt  <hyatt@apple.com>

	Back myself out. I seem to have stumbled onto another bug.
	Until I figure it out, turn this back off.
	
        * khtml/rendering/render_table.cpp:
        (RenderTable::addColumns):
        (RenderTable::addColInfo):

2002-07-30  David Hyatt  <hyatt@apple.com>

	Fix for 3000604, 2902173, 2921313.  Ensure that tables recalc their
	column widths like they are supposed to.  This fixes livepage.apple.com,
	applemuseum.com, and many other pages (that didn't have bugs filed).
	Yay!
	
        * khtml/rendering/render_table.cpp:
        (RenderTable::recalcColInfo):
        (RenderTable::addColInfo):

2002-07-29  David Hyatt  <hyatt@apple.com>

	Fix for 3008660, arstechnica regression.  Move the acquisition
	of the document's text color (and the addition of CSS properties)
	to the attach() call instead of the constructor.  The table won't
	add the properties until it is building its render object.

	Also removing the #ifndef around the layout scheduler.  This fixes
	:hover feedback and reflows from things like the marquee on
	livepage.apple.com.
	
        * khtml/html/html_tableimpl.cpp:
        (HTMLTableElementImpl::HTMLTableElementImpl):
        (HTMLTableElementImpl::id):
        (HTMLTableElementImpl::attach):
        * khtml/html/html_tableimpl.h:
        * khtml/rendering/render_object.h:

2002-07-29  Darin Adler  <darin@apple.com>

	- fixed 3010875 -- Find only works for latin characters
	- dealt with part of 2948387 -- stop button flashes to "go" twice while loading citibank.com

        * force-clean-timestamp: Make everyone do a make clean because dependencies won't do
	the right thing.

        * khtml/khtml_part.h:
        * khtml/khtml_part.cpp: (KHTMLPart::slotRedirect): Changed the APPLE_CHANGES ifdefs around
	in this function so we can start using it again.
	(KHTMLPart::jumpToSelection): Removed. The bridge goes straight to the impl. 

        * kwq/WebCoreBridge.mm: (-[WebCoreBridge jumpToSelection]): Go straight to the impl.

        * WebCore-tests.exp: One new export needed for tests with change to qstring.h.

        * kwq/qt/qevent.h:
        * kwq/KWQEvent.mm: Removed unused stuff.

        * kwq/KWQKHTMLPartImpl.h: Removed redirectURL(); we now use KHTMLPart::slotRedirect().

        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::write): Call latin1() explicitly in here for m_documentSource. It was being
	done implicitly before.
        (KWQKHTMLPartImpl::scheduleRedirection): Get rid of 1-second minimum delay for meta refresh.
        (KWQKHTMLPartImpl::timerEvent): Call KHTMLPart::slotRedirect() instead of redirectURL(), because
	they were identical, so we don't need our own copy.

        * kwq/kdeui/kmessagebox.h:
        * kwq/KWQKMessageBox.mm: (KMessageBox::questionYesNo): Added dontAskAgain string parameter.
	Before, it was being turned into a bool!

        * kwq/KWQKProtocolManager.mm: Tweak and add FIXME.

        * kwq/qt/qstring.h: Remove implicit conversion to const char *, which causes only pain.
        * kwq/KWQString.mm:
        (QString::find): Add caseSensitive parameter to the QString overload of this.
        (QString::contains): Add a QString version of this.

        * kwq/character-sets.txt: Add the MIB number for ISO-10646-J-1.
        * kwq/make-charset-table.pl: Remove special case for ISO-10646-J-1 MIB number.

2002-07-29  Richard Williamson  <rjw@apple.com>

        Fixed 3009074.  Added KHTMLPart::jumpToSelection and related scaffolding (part impl, bridge, etc.)
        
        * khtml/khtml_part.cpp:
        (KHTMLPart::jumpToSelection):
        * khtml/khtml_part.h:
        * kwq/KWQKHTMLPartImpl.h:
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::jumpToSelection):
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge jumpToSelection]):

2002-07-29  Richard Williamson  <rjw@apple.com>

        Fixed 3009067.  We were not correctly testing the first character of the node string.  Fixed in KWQString.
        This highlighted another problem.  KWQ does not support unichar * string find w/ case sensitive argument.
        KWQString implements QString::find(const char *chs, int index, bool caseSensitive), so  QStrings passed 
        will be auto-cast to char *.  Filed 3010875 to track that issue.

        * kwq/KWQString.mm:
        (compareToLatinCharacter):
        (QString::find):

2002-07-26  David Hyatt  <hyatt@apple.com>

	Changing the default user agent to be Gecko.  This fixes
	the layout issues with livepage.apple.com.  We simply
	cannot support absolute positioning while claiming to
	be Mac MSIE, since Mac MSIE incorrectly computes the containing
	block and sites have to correct for that.
	
        * kwq/KWQKProtocolManager.mm:
        (KProtocolManager::userAgentForHost):

2002-07-26  David Hyatt  <hyatt@apple.com>

	Fix for 2944382, NOWRAP was being incorrectly applied in KHTML.
	It was being ignored incorrectly if a fixed width was specified
	on a cell.  This width on the cell is actually irrelevant and
	should not have been checked, since NOWRAP will affect the
	whole column and not just a specific cell.
	
        * khtml/rendering/render_table.cpp:
        (RenderTableCell::calcMinMaxWidth):

2002-07-25  Darin Adler  <darin@apple.com>

        * WebCore.pbproj/project.pbxproj: Add DeploymentFat build style.

	- fixed 3007532 -- Main documentation frame doesn't load on Apple docs page

	This was caused by my recent fix for the "checkboxes in wrong place" bug.
	While discussing that bug fix with Richard, I realized that I needed to do the
	work at layout time, not print time. Luckily, this code ends up being simpler
	than the original solution.

        * khtml/rendering/render_replaced.cpp:
        (RenderWidget::resizeWidget): Take out size limits based on X limits.
        (RenderWidget::layout): Move widgets off into far away coordinate space when
	layout happens. They get moved back on to the right position during the print process.

        * kwq/KWQKHTMLPartImpl.h:
        * kwq/KWQKHTMLPartImpl.mm: Removed paint, buildViewsNotYetAddedSet, viewsNotYetAdded,
	and addedWidget.
        * kwq/KWQScrollView.mm: (QScrollView::addChild): Removed call to addedWidget.
        * kwq/WebCoreBridge.mm: (-[WebCoreBridge drawRect:withPainter:]): Put the call to the
	renderer to print back in here, since it's simple again.

        * kwq/KWQWidget.mm: (QWidget::internalSetGeometry): Left in a couple of asserts that
	were useful in narrowing this one down.

2002-07-25  David Hyatt  <hyatt@apple.com>

	Floated images using "align" should have margins to prevent the text from running right
	up against them.  Matches IE and Mozilla behavior.
	
        * khtml/css/html4.css:

2002-07-25  David Hyatt  <hyatt@apple.com>

	Fix <blockquote> tags to have top and bottom margins of 1em.  This matches the <blockquote>
	behavior in Gecko.
	
        * khtml/css/html4.css:

2002-07-25  Darin Adler  <darin@apple.com>

	- fixed 2965269 -- sizes reported to progress handler from KWQCheckCacheObjectStatus for images are wrong
	- fixed 3006054 -- assert error failingURL != nil

        * khtml/misc/loader.h: Add dataSize() and m_dataSize.
        * khtml/misc/loader.cpp:
        (CachedImage::CachedImage): Initialize m_dataSize.
        (CachedImage::data): Update m_dataSize.

        * kwq/kio/jobclasses.h:
        * kwq/KWQKjobclasses.mm: Store a KURL instead of an NSURL, because KURL can hold any string.

        * kwq/KWQLoaderImpl.mm:
        (KWQServeRequest): Send an error with [WebCoreBridge reportError:] if the URL is so bad we can't
	construct an NSURL from it. This is the only case in all our code where we need to have failingURL
	accept a string.
        (KWQCheckCacheObjectStatus): If the object is an image, use the dataSize() rather than size().
	The size() is a (bad) estimate of how much memory is used in the case of an image, but we want
	to report the size of the original data.

        * kwq/WebCoreBridge.h: Add a [reportError:] method.

2002-07-25  David Hyatt  <hyatt@apple.com>

	Fix for huge white space problem on appleturns.com, bug 2947818.  Vertical-align
	was being applied to block-level elts in violation of the CSS2 spec.  Vertical-align
	is only supposed to apply to inline-level elts and table cells.  getVerticalPosition
	will now bail if the element is block-level.
	
        * khtml/rendering/render_object.cpp:
        (RenderObject::getVerticalPosition):

2002-07-25  Chris Blumenberg  <cblu@apple.com>

        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge elementAtPoint:]): renamed

2002-07-25  David Hyatt  <hyatt@apple.com>

	Fix for bug 2992158, the calendar on www.blog.org in the upper
	right was shoved offscreen (and causing a horizontal scrollbar
	to be necessary).  KHTML was not recomputing the margins for
	the table when it became displaced by the float.  It was also
	mispositioning the float itself.  
	
        * khtml/rendering/render_box.h:
        * khtml/rendering/render_flow.cpp:
        (RenderFlow::layoutBlockChildren):
        (RenderFlow::addOverHangingFloats):
	
2002-07-24  David Hyatt  <hyatt@apple.com>

	Fix for bug 2953423, viamichelin.com lays out incorrectly.
	Remove a completely bogus optimization in the KHTML code that
	attempted to bail when the specified width was 0.  This was
	a very basic problem, and it should fix other pages that were
	laying out incorrectly as well.
	
        * khtml/rendering/render_flow.cpp:
        (RenderFlow::layout):

2002-07-24  Darin Adler  <darin@apple.com>

        * khtml/khtml_part.cpp: (KHTMLPart::clear): Remove code that reset m_frameNameId,
	to complete Maciej's change to fix bug 3006354.

2002-07-24  Darin Adler  <darin@apple.com>

	- fixed 2906567 -- Font size calculations should use 96 dpi instead of 72 dpi
	- fixed 3005932 -- fonts specified in 'ex' units rendered waaaaaaay too large
	
        * khtml/css/cssstyleselector.cpp: (CSSStyleSelector::computeFontSizes):
	Use a default font size that's the same as small, rather than a "medium font
	size". Don't multiply the values from settings by the scaling factor.
	(CSSStyleSelector::applyRule): Make the default font size here for nodes with
	no parents be small (m_fontSizes[2]) rather than medium (m_fontSizes[3]).

        * khtml/html/html_inlineimpl.cpp: (parseFontSizeNumber): Added. Tolerant of
	non-numeric characters after the numeric size. Also distinguishes a size like
	"0" from something that's not a numeric size at all.
        (HTMLFontElementImpl::parseAttribute): Use parseFontSizeNumber, but also make
	size 3 be the same as CSS_VAL_SMALL, not CSS_VAL_MEDIUM. This mistake (using
	CSS_VAL_MEDIUM) led to all kinds of strangeness in the KHTML code, including
	mishandling of 0 and the need to create CSS_VAL__KONQ_XXX_LARGE. Also change
	code so that 0 is treated as CSS_VAL_SMALL (same as 3) rather than CSS_VAL_XX_SMALL.
	This makes 0 between -1 and +1.

        * khtml/xml/dom_docimpl.cpp: (DocumentImpl::recalcStyle): Make default font
	size be small (fontSizes()[2]) rather than medium (fontSizes()[3]).
        * khtml/html/html_tableimpl.cpp: (HTMLTableElementImpl::HTMLTableElementImpl):
	Make default font size be CSS_VAL_SMALL, not CSS_VAL_MEDIUM.

        * kwq/qt/qfontmetrics.h:
        * kwq/KWQFontMetrics.mm: (QFontMetrics::xHeight): Added.
        * kwq/WebCoreTextRenderer.h: Added xHeight.

        * khtml/css/css_valueimpl.cpp: (CSSPrimitiveValueImpl::computeLengthFloat):
	Use xHeight rather than computing the height of an actual letter 'x'.
        * khtml/rendering/render_object.cpp: (RenderObject::getVerticalPosition):
	Use xHeight rather than computing the height of an actual letter 'x'.

        * kwq/WebCoreBridge.mm: (-[WebCoreBridge reapplyStyles]): Fixed backwards
	if that prevented font changes from being reflected in the browser window.

        * kwq/khtml/khtml_settings.h:
        * kwq/KWQKHTMLSettings.mm:
	(KHTMLSettings::defaultFontSize):
        * kwq/WebCoreSettings.h:
        * kwq/WebCoreSettings.m:
        (-[WebCoreSettings setDefaultFontSize:]):
        (-[WebCoreSettings defaultFontSize]):
	Replace mediumFontSize with defaultFontSize.

        * WebCore.pbproj/project.pbxproj: Rearrange some of the files.

2002-07-24  Richard Williamson (Local)  <rjw@apple.com>

        Support for find in HTML.

        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge searchFor:direction:caseSensitive:]):

2002-07-24  Darin Adler  <darin@apple.com>

	- fixed 2949235 -- checkboxes in wrong place until you scroll away and back

	The problem here was that we put views in when we print, but we never removed them.
	I added code to keep track of existing views, and remove them if they are not re-added.

        * kwq/KWQKHTMLPartImpl.h: Add paint, addedWidget, buildViewsNotAddedSet, and viewsNotYetAdded.
	It might be nice to find a different place to hang this that is not included by the KHTML code.
	But I think that having this on the bridge would be worse.
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::paint): Added. Removes any views that are not explicitly added by RenderWidget
	during the print process.
        (KWQKHTMLPartImpl::addedWidget): Added. Called by KWQScrollView to tell us a view was added.
        (KWQKHTMLPartImpl::buildViewsNotYetAddedSet): Added. Used to build the initial set of views.

        * kwq/KWQScrollView.mm: (QScrollView::addChild): Added call to KWQKHTMLPartImpl::addedWidget.
        * kwq/WebCoreBridge.mm: (-[WebCoreBridge drawRect:withPainter:]): Calls KWQKHTMLPartImpl::paint.

        * kwq/KWQWindowWidget.mm: (KWQWindowWidget::frameGeometry), (KWQWindowWidget::mapToGlobal),
	(KWQWindowWidget::mapFromGlobal), (KWQWindowWidget::internalSetGeometry):
	Fixed logic to work properly for windows not on main screen.

        * khtml/khtml_part.cpp: Moved the boundary of an existing ifndef APPLE_CHANGES so that
	KHTMLPart::show() and hide() are not compiled, mainly for clarity.
        * khtml/rendering/render_replaced.cpp: (RenderWidget::detach): Removed unneeded APPLE_CHANGES.

        * kwq/KWQWindowWidget.h: Removed some unneeded virtual functions.
        * kwq/qt/qscrollview.h: Removed some unneeded virtual functions, made others non-virtual.
        * kwq/qt/qwidget.h: Removed some unneeded virtual functions, made others non-virtual.
        * kwq/KWQWidget.mm: Removed a lot of unused and unneeded stuff.

        * force-clean-timestamp: Needed to do this because I changed header files.

2002-07-24  Darin Adler  <darin@apple.com>

	- fixed 3006329 - space should be stripped from beginning of relative url

        * kwq/KWQKURL.mm: (KURL::normalizeRelativeURLString): Added a call to stripWhiteSpace.

2002-07-24  Maciej Stachowiak  <mjs@apple.com>

	Made frame names globally unique, not just unique per parent frame
	- this is needed to avoid triggering the assertion in 3006354
	(Assertion failure on salon.com). Clearing my cache made the
	assertion go away by itself, but it seems good to avoid the
	possibility of triggering it in the future.
	
        * khtml/khtmlpart_p.h: Make m_frameNameId static.
        * khtml/khtml_part.cpp: Initialize it here.

2002-07-24  Darin Adler  <darin@apple.com>

	- fixed 3006336 -- crash in _NSDescriptionWithLocaleFunc

        * kwq/KWQKHTMLPartImpl.mm: (KWQKHTMLPartImpl::overURL):
	Don't use the result of getNSString() on a C++ temporary object.
	We could also fix this by doing retain autorelease in getNSString().

2002-07-23  Chris Blumenberg  <cblu@apple.com>

	More plumbing for contextual menu support.

        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge completeURLForDOMString:]): renamed
        (-[WebCoreBridge elementInfoAtPoint:]): renamed
        * kwq/qt/qpixmap.h: added an accessor to the WebCoreImageRenderer

2002-07-23  Darin Adler  <darin@apple.com>

        * WebCore.pbproj/project.pbxproj: Fix file reference types to be more consistent.

        * khtml/html/htmltokenizer.cpp:
        (HTMLTokenizer::parseTag): Changed indenting to use spaces, makes our diff with
	KDE smaller.
        (HTMLTokenizer::end): Remove unneeded APPLE_CHANGES.

        * kwq/KWQDOMNode.cpp: Tweak.
        * kwq/KWQDOMNode.h: Tweak.

2002-07-23  David Hyatt  <hyatt@apple.com>

	Fix bug 2803155 - images not displayed on http://bscw.gmd.de.
	My fix is to use our newfound quirks mode to implement a comment
	parsing quirk (this is how Mozilla handles this same issue).
	Only in quirks mode, the tokenizer will treat <!--> atomically as
	a complete comment.

	This is bug 34302 on bugs.kde.org, for those who are curious.
	
        * khtml/html/htmltokenizer.cpp:
        (HTMLTokenizer::parseTag):

2002-07-23  Chris Blumenberg  <cblu@apple.com>

	Initial plumbing for contextual menu support.

        * WebCore.pbproj/project.pbxproj:
        * kwq/KWQDOMNode.cpp: Added.
        (isImage):
        * kwq/KWQDOMNode.h: Added.
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge _URLForDOMString:]): added
        (-[WebCoreBridge _elementInfoForMouseEvent:]): added

2002-07-23  Richard Williamson (Local)  <rjw@apple.com>

        Turn on find related code in part in preparation for
        implementing find in WebKit.
        
        * khtml/khtml_part.cpp:
        (KHTMLPart::init):
        (KHTMLPart::clear):
        (KHTMLPart::findTextNext):

2002-07-23  David Hyatt  <hyatt@apple.com>

	Fixing two bugs here.  The first is bug with @import sheets not inheriting strict parsing mode from their parent sheet.
	This means all @import sheets are being treated as strict mode! 

	The second bug is in KWQ.  We were never calling determineParseMode, so we always defaulted to strict mode, and therefore
	were highly intolerant of unitless numbers on absolutely positioned blocks.  This fixes many problems, notably www.netscape.com
	and ZDNet.com on the cvs-base tests.
        * khtml/css/cssparser.h:
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::write):

2002-07-23  Darin Adler  <darin@apple.com>

	- fixed 3004818 -- relative urls are assembled incorrectly at ticketmaster
	- fixed 2999279 -- Invalid URI in request at subpage of swatch.com

	The issue here is URLs with paths that start with "/../". RFC 2396 says one
	thing, and that's what CFURL does. But real web browsers do another thing.

        * kwq/KWQKURL.mm:
        (KURL::KWQKURLPrivate::KWQKURLPrivate): Clean up a bit by removing unneeded init().
        (escapeQString): Don't make a copy of the passed-in QString.
        (pathEndsWithSlash): Don't make a copy of the passed-in QString.
        (copyEscapedPath): Make this a static function instead of extern.
        (KURL::KWQKURLPrivate::decompose): Add the new "../" and "./" logic.

2002-07-23  David Hyatt  <hyatt@apple.com>

        * khtml/rendering/font.cpp:
	Fix deployment build bustage by including <algorithm>.
	
        * khtml/rendering/render_frames.cpp:
        (RenderPartObject::calcReplacedWidth):
	Fix a bug with http://www.moveabletype.com's top portion
	not showing up (bug 2986714).  A hack was being improperly
	applied to fixed width plugins, when it should have only
	been applied to variable width plugins.
	
2002-07-23  Darin Adler  <darin@apple.com>

        * Makefile.am: Clean based on all, not all-am, so it happens before subdirs
	if any.

2002-07-23  Darin Adler  <darin@apple.com>

	Changes require a make clean because of the Project Builder bug.
	So I added the "make clean timestamp" hackery.

        * .cvsignore: Ignore the new clean timestamp.
        * force-clean-timestamp: Added.
        * Makefile.am: Add rules for making clean happen.

        * khtml/html/html_formimpl.cpp:
        (HTMLGenericFormElementImpl::defaultEventHandler): Fix NULL dereference
	bug in here that I ran into. Code later down in the same function has
	the check for NULL, so clearly this is just a bug.

        * khtml/rendering/font.cpp:
        (Font::drawText): Simplify by using new drawText that takes a QChar array,
	no need to make a QConstString.
        * khtml/rendering/render_text.cpp:
        (TextSlave::printDecoration): Simplify by using new drawUnderlineForText that
	takes a QChar array, no need to make a QConstString.

        * kwq/WebCoreTextRenderer.h: Change underline-drawing to use a UniChar array.

        * kwq/qt/qpainter.h:
        * kwq/KWQPainter.mm:
        (QPainter::drawText): Change to take QChar array instead of a QString, but
	also discovered a bizarre overloading thing that was happening before and
	dealt with that by adding a new drawText that still does take a QString.
        (QPainter::drawUnderlineForText): Change to take QChar array.

        * kwq/qt/qcolor.h: Mark constructor explicit, so we don't get subtle strangess
	like where the string to draw was being converted to a QColor.

        * khtml/css/cssstyleselector.cpp: No need for APPLE_CHANGES for
	this change any more.

        * kwq/kdecore/kcharsets.h:
        * kwq/KWQKCharsets.mm: Remove unused functions.

        * kwq/khtml/khtml_settings.h:
        * kwq/KWQKHTMLSettings.mm: Remove unused functions.

        * kwq/qt/qfont.h:
        * kwq/KWQFont.mm: Simplify.

        * kwq/KWQPaintDeviceMetrics.mm: Simplify.

        * kwq/qt/qtextcodec.h:
        * kwq/KWQtextcodec.mm: (QTextCodec::codecForName): Remove unused parameter.

2002-07-23  David Hyatt  <hyatt@apple.com>

	The STYLE element was ignoring both the media and type
	attributes (unlike its cousin, the LINK element).  This
	patch implements support for media and type and further
	stops us from loading stylesheets that we should have no
	business parsing.
	
        * khtml/html/html_headimpl.cpp:
        (HTMLLinkElementImpl::process):
        (HTMLStyleElementImpl::parseAttribute):
        (HTMLStyleElementImpl::insertedIntoDocument):
        (HTMLStyleElementImpl::removedFromDocument):
        (HTMLStyleElementImpl::childrenChanged):
        (HTMLStyleElementImpl::sheetLoaded):
        * khtml/html/html_headimpl.h:

=== Alexander-14 ===

2002-07-23  David Hyatt  <hyatt@apple.com>

        * khtml/html/html_objectimpl.cpp:
        (HTMLObjectElementImpl::attach):
	Oops.  I accidentally removed the call to an ancestor class
	attach function.  What made this subtle is that it deliberately
	skipped over a couple of base classes and called the one three
	superclasses up.  When I went to put it back in, I messed up
	and called the base class instead of the distant ancestor.  

	Silly me.  marvel.com and matadorrecords.com should be ok now.
	
2002-07-22  Darin Adler  <darin@apple.com>

        * khtml/rendering/render_text.cpp:
        (TextSlave::printSelection): Add comments to APPLE_CHANGES.
        (TextSlave::printDecoration): Add comments to APPLE_CHANGES.
        (TextSlave::checkSelectionPoint): Add comments to APPLE_CHANGES.

        * khtml/xml/dom_stringimpl.cpp: Add comments to APPLE_CHANGES.

        * khtml/xml/xml_tokenizer.cpp: (XMLTokenizer::end): Remove APPLE_CHANGES.
        * kwq/KWQsignals.mm: Add a new signal dummy function.

        * kwq/WebCoreJavaScript.h: Fix header.
        * kwq/WebCoreJavaScript.mm: Fix header.

        * kwq/WebCoreSettings.h: Added. Not used yet.
        * kwq/WebCoreSettings.m: Added. Not used yet.
        * WebCore.pbproj/project.pbxproj: Added WebCoreSettings.h and .m.

        * English.lproj/InfoPlist.strings: Fixed a spelling error.

        * kwq/WebCoreTextRendererFactory.h: Tweak.

2002-07-22  Maciej Stachowiak  <mjs@apple.com>

	Fixed Radar 3004897 - assert at mapquest

        * khtml/html/html_baseimpl.cpp:
        (HTMLIFrameElementImpl::attach): Put back frame name uniqueness
	check. Lack of this check was causing duplicate frames to be left
	floating in space.
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::requestFrame): Add an assertion that no frame
	of the requested name already exists.

2002-07-22  David Hyatt  <hyatt@apple.com>

	Fix for bug 3004889, plugin content on stylesheet pages not
	showing up.  The rendering tree needed to perform an update
	when all children had arrived, and this was being handled by
	the parser.  With async rendering construction, I had to store
	this in the content node instead, so it could do the update
	once the render object was built at a later date.
	
        * khtml/html/html_objectimpl.cpp:
        (HTMLObjectElementImpl::HTMLObjectElementImpl):
        (HTMLObjectElementImpl::attach):
        * khtml/html/html_objectimpl.h:
        * khtml/html/htmlparser.cpp:
        (KHTMLParser::processCloseTag):

2002-07-22  David Hyatt  <hyatt@apple.com>

	This checkin adds support for querying the selected style set,
	for querying the preferred style set, and for changing the
	selected style set dynamically.  With this checkin, a Web page
	in Alexander now has the capability to present its own alternate
	stylesheet UI in the page and to toggle between sets using script.
	
        * khtml/dom/css_stylesheet.cpp:
        (DocumentStyle::preferredStylesheetSet):
        (DocumentStyle::setSelectedStylesheetSet):
        (DocumentStyle::selectedStylesheetSet):
        * khtml/dom/css_stylesheet.h:
	Added new methods to the DocumentStyle interface as per Hixie's
	proposed spec.
	
        * khtml/dom/dom_doc.cpp:
        * khtml/dom/dom_doc.h:
        * khtml/ecma/kjs_dom.cpp:
        (DOMDocument::getValueProperty):
        (DOMDocument::tryPut):
        (DOMDocument::putValue):
        * khtml/ecma/kjs_dom.h:
	Implement the JS binding glue for the new properties.
	
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::processHttpEquiv):
        (DocumentImpl::preferredStylesheetSet):
        (DocumentImpl::selectedStylesheetSet):
        (DocumentImpl::setSelectedStylesheetSet):
        (DocumentImpl::recalcStyleSelector):
        * khtml/xml/dom_docimpl.h:
	The implementation of the new properties.  Also fixed a bug
	caused by the 3.02 merge in the stylesheet filtering code in
	recalcStyleSelector.
	
2002-07-22  Maciej Stachowiak  <mjs@apple.com>

        Merged WebCoreBridge and WebCoreFrameBridge.

        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::openURLInFrame): Use bridge, not frameBridge.
        (KWQKHTMLPartImpl::urlSelected): Use bridge, not frameBridge.
        (KWQKHTMLPartImpl::submitForm): Use bridge, not frameBridge.
        (KWQKHTMLPartImpl::findFrame): Use bridge, not frameBridge.
        (KWQKHTMLPartImpl::frames): Use bridge, not frameBridge.
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge dealloc]): Free RenderPart if set.
        (-[WebCoreBridge renderPart]): Moved here from WebFrameBridge.
        (-[WebCoreBridge setRenderPart:]): Moved here from WebFrameBridge.
        (-[WebCoreBridge copyRenderNode:khtml::copier:]): No more need to get render part from frame bridge.
        (-[WebCoreBridge installInFrame:]): No more need to get render part from frame bridge.
        * kwq/WebCoreFrameBridge.h: Removed.
        * kwq/WebCoreFrameBridge.mm: Removed.
	* WebCore.exp: Removed WebCoreFrameBridge.
        * WebCore.pbproj/project.pbxproj: Removed WebCoreFrameBridge.

2002-07-21  Maciej Stachowiak  <mjs@apple.com>

        Removed provisional/committed distinction from WebCore and the
	WebCore SPI. WebCore will never see a provisional data source or
	provisional anything, any more.

        * kwq/KWQScrollView.mm: Remove mention of provisional widget from comment.
        * kwq/WebCoreFrameBridge.h: Remove commitedBridge method, and remove comment
	about provisionality from bridge method.
	* kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::write): Remove bogus comment about provisional/committed
	transition.
        (KWQKHTMLPartImpl::findFrame): Call bridge, not committedBridge.
        (KWQKHTMLPartImpl::frames): Likewise.

2002-07-21  Darin Adler  <darin@apple.com>

	* khtml/*: Roll KDE 3.0.2 changes in. Also switch to not using APPLE_CHANGES
	for some of the changes that we definitely want to contribute upstream.

        * WebCore.pbproj/project.pbxproj: Add KWQStyle.mm, remove KWQStyle.h, moving contents
	into qstyle.h.

        * kwq/KWQApplication.mm: (QApplication::globalStrut): Remove _logNotYetImplemented().

        * kwq/KWQButton.mm: (QButton::QButton): Use plain release, not autorelease.
        * kwq/KWQComboBox.mm: (QComboBox::init): Use plain release, not autorelease.
        * kwq/KWQListBox.mm: (QListBox::QListBox): Use plain release, not autorelease.
        * kwq/KWQPainter.mm: (QPainter::drawArc): Use plain release, not autorelease.

        * kwq/KWQKHTMLPartBrowserExtension.mm: Remove import of KWQKHTMLPartImpl.h, now that
	it's always part of khtml_part.h.
        * kwq/KWQKHTMLPartImpl.cpp: Simplify.
        * kwq/KWQKHTMLPartImpl.h: Add wrapper to allow multiple inclusion. Don't include
	khtml_part.h any more, since that file now includes this one to minimize changes to
	KDE code that needs to get to functions in here.
        * kwq/KWQKHTMLPartImpl.mm:
        (KHTMLPart::onURL), (KHTMLPart::nodeActivated), (KHTMLPart::setStatusBarText):
	Moved here from khtml_part.cpp.
        * kwq/KWQLoaderImpl.mm: Include khtml_part.h instead of KWQKHTMLPartImpl.h.

        * kwq/KWQPushButton.mm:
        (buttonFontMetrics), (QPushButton::fontMetrics): Added. Used by the form code to size buttons.
        * kwq/KWQStyle.mm: Added.
        (QStyle::sizeFromContents): Added. Used by the form code to size buttons.

        * kwq/KWQStyle.h: Removed.
        * kwq/qt/qstyle.h: Moved contents of KWQStyle.h in here.
        * kwq/qt/qwidget.h: Include <qstyle.h> rather than KWQStyle.h.

        * kwq/WebCoreBridge.mm: (-[WebCoreBridge isFrameSet]): Call straight to impl.

        * kwq/kdeui/klineedit.h: Add KLineEdit::frameWidth().
        * kwq/qt/qnamespace.h: Remove GUIStyle, MacStyle, and WindowsStyle.
        * kwq/qt/qpaintdevice.h: Add QInternal, QInternal::Printer, and QPaintDevice::devType().
        * kwq/qt/qpainter.h: Add QPainter::device().
        * kwq/qt/qpushbutton.h: Add QPushButton::fontMetrics().

2002-07-21  Maciej Stachowiak  <mjs@apple.com>

	Fix a recent regression that made JavaScript window closing
	crash. Window closing was counting on delayed dealloc/destruction
	of things associated with the window, but now that we have made
	deallocs more synchronous, we need to add an explicit delay in
	this case.

	Also, change some fprintf diagnostics of things that should never
	happen into assertions, since I actually ran into one.
	
        * kwq/KWQKHTMLPartImpl.h:
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::slotData): Change fprintf diagnostic to assertion,
	remove comment that the diagnostic should be removed.
        (KWQKHTMLPartImpl::end): Change fprintf diagnostic to assertion,
	remove comment that the diagnostic should be removed.
        (KWQKHTMLPartImpl::scheduleClose): Renamed from close, changed to schedule
	window closing from the run loop rather than doing it immediately.
        * khtml/ecma/kjs_window.cpp:
        (Window::scheduleClose): Adjusted for above rename.

2002-07-21  David Hyatt  <hyatt@apple.com>

        * khtml/html/html_headimpl.cpp:
        (HTMLLinkElementImpl::process):
	Fix incorrect handling of alternate stylesheets that could
	cause KHTML to incorrectly interpret alternate representation
	links (e.g., <link rel=alternate> to a PDF representation)) as 
	alternate stylesheets instead.
	
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::processHttpEquiv):
	Add support for the selection of alternate stylesheets and
	preferred stylesheet sets as specified in section 14.3.2 of
	the HTML 4.0 spec.  If you want to hook up a UI to expose
	alternate stylesheets, the back end code is ready to rock. :)
	
        (DocumentImpl::recalcStyleSelector):
	Fixed a bug in recalcStyleSelector that could lead it to
	pick an alternate stylesheet as a preferred set incorrectly
	(thus loading alternate stylesheets when it shouldn't).  This
	is probably the cause of bungled display on some pages with
	alternate stylesheets (e.g., Eric Meyer's pages).

	On Ian Hickson's simple import test suite, we now pass tests 35 and
	36 (where before both were failed).
	
2002-07-21  Maciej Stachowiak  <mjs@apple.com>

        * Makefile.am: Remove products from symroots on `make clean'.

2002-07-21  Maciej Stachowiak  <mjs@apple.com>

        * WebCore.pbproj/project.pbxproj: Set directories for the group
	folders, so that creating new files in them will put them in the
	right directory by default.

2002-07-21  David Hyatt  <hyatt@apple.com>

	Fixing bug 3003837, list boxes are extremely slow.  The
	buildup of a list box was order n squared, since on every
	insert of an item the list box was rebuilding its entire
	contents.  This patch adds smarts to the list buildup, so that
	the underlying NSBrowser only rebuilds itself one time, after
	all the items have been inserted.

	This speeds up the Bugzilla forms page on cvs-base by 60%.
	
        * khtml/rendering/render_form.cpp:
        (RenderSelect::updateFromElement):
	Patched to make calls to beginBatchInsert and endBatchInsert
	on KListBox.
	
        * kwq/KWQListBox.h:
        * kwq/KWQListBox.mm:
        (QListBox::QListBox):
        (QListBox::insertItem):
        (QListBox::beginBatchInsert):
        (QListBox::endBatchInsert):
	If in the middle of a batch insert, the insertitem function will
	not rebuild the NSBrowser's list.  endBatchInsert will actually
	do this now.
	
2002-07-20  David Hyatt  <hyatt@apple.com>

	This patch fixes the FOUC (flash of unstyled content) problem.
	
        * khtml/css/cssstyleselector.cpp:
        * khtml/css/cssstyleselector.h:
	If stylesheets are still loading, the styleForElement method
	will return a default "display: none" style that prevents
	the rendering tree from being built for that element.  
	
        * khtml/html/html_headimpl.cpp:
        (HTMLLinkElementImpl::process):
        (HTMLLinkElementImpl::setStyleSheet):
        (HTMLStyleElementImpl::sheetLoaded):
	The link element has been patched to notify the document
	when stylesheet loads start and finish.
	
        * khtml/html/htmlparser.cpp:
        (KHTMLParser::startBody):
	This function has been hacked to unblock the layout of
	inlines within a block.  This can be done the moment the
	stylesheet loads have been kicked off (you don't have to
	wait for them to finish).
	
        * khtml/rendering/render_object.h:
	Contains a new method for recursively descending into the
	render tree to unblock the layout of inlines.  This is done
	as soon as the <body> is encountered, so the render tree is
	small at the time the unblocking occurs.
	
        * khtml/xml/dom_docimpl.cpp:
        (DocumentImpl::DocumentImpl):
        (DocumentImpl::stylesheetLoaded):
        (DocumentImpl::updateStyleSelector):
	The new function, stylesheetLoaded, is invoked by link elements
	when a stylesheet loads.  It simply decrements the loading sheet
	count and calls updateStyleSelector.  updateStyleSelector has
	been patched to avoid the recalculation of style until all 
	stylesheets have loaded.
	
        * khtml/xml/dom_docimpl.h:
	Two new methods.  The first, stylesheetLoaded, is described
	above.  The second is haveStylesheetsLoaded, which indicates
	whether or not all the sheets have completed loading.  A single
	new member variable, m_pendingStylesheets, tracks the number
	of sheets currently pending.
	
2002-07-20  Darin Adler  <darin@apple.com>

        * khtml/css/css_ruleimpl.cpp: (CSSImportRuleImpl::~CSSImportRuleImpl):
	Fix a potential leak by doing setParent(0) here just as is done in
	CSSMediaRuleImpl.

        * kwq/WebCoreBridge.h: Fix a misspelling of visible.

2002-07-20  Maciej Stachowiak  <mjs@apple.com>

	Changed the code to handle "icon" and "SHORTCUT ICON" links
	separately, and give higher priority to the former.

	- fixed 3003672 - Assertion failure related to iconloader on metafilter
	
        * khtml/html/html_headimpl.cpp:
        (HTMLLinkElementImpl::process): Changed to handle both "icon" and
	"SHORTCUT ICON" links properly.
        * kwq/KWQKHTMLPartBrowserExtension.mm:
	(KHTMLPartBrowserExtension::setIconURL): Moved here from
	KWQKHTMLPartImpl to do it more the way KDE does.
        (KHTMLPartBrowserExtension::setTypedIconURL): New method for
	handling moz-style icon links, which include a type as well as a
	URL.
        * kwq/KWQKHTMLPartImpl.h:
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::loadIcon): Removed.
        * kwq/WebCoreBridge.h: Prototype setIcon: and setIcon:withType: methods.
        * kwq/khtml/khtml_ext.h: Prototype new methods.
        * kwq/kparts/browserextension.h: Make setIcon pure virtual instead
	of a no-op.

2002-07-19  Chris Blumenberg  <cblu@apple.com>

	Per darin, only define loadIcon in KWQKHTMLPartImpl

        * khtml/html/html_headimpl.cpp:
        (HTMLLinkElementImpl::process):
        * khtml/khtml_part.cpp:
        * khtml/khtml_part.h:

2002-07-19  Chris Blumenberg  <cblu@apple.com>

        * khtml/html/html_headimpl.cpp:
        (HTMLLinkElementImpl::process): added an APPLE_CHANGES
        * khtml/khtml_part.cpp: 
        (KHTMLPart::loadIcon): added
        * khtml/khtml_part.h: added loadIcon
        * kwq/KWQKHTMLPartImpl.h: added loadIcon
        * kwq/KWQKHTMLPartImpl.mm: added loadIcon
        (KWQKHTMLPartImpl::loadIcon):
        * kwq/WebCoreBridge.h: added loadIcon

2002-07-19  Darin Adler  <darin@apple.com>

        * khtml/css/makeprop: Fail if we don't find gperf.
        * khtml/misc/makeattrs: Fail if we don't find gperf.
        * khtml/misc/maketags: Fail if we don't find gperf.

2002-07-19  Maciej Stachowiak  <mjs@apple.com>

        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge installInFrame:]): Assert that this bridge is
	either for the main frame, or that it's frame has a render
	part. If neither of these conditions is met, the view will never
	get installed in the view hiearchy leading to nasty silent
	failure; and this condition should be guaranteed.

2002-07-18  David Hyatt  <hyatt@apple.com>

        * khtml/css/css_valueimpl.cpp:
        Changed the QRegExps used for font family matching to statics.  Helped out
        one page on the base tests a fair bit.  Overall (spread over all 40 pages)
        it's not that big though.
        
2002-07-18  David Hyatt  <hyatt@apple.com>

        Small change that gives us 25% speedup (uncached) on the cvs-base suite.

        * khtml/css/cssstyleselector.cpp:
        Optimized CLASS style comparison to avoid allocing QStrings when the CLASS
        attribute only contains one entry (as opposed to a list of entries).
        
=== Alexander-13 ===

2002-07-17  Darin Adler  <darin@apple.com>

        * kwq/KWQKHTMLPartImpl.mm: (KWQKHTMLPartImpl::requestFrame):
	Take out bogus check for nil path -- a URL with a nil path is OK, for example "about:blank".
	Also improved log message.

2002-07-16  Maciej Stachowiak  <mjs@apple.com>

        Moved URL mouseover status to KWQKHTMLPartImpl, and made it
	responsive to modifier key presses, if enabled. Fixes:

	Radar 2980152 - Link mouseover status messages are not localizable
	Radar 2982043 - Link mouse-over status should change in response to modifier keys

	* khtml/khtml_part.cpp:
        (KHTMLPart::overURL): Remove extensive APPLE_CHANGES, and just call the
	impl method.
        * kwq/KWQKHTMLPartImpl.h: Prototype overURL method.
        * kwq/KWQKHTMLPartImpl.mm:
        (KWQKHTMLPartImpl::overURL): Construct status messages using format strings
	for localizability; change message in response to modifiers if modifier
	tracking is enabled.
        * kwq/WebCoreBridge.h: Prototype modifierTrackingEnabled method.

2002-07-16  Richard Williamson (Local)  <rjw@apple.com>

        Fixed field length test.  We were testing >= instead of >.
        * kwq/KWQNSTextField.mm:
        (-[KWQNSTextFieldFormatter isPartialStringValid:newEditingString:errorDescription:]):

2002-07-16  Darin Adler  <darin@apple.com>

	- fixed 2997244 -- crash when visiting cnn.com followed by another page

	Turns out the requestFrame code I've been tinkering with used to be
	dead code until we accidentally re-triggered the code path.

        * khtml/html/html_baseimpl.cpp: (HTMLFrameElementImpl::attach):
	Remove APPLE_CHANGES that were causing us to reuse the same frame which
	were an attempt to fix a frame targeting problem that was actually elsewhere.

        * kwq/KWQKHTMLPartImpl.mm: (KWQKHTMLPartImpl::requestFrame): Remove the code
	that handles the case of an already-existing frame with the same name. This
	is handled at a higher level.

        * kwq/WebCoreBridge.h: Remove now-unneeded childFrameNamed method.

2002-07-16  Darin Adler  <darin@apple.com>

	- fixed 2998692 -- crash when you type "googl" into the page address

        * kwq/KWQKHTMLPartImpl.mm: (KWQKHTMLPartImpl::requestFrame): Check for
	a nil part here to restore the old behavior. Whether that's OK or not
	is another question that I'd prefer to deal with later.

2002-07-16  Darin Adler  <darin@apple.com>

        * almost every file: Renamed IF* -> Web*.

2002-07-15  Darin Adler  <darin@apple.com>

	A teeny weeny bit of refactoring.

        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge stateForEvent:]): Replaces addModifiers:toState:.
        (-[WebCoreBridge mouseUp:]): Use stateForEvent:.
        (-[WebCoreBridge mouseDown:]): Use stateForEvent:.
        (-[WebCoreBridge mouseMoved:]): Use stateForEvent:.

2002-07-15  Richard Williamson (Home)  <rjw@apple.com>

        Added isFrameSet method.
        
        * WebCore.pbproj/project.pbxproj:
        * khtml/khtml_part.cpp:
        (KHTMLPart::isFrameSet):
        * khtml/khtml_part.h:
        * kwq/KWQKHTMLPart.mm:
        * kwq/KWQKHTMLPartImpl.cpp: Added.
        (KWQKHTMLPartImpl::isFrameSet):
        * kwq/KWQKHTMLPartImpl.h:
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge isFrameSet]):

2002-07-15  Darin Adler  <darin@apple.com>

        * WebCore.pbproj/project.pbxproj: Removed KWQKPrinter.mm.
        * kwq/KWQKPrinter.mm: Removed.

2002-07-15  Darin Adler  <darin@apple.com>

        * WebCore.pbproj/project.pbxproj: Removed unused qpopupmenu.h.
        * kwq/kdecore/ksimpleconfig.h: Removed unnecessary include of <config.h>.
        * kwq/kio/global.h: Removed unnecessary include of <config.h>.
        * kwq/kio/kprinter.h: Emptied out this file.
        * kwq/qt/qpopupmenu.h: Removed.
        * kwq/qt/qstylesheet.h: Removed unnecessary include of <config.h>.
        * kwq/qt/qtextedit.h: Removed unnecessary include of <config.h>.

2002-07-15  Darin Adler  <darin@apple.com>

        * kwq/qt/qfontmetrics.h: Remove unused, and not properly implemented,
	empty constructor. Add some const that was missing. Remove most of the
	parameters of size().
        * kwq/KWQFontMetrics.mm:
        (QFontMetrics::charWidth): Add const.
        (QFontMetrics::floatWidth): Add const.
        (QFontMetrics::floatCharacterWidth): Add const.
        (QFontMetrics::size): Remove unused parameters.

        * kwq/WebCoreTextRenderer.h: Remove two unused drawString methods and one
	unused widthForCharacters method.

2002-07-14  Darin Adler  <darin@apple.com>

        * kwq/WebCoreFrame.mm: (-[WebCoreFrame dealloc]): Fix NULL-dereferencing
	problem that was hidden by the "leak the world" bug in WebBrowser.

2002-07-14  Maciej Stachowiak  <mjs@apple.com>

        Assign getView() results to variable of appropriate type to work
	around apparent ObjC++ compiler bug. I wonder why other people
	aren't running into this (and why I haven't run into it before).

	* kwq/KWQButton.mm:
        (QButton::setText):
        (QButton::text):
        * kwq/KWQLineEdit.mm:
        (QLineEdit::setEchoMode):
        (QLineEdit::setText):
        (QLineEdit::text):
        (QLineEdit::setMaxLength):
        (QLineEdit::isReadOnly):
        (QLineEdit::setReadOnly):
        (QLineEdit::maxLength):
        (QLineEdit::selectAll):
        (QLineEdit::edited):
        (QLineEdit::setEdited):

2002-07-14  Darin Adler  <darin@apple.com>

        * WebCore-tests.exp: Tests needed access to QPoint, QString, and KURL symbols
	that were formerly exported for the benefit of WebKit.

        * kwq/KWQPixmap.mm: I needed to touch something since .exp files don't cause
	a rebuild, so I fixed a comment in here.

2002-07-14  Darin Adler  <darin@apple.com>

	Changes to WebCore that allow WebKit to work through Objective C without going
	straight to the KHTML headers. Also remove a bunch of unused stuff, especially
	in QPainter.

        * WebCore.exp: Export the new classes WebCoreCache and WebCoreJavaScript.
	Don't export any C++ symbols at all.

        * WebCore.pbproj/project.pbxproj: Remove KWQWMatrix.mm, add WebCoreCache.*
	and WebCoreJavaScript.*.

        * khtml/khtml_part.cpp: Put more unused code inside ifndef APPLE_CHANGES.
        * khtml/khtmlview.cpp: Put unused code inside #ifndef APPLE_CHANGES
        * khtml/khtmlview.h: Put unused virtual functions inside #ifndef APPLE_CHANGES.
        * khtml/misc/loader.cpp: (CachedImage::tiled_pixmap): Change this so it
	always returns pixmap(). Handling it at this level is better than changing
	all the callers for now.
        * khtml/rendering/render_box.cpp: (RenderBox::printBackground): Took out the
	APPLE_CHANGES now that tiled_pixmap() always just returns pixmap().
        * khtml/rendering/render_frames.cpp: (RenderFrameSet::userResize): Put some
	unused code inside APPLE_CHANGES.

        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPartImpl::requestFrame): Made it get the view using the bridge, since we
	don't have a [widget] method on the frame any more.
        (KWQKHTMLPartImpl::findFrame): Used committedBridge instead of bridge, since
	I changed bridge to return the provisional if available.
        (KWQKHTMLPartImpl::frames): Used committedBridge instead of bridge, since
	I changed bridge to return the provisional if available.

        * kwq/qt/qpixmap.h: Put an empty version of QWMatrix in here. We don't actually ever
	need a real matrix, just a class to let us compile.

        * kwq/qt/qpainter.h: Moved QWMatrix into qpixmap.h. Removed constructors that take
	QPixmap and QWidget. Removed unused variants of drawText. Removed unused setClipping,
	setClipRect, hasClipping, translate, scale, begin, end, and device functions.
        * kwq/KWQPainter.mm:
        (QPainter::QPainter): Remove the constructors that take a paint device, widget,
	or pixmap. We can get away without them.
        (QPainter::save): Simplify. Also remove the optimization for painters without
	stacks, since having an empty stack is very inexpensive.
        (QPainter::restore): Simplify.
        (QPainter::_drawPoints): Move paintingDisabled check in here.
        (QPainter::drawText): Removed many unused drawText variants.

        * kwq/KWQView.h: Tweaked.
        * kwq/KWQView.mm: Removed [KWQView drawRect:].

        * kwq/KWQWMatrix.mm: Removed.

        * kwq/qt/qwidget.h: Removed paint() virtual function.
        * kwq/KWQWidget.mm: Removed QWidget::paint().

        * kwq/WebCoreBridge.h: Added new methods installInFrame:, removeFromFrame,
	mouseDown:, mouseUp:, mouseMoved:, mouseDragged:, copyDOMTree:, and copyRenderTree:.

        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge dealloc]): Call removeFromFrame.
        (-[WebCoreBridge createKHTMLViewWithNSView:width:height:marginWidth:marginHeight:]):
	Don't return the view any more, also set bridgeOwnsKHTMLView to YES.
        (-[WebCoreBridge copyDOMNode:DOM::copier:]): Added helper method for copyDOMTree.
        (-[WebCoreBridge copyDOMTree:]): Added method to be used by IFDOMNode to get at DOM
	tree without using C++.
        (-[WebCoreBridge copyRenderNode:khtml::copier:]): Added helper method for copyRenderTree.
        (-[WebCoreBridge copyRenderTree:]): Added method to be used by IFRenderNode to get at
	render tree without using C++.
        (-[WebCoreBridge removeFromFrame]): Added. Deletes the view if we own it. We don't want
	to wait for dealloc time to do this, since a lingering view might be visible.
        (-[WebCoreBridge installInFrame:]): Added. Does a set of things we need to do at the
	time we commit a provisional data source.
        (-[WebCoreBridge addModifiers:toState:]): Moved here from IFHTMLView.
        (-[WebCoreBridge mouseUp:]): Added. Used to get a mouse up event to the KHTMLView.
        (-[WebCoreBridge mouseDown:]): Added. Used to get a mouse down event to the KHTMLView.
        (-[WebCoreBridge mouseMoved:]): Added. Used to get a mouse moved event to the KHTMLView.
        (-[WebCoreBridge mouseDragged:]): Added. Used to get a mouse moved event to the KHTMLView
	in the case where we are dragging -- perhaps could be merged with mouseMoved.

        * kwq/WebCoreCache.h: Added. Allows control of the WebCore cache; previously done directly
	in IFCache in WebKit.
        * kwq/WebCoreCache.mm: Added.

        * kwq/WebCoreFrame.h: Remove widget method. Change semantics of bridge method to return
	provisional bridge if available, which corresponds to what the widget method did before.
	Added a committedBridge method that has the semantics that bridge did before.

        * kwq/WebCoreJavaScript.h: Added. Returns statistics about the state of JavaScript objects;
	previously done directly in IFCache in WebKit.
        * kwq/WebCoreJavaScript.mm: Added.

2002-07-13  Darin Adler  <darin@apple.com>

        * WebCore.pbproj/project.pbxproj: Add a few files that are sources
	although they should not be compiled for any target.

        * kwq/qt/qpushbutton.h: Simplified.
        * kwq/KWQPushButton.mm: (QPushButton::QPushButton): Implemented text parameter.

2002-07-13  Darin Adler  <darin@apple.com>

        * ForwardingHeaders/*: Added. New approach to headers to try to
	make Project Builder's header dependency support work even for
	includes like #include <render/render_object.h>.
        * kwq/kjs/*: Removed. Now part of ForwardingHeaders.

        * Makefile.am: Remove embed.am support.

        * WebCore.pbproj/project.pbxproj: Remove other search paths, and
	add ForwardingHeaders directory as a search path. Add qucomextra_p.h.
	
        * khtml/ecma/kjs_navigator.cpp: Made gratuitous changes to touch this
	file to make things build without requiring clean rebuild.

        * khtml/rendering/render_form.cpp: Removed many unneeded QObject::
	qualifiers from inside APPLE_CHANGES to touch this file to make things
	build without requiring clean rebuild.

        * kwq/KWQButton.mm: (QButton::setText), (QButton::text):
        * kwq/KWQColor.mm: (QColor::setNamedColor):
	* kwq/KWQKConfigBase.mm: (KConfig::readEntry):
        * kwq/KWQKHTMLSettings.mm: (KHTMLSettings::stdFontName), (KHTMLSettings::fixedFontName):
        (KHTMLSettings::serifFontName), (KHTMLSettings::sansSerifFontName),
	(KHTMLSettings::cursiveFontName), (KHTMLSettings::fantasyFontName), (KHTMLSettings::encoding):
        * kwq/KWQKLocale.mm: (i18n):
        * kwq/KWQKMessageBox.mm: (KMessageBox::error), (KMessageBox::warningYesNo):
        (KMessageBox::questionYesNo), (KMessageBox::sorry):
        * kwq/KWQListBox.mm: (-[KWQBrowserDelegate browser:willDisplayCell:atRow:column:]):
        * kwq/WebCoreBridge.mm: (-[WebCoreBridge selectedText]):
        Wean from QSTRING_TO_NSSTRING and NSSTRING_TO_QSTRING.

        * kwq/KWQComboBox.mm:
        (QComboBox::insertItem): Wean from QSTRING_TO_NSSTRING. Note that this
	now stores a copy of the string in the array. The old version was unsafe
	if anyone later modified the QString that was passed in.

        * kwq/KWQFontMetrics.mm: (QFontMetrics::width):
        * kwq/KWQPainter.mm: (QPainter::drawUnderlineForText), (QPainter::drawText):
	Wean from QSTRING_TO_NSSTRING_LENGTH and _FAST_QSTRING_TO_NSSTRING. We still have
	speed as high as before, in the "length" case slightly faster.

        * kwq/qt/qstring.h: Remove QSTRING_TO_NSSTRING family of macros.

        * kwq/KWQInvisibleButton.mm:
        * kwq/KWQKHTMLPart.mm:
        * kwq/KWQKHTMLPartBrowserExtension.mm:
        * kwq/KWQKJavaAppletWidget.mm:
        * kwq/KWQKloader.mm:
        * kwq/KWQView.mm:
        * kwq/KWQsignals.mm:
        * kwq/WebCoreBridge.mm:
        * kwq/kdecore/kconfig.h:
        * kwq/kdecore/klibloader.h:
        * kwq/kdecore/klocale.h:
        * kwq/khtml/khtml_ext.h:
        * kwq/khtml/khtml_factory.h:
        * kwq/kio/kmimetype.h:
	Remove subdirectory prefix from imports to match Project Builder include scheme.

        * kwq/KWQKCursor.mm: (+[NSCursor _WebCore_linkCursor]):
        * kwq/KWQKLocale.mm: (i18n):
        * kwq/KWQKstddirs.mm: (locate):
	Use bundleForClass instead of bundleWithIdentifier to avoid any potential problems
	with multiple versions of the framework installed on the same system.

        * kwq/KWQKLineEdit.mm:
        (KLineEdit::completionBox): Remove _logNotYetImplemented, since this is implemented
	well enough for our needs now, and if we need to implement it later, it will become
	clear from the application behavior. This should be the destiny of most of these.

        * kwq/kdecore/kglobal.h: Simplify.
        * kwq/KWQKGlobal.mm: Simplify.
        * kwq/qt/qlineedit.h: Simplify.
        * kwq/KWQLineEdit.mm: Simplify.

        * kwq/KWQPaintDeviceMetrics.mm: Remove unneeded import.
        * kwq/qt/qbutton.h: Remove unneeded destructor.

2002-07-13  Richard Williamson (Home)  <rjw@apple.com>

        * kwq/KWQPainter.mm:
        Added disable drawing mode.
        (QPainter::drawRect):
        (QPainter::drawLine):
        (QPainter::drawEllipse):
        (QPainter::drawArc):
        (QPainter::drawLineSegments):
        (QPainter::drawPolyline):
        (QPainter::drawPolygon):
        (QPainter::drawConvexPolygon):
        (QPainter::drawPixmap):
        (QPainter::drawTiledPixmap):
        (QPainter::drawText):
        (QPainter::drawUnderlineForText):
        (QPainter::fillRect):
        (QPainter::setPaintingDisabled):
        
        * kwq/KWQWidget.mm:
        (QWidget::frameGeometry):
        Use the IFWebView's geometry.
        
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge _drawRect:withPainter:]):
        (-[WebCoreBridge drawRect:]):
        (-[WebCoreBridge adjustFrames:]):
        Added adjustFrames:.  Factored some code.
        
        * kwq/qt/qpainter.h:
        Added setPaintingDisabled.

        * khtml/html/html_baseimpl.cpp:
        (HTMLFrameElementImpl::attach):
        (HTMLIFrameElementImpl::attach):
        Removed uniqueness check.  Need to revisit vis-a-vis provisional ds.
        
2002-07-12  Darin Adler  <darin@apple.com>

        * WebCore.pbproj/project.pbxproj: Add WebCoreFrame.mm, also export all
	the WebCore headers as Private so WebKit can see them.

        * khtml/khtmlview.cpp: (KHTMLView::drawContents): Remove APPLE_CHANGES
	since we don't use this function any more.

        * kwq/KWQDef.h: Since <sys/types.h> now includes ushort and uint, update
	code here to take that into account.

        * kwq/KWQKHTMLPartImpl.h: Added getView().
        * kwq/KWQKHTMLPart.mm: (KWQKHTMLPartImpl::getView): Added. Used by bridge.

        * kwq/qt/qpainter.h:
        * kwq/KWQPainter.mm: Simplify a bit, and remove some unused stuff.

        * kwq/WebCoreBridge.h: Add reapplyStyles, forceLayout, drawRect:.
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge reapplyStyles]): Added.
        (-[WebCoreBridge forceLayout]): Added.
        (-[WebCoreBridge drawRect:]): Added.

        * kwq/WebCoreFrame.h: Make this a class as well as an interface.
        * kwq/WebCoreFrame.mm: Added.

        * WebCore.exp: Since WebCoreFrame is now a class as well as a protocol,
	export it so we can subclass.

2002-07-12  Darin Adler  <darin@apple.com>

	Build WebCore with Project Builder instead of make.
	Also wean WebCore from peeking inside the WebKit bundle.

        * WebCore.pbproj/.cvsignore: Added.
        * WebCore.pbproj/project.pbxproj: Added.

        * Makefile.am: Removed rules about building the framework,
	and just use pbxbuild instead.

        * dummy.mm: Removed.

        * khtml/Makefile.am: Removed everything but SUBDIRS.
        * khtml/css/Makefile.am: Removed everything but the rules for
	generated sources.
        * khtml/dom/Makefile.am: Removed.
        * khtml/ecma/Makefile.am: Removed everything but the rules for
	generated sources.
        * khtml/html/Makefile.am: Removed everything but the rules for
	generated sources.
        * khtml/misc/Makefile.am: Removed everything but the rules for
	generated sources.
        * khtml/rendering/Makefile.am: Removed.
        * khtml/xml/Makefile.am: Removed.
        * kwq/Makefile.am: Removed everything but the rules for
	generated sources.

        * kwq/KWQKLocale.mm: (i18n): Look in WebCore bundle, not WebKit bundle.
        * kwq/KWQKstddirs.mm:
        (locate): Look in WebCore bundle, not WebKit bundle. Also, always assume
	we are looking for html4.css.
        (locateLocal): Don't waste code making a bad path, just return empty string.

        * kwq/qt/qpixmap.h:
        * kwq/KWQPixmap.mm: Changed convertToImage() to an inline since we
	never need to implement it.

        * kwq/KWQKDebug.mm: Removed.
        * kwq/KWQKImageIO.mm: Removed.
        * kwq/kdecore/kcmdlineargs.h: Emptied out the file.
        * kwq/kdecore/kdebug.h: Made the do-nothing code here all be
	inlines for smaller code size.

        * kwq/KWQScrollBar.h: Fixed header guard.

        * .cvsignore:
        * kwq/.cvsignore:
        * khtml/dom/.cvsignore: Removed.
        * khtml/rendering/.cvsignore: Removed.
        * khtml/xml/.cvsignore: Removed.
        * kwq/kdecore/.cvsignore: Removed.
        * kwq/qt/.cvsignore: Removed.
	Don't ignore things we don't generate any more.

        * kwq/kjs/collector.h: Added.
        * kwq/kjs/internal.h: Added.
        * kwq/kjs/interpreter.h: Added.
        * kwq/kjs/lookup.h: Added.
        * kwq/kjs/object.h: Added.
	Used so that khtml can see the headers from JavaScriptCore.

2002-07-11  Maciej Stachowiak  <mjs@apple.com>

        Fixed Radar 2953254 - JavaScript window.scroll() and
	window.scrollBy() do not work

	* khtml/ecma/kjs_window.cpp:
        (WindowFunc::tryCall): Handle Scroll the same as ScrollBy.
        * kwq/KWQScrollView.mm:
        (QScrollView::scrollBy): Implement this method, since it's needed
	for JS scrolling.

2002-07-10  Darin Adler  <darin@apple.com>

	- fixed 2978796 -- Client-side image map not working

        * kwq/KWQRegion.mm: (QRegion::QRegion): Implement constructor that
	takes a QPointArray.

        * kwq/qt/qarray.h: Fix some const loopholes.

        * kwq/KWQCString.mm:
        (QCString::find): Use const char * instead of char *.
        (QCString::contains): Use const char * instead of char *.
        (QCString::right): Use const char * instead of char *.
        (QCString::mid): Use const char * instead of char *.

2002-07-10  Maciej Stachowiak  <mjs@apple.com>

        WebCore part of fix for:

	Radar 2953250 - JavaScript window.focus() and window.blur()
	methods don't work

        * khtml/ecma/kjs_window.cpp:
        (WindowFunc::tryCall): Call the appropriate things on focus and blur.
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPartImpl::unfocusWindow): Implemented by calling bridge.
        * kwq/KWQKHTMLPartImpl.h, kwq/KWQWidget.mm:
	(QWidget::setActiveWindow): Implemented by ordering the window
	front and making it key.
        * kwq/WebCoreBridge.h: Prototype new bridge method.

2002-07-10  Darin Adler  <darin@apple.com>

	- fixed 2979153 -- charset sjis page is gibberish

        * kwq/character-sets.txt: Add x-sjis as an alias for Shift JIS.

2002-07-10  Darin Adler  <darin@apple.com>

        * kwq/KWQPixmap.mm:
        (QPixmap::QPixmap): Restore the imageRenderer == nil case to fix a regression
	related to resized images. Otherwise, isNull was returning true for all images.
	In copy constructor, set needCopyOnWrite on both the source and destination;
	setting it on the destination was not enough.
        (QPixmap::receivedData): Create the imageRenderer if it's nil.
        (QPixmap::operator=): Set needCopyOnWrite on both the source and destination.

        * kwq/qt/qpixmap.h: Make needCopyOnWrite mutable so we can set it on the source
	when copying or assigning.

2002-07-10  Darin Adler  <darin@apple.com>

        * kwq/KWQKHTMLPart.mm: (KWQKHTMLPartImpl::setBaseURL):
	Call setBaseURL on the underlying document all the time, not just
	when we add a missing "/" character.

2002-07-07  Maciej Stachowiak  <mjs@apple.com>

        WebCore part of fix for Radar 2953431 - JavaScript window.close()
	method is not working

        * khtml/ecma/kjs_window.cpp:
        (Window::scheduleClose): In AppleChanges
        * khtml/khtml_part.cpp:
        (KHTMLPart::openedByJS): Call kwq implementations, because we need
	to remember the openedByJS state across location changes, which in
	our case means replacing the part.
        (KHTMLPart::setOpenedByJS): Likewise.
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPartImpl::openedByJS): Implement by calling bridge.
        (KWQKHTMLPartImpl::setOpenedByJS): Likewise.
        (KWQKHTMLPartImpl::close): Likewise.
        * kwq/KWQKHTMLPartImpl.h: Prototype new PartImpl methods.
        * kwq/WebCoreBridge.h: Prototype new bridge methods.

2002-07-06  Darin Adler  <darin@apple.com>

        * kwq/KWQKHTMLPart.mm: (KWQKHTMLPartImpl::write): Remove reference
	to nonexistent class in a comment.
        * kwq/KWQKHTMLPartImpl.h: Remove unused and unimplemented getDataSource().

2002-07-04  Maciej Stachowiak  <mjs@apple.com>

	Say "Go to" instead of "Link to" for links that won't open a new
	window. Also, the code is now set up to change the status text
	when modifier keys are pressed, but the code is disabled for now
	because it's impossible to do reliably.
	
        * khtml/khtml_part.cpp:
        (KHTMLPart::overURL):
        (KHTMLPart::khtmlMouseMoveEvent):
        * khtml/khtml_part.h:

2002-07-03  Darin Adler  <darin@apple.com>

	A small KURL speed improvement.

        * khtml/misc/loader.cpp:
        (Cache::requestImage):
        (Cache::requestStyleSheet):
        (Cache::requestScript):
	Don't do the isMalformed check, because it's expensive and has no clear benefit.
	There's no harm in caching null results for malformed URLs.

        * kwq/KWQKURL.mm:
        (KURL::KURL): Make the default constructor faster by not running all the
	normalize code on the empty string.

=== Alexander-11 ===

2002-07-03  Maciej Stachowiak  <mjs@apple.com>

        WebCore part of fixes for:

	Radar 2950616 - JavaScript window.screenX and window.screenY always return -1
	Radar 2950614 - JavaScript window.screenLeft and window.screenTop
	properties are unimplemented
	Radar 2950609 - JavaScript window.outerHeight and
	window.outerWidth properties always return 0

        * khtml/ecma/kjs_window.h:
        * khtml/ecma/kjs_window.cpp:
	(Window::get): Make ScreenLeft and ScreenTop synonyms for ScreenX
	and ScreenY respectively.
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPartImpl::setView): Set the real part's view too.
        * kwq/kdecore/kwin.h: Remove unneeded fields.
        * kwq/KWQKWin.mm:
        (KWin::info): Implemented.
        * kwq/qt/qwidget.h: 
        * kwq/KWQWidget.mm: 
	(QWidget::winId): Return long instead of int, to make sure there
	is room for a pointer even on 64-bit architectures.
        (QWidget::mapToGlobal): Use the top level widget to map.

2002-07-03  Richard Williamson  <rjw@apple.com>

        * kwq/KWQScrollView.mm:
        (QScrollView::addChild):
        Fixed regression that caused IFWebView frame origin to sometimes
        never be set correctly.  (khtml sets the x origin to -500000
        during initialization, and it was never getting set correctly).
        This problem manifested itself as blank white frames.
        
        * kwq/KWQWidget.mm:
        (QWidget::internalSetGeometry):

2002-07-03  Maciej Stachowiak  <mjs@apple.com>

	WebKit part of fix for:

	Radar 2943465 - JavaScript window.defaultStatus property not implemented
	Radar 2943464 - JavaScript window.status property is not implemented
	Radar 2926213 - show url of moused-over link in status bar

	Also fixed:

	Radar 2980091 - KHTMLPart::findFrame() and KHTML::frameExists()
	should search all frames, not just child frames
	
        * khtml/khtml_part.cpp:
        (KHTMLPart::overURL): Unifdef most of this, but adjust the wording.
        (KHTMLPart::setStatusBarText): Implement by calling KWQKHTMLPartImpl.
        * khtml/khtml_part.h:
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPartImpl::frameExists): Search all frames, not just child frames.
        (KWQKHTMLPartImpl::findFrame): Search all frames, not just child frames.
        (KWQKHTMLPartImpl::setStatusBarText): Implemented by calling WebCoreBridge.
        * kwq/KWQKHTMLPartImpl.h:
        * kwq/WebCoreBridge.h: Declare new setStatusText method
        * kwq/kparts/part.h: Remove setStatusBarText method.

2002-07-02  Darin Adler  <darin@apple.com>

	- fixed 2978806 -- Crash going to ebay home page

        * khtml/ecma/kjs_navigator.cpp: (PluginBase::PluginBase): Check to be sure
	that we are not at the end of the "tokens" collection before dereferencing
	the iterator.

2002-07-01  Maciej Stachowiak  <mjs@apple.com>

        Fixed Radar 2953256 - JavaScript window.moveTo() and
	window.moveBy() methods do not work

	This was done by creating a class to wrap an NSWindow as a
	QWidget, which should be useful for many other window-related
	features.
	
	* kwq/KWQWidget.mm:
        (QWidget::x): Implement in terms of the virtual frameGeometry() method.
        (QWidget::y): Likewise.
        (QWidget::width): Likewise.
        (QWidget::height): Likewise.
        (QWidget::size): Likewise.
        (QWidget::pos): Likewise.
        (QWidget::topLevelWidget): Implement by creating a KWQWindowWidget
        (QWidget::isVisible): Added FIXME comment.
        * kwq/KWQWindowWidget.h: Added.
        * kwq/KWQWindowWidget.mm: Added.
	(KWQWindowWidget::fromNSWindow): Static method that maintains a
	dictionary of top-level widgets, and creates them on demand.
        (deleteOnWindowClose): Delete top level widget on close.
        (KWQWindowWidget::KWQWindowWidget):
        (KWQWindowWidget::~KWQWindowWidget):
        (KWQWindowWidget::sizeHint): Implemented using NSWindow.
        (KWQWindowWidget::minimumSizeHint): Likewise.
        (KWQWindowWidget::frameGeometry): Likewise.
        (KWQWindowWidget::topLevelWidget): Likewise.
        (KWQWindowWidget::mapToGlobal): Likewise.
        (KWQWindowWidget::mapFromGlobal): Likewise.
        (KWQWindowWidget::setCursor): No-op implementation.
        (KWQWindowWidget::internalSetGeometry): Implemented using NSWindow.
        * kwq/Makefile.am: Add new files to build.
        * kwq/qt/qwidget.h: Make methods virtual as needed.

2002-07-01  Darin Adler  <darin@apple.com>

        * khtml/css/cssparser.cpp:
        * khtml/misc/htmlhashes.cpp:
	Remove workaround for a PFE bug that no longer affects us.

        * khtml/xml/dom_nodeimpl.h:
        * khtml/xml/dom_nodeimpl.cpp:
	Remove some unneeded APPLE_CHANGES.

        * WebCore.exp: One less symbol to export.

2002-06-29  Maciej Stachowiak  <mjs@apple.com>

        WebCore part of fix for:

	Radar 2942074 - JavaScript size, positioning and feature
	parameters to window.open are ignored

        * kwq/WebCoreBridge.h: Add new calls needed for window
	size/position/feature getting and setting.
        * kwq/KWQKHTMLPartBrowserExtension.mm:
        (KHTMLPartBrowserExtension::createNewWindow): Set properties on window
	after creating it using new bridge calls; make it visible.
	* khtml/ecma/kjs_window.cpp:
        (WindowFunc::tryCall): Support scrollbars feature too.
        * kwq/kparts/browserextension.h: Include scrollbar setting stuff.

2002-06-28  Richard Williamson  <rjw@apple.com>

        Use float character measurement to determine selection
        region.  Necessary to ensure accuracy of selection
        region.  First step towards weaning khtml off int
        measurements.
        
        * khtml/rendering/font.cpp:
        (Font::floatWidth):
        (Font::floatCharacterWidth):
        * khtml/rendering/font.h:
        * khtml/rendering/render_text.cpp:
        (TextSlave::checkSelectionPoint):
        * kwq/KWQFontMetrics.mm:
        (QFontMetrics::floatWidth):
        (QFontMetrics::floatCharacterWidth):
        * kwq/WebCoreTextRenderer.h:
        * kwq/qt/qfontmetrics.h:

2002-06-27  Chris Blumenberg  <cblu@apple.com>

	Added an APPLE_CHANGES to fix 2894742. The attributes of an EMBED tag
	must override the attributes of PARAM tags.

        * khtml/rendering/render_frames.cpp:
        (RenderPartObject::updateWidget):

2002-06-27  Darin Adler  <darin@apple.com>

	- fixed 2973342 -- copied text seems to have an extra blank line between paragraphs

        * khtml/khtml_part.cpp: (KHTMLPart::selectedText):
	Get rid of code that was adding an extraneous newline at the
	ends of various types of nodes, including <P>

2002-06-27  Darin Adler  <darin@apple.com>

	Fix Java. My changes this morning broke it.

        * khtml/rendering/render_applet.cpp: (RenderApplet::processArguments):
	Re-add required APPLE_CHANGES. Pass arguments to KJavaAppletWidget::processArguments.
        * kwq/khtml/java/kjavaappletwidget.h: Added KJavaAppletWidget::processArguments.
        * kwq/KWQKJavaAppletWidget.mm: (KJavaAppletWidget::processArguments): Added.

	Some QFont fixes.

        * kwq/qt/qfont.h: Remove unused setPixelSizeFloat.
        * kwq/KWQFont.mm: Change to keep family names in a set. Since there are only
	a small number of family names ever encountered, this is a bit of a memory win.
        (QFont::QFont): Don't retain the family name.
        (QFont::~QFont): Don't release the family name.
        (QFont::setFamily): Put the family name in a set, and use the one from the set.
        (QFont::operator=): Don't retain or release.
        (QFont::operator==): Use == to compare the name.

=== Alexander-10 ===

2002-06-27  Richard Williamson  <rjw@apple.com>

        Method name changes in preparation for fixing
        TextSlave::checkSelectionPoint().
        
        * kwq/WebCoreTextRenderer.h:

2002-06-27  Richard Williamson  <rjw@apple.com>

        Removed calls to old method.
        
        * kwq/KWQPainter.mm:
        (QPainter::drawText):
        * kwq/WebCoreTextRenderer.h:
        Removed old methods.

2002-06-27  Darin Adler  <darin@apple.com>

        * khtml/rendering/render_applet.cpp: Remove include of <iostream.h> to avoid bloat.
        (RenderApplet::RenderApplet): Remove APPLE_CHANGES.
        (RenderApplet::processArguments): Remove APPLE_CHANGES.
	This file is now back to 100% the same as the KDE original.

        * kwq/khtml/java/kjavaappletwidget.h: Added a bit of stuff so we match the interface
	of the KDE original and don't need APPLE_CHANGES.
        * kwq/KWQKJavaAppletWidget.mm: Remove include of <iostream.h> to avoid bloat.
        (KJavaAppletWidget::KJavaAppletWidget): Update for parameters that match the
	KDE original.
        (KJavaAppletWidget::~KJavaAppletWidget): Added.
        (KJavaAppletWidget::setBaseURL): Added.
        (KJavaAppletWidget::setParameter): Put strings into an NSMutableDictionary.
        (KJavaAppletWidget::showApplet): Use the new baseURL and parameters dictionary.

        * kwq/WebCoreViewFactory.h: Add baseURL parameter.
        * kwq/WebCoreViewFactory.m:
        (-[WebCoreViewFactory viewForJavaAppletWithFrame:baseURL:parameters:]): Add baseURL parameter.

        * kwq/kdecore/kurl.h: Fix NSURL definition to fit idiom.
        * kwq/qt/qmap.h: Added the const version of the [] operator.

        * khtml/ecma/kjs_navigator.cpp: Tweak whitespace.
        * khtml/html/html_documentimpl.cpp: Tweak to make it a little closer to original.

        * kwq/KWQKCookieJar.h: Reduce includes.
        * kwq/KWQKCookieJar.mm: Move includes in here.

        * kwq/WebCoreCookieAdapter.h: Fix comment that emacs munged.

2002-06-27  Richard Williamson  <rjw@apple.com>

        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge selectAll]):
        Select all using the part.

2002-06-27  Maciej Stachowiak  <mjs@apple.com>

	WebCore part of fixes for JavaScript cookie bugs:
	
	2943749 - JavaScript navigator.cookieEnabled property is always "true"
	2856039 - JavaScript document.cookies property is not implemented
	
	Thereby also fixing:
	
	2944378 - Trying to log into my Yahoo web mail account sent
	Alexander into a loop
	
        * kwq/KWQKCookieJar.h: Added.
        * kwq/KWQKCookieJar.mm: Added.
        (KWQKCookieJar::cookie): C++ veneer over WebCoreCookieAdapter call.
        (KWQKCookieJar::setCookie): Likewise.
        (KWQKCookieJar::cookieEnabled): Likewise.
        * kwq/Makefile.am: Add new files to build.
        * kwq/WebCoreCookieAdapter.h: Added.
        * kwq/WebCoreCookieAdapter.m: Added.
	(+[WebCoreCookieAdapter sharedAdapter]): Method to return shared
	instance, al la the WebCoreFactory classes.
        (-[WebCoreCookieAdapter init]): Establish self as shared instance.
        (-[WebCoreCookieAdapter cookiesEnabled]): No-op implementation.
        (-[WebCoreCookieAdapter cookiesForURL:]): Likewise.
        (-[WebCoreCookieAdapter setCookies:forURL:]): Likewise.
        * WebCore.exp: Export WebCoreCookieAdapter class.
        * khtml/ecma/kjs_navigator.cpp:
        (Navigator::getValueProperty): Call appropriate KWQCookieJar method.
        * khtml/html/html_documentimpl.cpp:
        (HTMLDocumentImpl::cookie): Call appropriate KWQCookieJar method.
        (HTMLDocumentImpl::setCookie): Likewise

2002-06-27  Chris Blumenberg  <cblu@apple.com>

	Fix to support sending PARAM tags to the Java plug-in.

        * khtml/rendering/render_applet.cpp:
        (RenderApplet::RenderApplet): removed APPLE_CHANGES
        (RenderApplet::layout): removed APPLE_CHANGES
        * kwq/KWQKJavaAppletWidget.mm:
        (KJavaAppletWidget::KJavaAppletWidget): removed setView
        (KJavaAppletWidget::showApplet): call setView here
        * kwq/WebCoreViewFactory.h:
        * kwq/WebCoreViewFactory.m:
        (-[WebCoreViewFactory viewForJavaAppletWithFrame:andArguments:]): renamed
        * kwq/khtml/java/kjavaappletwidget.h: added KJavaApplet

2002-06-26  Richard Williamson  <rjw@apple.com>

        Many improvements to selection.  More Cocoa like,
        normalized all text drawing code paths for selected 
        and unselected cases.  Still need to work on
        TextSlave::checkSelectionPoint.  Fixed redraw region
        problems.
        
        khtml redraw the entire visible region when selection changes.
        This could be optimzed.
        
        * khtml/rendering/font.cpp:
        (Font::drawText):
        (Font::width):
        * khtml/rendering/render_text.cpp:
        (TextSlave::printSelection):
        * kwq/KWQPainter.mm:
        (QPainter::drawText):
        (QPainter::selectedTextBackgroundColor):
        * kwq/KWQScrollView.mm:
        (QScrollView::contentsX):
        (QScrollView::contentsY):
        * kwq/WebCoreTextRenderer.h:
        * kwq/qt/qpainter.h:

2002-06-26  Maciej Stachowiak  <mjs@apple.com>

        Implement KHTMLPart::findFrame() to fix the following Radar bugs:
        
        Radar 2943177 - infinite JavaScript loop sfcu.org online bill paying
        Radar 2950580 - Unknown JavaScript properties on the Window object return self instead of Undefined
        
        * khtml/khtml_part.cpp:
        (KHTMLPart::findFrame):
        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPartImpl::findFrame):
        * kwq/KWQKHTMLPartImpl.h:

2002-06-26  Darin Adler  <darin@apple.com>

	- fixed 2969378 -- "A with hat" characters (Unicode 00C2) showing up at Zingermans.com

        * kwq/KWQCharsets.mm: (buildDictionaries): Put UTF-16 in the dictionary, but pointing
	at the string encoding for UTF-8. This mimics what Internet Explorer does.

        * kwq/KWQtextcodec.mm: (QTextCodec::fromUnicode): Fix implementation so it will convert
	the specified encoding instead of always Latin-1.

2002-06-26  Darin Adler  <darin@apple.com>

	Fixed (or at least worked around) a crash I saw where KWQKHTMLPartImpl::end was
        making calls after the KHTMLView was gone. This is specific to our APPLE_CHANGES
        code; it's handled differently in KDE.

        * khtml/khtml_part.h: Added detachView.
        * khtml/khtml_part.cpp: (KHTMLPart::detachView): Added. Nils out the view pointer.
        * khtml/khtmlview.cpp: (KHTMLView::~KHTMLView): Call m_part->detachView().
        * kwq/KWQKHTMLPart.mm: (KWQKHTMLPartImpl::end): Don't try to make calls to the view
        if it's nil.

2002-06-25  Richard Williamson  <rjw@apple.com>
        
        Support for khtml style selection drawing.  Ugly,
        we'll want to make this more Mac like.

        * khtml/rendering/font.cpp:
        (Font::drawText):
            Enable khtml code path.  Removed APPLE_CHANGES
        * kwq/KWQFontMetrics.mm:
        (QFontMetrics::charWidth):
            Implemented in terms of width().
        * kwq/KWQPainter.mm:
        (QPainter::drawText):
            Implemented.
        * kwq/qt/qfontmetrics.h:
            Added QFontMetrics::charWidth.

2002-06-25  Richard Williamson  <rjw@apple.com>

        Support for rudimentary plain text 'copy'.
        
        * kwq/WebCoreBridge.h:
        * kwq/WebCoreBridge.mm:
        (-[WebCoreBridge selectedText]):

2002-06-25  Richard Williamson  <rjw@apple.com>

        Enabled progressive image loading code.

        * khtml/misc/loader.cpp:
        (CachedImage::data):
        * kwq/KWQPixmap.mm:
        (QPixmap::QPixmap):

2002-06-25  Darin Adler  <darin@apple.com>

	Removed remaining uses of BORROWED defines.
	Made some simplifications and formatting fixes. All safe.

        * kwq/KWQArrayImpl.h:
        * kwq/KWQArrayImpl.mm:
        * kwq/KWQChar.mm:
        * kwq/KWQCharsets.mm:
        * kwq/KWQFile.mm:
        * kwq/KWQKCursor.mm:
        * kwq/KWQKHTMLPart.mm:
        * kwq/KWQListImpl.h:
        * kwq/KWQMapImpl.mm:
        * kwq/KWQString.mm:
        * kwq/KWQValueListImpl.mm:
        * kwq/KWQVectorImpl.h:
        * kwq/KWQtextcodec.mm:
        * kwq/make-charset-table.pl:
        * kwq/make-mac-encodings.c:
        * kwq/qt/qfile.h:
        * kwq/qt/qregexp.h:
        * kwq/qt/qtextcodec.h:

        * WebCore-tests.exp: Small change to exports for the array test.

2002-06-24  Chris Blumenberg  <cblu@apple.com>

	Changed the plug-in view constructor to take NSURL's rather
	than URL strings.	

        * kwq/KWQKHTMLPart.mm:
        (KWQKHTMLPartImpl::requestObject):
        * kwq/WebCoreViewFactory.h:
        * kwq/WebCoreViewFactory.m:

2002-06-24  Darin Adler  <darin@apple.com>

        * khtml/khtmlview.cpp: (KHTMLView::~KHTMLView): Put APPLE_CHANGES
        later in the sequence so we don't deref the part before the code
        gets to run.

        * kwq/kwqdebug.h: Re-add the __format__ attribute, now that Radar
        2920557 is fixed.

2002-06-21  Darin Adler  <darin@apple.com>

        * kwq/KWQFont.mm: Made it store a copy of the family name instead of
	storing a reference to the mutable CFString.

        * kwq/KWQPainter.mm:
        (QPainter::drawPixmap): Simplified.
        (QPainter::drawTiledPixmap): Used the new [tileInRect:].

        * kwq/WebCoreImageRenderer.h: Added [tileInRect:], removed [drawInRect:],
	and also removed view parameter from [beginAnimation].
	
        * kwq/qt/qpixmap.h: Removed unneeded getImageRenderer().

2002-06-21  Darin Adler  <darin@apple.com>

        - fixed 2964718 -- crash in KWQCheckCacheObjectStatus

	* kwq/KWQKloader.mm: (KWQCheckCacheObjectStatus):
	Handle case of nil object. Add comments. Remove questionable use
	of floating point abs() to convert always positive int to uint.

2002-06-20  Darin Adler  <darin@apple.com>

	* kwq/KWQKCharsets.mm: Removed unneeded parts.
	* kwq/KWQStyle.mm: Removed.
	* kwq/KWQToolTip.mm: Removed.
	* kwq/KWQVariant.mm: Simplified.
	* kwq/Makefile.am: Removed KWQStyle.mm and KWQToolTip.mm.

	* kwq/KWQRefPtr.h: Streamlined implementation that inlines
	a bit less and is more efficient for creating empty pointers.

	* kwq/KWQStyle.h: Removed unused stuff.

	* kwq/kdecore/kcharsets.h: Removed unneeded parts.
	* kwq/qt/qsortedlist.h: Removed unneeded parts.
	* kwq/qt/qtooltip.h: Removed unneeded parts.
	* kwq/qt/qvariant.h: Removed unneeded parts.

	* khtml/khtmlview.cpp: (KHTMLView::~KHTMLView):
	Remove unneeded APPLE_CHANGES -- no need to nil something out in
	a destructor.

=== Alexander-9 ===

2002-06-19  Richard Williamson (local)  <rjw@apple.com>

	* kwq/KWQScrollView.mm:
	(QScrollView::addChild):
	    Fixed regression from fix to 2956444.  Wrong view was being checked
	    for conformance to WebCoreFrameView.
	* kwq/KWQWidget.mm:
	(QWidget::internalSetGeometry):
	    Fixed regression from fix to 2956444.  Wrong view was being checked
	    for conformance to WebCoreFrameView.

2002-06-19  Richard Williamson (local)  <rjw@apple.com>

	* khtml/khtmlview.cpp: (KHTMLView::~KHTMLView): 
	    Tweak
	* khtml/rendering/render_image.cpp:
	(RenderImage::setPixmap):
	    Call stopAnimations when a image changes, i.e. may be changed
	    by JS.
	* kwq/KWQPixmap.mm:
	(QPixmap::stopAnimations):
	    Call image renderer's stopAnimation.
	* kwq/qt/qpixmap.h:
        Added stopAnimations.
        
2002-06-19  Darin Adler  <darin@apple.com>

	- fixed 2956444 -- mac os x feedback form missing textarea

	* kwq/WebCoreFrameView.h: Added.

	* kwq/KWQWidget.mm:
	(QWidget::setCursor): Checked for cursor-setting call based on the
	WebCoreFrameView protocol instead of using an informal protocol.
	Also walk up the view chain so the cursor actually gets set.
	(QWidget::internalSetGeometry): Changed the special case in here to use the new
	WebCoreFrameView protocol, so it won't happen for all NSScrollView objects.
	Also add comments to explain the hack better and mention the code in QScrollView.

	* kwq/KWQScrollView.mm:
	(-[NSView _KWQ_isScrollView]): Gave these KWQ names instead of IF names.
	(-[NSView _KWQ_getDocumentView]): Gave these KWQ names instead of IF names.
	(QScrollView::addChild): Changed the special case in here to use the new
	WebCoreFrameView protocol, so it won't happen for all NSScrollView objects.
	Also add comments to explain the hack better and mention the code in QWidget.

	Other changes:

	* kwq/kwqdebug.h: Cloned improved assert code from WebFoundation.

	* kwq/KWQTextArea.h: Removed unused isReadOnly/setReadOnly.
	* kwq/KWQTextArea.mm: Removed unused isReadOnly/setReadOnly.

	* kwq/WebCoreViewFactory.h: Removed extraneous import and WebCoreCursorSetting
	API from here.

	* kwq/KWQTextEdit.mm: Tweaked.
	* kwq/kparts/part.h: Tweaked.

2002-06-18  Kenneth Kocienda  <kocienda@apple.com>

        Fix for this bug:

        Radar 2928483 (activity viewer does not show all the pieces of a web page when the page is cached)

	* khtml/misc/loader.cpp:
	(DocLoader::requestImage): Added APPLE_CHANGES call to the KWQCheckCacheObjectStatus function 
                                   described below 
	(DocLoader::requestStyleSheet): ditto
	(DocLoader::requestScript): ditto
	* kwq/KWQKloader.mm:
	(KWQCheckCacheObjectStatus): New function that informs WebKit of the
                                     fact that a URL was loaded from the WebCore/khtml cache.
	* kwq/KWQLoaderImpl.h: Added prototype for KWQCheckCacheObjectStatus
	* kwq/WebCoreBridge.h: Added KWQCheckCacheObjectStatus to WebCoreBridge protocol

2002-06-18  Darin Adler  <darin@apple.com>

	* kwq/KWQKHTMLPart.mm: (KWQKHTMLPartImpl::~KWQKHTMLPartImpl):
	Remove an NSLog I left in by accident.

2002-06-17  Richard Williamson  <rjw@apple.com>

    Fixed window.open regression.
    Partial fix to targeting frame of new name.
    
	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::urlSelected):
	    Partial fix to frame not found problem.
	* kwq/KWQKHTMLPartBrowserExtension.mm:
	(KHTMLPartBrowserExtension::createNewWindow):
	    Fix for window.open regression.
	* kwq/WebCoreBridge.h:
        Changed return type of openNewWindowWithURL:

2002-06-17  Darin Adler  <darin@apple.com>

	Fixed a storage leak.

	* kwq/WebCoreBridge.mm: (-[WebCoreBridge documentTextFromDOM]): Add a missing autorelease.

	Remove a bunch of loader-related APPLE_CHANGES.

	* khtml/misc/loader.h: Remove KWQURLLoadClient and KWQLoaderImpl.
	* khtml/misc/loader.cpp:
	(Loader::Loader): Remove unneeded KWQLoaderImpl object.
	(Loader::~Loader): Remove unneeded KWQLoaderImpl object.
	(Loader::servePendingRequests): Call KWQServeRequest instead of KWQLoaderImpl::serveRequest.
	(Loader::slotFinished): Remove unneeded KWQLoaderImpl::objectFinished.

	* kwq/KWQLoaderImpl.h:
	* kwq/KWQKloader.mm: (KWQServeRequest): Replaces the KWQLoaderImpl class. The rest of what
	was in this class was obsolete.

2002-06-17  Richard Williamson  <rjw@apple.com>

    Fixed www.2cpu.com regression.  QWidget::_displayRect was displaying the wrong
    view.  This was a regression that would impact all DHTML.

	* khtml/khtmlview.cpp:
	(KHTMLView::timerEvent):
	* kwq/KWQScrollView.mm:
	(QScrollView::updateContents):
	* kwq/KWQWidget.mm:
	(QWidget::QWidget):
	(QWidget::endEditing):
	* kwq/qt/qwidget.h:

2002-06-17  Darin Adler  <darin@apple.com>

	Fixed bug where some images would get left behind when scrolling. Turned out it
	was all the tiled images that were getting left behind.

	* kwq/KWQPainter.mm: (QPainter::drawTiledPixmap): Fixed to get the view for
	coordinates from [NSView focusView] the way drawPixmap does, rather than using
	data->widget->getView(), which gives the scroll view instead of the scrolled view.

2002-06-16  Darin Adler  <darin@apple.com>

	* kwq/KWQKHTMLPart.mm: (KWQKHTMLPartImpl::frames):
	Fixed this function to get from frames to parts properly. It was still
	assuming that [WebCoreBridge childFrames] would return a list of WebCoreBridge
	objects, but now it returns WebCoreFrame objects.

	* kwq/WebCoreFrame.h: Added [WebCoreFrame bridge] for the case above.
	Note that it always gives the "committed" bridge, not the provisional one.

2002-06-16  Darin Adler  <darin@apple.com>

	Add a separate WebCoreFrame alongside WebCoreBridge to facilitate
	handling of frames with no HTML content in them. This probably fixes
	frames named "_blank".

	Also fixed the build, because a clean build failed.

	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::openURLInFrame):
	(KWQKHTMLPartImpl::urlSelected):
	(KWQKHTMLPartImpl::requestFrame):
	(KWQKHTMLPartImpl::submitForm):
	(KWQKHTMLPartImpl::parentPart):
	Work with WebCoreFrame objects instead of WebCoreBridge objects when dealing with
	frame operations -- loading new URLs mainly.

	* kwq/WebCoreBridge.h: Removed frame-related operations, now they are on WebCoreFrame.
	Broke out WebCoreResourceLoader into its own file. Added comments.

	* kwq/WebCoreFrame.h: Added.

	* kwq/WebCoreResourceLoader.h: Added.
	* kwq/KWQKloader.mm: Include WebCoreResourceLoader.h now that it's broken out.

	* WebCore-tests.exp: Tests still need QString::latin1(), although we don't need
	to export it for WebKit any more.

2002-06-16  Darin Adler  <darin@apple.com>

	Moved the IFURLHandleClient subclass to WebKit, so it can some day be merged
	with the one for the frames themselves; this one is for resources.

	* kwq/kio/jobclasses.h:
	* kwq/KWQKjobclasses.mm:
	(TransferJob::setHandle): Replaced the old TransferJob::begin with this.

	* kwq/KWQLoaderImpl.h: Remove setClient.
	* kwq/KWQKloader.mm:
	(-[WebCoreResourceLoader initWithLoader:job:]): Added.
	(-[WebCoreResourceLoader dealloc]): Added.
	(-[WebCoreResourceLoader addData:]): Added.
	(-[WebCoreResourceLoader cancel]): Added.
	(-[WebCoreResourceLoader finish]): Added.
	(KWQLoaderImpl::serveRequest): Use [WebCoreBridge startLoadingResource:withURL:].
	* khtml/misc/loader.cpp: (Loader::load): Removed unneeded call to setClient.

	* kwq/WebCoreBridge.h: Remove unneeded methods. Added [WebCoreBridge startLoadingResource:withURL:].

2002-06-15  Darin Adler  <darin@apple.com>

	Fix frame-related calls. I was always searching all the frames, which was disastrous.
	Also do name changes.

	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::urlSelected): Use descendantFrameNamed rather than frameNamed.
	(KWQKHTMLPartImpl::requestFrame): Use childFrameNamed rather than frameNamed.
	(KWQKHTMLPartImpl::frameExists): Use childFrameNamed rather than frameNamed.

	* kwq/KWQScrollView.mm: (QScrollView::addChild): Asserts I used while debugging.

	* kwq/WebCoreBridge.h: Add new calls. Change names of old ones to include the
	word frame consistently. (Also bits of new work that will do no harm, but are
	not really needed yet.)

2002-06-15  Darin Adler  <darin@apple.com>

	* kwq/KWQKloader.mm:
	(-[KWQURLLoadClient IFURLHandle:didRedirectToURL:]):
	Rolled out an assert I added by accident that will break Deployment builds.

2002-06-15  Darin Adler  <darin@apple.com>

	* kwq/KWQKloader.mm:
	(-[KWQURLLoadClient IFURLHandleResourceDidCancelLoading:]):
	(-[KWQURLLoadClient IFURLHandleResourceDidFinishLoading:data:]):
	(-[KWQURLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]):
	Fixed the order so the URL handles are removed before we send notifications
	as before my change. This seems to fix the rest of the breakage.

2002-06-15  Darin Adler  <darin@apple.com>

	* kwq/KWQKloader.mm: (-[KWQURLLoadClient initWithLoader:bridge:]):
        Fix bridge/m_bridge typo that was responsible for at least some of the breakage
        I caused.

2002-06-15  Richard Williamson  <rjw@apple.com>

    Fixed factoring problem.
    
	* kwq/KWQScrollView.mm:
	(-[NSView _IF_getDocumentView]):
	(-[NSView _IF_isScrollView]):
	(QScrollView::visibleWidth):
	(QScrollView::visibleHeight):
	(QScrollView::contentsWidth):
	(QScrollView::contentsHeight):
	(QScrollView::contentsX):
	(QScrollView::contentsY):
	(QScrollView::setContentsPos):
	(QScrollView::addChild):
	(QScrollView::resizeContents):
	(QScrollView::contentsToViewport):
	(QScrollView::viewportToContents):
	* kwq/qt/qscrollview.h:

2002-06-15  Darin Adler  <darin@apple.com>

	* kwq/WebCoreBridge.mm:
	(-[WebCoreBridge createKHTMLViewWithNSView:width:height:marginWidth:marginHeight:]):
	Implement the rule where a negative number means "don't set the margin".

2002-06-15  Darin Adler  <darin@apple.com>

	* kwq/kio/jobclasses.h: Removed import of WebFoundation.h.
	* kwq/KWQKjobclasses.mm: Added import of IFURLHandle.h.
	* kwq/KWQKloader.mm: Added import of IFError.h and IFURLHandle.h.

	* kwq/WCLoadProgress.h: Removed.
	* kwq/WCWebDataSource.h: Removed.
	* kwq/KWQKHTMLPart.mm: Removed import of WCWebDataSource.h.

	* *.mm: Changed all includes to imports using a perl script.

2002-06-15  Darin Adler  <darin@apple.com>

	- fixed 2942808 -- remove all calls to WebKit from WebCore

	More work on the bridge. Now we don't call anything in WebKit explicitly,
	although there are still implicit connections that need to be fixed.

	* WebCore.exp: Remove exports that are no longer needed, now that
	WebKit is using the bridge to get at more things.

	* khtml/misc/loader.h:
	* khtml/misc/loader.cpp:
	(CachedCSSStyleSheet::CachedCSSStyleSheet):
	(CachedScript::CachedScript):
	(CachedImage::CachedImage):
	Remove the extra parameter to the CachedObject constructor. We don't
	need it any more, so we can remove all these APPLE_CHANGES.

	* kwq/KWQKHTMLPart.mm: Remove getDataSource.

	* kwq/KWQLoaderImpl.h: Remove destructor.
	* kwq/KWQKloader.mm:
	(-[KWQURLLoadClient initWithLoader:bridge:]): Keep the bridge around instead
	of the data source.
	(-[KWQURLLoadClient dealloc]): Release the bridge instead of the data source.
	Also put another workaround for 2954901 here, like in WebKit.
	(-[KWQURLLoadClient IFURLHandleResourceDidBeginLoading:]):
	(-[KWQURLLoadClient IFURLHandle:resourceDataDidBecomeAvailable:]):
	(-[KWQURLLoadClient doneWithHandle:error:]):
	(-[KWQURLLoadClient IFURLHandleResourceDidCancelLoading:]):
	(-[KWQURLLoadClient IFURLHandleResourceDidFinishLoading:data:]):
	(-[KWQURLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]):
	(-[KWQURLLoadClient IFURLHandle:didRedirectToURL:]):
	(KWQLoaderImpl::setClient):
	(KWQLoaderImpl::serveRequest):
	Use the bridge to do all the heavy lifting, and put lots of common code into
	a doneWithHandle:error: method. Also store the URL so the redirect code works
	properly for multiple redirects and add asserts like the ones in IFMainURLHandleClient.
	(KWQLoaderImpl::objectFinished): Add a comment.

	* kwq/WebCoreBridge.h: Make header so it can be included from plain Objective C,
	not just Objective C++. Add a bunch of methods for bridging in to WebCore as opposed
	to out of WebCore. Add new methods for bridging out from WebCore too for all the
	progress hooks. Put all the subclass responsibility methods into a protocol
	in such a way that we don't need to implement them in the base class, and subclasses
	can set things up so they get errors if they forget to implement anything.

	* kwq/WebCoreBridge.mm:
	(-[WebCoreBridge openURL:]): Added.
	(-[WebCoreBridge addData:withEncoding:]): Added.
	(-[WebCoreBridge closeURL]): Added.
	(-[WebCoreBridge end]): Added.
	(-[WebCoreBridge setURL:]): Added.
	(-[WebCoreBridge createKHTMLViewWithNSView:width:height:marginWidth:marginHeight:]): Added.
	(-[WebCoreBridge documentTextFromDOM]): Added.
	(-[WebCoreBridge scrollToBaseAnchor]): Added.

	* kwq/external.h: Removed.

2002-06-15  Maciej Stachowiak  <mjs@apple.com>

	Get current bits per pixel from CoreGraphics, thereby fixing
        
        Radar 2943736 - JavaScript screen.colorDepth and screen.pixelDepth properties always returns 32, 
        regardless of real depth
        
        * kwq/KWQPaintDeviceMetrics.mm:
	(QPaintDeviceMetrics::depth):

2002-06-15  Maciej Stachowiak  <mjs@apple.com>

	Removed product and vendor properties, thereby fixing:
        
        Radar 2943751 - JavaScript navigator.product property is "Konqueror/khtml"
        Radar 2943753 - JavaScript navigator.vendor property is "KDE"
        
        * khtml/ecma/kjs_navigator.cpp:
	(Navigator::getValueProperty): Return undefined for the above mentioned properties.

2002-06-15  Maciej Stachowiak  <mjs@apple.com>

        Implemented functionality needed for missing Screen properties, thereby fixing the following
        bugs:
        
        Radar 2943730 - JavaScript screen.availHeight property is not implemented
        Radar 2943732 - JavaScript screen.availLeft property is not implemented
        Radar 2943734 - JavaScript screen.availTop property not implemented
        Radar 2943735 - JavaScript screen.availWidth property is not implemented
        
	* kwq/KWQKWinModule.mm:
	(KWinModule::workArea): Return the correct screen size to fix the above bugs.

2002-06-14  Richard Williamson  <rjw@apple.com>

    Changed IFResourceProgressHandler to pass back resource handle instead of
    string description.  This will address the needs descibed in 2954160.

	* kwq/KWQKloader.mm:
	(-[KWQURLLoadClient IFURLHandleResourceDidBeginLoading:]):
	(-[KWQURLLoadClient IFURLHandleResourceDidCancelLoading:]):
	(-[KWQURLLoadClient IFURLHandleResourceDidFinishLoading:data:]):
	(-[KWQURLLoadClient IFURLHandle:resourceDataDidBecomeAvailable:]):
	(-[KWQURLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]):
	(-[KWQURLLoadClient IFURLHandle:didRedirectToURL:]):
	(KWQLoaderImpl::serveRequest):
	* kwq/external.h:

2002-06-14  Darin Adler  <darin@apple.com>

	* kwq/KWQDateTime.mm: Add ifdefs needed to make Deployment build compile.

2002-06-14  Darin Adler  <darin@apple.com>

	Worked on eliminating calls to WebKit. About 3/4 done.

	* WebCore.exp: Export new WebCoreBridge class, fewer other things.

	* WebCorePrefix.h: #include <ostream> in debug builds; we couldn't
	before because of a PFE bug that has since been fixed (2920556).

	* khtml/html/html_objectimpl.cpp: (HTMLObjectElementImpl::attach):
	Add a comment explaining our latest change here.

	* khtml/khtml_part.cpp: (KHTMLPart::~KHTMLPart): Fix storage leak
	by deleting m_hostExtension.

	* khtml/misc/loader.h: Set type properly on client member so we
	don't have to do so much casting.

	* kwq/KWQKHTMLPartImpl.h: Add getBridge and setBridge, remove setDataSource.
	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::KWQKHTMLPartImpl): Eliminate m_dataSource.
	(KWQKHTMLPartImpl::openURLInFrame): Use WebCoreBridge.
	(KWQKHTMLPartImpl::urlSelected): Use WebCoreBridge.
	(KWQKHTMLPartImpl::requestFrame): Use WebCoreBridge.
	(KWQKHTMLPartImpl::requestObject): Move WebCoreViewFactory code
	here; we don't need an entire WCPluginWidget file just for this
	function.
	(KWQKHTMLPartImpl::submitForm): Use WebCoreBridge.
	(KWQKHTMLPartImpl::frameExists): Use WebCoreBridge.
	(KWQKHTMLPartImpl::frames): Use WebCoreBridge.
	(KWQKHTMLPartImpl::setTitle): Use WebCoreBridge.
	(KWQKHTMLPartImpl::getDataSource): Use WebCoreBridge.
	(KWQKHTMLPartImpl::parentPart): Use WebCoreBridge.

	* kwq/KWQKHTMLPartBrowserExtension.mm:
	(KHTMLPartBrowserExtension::createNewWindow): Use WebCoreBridge.

	* kwq/KWQKloader.mm: Move the part of external.h that we still use in
	here, with the expectation of eliminating it soon. Also renamed
	URLLoadClient to KWQURLLoadClient so we don't hog namespace.

	* kwq/qt/qscrollview.h:
	* kwq/KWQScrollView.mm: Used helper functions to do the "documentView"
	selector thing more consistently.

	* kwq/KWQWidget.mm: Get interface for changing the cursor from
	WebCoreViewFactory.h instead of from external.h.

	* kwq/WebCoreViewFactory.h:
	* kwq/Makefile.am: Remove WCPluginWidget.mm, add WebCoreBridge.mm.
	* kwq/WCPluginWidget.h: Removed.
	* kwq/WCPluginWidget.mm: Removed.
	* kwq/WebCoreBridge.h: Added.
	* kwq/WebCoreBridge.mm: Added.

	* kwq/qt/qarray.h: Use <ostream> instead of <iostream>.
	* kwq/qt/qcstring.h: Remove <iostream> include since we include <qarray.h>.
	* kwq/qt/qdatetime.h: Replace unconditional <iostream> include with a
	conditional <ostream> include. Also made streaming operators conditional.
	* kwq/qt/qlist.h: Use <ostream> instead of <iostream>.
	* kwq/qt/qmap.h: Use <ostream> instead of <iostream>.
	* kwq/qt/qpoint.h: Use <iosfwd> instead of <iostream>.
	* kwq/qt/qsize.h: Use <iosfwd> instead of <iostream>.
	* kwq/qt/qvaluelist.h: Use <ostream> instead of <iostream>.
	* kwq/qt/qvector.h: Replace unconditional <iostream> include with a
	conditional <ostream> include. Also made streaming operators conditional.

2002-06-14  Richard Williamson  <rjw@apple.com>

    Name change view -> webView.
    
	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::requestFrame):
	* kwq/external.h:

2002-06-14  Chris Blumenberg  <cblu@apple.com>

	Put #ifndef APPLE_CHANGES around one line that
	was causing EMBED and OBJECT tags to not have render objects.

	* khtml/html/html_objectimpl.cpp:
	(HTMLObjectElementImpl::attach):

2002-06-14  Chris Blumenberg  <cblu@apple.com>

	Committing Richard's changes to KWQPainter

2002-06-13  Richard Williamson  <rjw@apple.com>

    More cleanup to deal with special case of provisional view
    not being in a scrollview.
    
	* kwq/KWQScrollView.mm:
	(QScrollView::contentsWidth):
	(QScrollView::contentsHeight):
	(QScrollView::contentsX):
	(QScrollView::contentsY):

2002-06-13  Richard Williamson  <rjw@apple.com>

    
	* kwq/KWQWidget.mm: (QWidget::setCursor):  restored code
	* kwq/external.h:   removed definitions no longer needed
	* khtml/rendering/render_form.cpp: (RenderLineEdit::calcMinMaxWidth): tweaked size

2002-06-12  Kenneth Kocienda  <kocienda@apple.com>

	* kwq/kwqdebug.h: Made assertion failure console message bolder and easier to see.

2002-06-11  Darin Adler  <darin@apple.com>

	* kwq/KWQKURL.mm:
	(RelativeURLKeyRetainCallBack): Use a ref count.
	(RelativeURLKeyReleaseCallBack): Use a ref count instead of assuming there will
	never be more than one reference.
	(KURL::normalizeRelativeURLString): Remove the workaround for CFURL bug 2891336.
	(operator==): Don't put URLs on the autorelease pool just to compare them.

2002-06-10  Darin Adler  <darin@apple.com>

	* khtml/css/cssstyleselector.cpp: Fix uninitialized variable warning.

2002-06-10  Darin Adler  <darin@apple.com>

	Merged in changes from KDE 3.0.1.

	* kwq/kdecore/kurl.h:
	* kwq/KWQKURL.mm: (operator==): New, needed by some 3.0.1 code.

	* kwq/qt/qpalette.h: Add QPalette::NColorGroups and QColorGroup::NColorRoles.
	* kwq/KWQPalette.mm: Simplify by getting rid of "private" indirection.
	(QPalette::color): New, needed by some 3.0.1 code.
	* kwq/KWQColorGroup.mm: Simplify by getting rid of "private" indirection.

	* kwq/qt/qstring.h:
	* kwq/KWQString.mm: (QConstString::QConstString): Change parameter to const QChar *
	to match Qt so we compile.

	* kwq/qt/qtextedit.h:
	* kwq/KWQTextEdit.mm: (QTextEdit::setTabStopWidth): Add unimplemented placeholder,
	needed by some 3.0.1 code.

	* kwq/qt/qvaluelist.h:
	* kwq/KWQValueListImpl.h:
	* kwq/KWQValueListImpl.mm: Simplify implementation.

	* WebCore-tests.exp: Update for changes in QValueList implementation.

	* kwq/kdecore/klibloader.h: Add include of <kio/global.h> to make something compile.

	* kwq/khtml/java/kjavaappletcontext.h: Add JType and constructor that takes DCOPObject*.

	* kwq/kio/global.h: Add KIO::CacheControl.

	* khtml/css/css_ruleimpl.cpp:
	* khtml/css/css_ruleimpl.h:
	* khtml/css/css_stylesheetimpl.cpp:
	* khtml/css/css_stylesheetimpl.h:
	* khtml/css/css_valueimpl.cpp:
	* khtml/css/css_valueimpl.h:
	* khtml/css/cssparser.cpp:
	* khtml/css/cssparser.h:
	* khtml/css/cssstyleselector.cpp:
	* khtml/css/cssstyleselector.h:
	* khtml/css/html4.css:
	* khtml/dom/css_rule.cpp:
	* khtml/dom/css_rule.h:
	* khtml/dom/css_stylesheet.cpp:
	* khtml/dom/css_stylesheet.h:
	* khtml/dom/css_value.cpp:
	* khtml/dom/dom2_events.cpp:
	* khtml/dom/dom2_range.cpp:
	* khtml/dom/dom2_range.h:
	* khtml/dom/dom2_views.cpp:
	* khtml/dom/dom_doc.cpp:
	* khtml/dom/dom_element.cpp:
	* khtml/dom/dom_exception.h:
	* khtml/dom/dom_node.cpp:
	* khtml/dom/dom_string.cpp:
	* khtml/dom/dom_text.cpp:
	* khtml/dom/dom_xml.cpp:
	* khtml/dom/html_base.cpp:
	* khtml/dom/html_block.cpp:
	* khtml/dom/html_document.cpp:
	* khtml/dom/html_element.cpp:
	* khtml/dom/html_element.h:
	* khtml/dom/html_form.cpp:
	* khtml/dom/html_head.cpp:
	* khtml/dom/html_image.cpp:
	* khtml/dom/html_inline.cpp:
	* khtml/dom/html_list.cpp:
	* khtml/dom/html_misc.cpp:
	* khtml/dom/html_object.cpp:
	* khtml/dom/html_table.cpp:
	* khtml/ecma/kjs_html.cpp:
	* khtml/ecma/kjs_proxy.cpp:
	* khtml/ecma/kjs_traversal.cpp:
	* khtml/ecma/kjs_window.cpp:
	* khtml/html/html_baseimpl.cpp:
	* khtml/html/html_formimpl.cpp:
	* khtml/html/html_miscimpl.h:
	* khtml/html/html_objectimpl.cpp:
	* khtml/html/html_objectimpl.h:
	* khtml/html/htmlparser.cpp:
	* khtml/html/htmlparser.h:
	* khtml/html/htmltokenizer.cpp:
	* khtml/html/htmltokenizer.h:
	* khtml/khtml_part.cpp:
	* khtml/khtmlpart_p.h:
	* khtml/khtmlview.cpp:
	* khtml/misc/helper.cpp:
	* khtml/misc/khtmllayout.h:
	* khtml/misc/loader.cpp:
	* khtml/misc/loader.h:
	* khtml/misc/loader_client.h:
	* khtml/misc/shared.h: Added.
	* khtml/rendering/bidi.cpp:
	* khtml/rendering/break_lines.cpp:
	* khtml/rendering/font.cpp:
	* khtml/rendering/render_applet.cpp:
	* khtml/rendering/render_applet.h:
	* khtml/rendering/render_container.cpp:
	* khtml/rendering/render_form.cpp:
	* khtml/rendering/render_form.h:
	* khtml/rendering/render_frames.cpp:
	* khtml/rendering/render_image.cpp:
	* khtml/rendering/render_object.cpp:
	* khtml/rendering/render_object.h:
	* khtml/rendering/render_replaced.cpp:
	* khtml/rendering/render_replaced.h:
	* khtml/rendering/render_root.cpp:
	* khtml/rendering/render_style.cpp:
	* khtml/rendering/render_style.h:
	* khtml/rendering/render_table.cpp:
	* khtml/rendering/render_table.h:
	* khtml/rendering/render_text.cpp:
	* khtml/rendering/render_text.h:
	* khtml/xml/dom2_eventsimpl.h:
	* khtml/xml/dom2_rangeimpl.h:
	* khtml/xml/dom2_traversalimpl.cpp:
	* khtml/xml/dom2_traversalimpl.h:
	* khtml/xml/dom2_viewsimpl.h:
	* khtml/xml/dom_docimpl.cpp:
	* khtml/xml/dom_docimpl.h:
	* khtml/xml/dom_elementimpl.h:
	* khtml/xml/dom_nodeimpl.cpp:
	* khtml/xml/dom_nodeimpl.h:
	* khtml/xml/dom_stringimpl.cpp:
	* khtml/xml/dom_stringimpl.h:
	* khtml/xml/xml_tokenizer.h:
	Merge in 3.0.1 changes and add APPLE_CHANGES as necessary to get it to compile.

2002-06-07  Darin Adler  <darin@apple.com>

	* Makefile.am: Use new shared "embed.am" file so we don't need four copies of
	the embedding rules for WebFoundation, JavaScriptCore, WebCore, and WebKit.

2002-06-07  Maciej Stachowiak  <mjs@apple.com>

	* Makefile.am: Rename libwebcore.dylib to libwebcore.a; since this
	target is just a fake for dependency purposes, it doesn't matter
	what it's called.
	* .cvsignore: Update ignorance.

2002-06-07  Darin Adler  <darin@apple.com>

	* Makefile.am: I was running into failures in the embed rule, so I made it
	always remove the framework before copying the new one in. This is better
	for cases where a header was removed, too, so maybe we should do this in
	the other directories.

	* kwq/KWQDrawUtil.mm:
	* kwq/KWQKComboBox.mm:
	* kwq/KWQKConfigBase.mm:
	* kwq/KWQKDebug.mm:
	* kwq/KWQKMessageBox.mm:
	* kwq/KWQKMimeType.mm:
	* kwq/KWQKPrinter.mm:
	* kwq/KWQKURL.mm:
	* kwq/KWQMapImpl.mm:
	* kwq/KWQObject.mm:
	* kwq/KWQRegExp.mm:
	* kwq/KWQRegion.mm:
	* kwq/KWQScrollView.mm:
	* kwq/KWQStringList.mm:
	Remove repeated default values for parameters -- the new compiler
	won't allow these and they are illegal C++.

2002-06-07  Darin Adler  <darin@apple.com>

	* kwq/KWQPtrDictImpl.h: Use CoreFoundation.h -- new compiler
	is picky about the difference between struct and typedef.

	* kwq/KWQValueListImpl.h: Add a friend declaration that we need
	because the new compiler is more strict.

	- fix 2949882 -- joecartoon.com crashes

	* khtml/ecma/kjs_window.cpp: (Window::get): Turn off some code that
	doesn't work for us -- similar to code elsewhere in this file that
	was also turned off.

2002-06-07  Chris Blumenberg  <cblu@apple.com>

        Made IFWebController a class.
        Fixed all places where IFWebController was referred to as a protocol.
        Renamed IFBaseWebController files to IFWebController.
        IFWebController.h replaces IFWebBaseController.h.

	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::requestFrame):
	* kwq/KWQKHTMLPartBrowserExtension.mm:
	(KHTMLPartBrowserExtension::createNewWindow):
	* kwq/KWQKloader.mm:
	(-[URLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]):
	(-[URLLoadClient IFURLHandle:didRedirectToURL:]):
	(KWQLoaderImpl::serveRequest):
	* kwq/external.h:

=== Alexander-8 ===

2002-06-07  Darin Adler  <darin@apple.com>

	Try to make Jersey work again.

	* kwq/KWQInvisibleButton.h: Simplify includes.
	* kwq/KWQInvisibleButton.mm: Simplify includes.

2002-06-05  Darin Adler  <darin@apple.com>

	Some fixes to speed up the citibank.com page, and other related changes.

	* khtml/ecma/kjs_dom.cpp: (DOMNode::getValueProperty): Only do a layout
	if it's actually needed. This speeds things up immensely, and I'm pretty
	sure it's correct.

	* kwq/KWQListImpl.h: To speed things up, get rid of the "private part"
	level of indirection. This is particularly vital for list iterators, which
	are created and destroyed a lot on the stack. Also made trivial functions
	be inline.

	* kwq/KWQListImpl.mm:
	(copyList): Now a static function rather than a member of the now-defunct
	private class.
	(KWQListImpl::KWQListImpl): Set up all the new members that used to be in
	the separate private object.
	(KWQListImpl::~KWQListImpl): Update the iterator-detaching code to do it
	the new way, with intrusive list. Also, use clear() instead of having our
	own code to delete the list -- note this is only used after the level above
	us does a clear() anyway.
	(KWQListImpl::clear): Use a loop to delete all the nodes rather than making
	a delete of one node recursively delete the next -- iteration is more efficient,
	and also easier to understand in this case. Also update all the iterators so
	they don't point to deleted nodes.
	(KWQListImpl::containsRef): Update to return the count, rather than just a
	true or false value, since that's how the class is defined.
	(KWQListImpl::assign): Delete the items if asked to (fixes a FIXME). Also
	use a new swap member function since there's more to swap now.
	(KWQListImpl::addIterator): Rewrite to use an intrusive linked list.
	(KWQListImpl::removeIterator): Rewrite to use an intrusive linked list; this
	makes it much faster since it doesn't have to search the list.
	(KWQListImpl::swap): Implement this private member function used by assign.
	(KWQListIteratorImpl::KWQListIteratorImpl): Set up the new members that
	used to be in the separate private object.

	* kwq/qt/qlist.h: Re-add the operator= definition. This would cause a storage
	leak, although I haven't actually observed the leak.

	* kwq/qt/qbuffer.h: Initialize opened to false. This was causing a test failure.

	* kwq/KWQDictImpl.h:
	* kwq/KWQDictImpl.mm: Streamline implementation a bit by getting rid of
	unneeded copy constructor definition and making trivial constructor for
	iterator inline.

	* kwq/KWQPtrDictImpl.h: Remove unneeded include.

	* WebCore-tests.exp: Update for changes in the entry points
	used by the tests.

2002-06-05  Richard Williamson  <rjw@apple.com>

    Fixed 2938552.  This required an implementation of KHTMLPart::frames which
    is used by the JS window.frames property.
    
	* khtml/khtml_part.cpp:
	(KHTMLPart::frames):
	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::frames):
	* kwq/KWQKHTMLPartImpl.h:

2002-06-05  Richard Williamson  <rjw@apple.com>

    Fixed window.top JS property (2939353).  This caused funny recursion problems at
    www.megapixel.net and other pages that try to pop frames.

	* khtml/khtml_part.cpp:
	(KHTMLPart::parentPart):
	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::parentPart):
	* kwq/KWQKHTMLPartImpl.h:

2002-06-05  Richard Williamson  <rjw@apple.com>

    Cleaned up call to frameNamed:.  Now use frame relative naming.
    Fixed various frame related bugs.
    
	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::urlSelected):
	* kwq/external.h:

2002-06-04  Richard Williamson  <rjw@apple.com>

	* kwq/KWQKHTMLPart.mm:
	(KWQKHTMLPartImpl::timerEvent):
	(KWQKHTMLPartImpl::redirectURL):
	
	Renamed redirectJS to redirectURL to more correctly reflect it's
	function.
	
	(KWQKHTMLPartImpl::urlSelected):

    Fixed 2935505.  We now pop out of a frame if a link is clicked in a frame
    and that frame is the only frame in a frameset.  This emulates the behavior of IE.

	* kwq/KWQKHTMLPartImpl.h:
	* kwq/external.h:

2002-06-04  Richard Williamson  <rjw@apple.com>

    More exclusion for pre 6C48.
    
	* kwq/KWQPixmap.mm:
	(QPixmap::QPixmap):

2002-06-04  Kenneth Kocienda  <kocienda@apple.com>

	* kwq/kwqdebug.h: Added a line of stderr output into the 
        assertion failure code so that we have some idea of what happened.

2002-06-04  Richard Williamson  <rjw@apple.com>

    Changes to support progressive image loading.  Currently disabled
    until 2945218 is fixed.
    
	* khtml/misc/loader.cpp:
	* kwq/KWQKloader.mm:
	* kwq/KWQPixmap.mm:
	* kwq/WebCoreImageRenderer.h:
	* kwq/WebCoreImageRendererFactory.h:
	* kwq/WebCoreImageRendererFactory.m:
	* kwq/qt/qpixmap.h:

2002-06-04  Darin Adler  <darin@apple.com>

	- fixed 2943897 -- Initial uncached load of amazon.com renders partial page.

	* khtml/khtml_part.cpp: (KHTMLPart::setEncoding): Put the code that
	reloads the page when the encoding is changed back inside APPLE_CHANGES.
	This was causing partial loads because of how it interacts with our
	way of saving up text and not decoding until we discover what the
	encoding is.

2002-06-03  Darin Adler  <darin@apple.com>

	* LICENSE: Add 2002.
        
	* kwq/KWQApplication.mm:
	* kwq/kdecore/kapplication.h:
	* kwq/qt/qapplication.h:
        Found a way to simplify the application objects by making more of
        the functions static so we don't need to actually allocate an object.

	* kwq/Makefile.am:
	* kwq/KWQKApplication.mm: Removed.
	* kwq/kdecore/kapp.h: Removed.

2002-06-03  Darin Adler  <darin@apple.com>

	A few more unused things.

	* kwq/Makefile.am: Removed KWQKProcess.mm
	* kwq/KWQKProcess.mm: Removed.
	* kwq/KWQStrList.h: Removed.
	* kwq/kdecore/kprocess.h: Removed.

2002-06-03  Darin Adler  <darin@apple.com>

	Forgot one file.

	* kwq/qt/qframe.h: Added.

2002-06-03  Darin Adler  <darin@apple.com>

	Get rid of many unneeded APPLE_CHANGES.
	Also get rid of _KWQ_ and _KWQ_PEDANTIC_.

	* WebCore.exp: Don't export DomShared::ref/deref any more.
	* WebCore-tests.exp: Changed around as needed due to changes in
	the classes being tested.

	* khtml/html/htmlparser.cpp:
	* khtml/html/htmltokenizer.cpp:
	Simplified APPLE_CHANGES for better merging.

	* khtml/dom/dom_misc.h:
	* khtml/dom/dom_misc.cpp:
	* khtml/dom/html_document.cpp:
	* khtml/khtmlview.cpp:
	* khtml/ecma/kjs_css.h:
	* khtml/ecma/kjs_dom.cpp:
	* khtml/ecma/kjs_dom.h:
	* khtml/ecma/kjs_window.cpp:
	* khtml/html/html_formimpl.cpp:
	* khtml/html/html_objectimpl.cpp:
	* khtml/misc/helper.cpp:
	* khtml/rendering/bidi.cpp:
	* khtml/rendering/render_flow.cpp:
	* khtml/rendering/render_form.cpp:
	* khtml/rendering/render_text.cpp:
	* khtml/xml/xml_tokenizer.h:
	* kwq/qt/qtextedit.h:
	Remove now-unneeded APPLE_CHANGES.

	* khtml/misc/loader.cpp: (CachedImage::pixmap): Turned off more of
	the QMovie code.

	* khtml/html/html_documentimpl.cpp:
	* khtml/html/htmltokenizer.h:
	* khtml/xml/dom_elementimpl.h:
	* kwq/KWQKHTMLPart.mm:
	Formatting and other minor tweaks.

	* kwq/KWQApplication.mm: (QApplication::sendEvent): Implemented.
	* kwq/KWQChar.mm: (QChar::direction): Improved implementation.

	* kwq/KWQCollection.h: Removed.
	* kwq/KWQIcon.h: Removed.

	* kwq/Makefile.am: Removed following files.
	* kwq/KWQKCompletionBox.mm: Removed.
	* kwq/KWQKFactory.mm: Removed.
	* kwq/KWQListBox.mm: Removed.
	* kwq/KWQKImageIO.mm: Removed.

	* kwq/KWQObject.mm: (QObject::event): Added, does nothing.
	(QObject::inherits): Put in real implementation (good enough for us).

	* kwq/WCWebDataSource.h: Removed extern declaration of global.

	* kwq/KWQCursor.mm: (QCursor::handle): Made the handle be an
	NSCursor *.

	* kwq/external.h: Moved [IFWebView setFrameSize:] here.
	Got rid of IFAnimatedImage.

	* kwq/KWQDef.h: Remove unused Q_INT8, Q_INT16, Q_UINT8, Q_UINT16,
	QCOORD, WFlags, WId, ASSERT, CHECK_PTR, Q_EXPORT, Q_PACKED,
	QT_STATIC_CONST, QT_STATIC_CONST_IMPL. Define _KWQ_IOSTREAM_ only
	when NDEBUG is not defined.

	* kwq/KWQBuffer.mm:
	* kwq/KWQCString.mm:
	* kwq/KWQCollection.mm:
	* kwq/KWQCompletion.h:
	* kwq/KWQCompletion.mm:
	* kwq/KWQFrame.h:
	* kwq/KWQFrame.mm:
	* kwq/KWQHBox.mm:
	* kwq/KWQKFileItem.mm:
	* kwq/KWQKIconLoader.mm:
	* kwq/KWQKLineEdit.mm:
	* kwq/KWQKProtocolManager.mm:
	* kwq/KWQLabel.mm:
	* kwq/KWQListBox.h:
	* kwq/KWQMovie.mm:
	* kwq/KWQWidget.mm:
	* kwq/KWQxml.mm:
	* kwq/qt/qbuffer.h:
	* kwq/kdecore/kdebug.h:
	* kwq/kdecore/kglobal.h:
	* kwq/kdecore/kglobalsettings.h:
	* kwq/kdecore/kiconloader.h:
	* kwq/kdecore/kstaticdeleter.h:
	* kwq/kdecore/kstringhandler.h:
	* kwq/kdeui/kcombobox.h:
	* kwq/kdeui/kcompletionbox.h:
	* kwq/kdeui/klineedit.h:
	* kwq/kdeui/klistbox.h:
	* kwq/kdeui/kmessagebox.h:
	* kwq/kio/kfileitem.h:
	* kwq/kio/kimageio.h:
	* kwq/kio/kmimetype.h:
	* kwq/kio/kprotocolmanager.h:
	* kwq/kio/netaccess.h:
	* kwq/qt/qxml.h:
	* kwq/kparts/browserinterface.h:
	* kwq/kparts/factory.h:
	* kwq/kparts/part.h:
	* kwq/qt/qarray.h:
	* kwq/qt/qcollection.h:
	* kwq/qt/qcstring.h:
	* kwq/qt/qcursor.h:
	* kwq/qt/qdict.h:
	* kwq/qt/qhbox.h:
	* kwq/qt/qlabel.h:
	* kwq/qt/qlist.h:
	* kwq/qt/qmap.h:
	* kwq/qt/qmovie.h:
	* kwq/qt/qobject.h:
	* kwq/qt/qpaintdevicemetrics.h:
	* kwq/qt/qpainter.h:
	* kwq/qt/qpoint.h:
	* kwq/qt/qradiobutton.h:
	* kwq/qt/qrect.h:
	* kwq/qt/qregion.h:
	* kwq/qt/qscrollview.h:
	* kwq/qt/qsize.h:
	* kwq/qt/qstack.h:
	* kwq/qt/qstringlist.h:
	* kwq/qt/qtextedit.h:
	* kwq/qt/qvaluelist.h:
	* kwq/qt/qvector.h:
	* kwq/qt/qwidget.h:
	* kwq/qt/qxml.h:
	Removed unused stuff.

	* kwq/KWQListBox.mm:
	* kwq/KWQMapImpl.h:
	* kwq/KWQMapImpl.mm:
	* kwq/KWQPainter.mm:
	* kwq/KWQPoint.mm:
	* kwq/KWQRadioButton.mm:
	* kwq/KWQRect.mm:
	* kwq/KWQRegion.mm:
	* kwq/KWQScrollBar.h:
	* kwq/KWQScrollView.mm:
	* kwq/KWQSize.mm:
	* kwq/KWQStringList.mm:
	* kwq/KWQbrowserinterface.mm:
	Simplified.

	* kwq/kdecore/kurl.h:
	Added include to match what's expected by clients.

	* kwq/qt/qobjectlist.h: Added. Empty file to make includers happy.

	* kwq/khtml/khtml_printsettings.h: Added. Empty file.
	* kwq/qt/qobjectlist.h: Added. Empty file.

	* kwq/kio/kssl/ksslkeygen.h: Define just enough to make callers
	happy.

	* kwq/qt/qobject.h: Added event().
	* kwq/kparts/part.h: Added bool return type to event().
	* kwq/qt/qvector.h: Added QGVector base class.

2002-06-01  Darin Adler  <darin@apple.com>

	* kwq/KWQPtrDictImpl.mm: (KWQPtrDictPrivate::~KWQPtrDictPrivate):
	Fix compile error.

2002-05-31  Darin Adler  <darin@apple.com>

	Fix infinite loop while cancelling bug that was caused by dictionary
	iterators not getting updated when keys are removed.

	* kwq/KWQPtrDictImpl.mm:
	(KWQPtrDictPrivate::KWQPtrDictPrivate): Set iterators list to 0.
	(KWQPtrDictPrivate::~KWQPtrDictPrivate): Tell iterators dict is gone.
	(KWQPtrDictImpl::remove): Tell each iterator that the item was removed.
	(KWQPtrDictIteratorPrivate::KWQPtrDictIteratorPrivate): Insert the
	iterator into a list with a head stored in the dict.
	(KWQPtrDictIteratorPrivate::~KWQPtrDictIteratorPrivate): Remove the
	iterator from the list.
	(KWQPtrDictIteratorPrivate::remove): Remove the key from the iterator's
	private storage.
	(KWQPtrDictIteratorPrivate::dictDestroyed): Clear out the dict pointer
	and set the count to 0.

	* kwq/KWQPtrDictImpl.h: Move private classes out so they can get at each
	other without being friends of each other.

	* kwq/qt/qptrdict.h: Simplify a bit.

2002-05-31  Darin Adler  <darin@apple.com>

	* khtml/khtmlview.h: Add KWQKHTMLPartImpl as friend class, remove khtml_part.h
	include that we added inside APPLE_CHANGES.

	* kwq/KWQKHTMLPart.mm: (KWQKHTMLPartImpl::end): Reinstate a line of code that
	required friend status.

	* kwq/KWQView.mm: Add include of khtml_part.h.

2002-05-31  Darin Adler  <darin@apple.com>

	* kwq/kwqdebug.h: Don't use displayableString; it's an SPI and those
	are no nos inside WebCore.

2002-05-31  Darin Adler  <darin@apple.com>

	* kwq/kio/jobclasses.h: Removed SimpleJob and made Job just enough for
	TransferJob to inherit from it. Removed unused stuff and made url() return
	an NSURL rather than a KURL.
	* kwq/KWQKjobclasses.mm: Removed much of the code, and reworked what
	remains to simplify it.
	* kwq/KWQKloader.mm: Update users of TransferJob::url since it now returns
	an NSURL rather than a KURL.

	* kwq/kio/job.h: Simplify.
	* kwq/KWQKJob.mm: Simplify.

	* kwq/kio/scheduler.h: Emptied this file out.
	* kwq/KWQKScheduler.mm: Removed.
	* kwq/Makefile.am: Removed KWQKScheduler.mm.

2002-05-31  Darin Adler  <darin@apple.com>

	Remove some unused stuff; total of 1000s of lines.

	* Makefile.am: Removed some strange uses of "./" and
	improved stamp-related rules.

	* WebCore-tests.exp: Removed QDir functions.

	* khtml/Makefile.am: Removed java subdirectory.
	* khtml/java/*: Removed.
	* khtml/rendering/render_applet.cpp: Rearrange APPLE_CHANGES so
	that we use our own KJavaAppletWidget rather than a QWidget.
	* kwq/khtml/java/kjavaappletcontext.h: Added.
	* kwq/khtml/java/kjavaappletwidget.h: Added.
	* kwq/KWQKJavaAppletWidget.mm: Added. Replaces WCJavaAppletWidget.mm.
	* kwq/KWQsignals.mm: Removed java-related signals.

	* khtml/css/Makefile.am:
	* khtml/misc/Makefile.am:
	Improve stamp-related rules.

	* khtml/misc/loader.cpp: Move around and add ifdefs so we don't
	need as much KWQ code. Maybe revisit this later -- related to the
	KDE implementation of animated and progressive loading images,
	which we probably don't need, but it may integrate slightly better than
	doing our hacks inside QPixmap.

	* kwq/KWQApplication.mm:
	* kwq/KWQFontInfo.mm:
	* kwq/KWQInputDialog.mm:
	* kwq/KWQKFileDialog.mm:
	* kwq/KWQKHTMLPartBrowserExtension.mm:
	* kwq/KWQKWin.mm:
	* kwq/KWQKWinModule.mm:
	* kwq/KWQKstddirs.mm:
	* kwq/KWQPixmap.mm:
	Simplified, removed unused code, minor tweaks.

	* kwq/Makefile.am: Removed all the old files, added some new ones.
	* kwq/KWQBitmap.mm: Removed.
	* kwq/KWQBrush.mm: Removed.
	* kwq/KWQDCOPClient.mm: Removed.
	* kwq/KWQDataStream.h: Removed.
	* kwq/KWQDir.mm: Removed.
	* kwq/KWQFontDatabase.mm: Removed.
	* kwq/KWQImage.mm: Removed.
	* kwq/KWQKInstance.mm: Removed.
	* kwq/KWQPaintDevice.mm: Removed.
	* kwq/KWQPart.mm: Removed.
	* kwq/KWQasyncimageio.mm: Removed.
	* kwq/KWQasyncio.mm: Removed.
	* kwq/KWQbrowserextension.mm: Removed.
	* kwq/WCJavaAppletWidget.h: Removed.
	* kwq/WCJavaAppletWidget.mm: Removed.
	* kwq/qt/qdatastream.h: Removed.
	* kwq/qt/qdir.h: Removed.
	* kwq/qt/qlayout.h: Removed.

	* kwq/KWQCursor.mm:
	(QCursor::handle): Return the cursor object as an integer rather than
	just returning 0; makes the code that uses handle() more likely to work
	although it introduces a 64-bit cleanliness problem.

	* kwq/KWQEvent.mm: Initialize event type in QEvent subclasses.

	* kwq/WebCoreImageRenderer.h: Added NSObject and NSCopying protocols to
	the WebCoreImageRenderer protocol.

	* kwq/kwqdebug.h: Use displayableString in DEBUG_OBJECT for better logging.

	* kwq/dcop/dcopclient.h:
	* kwq/kdecore/kstddirs.h:
	* kwq/kdecore/kwin.h:
	* kwq/kdecore/kwinmodule.h:
	* kwq/kfile/kfiledialog.h:
	* kwq/kparts/browserextension.h:
	* kwq/kparts/event.h:
	* kwq/qt/qapplication.h:
	* kwq/qt/qasyncimageio.h:
	* kwq/qt/qasyncio.h:
	* kwq/qt/qbitmap.h:
	* kwq/qt/qbrush.h:
	* kwq/qt/qbutton.h:
	* kwq/qt/qcheckbox.h:
	* kwq/qt/qcollection.h:
	* kwq/qt/qcolor.h:
	* kwq/qt/qcombobox.h:
	* kwq/qt/qcursor.h:
	* kwq/qt/qdrawutil.h:
	* kwq/qt/qevent.h:
	* kwq/qt/qfont.h:
	* kwq/qt/qfontdatabase.h:
	* kwq/qt/qfontinfo.h:
	* kwq/qt/qimage.h:
	* kwq/qt/qinputdialog.h:
	* kwq/qt/qintcache.h:
	* kwq/qt/qintdict.h:
	* kwq/qt/qpaintdevice.h:
	* kwq/qt/qpixmap.h:
	* kwq/qt/qstring.h:
	Removed lots of unused stuff, including old conditionals and the like.

	* khtml/khtml_part.cpp:
	(KHTMLPart::khtmlMouseMoveEvent): Add missing parenthesis.

2002-05-30  Maciej Stachowiak  <mjs@apple.com>

	WebCore part of fixes for:

	Radar 2926169 - no support for window.open
	Radar 2890469 - Preference to prevent JavaScript from automatically
	opening new windows doesn't work
	Radar 2938569 - link cursor does not appear on some pages
	
	* khtml/ecma/kjs_window.cpp:
	(WindowFunc::tryCall): #ifdef'd out some parts of this code that are
	broken (but fortunately also unnecessary) in our project.
	* kwq/KWQKConfigBase.mm:
	(KConfig::KConfig): Changes to support JavaScript window opening pref.
	(KConfig::readUnsignedNumEntry): Likewise.
	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::openURLInFrame): Implemented.
	* kwq/KWQKHTMLPartBrowserExtension.mm:
	(KHTMLPartBrowserExtension::KHTMLPartBrowserExtension): Implemented.
	(KHTMLPartBrowserExtension::openURLRequest): Implemented by
	calling openURLInFrame on the part.
	(KHTMLPartBrowserExtension::createNewWindow): Implemented by
	calling new WebController openNewWindowWIthURL method.
	* kwq/KWQKHTMLSettings.mm:
	(KHTMLSettings::isJavaScriptEnabled): Handle renaming of pref.
	* kwq/KWQView.mm:
	(-[KWQHTMLView setCursor:]): Fixes to set cursor properly even if
	none was set.	
	* kwq/external.h: Declare some new WebKit methods.
	* kwq/kparts/browserextension.h: Make formerly empty methods pure virtual.
	* kwq/khtml/khtml_ext.h: Declare some virtual methods.

2002-05-30  Darin Adler  <darin@apple.com>

	Cut down our copied and pasted code even more.

	* WebCore.exp: Change what's exported for things that moved from
	KHTMLPart into KWQKHTMLPartImpl.

	* khtml/.cvsignore:
	* khtml/css/.cvsignore:
	* khtml/dom/.cvsignore:
	* khtml/ecma/.cvsignore:
	* khtml/html/.cvsignore:
	* khtml/java/.cvsignore:
	* khtml/misc/.cvsignore:
	* khtml/rendering/.cvsignore:
	* khtml/xml/.cvsignore:
	Some .cvsignore hygiene.

	* khtml/khtml_part.cpp: Use a lot more of this file, rather than using a copy inside
	the kwq directory. Now we have KWQKHTMLPartImpl for the part that does need to be in kwq.
	* khtml/khtml_part.h: Add KWQKHTMLPartImpl pointer, remove most of the other APPLE_CHANGES.
	* khtml/khtmlpart_p.h: Remove almost all of the APPLE_CHANGES.
	* kwq/KWQKHTMLPart.mm: Changed everything from being part of KHTMLPart to be a separate
	KWQKHTMLPartImpl class. Minimized copied and pasted code; still more to do.
	* kwq/KWQKHTMLPartImpl.h: Added. Interface so KHTMLPart can call into kwq as necessary.

	* khtml/misc/Makefile.am: Added loader.cpp.
	* khtml/misc/loader.cpp: Added from KDE 3.0. Rolled most of the changes from KWQKloader.mm
	in here. The kwq-specific part is now in a KWQLoaderImpl class.
	* khtml/misc/loader.h: Replace LoaderPrivate with KWQLoaderImpl.
	* khtml/misc/loader.moc: Added empty file.
	* kwq/KWQKloader.mm: Changed everything to be a separate KWQLoaderImpl class.
	Minimized copied and pasted code.
	* kwq/KWQLoaderImpl.h: Added. Interface so loader can call into kwq as necessary.
	* kwq/loader.moc: Removed empty file.

	* kwq/kparts/historyprovider.h: Add HistoryProvider::insert.
	* kwq/KWQKHistoryProvider.mm: Add HistoryProvider::insert.

	* kwq/KWQKLocale.mm: (KLocale::language): Simplify.

	* kwq/KWQListBox.h:
	* kwq/KWQNSTextField.h:
	Use import instead of include for Cocoa.h.

	* kwq/KWQScrollView.mm: (QScrollView::contentsToViewport): Implement this.

	* kwq/external.h: Add declarations so this can be included cleanly.

	* kwq/khtml/khtml_pagecache.h: Put a no-op cache in here so we don't have to do so
	many APPLE_CHANGES ifdefs.

	* kwq/kparts/part.h: Put ref/deref and event/customEvent in here so they don't need
	to be added to KHTMLPart.

	* kwq/kio/scheduler.h: Add <qtimer.h> include to help us build (not sure if it's
	really needed.
	* kwq/kparts/partmanager.h: Add <qdatetime.h> include to help us build (not sure if it's
	really needed.

=== Alexander-7 ===

2002-05-29  Richard Williamson  <rjw@apple.com>

    Changes to support animated image rendering.
    Moved image rendering into webkit.
    
	* WebCore.exp:
	* kwq/KWQPainter.mm:
	(QPainter::drawPixmap):
	(QPainter::drawTiledPixmap):
	(QPainter::translate):
	(QPainter::scale):
	(QPainter::begin):
	(QPainter::end):
	* kwq/KWQPixmap.mm:
	(QPixmap::QPixmap):
	(QPixmap::~QPixmap):
	(QPixmap::isNull):
	(QPixmap::size):
	(QPixmap::rect):
	(QPixmap::width):
	(QPixmap::height):
	(QPixmap::resize):
	(QPixmap::operator=):
	* kwq/Makefile.am:
	* kwq/WebCoreImageRenderer.h: Added.
	* kwq/WebCoreImageRendererFactory.h: Added.
	* kwq/WebCoreImageRendererFactory.m: Added.
	(+[WebCoreImageRendererFactory sharedFactory]):
	(-[WebCoreImageRendererFactory init]):
	(-[WebCoreImageRendererFactory imageRendererWithBytes:length:]):
	(-[WebCoreImageRendererFactory imageRendererWithSize:]):
	* kwq/qt/qpixmap.h:

2002-05-28  Richard Williamson  <rjw@apple.com>

    Moved cancellation check before creation on job instance,
    preventing leak.
    
	* kwq/KWQKloader.mm:
	(Loader::servePendingRequests):

2002-05-28  Richard Williamson  <rjw@apple.com>

    Fixed edge case cancellation problem (actually happens a lot).
    No new loads are allowed after a data source has been
    set as "stopping".
    
	* kwq/KWQKloader.mm:
	(Loader::servePendingRequests):
	* kwq/external.h:

2002-05-28  Richard Williamson  <rjw@apple.com>

    Fixed reporting of malformed resources URLs.  This fixed
    exceptions that were being thrown because nil handles were
    being added to datasource handle array.

	* kwq/KWQKjobclasses.mm:
	* kwq/KWQKloader.mm:
	(Loader::servePendingRequests):

2002-05-28  Chris Blumenberg  <cblu@apple.com>

	Added framework-header-stamp

	* .cvsignore:

2002-05-27  John Sullivan  <sullivan@apple.com>

	* Resources/linkCursor.tiff: Added. Maciej forgot to cvs add
	this new file. I stole the one from haircut.

2002-05-27  Maciej Stachowiak  <mjs@apple.com>

	Fixed the vexing and long-standing:

	Radar 2894699 - Crash at: http://cb.apple.com/jsplugins.html
	
	* khtml/ecma/kjs_navigator.cpp: This crash was caused by Plugin
	and MimeType objects referring to data that was held and
	refcounted by PluginBase, without holding a ref. I fixed it by
	making these individual items participate in the refcounting as
	well.

2002-05-26  Maciej Stachowiak  <mjs@apple.com>

	Webcore part of fix for:

	Radar 2884085 - add support for changing cursor over links

	* Makefile.am: Install tiff of link cursor.
	* kwq/qt/qcursor.h, kwq/KWQCursor.mm:
	(QCursor::QCursor): Change QCursor to contain an NSCursor.
	(QCursor::~QCursor): Likewise.
	(QCursor::operator=): Likewise.
	(QCursor::handle): Likewise.
	* kwq/KWQKCursor.mm:
	(+[NSCursor _WebCore_linkCursor]): NSCursor extension method that
	provides the link cursor.	
	(KCursor::handCursor): Use the link cursor instead of the default
	arrow cursor.
	* kwq/KWQKHTMLSettings.mm:
	(KHTMLSettings::changeCursor): Return TRUE; we always want cursor
	tracking.
	* kwq/KWQView.h, kwq/KWQView.mm:
	(-[KWQHTMLView setCursor:]): Remember the new cursor and
	invalidate cursor rects.
	(-[KWQHTMLView resetCursorRects]): Establish cursor rect for
	currently set cursor, if not default.
	* kwq/KWQWidget.mm:
	(QWidget::setCursor): Call setCursor: on the underlying
	NSView, if implemented.
	(QWidget::cursor): Implemented.
	(QWidget::unsetCursor): Implemented.

2002-05-25  Maciej Stachowiak  <mjs@apple.com>

	Changed WebCore to build as a framework, not a dylib, so resources
	can be added to it.

	* Makefile.am: Actual changes to build WebCore.framework
	* Resources/Info.plist: Added.
	* English.lproj/InfoPlist.strings: Added.
	* WebCore-tests.exp: Added.
	* WebCore.exp: Added.
	* libwebcore.exp: Removed.
	* libwebcoretests.exp: Removed.
	* .cvsignore: Updated.

=== 0.3 ===

2002-05-24  Shelley A Sheridan  <sheridan@apple.com>

	* ChangeLog:

=== Alexander-6 ===

2002-05-23  Maciej Stachowiak  <mjs@apple.com>

	Fixes for the following (the first bug also requires WebKit and
	WebBrowser changes):
	
	Radar 2896391 - command-click should open link in new window
	Radar 2935858 - two mails for each mailto:

	* khtml/html/html_inlineimpl.cpp:
	(HTMLAnchorElementImpl::defaultEventHandler): Set flag for Meta
	key in addition to Control, Shift and Alt, since the Command key
	is treated as Meta.
	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::urlSelected): Open a new window if the user
	command-clicked.
	(KHTMLPart::khtmlMouseMoveEvent): Clean up use of braces and ifdefs to
	make prepare-ChangeLog happy.
	(KHTMLPart::khtmlMouseReleaseEvent): Remove code that tried to
	process link click events here. This made link clicks get
	processed twice, now that mouse events are hooked up for real.
	* kwq/external.h: prototype openNewWindowWithURL: method.

2002-05-23  Kenneth Kocienda  <kocienda@apple.com>

        More work to fix this bug:

        Radar 2883631 (need to implement support for META HTTP_EQUIV=REFRESH)

        There was yet two more cases where the refresh timers were getting clobbered.
        Fixed.

	* khtml/ecma/kjs_window.cpp:
	(WindowQObject::parentDestroyed)
	* khtml/khtmlview.cpp:
	(KHTMLView::clear)

2002-05-23  Richard J. Williamson  <rjw@apple.com>

    Fixed crasher 2935757.  I still need to investigate the root cause
    of this problem.
    
	* khtml/rendering/render_text.cpp:
	(RenderText::setText):

2002-05-23  Kenneth Kocienda  <kocienda@apple.com>

        Fixes for these bugs:

        Radar 2883631 (need to implement support for META HTTP_EQUIV=REFRESH)
        Radar 2935472 (Non-standard html pages don't always get decoded)

	* khtml/khtml_part.cpp: Don't kill all timers. Just kill the ones for this object.
	(KHTMLPart::~KHTMLPart):
	* khtml/khtml_part.h: Modified interface to slotData to add a flag for when all data 
          for a load has been received.
	* khtml/khtmlview.cpp:
	(KHTMLView::~KHTMLView): Don't kill all timers. Just kill the ones for this object.
	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::slotData): Senses when text encoding is not available, but all data has been received.
	(KHTMLPart::write): Ditto
	(KHTMLPart::scheduleRedirection):
	* libwebcore.exp: Changed symbol for slotData

2002-05-23  Shelley A Sheridan  <sheridan@apple.com>

	* ChangeLog:

=== Alexander-5 ===

2002-05-23  Maciej Stachowiak  <mjs@apple.com>

	Notify when loads of sub-URLs start and stop, so panels for these
	can be attached to the right windows.

	* kwq/KWQKloader.mm:
	(-[URLLoadClient IFURLHandleResourceDidBeginLoading:]):
	(-[URLLoadClient IFURLHandleResourceDidCancelLoading:]):
	(-[URLLoadClient IFURLHandleResourceDidFinishLoading:data:]):
	(-[URLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]):
	(-[URLLoadClient IFURLHandle:didRedirectToURL:]):
	* kwq/external.h:

2002-05-22  Richard J. Williamson  <rjw@apple.com>
    

    Additional additional callback when resource is first loaded.
        
	* kwq/KWQKloader.mm:
	(-[URLLoadClient IFURLHandleResourceDidBeginLoading:]):

2002-05-21  Richard J. Williamson  <rjw@apple.com>

    Lots of changes for DHTML.
    Bugs fixes, and fixes to regressions.
    
	* khtml/misc/decoder.cpp:
	(Decoder::decode):
	* khtml/rendering/render_flow.cpp:
	(RenderFlow::print):
	(RenderFlow::layout):
	* khtml/rendering/render_text.cpp:
	(RenderText::print):
	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::urlSelected):
	* kwq/qt/qevent.h:
	* kwq/qt/qstring.h:
	* libwebcore.exp:

2002-05-21  Kenneth Kocienda  <kocienda@apple.com>

        Fix for this bug:

        Radar 2924728 (post form fails at pt.apple.com; succeeds at macosx.apple.com)

        Posted forms are now submitted with the IFURLHandleFlagLoadFromOrigin 
        load flag set.  This prevents a potential bug which may cause a page 
        with a form that uses itself as an action to be returned from the 
        cache without submitting.

	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::submitForm)

2002-05-21  Kenneth Kocienda  <kocienda@apple.com>

        Merged these four include files into the precompiled header.
        These are used for the enhanced assertion/debuggin support I
        added yesterday.

        <signal.h>
        <sys/types.h>
        <sys/time.h>
        <sys/resource.h>

	* WebCorePrefix.h

2002-05-20  Darin Adler  <darin@apple.com>

	Forgot one file.

	* khtml/khtml_part.moc: Added.

2002-05-20  Darin Adler  <darin@apple.com>

	Use more of the original khtml_part.cpp; a step in the direction of factoring
	our code out so more of it can go in WebKit and we don't need external.h.

	* khtml/Makefile.am:
	* khtml/khtml_part.cpp:
	* khtml/khtml_part.h:
	* khtml/khtmlpart_p.h:
	Start compiling khtml_part.cpp and using khtmlpart_p.h again.

	* kwq/KWQKHTMLPart.mm:
	Remove code that was identical to khtml_part.cpp. We aren't going to use the
	"copy and hack our copy" approach on this class for the long termk, and this
	is the first step in cleaning things up.

	* khtml/khtml_ext.h: Removed.
	* khtml/khtml_factory.h: Removed.

	* khtml/misc/loader.h:
	* khtml/xml/dom_docimpl.cpp:
	(DocumentImpl::recalcStyleSelector):
	Remove some APPLE_CHANGES ifdefs we don't need any more.

	* kwq/KWQDateTime.mm:
	Simplify things like copy constructors.

	* kwq/kdeui/kcursor.h:
	* kwq/KWQKCursor.mm:
	Add handCursor.

	* kwq/KWQKHTMLFactory.mm:
	Put in real implementations, not just placeholders.

	* kwq/KWQKHTMLPartBrowserExtension.mm:
	* kwq/KWQKInstance.mm:
	* kwq/KWQPart.mm:
	* kwq/KWQbrowserextension.mm:
	Empty these files out, nothing in them is needed any more.

	* kwq/khtml/khtml_settings.h:
	* kwq/KWQKHTMLSettings.mm:
	(KHTMLSettings::isJavaEnabled):
	(KHTMLSettings::autoLoadImages):
	(KHTMLSettings::isPluginsEnabled):
	(KHTMLSettings::isJavaScriptEnabled):
	(KHTMLSettings::isJavaScriptDebugEnabled):
	Moved settings here from KWQKHTMLPart.mm

	* kwq/kdecore/kurl.h:
	* kwq/KWQKURL.mm:
	(KURL::encodedHtmlRef):
	(KURL::htmlRef):
	Placeholders for these two, called in KHTMLPart, but maybe not really needed.

	* kwq/KWQKloader.mm:
	(Cache::preloadScript):
	(Cache::preloadStyleSheet):
	Empty functions for these, called in KHTMLPart but no implementation needed.

	* kwq/qt/qtimer.h:
	* kwq/KWQTimer.mm:
	(QTimer::isActive):
	(QTimer::start):
	(QTimer::stop):
	More timer functions.

	* kwq/qt/qscrollview.h: Add one more function.

	* kwq/kdecore/kinstance.h: Simplify.
	* kwq/kdeui/kaction.h: Simplify.
	* kwq/khtml/khtml_factory.h: Simplify.
	* kwq/kparts/browserextension.h: Simplify.
	* kwq/kparts/part.h: Simplify.
	* kwq/qt/qdatetime.h: Simplify.

	* kwq/kdecore/klibloader.h: Added.
	* kwq/khtml/khtml_ext.h: Added.
	* kwq/kparts/partmanager.h: Added.
	Nearly-empty files with just simple placeholders so we can compile more.

	* kwq/dcop/kdatastream.h: Added.
	* kwq/kdecore/kmultipledrag.h: Added.
	* kwq/kdecore/ktempfile.h: Added.
	* kwq/kdecore/kurldrag.h: Added.
	* kwq/kdeui/kstdaction.h: Added.
	* kwq/kdeui/kxmlguifactory.h: Added.
	* kwq/khtml/khtml_find.h: Added.
	* kwq/khtml/khtml_iface.h: Added.
	* kwq/khtml/khtml_pagecache.h: Added.
	* kwq/khtml/khtml_run.h: Added.
	* kwq/kio/kssl/ksslcertchain.h: Added.
	* kwq/kio/kssl/ksslinfodlg.h: Added.
	* kwq/kio/ktrader.h: Added.
	* kwq/qt/private/qucomextra_p.h: Added.
	* kwq/qt/qclipboard.h: Added.
	* kwq/qt/qmetaobject.h: Added.
	Empty files just so includes of these names will compile.

	* libwebcoretests.exp: Remove one export that's no longer needed.

2002-05-20  Richard J. Williamson  <rjw@apple.com>

	* khtml/ecma/kjs_events.cpp:
	(JSEventListener::handleEvent):
	* khtml/khtml_part.h:
	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::~KHTMLPart):
	(KHTMLPart::scheduleRedirection):
	(KHTMLPart::timerEvent):
	(KHTMLPart::redirectJS):
	(KHTMLPart::urlSelected):
	* kwq/KWQVariant.mm:
	(QVariant::asString):
	* kwq/qt/qvariant.h:

2002-05-20  Kenneth Kocienda  <kocienda@apple.com>

	* kwq/kwqdebug.h: Now includes <sys/time.h> to prevent possible
        build breakage in the inclusion of <sys/resource.h>

2002-05-20  Kenneth Kocienda  <kocienda@apple.com>

        Changed assertion failure code to send a SIGQUIT instead
        of raising an NSException.

	* kwq/kwqdebug.h

2002-05-19  Darin Adler  <darin@apple.com>

	* khtml/rendering/render_object.cpp: (RenderObject::drawBorder):
	Add missing break statement so borders don't draw strangely.

	* khtml/rendering/render_style.h: Remove unneeded QColor workaround,
	now that we handle invalid colors properly.

	* kwq/KWQColor.mm:
	(createStaticConstructorAutoreleasePool): New solution to the problem
	of autorelease at static constructor time.
	(getNamedColors): Function that creates this dictionary when needed
	rather than creating it inside an init function.
	(QColor::QColor): Share code with setRgb, get rid of _initialize.
	(hex2int): Return -1 for bad digit rather than 0.
	(decodeColorFromHexColorString): Make more robust and simpler.
	(QColor::setNamedColor): Set color to invalid rather than black when
	the passed in name is empty or unrecognized.
	(QColor::red), (QColor::green), (QColor::blue): Round instead of truncating.
	(QColor::setRgb): Set color to invalid if r, g, or b is out of range.
	(QColor::operator=): Simplify.
	(QColor::operator==): Handle invalid colors correctly.
	(QColor::getNSColor): Return black of invalid colors.

	* kwq/KWQCursor.mm: Simplify cursor globals.

	* kwq/KWQPainter.mm:
	(QPainter::_setColorFromBrush): Use getNSColor() to handle invalid colors correctly.
	(QPainter::_setColorFromPen): Use getNSColor() to handle invalid colors correctly.
	(QPainter::drawLine): Add code to respect style and width and handle endpoints in a
	way that will make the lines look like Qt users expect.
	(QPainter::drawText): Use getNSColor() to handle invalid colors correctly.
	(QPainter::drawUnderlineForText): Use getNSColor() to handle invalid colors correctly.
	(QPainter::fillRect): Use getNSColor() to handle invalid colors correctly.

	* kwq/KWQPen.mm: (QPen::QPen): (QPen::setStyle): Remove use of MPenStyle.

	* kwq/KWQPixmap.mm: (QPixmap::QPixmap): Add comments.

	* kwq/qt/qcolor.h: Simplify ifdefs, remove cname, _initialize, globals_init, and
	initGlobalColors.

	* kwq/qt/qnamespace.h: Remove AlignTop, AlignBottom, SingleLine, ExpandTabs, DontPrint,
	DashDotLine, DashDotDotLine, MPenStyle, WResizeNoRease, WRepaintNoErase, color0, color1,
	darkRed, darkGreen, darkBlue, darkCyan, darkMagenta, darkYellow. Simplify the QColor
	and QCursor globals.

	* kwq/qt/qpen.h: QPainter is no longer a friend class. Remove linest.

2002-05-17  Darin Adler  <darin@apple.com>

	* khtml/rendering/render_list.cpp: (RenderListItem::setStyle):
	OK. This time it's correct.

2002-05-17  Darin Adler  <darin@apple.com>

	* khtml/rendering/render_list.cpp: (RenderListItem::setStyle):
	Roll the change out while I see why it causes a crash.

prim2002-05-17  Darin Adler  <darin@apple.com>

	* khtml/rendering/render_list.cpp: (RenderListItem::setStyle):
	Remove an old incorrect fix for a style leak in here and put in
	a new correct fix.

2002-05-16  Richard J. Williamson  <rjw@apple.com>

	Fixed 2896350.  Ignore DPI in images and render directly at pixel size.
	
	* kwq/KWQPainter.mm:
	(QPainter::drawPixmap):
	* kwq/KWQPixmap.mm:
	(QPixmap::QPixmap):

2002-05-16  Richard J. Williamson  <rjw@apple.com>

	Fixed 2925638.  Don't send last progress message from resourceDataDidBecomeAvailable,
	it is sent from IFURLHandleResourceDidFinishLoading, avoiding duplication.
	
	* kwq/KWQKloader.mm:
	(-[URLLoadClient IFURLHandle:resourceDataDidBecomeAvailable:]):

2002-05-15  Richard J. Williamson  <rjw@apple.com>
    
    Alerts, useful for validating that js handlers work.
    Validated that onsubmit is working.
    
	* kwq/KWQKMessageBox.mm:
	(KMessageBox::error):
	(KMessageBox::warningYesNo):
	(KMessageBox::questionYesNo):
	(KMessageBox::sorry):

2002-05-15  Darin Adler  <darin@apple.com>

	* kwq/qt/qguardedptr.h: Fix reversed sense of check in isNull. Fixes
	a bug that was causing a lot of DHTML not to work.

2002-05-15  Kenneth Kocienda  <kocienda@apple.com>

	* kwq/KWQInvisibleButton.h: Changed an #include of Cocoa.h to an #import

2002-05-15  Darin Adler  <darin@apple.com>

	* kwq/KWQListImpl.mm:
	(KWQListImpl::KWQListPrivate::copyList): Take out unnecessary line of code.
	(KWQListImpl::KWQListPrivate::~KWQListPrivate): Delete the iterator nodes
	also, not just the item nodes. Fixes a storage leak.
	(KWQListIteratorImpl::KWQListIteratorPrivate::KWQListIteratorPrivate):
	Change interface to take a list pointer so we don't rely on the undefined
	behavior of &* on a null pointer.
	(KWQListImpl::addIterator): Set up the prev pointer of the old head of
	the list. This was causing the crash I was debugging.
	(KWQListIteratorImpl::operator=): Simpler implementation.

2002-05-14  Richard J. Williamson  <rjw@apple.com>

    Added another symbol for stack based event constructor.
    Change to support onLoad.
    
	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::end):    
	* libwebcore.exp:

2002-05-14  Chris Blumenberg  <cblu@apple.com>

	Changed slotData to slotData(NSString *encoding, const char *bytes, int length)

	* khtml/khtml_part.h:
	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::slotData):
	* libwebcore.exp:

2002-05-14  Darin Adler  <darin@apple.com>

	Fixed 2925291 -- CSS2 test page causes infinite recursion, crash

	* khtml/rendering/render_container.cpp: (RenderContainer::addChild):
	Add code to detect the case of a render object that uses text cell
	style but is not itself a text style, and make sure we don't try to
	nest such an object inside an infinite number of tables.

2002-05-14  Darin Adler  <darin@apple.com>

	* kwq/KWQListImpl.mm: (KWQListIteratorImpl::KWQListIteratorImpl):
	Add a missing check for a null pointer.

	* kwq/KWQGuardedPtr.mm: (KWQGuardedPtrBase::KWQGuardedPtrBase):
	Remove an unnecessary call to "toFirst", because new iterators
	already default to pointing to the first element of the list.

2002-05-13  Darin Adler  <darin@apple.com>

	* kwq/KWQListImpl.mm: (KWQListImpl::~KWQListImpl): Detach all the iterators from
	the list when the list is destroyed. I thought this was done before, but it seems not.

2002-05-13  Darin Adler  <darin@apple.com>

	Fixed bug 2922884 (JavaScript object leak creating Image object from JavaScript).
	There was a reference loop created when a document contained a variable that
	referenced an image, because images held references to the document; the C++
	kind that do not participate in the JavaScript garbage collection.

	* khtml/ecma/kjs_html.h: Use a QGuardedPtr to the DocumentImpl instead of using
	a Document object.
	* khtml/ecma/kjs_html.cpp:
	(Image::tryPut): Change because the "doc" pointer is now a pointer to the
	DocumentImpl, not the Document. Also check for 0, since it's now a QGuardedPtr
	that can become 0.
	(Image::Image): Newly out of line. Changed because the "doc" pointer is now a
	pointer to the DocumentImpl, not the Document.

	Since the solution used QGuardedPtr, I had to implement it.

	* kwq/qt/qguardedptr.h: Put the implementation in a new KWQGuardedPtrBase class,
	with only the bare minimum in a template. This new implementation uses iterators
	on a QPtrList, which means there's not much code needed.
	* kwq/KWQGuardedPtr.mm: (KWQGuardedPtrBase::KWQGuardedPtrBase): Rewrite to use
	a QPtrListIterator to a dummy list in the QObject. This reuses code nicely, but
	a custom-coded solution would be a bit more efficient.

	* kwq/qt/qobject.h:
	* kwq/KWQObject.mm: (QObject::QObject): Create the one-element list that's used
	by the QGuardedPtr instances.

	Since the above code needed to copy a QPtrListIterator, I needed to support that.

	* kwq/qt/qlist.h: Move the iterator's copy constructor out of the private part,
	and implement it. This class was strange in that it has a public assignment
	operator, but a private unimplemented copy constructor. Implementing it was trivial,
	though, so this was no obstacle.

2002-05-13  Maciej Stachowiak  <mjs@apple.com>

	Removed libjpeg dependency. Turns out we don't need it.
	
	* Makefile.am: Remove -ljpeg from link line.
	* khtml/misc/loader_jpeg.cpp: Removed.
	* khtml/misc/loader_jpeg.h: Removed.
	* khtml/misc/Makefile.am: Remve loader_jpeg from build.

2002-05-10  Richard J. Williamson  <rjw@apple.com>

	Made log output match webkit logging.

	* kwq/kwqdebug.mm:
	(KWQLog):

2002-05-10  Chris Blumenberg  <cblu@apple.com>

	Changed WCIFWebDataSourceMake to wrap around [IFWebDataSource initWithURL: attributes: flags:]
	instead of initWithHandle. 

	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::requestFrame):
	(KHTMLPart::submitForm):
	* kwq/WCWebDataSource.h:
	* libwebcore.exp:

2002-05-10  Darin Adler  <darin@apple.com>

	* kwq/WebCoreTextRenderer.h:

2002-05-09  Richard J. Williamson  <rjw@apple.com>

    Added new method to avoid creation of NSString.
    
        - (void)drawCharacters:(const UniChar *)characters length: (unsigned)length atPoint:(NSPoint)point withColor:(NSColor *)color;

	* kwq/KWQPainter.mm:
	(QPainter::drawText):
	* kwq/WebCoreTextRenderer.h:

2002-05-09  Kenneth Kocienda  <kocienda@apple.com>

        Fix for this bug:

        Radar 2890624 (need to remove workaround for double free of image data from QPixmap)

        The appropriate, bug-free AppKit code is now available to us on Jaguar. 
        Rolling out the workaround.

	* kwq/KWQPixmap.mm:
	(QPixmap::QPixmap)

=== Alexander-3 ===

2002-05-07  Darin Adler  <darin@apple.com>

	* kwq/KWQFontMetrics.mm: Fixed storage leak by initializing refCount.

2002-05-07  Darin Adler  <darin@apple.com>

	Move more plugin code into WebKit.

	Stop using IF for anything in WebCore to help make it clear what's part of
	the BSD licensed stuff and what's part of our proprietary stuff.

	* libwebcore.exp: Names of what exported changed.
	* kwq/Makefile.am: Source file names changed.

	* kwq/IFTextRenderer.h: Renamed to WebCoreTextRenderer.
	* kwq/IFTextRendererFactory.h: Renamed to WebCoreTextRendererFactory.
	* kwq/IFTextRendererFactory.m: Renamed to WebCoreTextRendererFactory.
	* kwq/WebCoreTextRenderer.h: Renamed from IFTextRenderer.
	* kwq/WebCoreTextRendererFactory.h: Renamed from IFTextRendererFactory.
	* kwq/WebCoreTextRendererFactory.m: Renamed from IFTextRendererFactory.

	* kwq/KWQFontMetrics.mm:
	* kwq/KWQPainter.mm:
	Updated for IF -> WebCore name change.

	* kwq/WebCoreViewFactory.h: Added.
	* kwq/WebCoreViewFactory.m: Added.

	* kwq/KWQKConfigBase.mm: (KConfig::readEntry): (KConfig::readNumEntry):
	Use the new [WebCoreViewFactory pluginsInfo] so we don't have to have
	the plugin database in WebCore any more.

	* kwq/WCJavaAppletWidget.h:
	* kwq/WCJavaAppletWidget.mm: (IFJavaAppletWidgetCreate):
	* kwq/WCPluginWidget.h:
	* kwq/WCPluginWidget.mm: (IFPluginWidgetCreate):
	Remove creation function machinery, and use the WebCoreViewFactory instead.

	* kwq/WCPlugin.h: Moved to WebKit.
	* kwq/WCPlugin.mm: Moved to WebKit.
	* kwq/WCPluginDatabase.h: Moved to WebKit.
	* kwq/WCPluginDatabase.mm: Moved to WebKit.
	* kwq/npapi.h: Moved to WebKit.
	* kwq/npapi.mm: Moved to WebKit.

2002-05-06  Darin Adler  <darin@apple.com>

	* WebCorePrefix.h: Added.

	* .cvsignore: Ignore the .pfe files in this directory.

	* khtml/dom/dom_doc.cpp:
	* khtml/dom/dom_text.cpp:
	Added namespace directives as a clean workaround for a conflict
	with the struct named Comment in <Carbon/AIFF.h>

	* kwq/KWQFont.mm:
	* kwq/KWQFontMetrics.mm:
	* kwq/KWQKGlobal.mm:
	* kwq/KWQListImpl.mm:
	* kwq/KWQPtrDictImpl.h:
	* kwq/KWQVectorImpl.mm:
	* kwq/kwqdebug.h:
	* kwq/qt/qcolor.h:
	* kwq/qt/qcombobox.h:
	* kwq/qt/qregion.h:
	* kwq/qt/qstring.h:
	* kwq/qt/qwidget.h:
	Remove old workaround for conflicts with Fixed, Rect, and Boolean.
	It does not good with a precompiled header anyway, and there is a
	more elegant small fix in the KDE code itself.

	* kwq/qt/qpoint.h:
	* kwq/KWQPointArray.mm: (QPointArray::setPoints):
	Work around bug with va_arg and PFE by not using varargs here.

	* kwq/KWQRect.mm: (QRect::unite): (QRect::operator&):
	Use std::min and std::max instead of defining our own MIN and MAX, which
	conflict with something in one of the headers we are precompiling (error
	message did not make it clear which).

	* kwq/KWQView.mm: (-[KWQHTMLView layout]), (-[KWQHTMLView drawRect:]):
	Switch from xNDEBUG to NDEBUG.

	* kwq/Makefile.am: Remove stuff for getting at the header inside the
	ApplicationServices and QD frameworks, since that code is now in WebKit.

	* kwq/kwqdebug.h: Get rid of format attribute because of bug 2920557.
	Switch from xNDEBUG to NDEBUG.

	* kwq/kwqdebug.mm: Switch from xNDEBUG to NDEBUG.

	* kwq/qt/qstring.h: Define QT_VERSION in here instead of on the command
	line to work around a PFE bug with -D, Radar 2921026.

2002-05-06  Richard J. Williamson  <rjw@apple.com>
        
        Changes to support dhmtl.
        Changes to support targeting (regression after 3.0 merge).

	* khtml/khtmlview.cpp:
	* kwq/KWQEvent.mm:
	* kwq/KWQKHTMLPart.mm:
	* kwq/KWQObject.mm:
	* kwq/KWQWidget.mm:
	* kwq/qt/qevent.h:
	* kwq/qt/qobject.h:
	* kwq/qt/qwidget.h:

2002-05-03  Darin Adler  <darin@apple.com>

	* khtml/css/cssstyleselector.cpp:
	* khtml/dom/css_value.cpp:
	* khtml/xml/dom_stringimpl.cpp:
	Put in some namespace-related statements to more-elegantly work around the
	conflicts between Macintosh and khtml identifiers.

2002-05-03  Darin Adler  <darin@apple.com>

	* kwq/IFTextRenderer.h: Added.
	* kwq/IFTextRendererFactory.h: Added.
	* kwq/IFTextRendererFactory.m: Added.
	These three are the new API for supplying text rendering machinery for WebCore.
	The implementation is in WebKit. Later we might want to flesh out the default
	implementation in WebCore so that it works OK by itself.

	* khtml/rendering/font.cpp: (Font::width): Function is now "width" without
	an underscore. We don't really need to hide the overload we added in this
	case.

	* kwq/qt/qfont.h: Simplify a lot. Doesn't hold an NSFont any more.
	* kwq/KWQFont.mm:
	(QFont::QFont): Eliminated the concept of "default font". Also, a QFont no
	longer holds an NSFont object. That's handled inside IFTextRenderer machinery.
	(QFont::~QFont): Simplify since we don't have an NSFont.
	(QFont::setFamily): Simplify since we don't have an NSFont.
	(QFont::setPixelSize): Simplify since we don't have an NSFont.
	(QFont::setPixelSizeFloat): Simplify since we don't have an NSFont.
	(QFont::setWeight): Simplify since we don't have an NSFont.
	(QFont::weight): Fix a bug where it would return Normal for a QFont that was
	both bold and italic.
	(QFont::setItalic): Simplify since we don't have an NSFont.
	(QFont::italic): Simplify since we have real "bool".
	(QFont::bold): Simplify since we have real "bool".
	(QFont::operator=): Simplify since we don't have an NSFont.
	(QFont::operator==): Rewrite since we don't have an NSFont.

	* kwq/qt/qfontmetrics.h: Simplify a little. The _width() method is now just an
	overload of the width() method. The main change was removing the include of Cocoa.h.
	* kwq/KWQFontMetrics.mm:
	Move most of the code out of here into WebKit.
	(QFontMetrics::ascent): Get it from the renderer.
	(QFontMetrics::descent): Get it from the renderer.
	(QFontMetrics::lineSpacing): Get it from the renderer.
	(QFontMetrics::width): Get it from the renderer.
	(QFontMetrics::boundingRect): Combine width and height that came from the renderer.
	(QFontMetrics::size): Combine width and height that came from the renderer.

	* kwq/Makefile.am: Add IFTextRendererFactory.m, remove KWQTextStorage.mm and KWQTextContainer.mm.
	* kwq/KWQMetrics.h: Removed.
	* kwq/KWQTextContainer.h: Removed.
	* kwq/KWQTextContainer.mm: Removed.
	* kwq/KWQTextStorage.h: Removed.
	* kwq/KWQTextStorage.mm: Removed.

	* kwq/KWQPainter.mm:
	Move most of the code out of here into WebKit.
	(QPainter::drawText): Call the renderer to do it.
	(QPainter::drawUnderlineForText): Call the renderer to do it.

	* libwebcore.exp: Export the IFTextRendererFactory class.

2002-04-26  Darin Adler  <darin@apple.com>

	* kwq/make-mac-encodings.c: (main): One more place that needed a workaround
	for Radar 2912404 (kCFStringEncodingInvalidId is negative even though
	CFStringEncoding is unsigned).

	* kwq/KWQTextArea.mm: (-[KWQTextArea paragraphs]): Do this
	ourselves so we don't rely on WebFoundation.
	* kwq/Makefile.am: Don't do a -I for WebFoundation.

2002-04-26  Darin Adler  <darin@apple.com>

	Pay no attention to the man who is not supposed to be working.

	* khtml/Makefile.am:
	* khtml/css/Makefile.am:
	* khtml/ecma/Makefile.am:
	* khtml/html/Makefile.am:
	* khtml/java/Makefile.am:
	* khtml/misc/Makefile.am:
	* khtml/rendering/Makefile.am:
	* khtml/xml/Makefile.am:
	Don't generate empty .moc files or khtmldata.h; there's no reason
	not to just check them in instead. Also tweak a few build rules to
	use automatic make variables.

	* khtml/ecma/kjs_window.moc: Added.
	* khtml/html/html_documentimpl.moc: Added.
	* khtml/html/htmltokenizer.moc: Added.
	* khtml/java/kjavaapplet.moc: Added.
	* khtml/java/kjavaappletcontext.moc: Added.
	* khtml/java/kjavaappletserver.moc: Added.
	* khtml/java/kjavaappletwidget.moc: Added.
	* khtml/java/kjavadownloader.moc: Added.
	* khtml/java/kjavaprocess.moc: Added.
	* khtml/khtmlview.moc: Added.
	* khtml/misc/khtmldata.h: Added.
	* khtml/rendering/render_form.moc: Added.
	* khtml/rendering/render_frames.moc: Added.
	* khtml/rendering/render_replaced.moc: Added.
	* khtml/xml/dom_docimpl.moc: Added.
	* khtml/xml/xml_tokenizer.moc: Added.

	* kwq/kwqdebug.mm: Make some globals private.

2002-04-25  Darin Adler  <darin@apple.com>

	* kwq/KWQMetrics.h: Add NSObject to required protocols for
	the KWQLayoutFragment protocol so we can retain and release.

	* kwq/KWQTextStorage.mm: (-[KWQTextStorage _buildFragmentForString:]):
	Removed a cast to NSObject * that worked around the lack of the above.

2002-04-25  Richard Williamson  <rjw@apple.com>

        Little changes in preparation for events.

	* khtml/ecma/kjs_proxy.cpp:
	(KJSProxyImpl::createHTMLEventHandler):
	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::createHTMLEventListener):

2002-04-25  Darin Adler  <darin@apple.com>

	Add a workaround for Radar 2912404 (kCFStringEncodingInvalidId is negative even
	though CFStringEncoding is unsigned)

	* kwq/KWQCharsets.mm:
	(KWQCFStringEncodingFromIANACharsetName):
	(KWQCFStringEncodingFromMIB):
	* kwq/KWQtextcodec.mm:
	(QTextCodec::codecForMib):
	(QTextCodec::codecForName):
	* kwq/make-charset-table.pl:
	Add casts to (CFStringEncoding) wherever we use kCFStringEncodingInvalidId.

2002-04-25  Darin Adler  <darin@apple.com>

	Rework plugin code to prepare to move more of it into WebKit.

	* khtml/rendering/render_applet.cpp:
	(RenderApplet::RenderApplet): Create a widget for the applet using
	the new simpler API.

	* kwq/kdecore/kconfig.h:
	* kwq/KWQKConfigBase.mm: Eliminate KConfigBase.
	Set things up so we are poised to handle the other non-plugin
	config keys easily in the future.

	* kwq/KWQKHTMLPart.mm: (KHTMLPart::requestObject): Use the new simpler
	IFPluginWidgetCreate API instead of the older WCPluginWidget one.

	* kwq/qt/qstring.h: Add simpler conversions to/from NSString.
	* kwq/KWQString.mm: (QString::fromNSString): New.

	* kwq/WCPluginWidget.h: Made this API simpler both for the C++
	side and the Objective-C side. There's now no class, and only one
	function that needs to be supplied (normally by WebKit).
	* kwq/WCJavaAppletWidget.h: Same thing for the Java case.

	* kwq/WCJavaAppletWidget.mm:
	(IFSetJavaAppletViewCreationFunction): New.
	(IFJavaAppletWidgetCreate): New. Most of the code that was in here
	is now moved into WebKit.
	* kwq/WCPluginWidget.mm:
	(IFSetPluginViewCreationFunction): New.
	(IFPluginWidgetCreate): New. Most of the code that was in here
	is now moved into WebKit.

	* libwebcore.exp: Update for new function names.

2002-04-24  Chris Blumenberg  <cblu@apple.com>

	Renamed [IFWebDataSource frame] to [IFWebDataSource webFrame]

	* kwq/KWQKHTMLPart.mm:
	(KHTMLPart::submitForm):
	(KHTMLPart::khtmlMouseReleaseEvent):
	* kwq/external.h:

=== Alexander 0.3c2 (v1) ===

2002-04-24  Darin Adler  <darin@apple.com>

	Get rid of all NEED_BOGUS_XXX.

	* khtml/java/Makefile.am: Remove -DNEED_BOGUS_TEXTSTREAMS and
	-DNEED_BOGUS_X_DEFINES.
	* khtml/rendering/Makefile.am: Remove -DNEED_BOGUS_X_DEFINES.
	* khtml/xml/Makefile.am: Remove -DNEED_BOGUS_TEXTSTREAMS.
	* kwq/Makefile.am: Remove -DNEED_BOGUS_X_DEFINES and KWQKJavaEmbed.mm.
	* kwq/KWQKJavaEmbed.mm: Removed.

	* kwq/KWQDef.h: Remove XEvent define (inside NEED_BOGUS_X_DEFINES).

	* kwq/qt/qtextstream.h: Don't look at NEED_BOGUS_TEXTSTREAMS.
	* kwq/KWQtextstream.mm: Don't look at NEED_BOGUS_TEXTSTREAMS.

	* khtml/java/javaembed.h: Made this just a QWidget typedef for now.
	* khtml/java/kjavaappletwidget.cpp: ifdef out the unused setWindow function.

2002-04-23  Darin Adler  <darin@apple.com>

	* khtml/css/css_valueimpl.cpp:
	(CSSPrimitiveValueImpl::computeLengthFloat):
	* khtml/css/cssstyleselector.cpp:
	(CSSStyleSelector::computeFontSizes):
	Remove our 72/96 dpi changes. They weren't doing much good.
	But this doesn't fix all the 72/96 dpi issues. It's just the start.

	* kwq/khtml/khtml_settings.h:
	* kwq/KWQKHTMLSettings.mm:
	Remove some unused stuff: charset(), setCharset(), availableFamilies(),
	fontSizes(), SCREEN_RESOLUTION.

2002-04-23  Kenneth Kocienda  <kocienda@apple.com>

        Reviewed by: Darin Adler

        Fix for Radar 2908403 (Fix names in WebFoundation extensions code)

        Extensions code in WebFoundation now is in its own namespace.
        Where we have added categories to existing Foundation and AppKit
        classes, the categories begin with the IF prefix. All method names
        begin with the _IF_ prefix.

        The file here was changed to use the new names.

	* kwq/KWQTextArea.mm:
	(-[KWQTextArea paragraphs])

2002-04-23  Kenneth Kocienda  <kocienda@apple.com>

	* kwq/KWQPixmap.mm:
	(QPixmap::QPixmap): Fixed unneeded leak of an NSImage in
        the case where we are still covering for a double-release
        bug in AppKit. No need to add insult to injury. :)

2002-04-22  Darin Adler  <darin@apple.com>

	Fix width of non-breaking spaces. There's code to hack this
	at the KDE level for fonts that don't have non-breaking space
	characters, but we need it even for fonts that do.

	Not sure why this worked better on Puma, but now it's fine on
	both Puma and Jaguar.

	* kwq/KWQFontMetrics.mm:
	(ConvertCharactersToGlyphs): New. Turns non-breaking spaces into
	normal spaces if needed.
	(-[KWQLayoutInfo drawString:atPoint:withFont:color:]),
	(-[KWQLayoutInfo _initializeCaches]), (_rectForString): Change to
	call ConvertCharactersToGlyphs instead of ATSUConvertCharToGlyphs.

2002-04-22  Darin Adler  <darin@apple.com>

	* kwq/qt/qpixmap.h:
	* kwq/KWQPixmap.mm:
	(QPixmap::QPixmap): Clear needsCopyOnWrite flag in all the
	constructors other than the copy constructor. Set it in the copy
	constructor.
	(QPixmap::~QPixmap): Simplify.
	(QPixmap::mask): Always return 0 rather than leaking a QBitmap each time,
	since Qt uses 0 to mean "no mask".
	(QPixmap::isNull): Simplify.
	(QPixmap::resize): Do the copy here if we need it, and do the setScalesWhenResized:
	call in here instead of trying to do it elsewhere.
	(QPixmap::xForm): Only copy the pixmap once.
	(QPixmap::operator=): Set the needsCopyOnWrite flag. Also change the retain/release
	idiom around so we don't need to check for self-assignment.

	* khtml/ecma/Makefile.am: Don't build kjs_debugwin any more.
	* khtml/ecma/kjs_debugwin.cpp: Removed.
	* khtml/ecma/kjs_debugwin.h: Removed.

2002-04-22  Chris Blumenberg  <cblu@apple.com>

	Added a new method to WCPluginDatabase allHandledMIMETypes.
	It returns an  array of the mime types that plug-ins handle.

	* kwq/WCPluginDatabase.h:
	* kwq/WCPluginDatabase.mm:
	(-[WCPluginDatabase allHandledMIMETypes]):

2002-04-20  Darin Adler  <darin@apple.com>

	Problems loading iframes seemed to be due to NSURL objects that
	were not normalized, so I made the NSURL creation all be done
	by KURL, which fixed the problem.

	* kwq/KWQKHTMLPart.mm: (KHTMLPart::requestFrame), (KHTMLPart::submitForm),
	(KHTMLPart::khtmlMouseReleaseEvent):
	* kwq/KWQKjobclasses.mm:
	Call getNSURL instead of creating NSURLs by converting to strings.

	* kwq/kdecore/kurl.h:
	* kwq/KWQKURL.mm: (KURL::getNSURL): New.

2002-04-19  Kenneth Kocienda  <kocienda@apple.com>

        Changes to support submission of forms using HTTP POST.
                
        These changes move us over to using the new WebKit interface for creating 
        WebDataSource instances, one that passes a handle rather than just a URL, 
        enabling the specific request method to be communicated to WebFoundation.
        This fixes:

        Radar 2903602 (IFWebDataSource API must passes attributes and flags to IFURLHandle)

        Fixed handling of password fields:

        Radar 2903605 (WebCore form processing drops out password input data)
        
        Added some hacks to get form <input type=image ...> working correctly:

        Radar 2907198 (Forms not getting submitted correctly when <input type=image>)
        
        
	* khtml/rendering/render_form.cpp: (RenderImageButton::RenderImageButton),
	(RenderImageButton::~RenderImageButton), (RenderImageButton::printObject):
	* khtml/rendering/render_form.h:
	* kwq/KWQKHTMLPart.mm: (KHTMLPart::requestFrame), (KHTMLPart::submitForm),
	(KHTMLPart::khtmlMouseReleaseEvent):
	* kwq/KWQNSTextField.mm: (-[KWQNSTextField setPasswordMode:]), (-[KWQNSTextField
	textDidChange:]), (-[KWQNSTextField stringValue]):
	* kwq/Makefile.am:
        * kwq/KWQInvisibleButton.h: Added
        * kwq/KWQInvisibleButton.mm: Added

2002-04-18  Darin Adler  <darin@apple.com>

	Fixes for compiling with gcc3 and more warnings.

	* khtml/html/.cvsignore: Add kentities.c; I could have sworn I did this
	already.
	* khtml/html/Makefile.am: Remove erroneous duplicate definition of
	CLEAN_FILES.

	* libwebcore.exp:
	* libwebcoretests.exp:
	Rebuilt these lists from scratch. Almost everything in here is different
	since the C++ name mangling rules changed.

	* khtml/css/cssparser.cpp:
	* khtml/misc/htmlhashes.cpp:
	Disable inlining in part of this file as a workaround for Radar 2905890.

	* kwq/KWQApplication.mm: (QDesktopWidget::screenGeometry):
	Add casts to int needed to make gcc3 happy.
	* kwq/KWQArrayImpl.mm: Add missing #include of <string.h>.

	* kwq/KWQBitmap.mm:
	* kwq/KWQFrame.mm:
	* kwq/KWQLineEdit.mm:
	Removed some unused copy constructors and assignment operators to avoid
	warnings in them.

	* kwq/KWQButton.mm: (QButton::setText):
	* kwq/KWQListBox.mm: (QListBox::~QListBox), (QListBox::clear),
	(QListBox::setSelectionMode), (QListBox::currentItem), (QListBox::insertItem),
	(QListBox::setSelected), (QListBox::isSelected), (QListBoxItem::width),
	(QListBoxItem::height):
	* kwq/KWQScrollView.mm: (QScrollView::setContentsPos), (QScrollView::addChild),
	(QScrollView::resizeContents), (QScrollView::viewportToContents),
	Use local variables to work around Radar 2905835.

	* kwq/KWQCString.mm: (operator<<):
	* kwq/KWQPoint.mm: (operator<<):
	* kwq/KWQRect.mm: (operator<<):
	* kwq/KWQSize.mm: (operator<<):
	* kwq/qt/qarray.h:
	* kwq/qt/qcstring.h:
	* kwq/qt/qdatetime.h:
	* kwq/qt/qdict.h:
	* kwq/qt/qlist.h:
	* kwq/qt/qmap.h:
	* kwq/qt/qpainter.h:
	* kwq/qt/qpoint.h:
	* kwq/qt/qptrdict.h:
	* kwq/qt/qrect.h:
	* kwq/qt/qsize.h:
	* kwq/qt/qstack.h:
	* kwq/qt/qvaluelist.h:
	* kwq/qt/qvector.h:
	Say std::ostream instead of just ostream.

	* kwq/KWQCharsets.mm: Fix a const problem.

	* kwq/KWQDateTime.mm: (QTime::elapsed), (QTime::restart): Use int instead
	of uint, since these functions try to handle values that are less than 0.
	(operator<<): Say std::ostream instead of just ostream.
	* kwq/KWQTextArea.mm: (RangeOfParagraph): Fix an int/uint issue.

	* kwq/KWQFile.mm: (QFile::KWQFilePrivate::KWQFilePrivate),
	(QFile::KWQFilePrivate::~KWQFilePrivate): Use new/delete instead of
	malloc/free so we don't get void * warnings.

	* kwq/KWQFontMetrics.mm: (__IFFillStyleWithAttributes),
	(-[KWQLayoutInfo drawString:atPoint:withFont:color:]),
	(-[KWQLayoutInfo _initializeCaches]),
	(_rectForString):
	* kwq/KWQKURL.mm: (KURL::KWQKURLPrivate::KWQKURLPrivate),
	(RelativeURLKeyRetainCallBack), (RelativeURLKeyReleaseCallBack),
	(RelativeURLKeyEqualCallBack), (RelativeURLKeyHashCallBack),
	(KURL::normalizeURLString), (KURL::normalizeRelativeURLString):
	* kwq/KWQPainter.mm: (QPainter::save):
	* kwq/KWQKloader.mm:
	(-[URLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]),
	(-[URLLoadClient IFURLHandle:didRedirectToURL:]):
	Add type casts where necessary to make the stricter gcc3 happy.

	* kwq/KWQPixmap.mm: (QPixmap::QPixmap): Explicitly initialize the underlying
	QPaintDevice.
	(QPixmap::size), (QPixmap::rect): Add type casts where necessary to make
	the stricter gcc3 happy.
	
	* kwq/KWQPtrDictImpl.mm: (KWQPtrDictImpl::KWQPtrDictPrivate::KWQPtrDictPrivate):
	Say std::bad_alloc instead of just bad_alloc.
	(invokeDeleteFuncOnValue), (KWQPtrDictImpl::clear): Pass a pointer to a function
	pointer rather than a function pointer to avoid a warning about turning function
	pointers into void *.

	* kwq/KWQRegion.mm: (QRegion::_initialize), (QRegion::~QRegion): Use new/delete
	rather than calloc/free so we don't get void * warnings.
	(QRegion::boundingRect): Add type casts.

	* kwq/KWQString.mm: (QString::fromStringWithEncoding): Add cast.
	(QString::setNum): use %ld and %lu rather than %D and %U.
	(QString::fill), (QString::convertToQCString): Add casts.

	* kwq/KWQTextStorage.mm: (-[KWQTextStorage _buildFragmentForString:]):
	Add a cast to make gcc3 happy.

	* kwq/KWQVariant.mm: Say "friend class" instead of "friend".

	* kwq/KWQVectorImpl.mm: (KWQVectorImpl::KWQVectorPrivate::KWQVectorPrivate):
	Say std::bad_alloc instead of just bad_alloc.
	(KWQVectorImpl::data): Replace the old autorelease trick with a new one that
	doesn't require mixing malloc with NSData.

	* kwq/KWQView.mm: (-[KWQHTMLView mouseUp:]), (-[KWQHTMLView mouseDown:]):
	Add casts to make gcc3 happy.

	* kwq/KWQWidget.mm: (QWidget::frameGeometry), (QWidget::mapToGlobal),
	(QWidget::minimumSizeHint): Add casts to make gcc3 happy. Also another
	workaround for Radar 2905835.

	* kwq/WCPlugin.mm: (-[WCPlugin load]): Add tons of type casts so we don't have
	to mix void * with function pointer types.

	* kwq/WCPluginWidget.h:
	* kwq/WCPluginWidget.mm: (WCIFPluginMakeFunction), (WCIFNullPluginMakeFunction):
	Change types so we don't have to mix void * with function pointer types.
	This caught a mistake where WCIFNullPluginMakeFunction was returning the wrong
	function pointer.

	* kwq/external.h: Add some missing interfaces that the pickier gcc3 needed to see.

	* kwq/kwqdebug.mm: Don't compile the file if xNDEBUG is set. Otherwise we get
	a warning in here.

	* kwq/npapi.h: Use function pointer types for function pointers and transition
	vectors so we don't have to mix void * with function pointer types.

	* kwq/npapi.mm: (NPN_GetURLNotify), (NPN_GetURL),
	(NPN_PostURLNotify), (NPN_PostURL), (NPN_NewStream), (NPN_Write),
	(NPN_DestroyStream), (NPN_Status), (NPN_GetValue), (NPN_SetValue),
	(NPN_InvalidateRect), (NPN_InvalidateRegion), (NPN_ForceRedraw):
	Use local variables to work around Radar 2905835.
	(functionPointerForTVector), (tVectorForFunctionPointer):
	Change types around so we don't have to mix void * with function pointer types.

2002-04-17  Darin Adler  <darin@apple.com>

	Fix some std:: things as a first step in compiling with gcc 3.
	These fixes are all needed to compile WebBrowser with gcc 3.

	* kwq/qt/qarray.h:
	* kwq/qt/qcstring.h:
	* kwq/qt/qlist.h:
	* kwq/qt/qmap.h:
	* kwq/qt/qpainter.h:
	* kwq/qt/qpoint.h:
	* kwq/qt/qrect.h:
	* kwq/qt/qsize.h:
	* kwq/qt/qvaluelist.h:
	Call it std::ostream instead of ostream.

2002-04-17  Darin Adler  <darin@apple.com>

	Fix build problem.

	* Makefile.am: Don't build this directory before subdirs, because
	we link at this level. Move the kentities.c build out of here,
	because it needs to be done before khtml/html.
	* khtml/html/Makefile.am: Move kentities.c build rules here.

	* kentities.gperf: Removed.
	* khtml/html/kentities.gperf: Added.

	* .cvsignore: Don't ignore kentities.c.
	* khtml/html/.cvsignore: Ignore kentities.c.

2002-04-17  Darin Adler  <darin@apple.com>

	* .cvsignore: Ignore new generated files at this level.

	* include/ *: Removed. We don't need this hack any more.
	* src/ *: Removed. Sources are now in their new locations.
	* src/libwebcore.exp: Removed. This is now in its new location.
	* src/libwebcoretests.exp: Removed. This is now in its new location.

	* Makefile.am: Build khtml and kwq subdirs, don't build src and include.
	Also add the rules that used to be in src about linking the library and
	the rules that used to be in src/kdelibs/kdecore about building the
	kentitices.c file.

	* dummy.mm: Moved here from src by hand.
	* kentities.gperf: Moved here from src/kdelibs/kdecore by hand.

	* khtml/html/Makefile.am: Add WebCore directory to includes so the
	include of "kentities.c" will work.

	* kwq/KWQKHTMLPart.mm:
	* kwq/KWQKJavaEmbed.mm:
	* kwq/KWQKloader.mm:
	Correct includes so we don't need a -I for each of the subdirectories.

	* kwq/khtml/java/javaembed.h: Removed. We use the one in the real
	khtml directory.

	* kwq/kwqdebug.h: Rolled over Chris's changes, which were done after
	the cvs surgery was done.

2002-04-17  Chris Blumenberg  <cblu@apple.com>

	Added a debug bit mask for plugins and downloads.

	* src/kwq/kwqdebug.h:

2002-04-16  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/khtml_part.cpp: Added. Not used yet, but maybe we'll use
	part of it some time soon.

	* src/kdelibs/khtml/khtml_part.h: Reenabled this file, and made changes so it
	could be used instead of our own header.
	* src/kwq/KWQKHTMLPart.h: Removed.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::KHTMLPart): Add parameter to match KDE.
	(KHTMLPart::settings): Add const to match KDE.
	(KHTMLPart::scheduleRedirection): Add parameter to match KDE.
	(KHTMLPart::encoding): Add const to match KDE.
	(KHTMLPart::urlCursor): Update return value to match KDE.
	(KHTMLPart::urlSelected): Add parameter to match KDE.
	(KHTMLPart::requestObject): Put plugins array on private object.
	(KHTMLPart::frames): Remove const to match KDE.
	(KHTMLPart::documentSource): Add const to match KDE.
	(KHTMLPart::setTitle): Put dataSource on private object.
	(KHTMLPart::setDataSource): New, not inline any more.
	(KHTMLPart::getDataSource): New, not inline any more.

	* src/libwebcore.exp: Update for function name changes.

	* src/kwq/khtml/khtml_settings.h:
	* src/kwq/KWQKHTMLSettings.mm: (KHTMLSettings::changeCursor): Add const.

	* src/kwq/KWQView.mm: (-[KWQHTMLView layout]): No need to check xmlDocImpl()
	and renderer() for NULL now, because KHTMLView::layout does.

	* src/kwq/KWQKloader.mm: (Loader::load): Use type instead of id.

2002-04-16  Darin Adler  <darin@apple.com>

	* src/kwq/kio/jobclasses.h:
	* src/kwq/KWQKjobclasses.mm: (TransferJob::setError): New.

	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidCancelLoading:]),
	(-[URLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]):
	Set an error code so that the load will abort intead of continuing.

	* src/kwq/KWQKHTMLPart.mm: Removed some unused code.

2002-04-16  Kenneth Kocienda  <kocienda@apple.com>

        Moved IFError class from WebKit to WebFoundation.
        Updated URL handle client interface to pass an IFError in
        an error callback rather than a plain int. These files were
        modified due to this change.

	* src/kwq/KWQKHTMLPart.mm: (WCSetIFWebDataSourceMakeFunc):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):

        Removed now unneeded file and function pointer symbol entry
        since WebCore code never needs to create an IFError now that 
        those objects are created at a lower level (in WebFoundation).
        
	* src/kwq/WCError.h: Removed.
	* src/libwebcore.exp:

2002-04-15  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):
	Remove some minor gratuitous diffs vs. KDE.

2002-04-15  Richard Williamson  <rjw@apple.com>

        Updated to reflect changes in KDE.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):

2002-04-15  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/css/css_valueimpl.cpp:
	(FontFamilyValueImpl::FontFamilyValueImpl): Fix comment.
	* src/kdelibs/khtml/css/cssstyleselector.cpp: Remove some gratuitous diffs vs. KDE.
	* src/kdelibs/khtml/html/html_objectimpl.cpp:
	(HTMLEmbedElementImpl::parseAttribute): Remove unneeded copy from KWQ's early days.
	* src/kdelibs/khtml/html/html_tableimpl.cpp:
	(HTMLTableElementImpl::parseAttribute),
	(HTMLTablePartElementImpl::parseAttribute): Remove unneeded copy from KWQ's early days.
	* src/kdelibs/khtml/html/htmltokenizer.cpp: (HTMLTokenizer::processToken): Redo the
	APPLE_CHANGES ifdef here.
	* src/kdelibs/khtml/khtmlpart_p.h: Update to latest kde.
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::KHTMLView): Add ifdef APPLE_CHANGES.
	(KHTMLView::~KHTMLView): Add ifdef APPLE_CHANGES.
	(KHTMLView::print): Remove code left in here during merge process.
	* src/kwq/KWQKHTMLPart.mm: Remove unused setFontSizes(), fontSizes(), and
	resetFontSizes(). After the merge is landed, remove more.
	* src/libwebcore.exp: Export updateStyleSelector() for WebKit.

2002-04-15  Darin Adler  <darin@apple.com>

	Fix text to it displays at the right font size.

	* src/kdelibs/khtml/css/cssstyleselector.cpp:
	(CSSStyleSelector::computeFontSizes): Apply the same SCREEN_RESOLUTION hack here
	that we do elsewhere.
	* src/kdelibs/khtml/rendering/font.cpp: (Font::width): Use kMin instead of max (oops).
	(Font::update): Turn off font database chicanery.
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::zoomFactor): Use zoom factor 100, not 1.

2002-04-15  Darin Adler  <darin@apple.com>

	More fixes so text displays (still at wrong font size).

	* src/kdelibs/khtml/rendering/font.cpp: (max): New helper.
	(Font::drawText): Simplified implementation for now.
	(Font::width): Simplified implementation for now.
	* src/kwq/KWQColorGroup.mm: Reinstated QCOLOR_GROUP_SIZE.

	* src/kwq/qt/qfontmetrics.h: Removed charWidth and changed _width to take QChar *.
	* src/kwq/KWQFontMetrics.mm: Removed charWidth and changed _width to take QChar *.

2002-04-15  Darin Adler  <darin@apple.com>

	Merged changes from KDE 3.0 final. Other fixes to get things compiling.

	* src/kdelibs/khtml/css/css_valueimpl.cpp:
	(CSSStyleDeclarationImpl::setProperty): Fix unused variable.
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::contentsContextMenuEvent):
	Fix unused variable.
	* src/kdelibs/khtml/rendering/font.cpp: (Font::drawText), (Font::width),
	(Font::update): Disable special "nsbp" logic for now. We can reenable it
	if necessary.
	* src/kdelibs/khtml/rendering/render_replaced.cpp: Fix mismerge.
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::nodeAtPoint):
	Fix unused variable.
	* src/kwq/KWQApplication.mm: (QDesktopWidget::width), (QApplication::desktop):
	Fix mismerge.
	* src/kwq/KWQColorGroup.mm: Fix QCOLOR_GROUP_SIZE.
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::lineSpacing): New.
	(QFontMetrics::width): Remove unused optimization.
	* src/kwq/qt/qfontmetrics.h: Add lineSpacing().

2002-04-15  Darin Adler  <darin@apple.com>

        Merged changes from previous merge pass.

        2002-03-25  Darin Adler  <darin@apple.com>

        Last bit of making stuff compile and link. Probably will drop the merge now
        and take it up again when it's time to merge in KDE 3.0 final.

	* src/kwq/KWQEvent.mm: (QFocusEvent::reason): New.
	* src/kwq/KWQPainter.mm: (QPainter::drawText): New overload.

        2002-03-25  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/rendering/font.cpp: (Font::width): Make it call _width so we
        don't lose the optimization.
        
	* src/kwq/KWQApplication.mm: (QDesktopWidget::screenNumber): New.
	(QDesktopWidget::screenGeometry): New.
        (QApplication::style): New.
	* src/kwq/KWQColorGroup.mm: (QColorGroup::highlight): New.
	(QColorGroup::highlightedText): New.
	* src/kwq/KWQFont.mm: (QFont::setPixelSize): New.
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::charWidth): New.
	* src/kwq/KWQKGlobal.mm: (KGlobal::locale): Implement.
        (KLocale::KLocale): New.
	(KLocale::languageList): New.
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::sheetUsed): New.
	(KHTMLPart::setSheetUsed): New.
        (KHTMLPart::zoomFactor): New.
	* src/kwq/KWQKHTMLSettings.mm: (KHTMLSettings::mediumFontSize): New.
	* src/kwq/KWQScrollView.mm: (QScrollView::childX): New.
        (QScrollView::childY): New.
        
	* src/kwq/qt/qapplication.h: style() returns a QStyle &.
	* src/kwq/qt/qpalette.h: Add Highlight and HighlightedText.

        2002-03-24  Darin Adler  <darin@apple.com>

        More compiling. Still won't link.

	* src/kdelibs/khtml/khtmlview.cpp: Disable printing and drag and drop code.
	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):
        Temporarily turn off our smarter underlining since it relies on access to the
        string, and TextSlave doesn't have that any more.
	(RenderText::nodeAtPoint): Get rid of a workaround we don't need any more for
        a bug that was fixed by KDE folks.
	* src/kwq/KWQApplication.mm: (QApplication::desktop): Make the desktop be a
        QDesktopWidget.
	* src/kwq/qt/qnamespace.h: Add MetaButton.
	* src/kwq/qt/qtooltip.h: Add a maybeTip virtual function member and a virtual
        destructor.

        2002-03-24  Darin Adler  <darin@apple.com>

        Some fixes to get more stuff to compile.

	* src/kdelibs/khtml/ecma/kjs_dom.cpp: (DOMDocument::getValueProperty):
        Don't try to look at the private m_bComplete to display "complete". Just do
        "loading" and "loaded".
        * src/kdelibs/khtml/khtmlpart_p.h: #ifdef this all out for APPLE_CHANGES.
	* src/kdelibs/khtml/rendering/font.cpp: (Font::update): Add an explicit cast to
        int to avoid float -> int warning.
	* src/kdelibs/khtml/rendering/render_table.cpp: (RenderTable::calcColMinMax):
        Add an explicit cast to int to avoid uint compared with int warning.
	* src/kdelibs/khtml/xml/dom_docimpl.cpp: (DocumentImpl::recalcStyleSelector):
        Use sheetUsed() and setSheetUsed() functions on KHTMLPart intead of getting
        at private fields the way the real KDE code does.
        
        * src/kwq/KWQKHTMLPart.h: Declare zoomFactor(), sheetUsed(), and setSheetUsed().
	* src/kwq/KWQStyle.h: Add PM_DefaultFramWidth as another metric.
	* src/kwq/kdecore/klocale.h: Add languageList().
	* src/kwq/khtml/khtml_settings.h: Add mediumFontSize().
	* src/kwq/qt/qapplication.h: Add style() and QDesktopWidget.
	* src/kwq/qt/qevent.h: Add reason().
	* src/kwq/qt/qfont.h: Add setPixelSize(int).
	* src/kwq/qt/qfontmetrics.h: Add charWidth() and _charWidth() functions.
	* src/kwq/qt/qpainter.h: Add drawText() overload with position parameter.
	* src/kwq/qt/qpalette.h: Add highlight() and highlightedText().
	* src/kwq/qt/qscrollview.h: Add childX() and childY().
        
	* src/kwq/KWQApplication.mm: Change KWQDesktopWidget to QDesktopWidget.

2002-04-11  Chris Blumenberg  <set EMAIL_ADDRESS environment variable>

        Added a symbol for WCPluginDatabase.

	* src/libwebcore.exp:

2002-04-08  Maciej Stachowiak  <mjs@apple.com>

	Fix Radar 2896001 (crashes in KURL):

	* src/kwq/KWQKURL.mm: (KURL::KWQKURLPrivate::KWQKURLPrivate):
	Initialize refCount to 0 in the copy constructor.

2002-04-08  Chris Blumenberg  <cblu@apple.com>

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::requestObject):
	* src/kwq/WCPluginWidget.h:
	* src/kwq/WCPluginWidget.mm: (WCPluginWidget::WCPluginWidget):

        Support new stream requests from plug-ins that are relative URL's.

2002-04-05  Chris Blumenberg  <cblu@apple.com>

	* src/libwebcore.exp:

	Added symbol for IFNullPluginView

2002-04-05  Richard Williamson  <rjw@apple.com>

        Various scrolling, hit detection, and goto anchor fixes to account for frames being
        translated in scroll views.
        
	* src/kwq/KWQScrollView.mm: (QScrollView::setContentsPos),
	(QScrollView::viewportToContents):

2002-04-05  Chris Blumenberg  <cblu@apple.com>

	* src/kwq/WCPluginWidget.h:
	* src/kwq/WCPluginWidget.mm: (WCSetIFNullPluginMakeFunc),
	(WCPluginWidget::WCPluginWidget), (WCIFPluginMakeFunction),
	(WCIFNullPluginMakeFunction):

	An IFNullPluginView is now created when no plug-in for a requested
	mime type is found. IFNullPluginView displays a null plug-in icon
	and will eventually report this error to the WebController. 

2002-04-05  Richard Williamson  <rjw@apple.com>

        Hacks to support:
        
        1.  Not loading a document when a link is to an anchor on same page.
        2.  Correctly targeting frames.
        
        Our documentation is actually useable now.
        
	* src/kwq/KWQKHTMLPart.mm: (splitUrlTarget), (KHTMLPart::khtmlMouseReleaseEvent):
	* src/kwq/external.h:

2002-04-05  Darin Adler  <darin@apple.com>

	* src/kwq/KWQKloader.mm:
	(-[URLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]):
	Use contentLengthReceived rather than getting the length of
	availableResourceData to determine how much data has arrived.

2002-04-05  Richard Williamson  <rjw@apple.com>

        More bulletproofing to deal with cleanup during deallocation.
        
	* src/kdelibs/khtml/html/htmlparser.cpp: (KHTMLParser::popOneBlock):
	* src/kdelibs/khtml/html/htmltokenizer.cpp: (HTMLTokenizer::processToken):

2002-04-05  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/qt/qmap.h (QMapNode::~QMapNode): Cast left() and right()
	to the right type to fix a leak detected by the automated leak
	checking on Jersey.

2002-04-04  Richard Williamson  <rjw@apple.com>

        Extra bulletproofing to prevent script execution when in partially
        dealloced state.
        
	* src/kdelibs/khtml/html/htmltokenizer.cpp: (HTMLTokenizer::scriptExecution):

2002-04-04  Chris Blumenberg  <cblu@apple.com>

	* src/kwq/WCPlugin.mm: (-[WCPlugin load]):
	* src/kwq/npapi.h:
	* src/kwq/npapi.mm: (NPN_GetJavaEnv), (NPN_GetJavaPeer):

	Added stubs for NPN_GetJavaEnv and NPN_GetJavaPeer. This fixes a flash crasher.

2002-04-04  Chris Blumenberg  <cblu@apple.com>

	* src/kdelibs/khtml/rendering/render_frames.cpp:
	(RenderPartObject::updateWidget):
	* src/kwq/WCPluginWidget.mm: (WCPluginWidget::WCPluginWidget):

	Moved the removal of __KHTML__ EMBED to attributes WCPluginWidget. One less APPLE_CHANGES.

2002-04-04  Darin Adler  <darin@apple.com>

	Redo clobbered fixes for problems that show up only when xNDEBUG is set

	* src/kwq/KWQApplication.mm: (QApplication::sendEvent):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidBeginLoading:]):
	Remove or ifdef otherwise-unused variables.

	* src/kwq/KWQFontMetrics.mm: (_rectForString):
	Add missing semicolons.

2002-04-04  Darin Adler  <darin@apple.com>

	* src/kwq/KWQString.mm: (QString::unicode), (QString::latin1),
	(QString::convertToQCString): Remove some excessive logging that
	was getting in the way of important log messages.

2002-04-03  Richard Williamson  <rjw@apple.com>

        Added support for finalURL in data source.
        
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandle:didRedirectToURL:]):
	* src/kwq/external.h:

2002-04-03  Darin Adler  <darin@apple.com>

	* src/Makefile.am: Concatenate libwebcore.exp and libwebcoretests.exp.
	* src/libwebcore.exp: Update with exports that are needed when inlining is
        turned off.
	* src/libwebcoretests.exp: Added. Exports that we need to run the test in the
        Tests directory.
        * .cvsignore: Ignore the concatenated file.

2002-04-03  Darin Adler  <darin@apple.com>

	* src/Makefile.am: Don't strip at all if STRIP_FLAGS are empty.
	* src/kwq/qt/qtextcodec.h: Remove stray undef.

2002-04-03  Kenneth Kocienda  <kocienda@apple.com>

        Updated debugging log messages to use new varargs macros.

	* src/kwq/KWQApplication.mm: (QApplication::sendEvent),
	(QApplication::_initialize):
	* src/kwq/KWQColor.mm: (QColor::setNamedColor):
	* src/kwq/KWQComboBox.mm: (QComboBox::setCurrentItem):
	* src/kwq/KWQFont.mm: (QFont::getFont):
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutInfo _initializeCaches]),
	(_rectForString):
	* src/kwq/KWQKHTMLPart.mm: (recursive), (KHTMLPart::write), (KHTMLPart::end),
	(KHTMLPart::nodeActivated):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidBeginLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidCancelLoading:]), (-[URLLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]), (-[URLLoadClient
	IFURLHandle:didRedirectToURL:]), (Loader::servePendingRequests):
	* src/kwq/KWQObject.mm: (QObject::connect), (QObject::performAction):
	* src/kwq/KWQScrollView.mm: (QScrollView::addChild),
	(QScrollView::resizeContents), (QScrollView::updateContents),
	(QScrollView::repaintContents):
	* src/kwq/KWQString.mm: (QString::unicode), (QString::latin1):
	* src/kwq/KWQView.mm: (-[KWQHTMLView notificationReceived:]), (-[KWQHTMLView
	layout]), (-[KWQHTMLView drawRect:]), (-[KWQHTMLView resetView]), (-[KWQHTMLView
	mouseDragged:]):
	* src/kwq/KWQWidget.mm: (QWidget::resize), (QWidget::move):
	* src/kwq/WCPlugin.mm: (-[WCPlugin initializeWithPath:]), (-[WCPlugin load]):
	* src/kwq/WCPluginDatabase.mm: (findPlugins):
	* src/kwq/kwqdebug.h:
	* src/kwq/kwqdebug.mm: (timestamp), (KWQLog):

2002-04-03  Darin Adler  <darin@apple.com>

	Fix problems that show up only when xNDEBUG is set.

	* src/kwq/KWQApplication.mm: (QApplication::sendEvent):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidBeginLoading:]):
	* src/kwq/KWQView.mm: (-[KWQHTMLView layout]), (-[KWQHTMLView drawRect:]):
	Remove or ifdef otherwise-unused variables.

	* src/kwq/KWQFontMetrics.mm: (_rectForString):
	* src/kwq/KWQPainter.mm: (QPainter::setRasterOp), (QPainter::translate),
	(QPainter::scale):
	Add missing semicolons.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::begin):
	Fix an ifdef.

2002-04-03  Darin Adler  <darin@apple.com>

	* src/Makefile.am: Use nmedit and strip to remove the symbols
	we don't want to export.

	* src/libwebcore.exp: Added. List of symbols exported.

2002-04-03  Maciej Stachowiak  <mjs@apple.com>

	* src/Makefile.am: Pave the way for cutting down the exports
	list. Also, make the embed target when installing libwebcore.

2002-04-03  Maciej Stachowiak  <mjs@apple.com>

	Fixed Radar 2893361 (Two frames with same name cause memory
	trasher (likely double-free)) by implementing the mechanism KDE
	uses to guarantee unique frame names.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::frameExists): Actually
	implement this, so that the khtml code can guarantee unique frame
	names on each page.

	* src/kwq/external.h: Prototype IFWebDataSource's frameExists:
	method here.

2002-04-03  Maciej Stachowiak  <mjs@apple.com>

	Fixed Radar 2893298 (KURL rejects spaces and other illegal but
	unambiguous characters, leading to load failures).

	* src/kwq/KWQKURL.mm: (KURL::KWQKURLPrivate::makeRef,
	KURL::normalizeRelativeURLString): Escape forbidden characters
	(ones that are never legal in a URL), except '#' (since that can
	start a fragment identifier) and '%'
	(since that can be the start of a valid escape sequence).

	(KURL::KWQKURLPrivate::KWQKURLPrivate,
	KURL::KWQKURLPrivate::compose): out of paranoia, make sure urlRef
	is set to NULL if not a valid value.

2002-04-03  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/kwqdebug.mm: (KWQGetLogLevel): Allocate and release
	NSScanner instead of using an autoreleased one, to fix Jersey
	redness whereby the regression tests leak.

2002-04-02  Darin Adler  <darin@apple.com>

	* src/kwq/kwqdebug.h: Turn off logging when xNDEBUG is defined.
	Remove unused stuff. Add checking for printf parameters.
	* src/kwq/kwqdebug.mm: Remove unused variants.

	* src/kwq/KWQApplication.mm:
	* src/kwq/KWQKGlobal.mm:
	* src/kwq/KWQKloader.mm:
	* src/kwq/KWQObject.mm:
	* src/kwq/KWQString.mm:
	* src/kwq/KWQToolTip.mm:
	* src/kwq/KWQWidget.mm:
	* src/kwq/WCPlugin.mm:
	* src/kwq/WCPluginDatabase.mm:
	* src/kwq/npapi.mm:
	Fix types in log statements caught by the compiler.

2002-04-02  Richard Williamson  <rjw@apple.com>

        Fixed a fix, shoulda' been a #ifndef to exclude unnecessary code.
        
	* src/kdelibs/khtml/rendering/render_replaced.cpp: (RenderWidget::detach):

2002-04-02  Richard Williamson  <rjw@apple.com>

        More noisy bulletproofing.  Still need to find source of problem.
        
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::~KHTMLPart), (KHTMLPart::slotData),
	(KHTMLPart::write), (KHTMLPart::end):

2002-04-02  Darin Adler  <darin@apple.com>

        Fix some small storage leaks.

	* src/kwq/KWQWidget.mm: (QWidget::QWidget): Use a single shared default style
        instead of creating a new one for each widget.
        (QWidget::setFont): Since we store a QFont here, we don't have to delete the
        old font and we don't leak.
        (QWidget::setCursor): Since now store a QCursor here, we don't have to delete
        the old cursor.
        Also removed a lot of unused code in here.
        
	* src/kwq/KWQKURL.mm: Minor code cleanup.

2002-04-02  Richard Williamson  <rjw@apple.com>

        Added ref() of part from KHTMView.
        Added log to catch m_doc == 0 case.  Should never happen.
        
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::KHTMLView),
	(KHTMLView::~KHTMLView):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::write):

2002-04-02  Richard Williamson  <rjw@apple.com>

        Removed unnecessary and erroneous call to CGContextSetCharacterSpacing.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutInfo _initializeCaches]):

2002-04-01  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQKHTMLPart.mm (KHTMLPartPrivate::~KHTMLPartPrivate):
	Delete the jScript interpreter if it exists, to avoid leaking
	it. Also, garbage collect in this case because when we destroy the
	interpreter a lot of objects will become garbage and this seems
	like a good time to clean it all up.

2002-04-01  Richard Williamson  <rjw@apple.com>

        Added log to catch more problems with NS/CFURL.
        
	* src/kwq/KWQKjobclasses.mm:

2002-04-01  Richard Williamson  <rjw@apple.com>

        Cleaned up lots of potentially stale references to controller.
        Added ref count to part.
        
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::init):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]):

2002-04-01  Richard Williamson  <rjw@apple.com>

        Changes to support correct behavior is i/frame margins and
        scroll views.
        
	* src/kdelibs/khtml/html/html_baseimpl.h:
	* src/kdelibs/khtml/rendering/render_body.cpp: (RenderBody::layout):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::requestFrame):
	* src/kwq/external.h:

2002-04-01  Kenneth Kocienda  <kocienda@apple.com>

        The guts of the fix for this bug:

        Radar 2879234 (Redirected URLs not used for subsequent GETs)

        This change, though small, will fix most of the outstanding problems
        with URL redirects. Some little bits of work need to be done, but much
        of that is on the UI level.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::begin), (KHTMLPart::setBaseURL):

2002-04-01  Darin Adler  <darin@apple.com>

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::jScriptEnabled): Hook this up to the
        preference from WebKit.
        (KHTMLPart::jScript): Return 0 if JavaScript is disabled. This is exactly what
        the original KHTMLPart from KDE did.

2002-04-01  Darin Adler  <darin@apple.com>

	* src/kwq/KWQDef.h: Use KWQ_UNSIGNED_TYPES_DEFINED for compatibility with code
        in JavaScriptCore that has to do the same thing.

2002-04-01  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::restoreScrollBar): Disable code
        that checks if the scroll bar is visible, because it currently doesn't do us
        any good. We may want to turn it back on if we ever implement setVScrollBarMode.
	(KHTMLView::viewportWheelEvent): Disable this code for now since it requires
        access to the vertical scroll bar object.
	* src/kdelibs/khtml/rendering/render_form.cpp:
        (RenderTextArea::calcMinMaxWidth): Use our own verticalScrollBarWidth and
        horizontalScrollBarHeight rather than getting scroll bar widgets.
        
	* src/kwq/qt/qscrollview.h: Remove QScrollView::horizontalScrollBar() and
        QScrollView::verticalScrollBar(), since we don't have QWidgets to return for
        these two. We can re-add these later if we need to.
         
	* src/kwq/qt/qtextedit.h: Removed QMultiLineEdit, and QTextEdit() constructor.
	* src/kwq/kdeui/keditcl.h: Removed.
	* src/kwq/KWQTextEdit.mm: Remove unused functions.
	(QTextEdit::verticalScrollBarWidth), (QTextEdit::horizontalScrollBarHeight):
        Implement these two new ones.
	* src/kwq/KWQScrollView.mm: Remove unused functions.

	* src/kdelibs/khtml/rendering/render_form.cpp: Fixed spelling error.

2002-03-31  Maciej Stachowiak  <mjs@apple.com>

	Fix Radar 2890464 (abcnews.com renders as a blank blue page (probably a JavaScript
	problem).) It turns out not to be a JavaScript problem:
	
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]): Report that load
	is finished to KDE layers. Otherwise, the tokenizer will wait
	forever for a script load completion message that never comes.

2002-03-31  Darin Adler  <darin@apple.com>

	* src/kwq/KWQString.mm: (QString::toDouble): Fix to properly handle
        an empty string.

2002-03-30  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/xml/dom_docimpl.cpp: (DocumentImpl::setTitle):
	Call through to a new KHTMLPart::setTitle instead of the old
	setWindowCaption. We want to skip the special logic for using
	the URL if the title is blank, and for squeezing the title into
	a smaller string, because those are handled at a higher level.

	* src/kwq/KWQKHTMLPart.h: Add setTitle. Also clean up ifdefs.
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::setTitle): New. Calls
	[IFWebDataSource _setTitle].

	* src/kwq/kparts/part.h: Removed setWindowCaption.
	* src/kwq/KWQPart.mm: Removed setWindowCaption.

	* src/kwq/external.h: Add [IFWebDataSource _setTitle].

2002-03-30  Richard Williamson  <rjw@apple.com>

        Added support for scrolling to anchor points.
        Optimization:  we always load the page, even if the URL that contains
        the anchor is the current page.
        
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::end), (KHTMLPart::gotoBaseAnchor),
	(KHTMLPart::gotoAnchor), (KHTMLPart::setUserStyleSheet):
	* src/kwq/KWQScrollView.mm: (QScrollView::setContentsPos):

2002-03-30  Richard Williamson  <rjw@apple.com>

        Added log to note cases of NSURL (CFURL) being unable to
        correctly initialize from URLs.  This log will likely indicate
        bugs in CFURL.
        
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::requestFrame):

2002-03-30  Richard Williamson  <rjw@apple.com>

        Twiddling with baselines.  kde 2.2 appears to not line up baselines correctly.
        Need to experiment with kde 3.
        
        Removed copy of function prototype, instead included the correct header.
 
	Fixed crasher in setFocusPolicy, I don't think we even need to use kde's focus policy.
        This was added during the kde 3 beta 2 merge.
       
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutInfo
	drawString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	initWithFont:]), (-[KWQLayoutInfo _initializeCaches]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQWidget.mm: (QWidget::setFocusProxy):

2002-03-30  Darin Adler  <darin@apple.com>

	* src/kwq/KWQKURL.mm: (copyAndReplaceAll), (needToHideColons): New
        functions used in workaround for CFURL bug.
	(KURL::normalizeRelativeURLString): Add workaround for CFURL bug; hide colons
        that would confuse CFURL from the CFURL code.

	* src/kwq/KWQFont.mm: (QFont::getFont): Use lossyCString instead of cString for
        debugging messages.
        
2002-03-30  Maciej Stachowiak  <mjs@apple.com>

	* src/Makefile.am: Link against JavaScriptCore.framework instead
	of the defunct libJavaScriptCore.dylib.

2002-03-29  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/rendering/render_image.cpp: (RenderImage::updateFromElement):
        Make images with no src, or src="" be empty rather than being the page itself
        loaded as an image.

2002-03-29  Richard Williamson  <rjw@apple.com>

        More fixes for cancelling.  Fixed some code that appears to have been
        mis-merged after the KDE 3 beta 2 landing.
        
	* src/kwq/KWQKloader.mm: (-[URLLoadClient initWithLoader:dataSource:])

2002-03-29  Darin Adler  <darin@apple.com>

	* src/kwq/KWQKloader.mm: (Cache::getStatistics), (Cache::flushAll):
        Fix both of these to work when cache is not yet allocated.

2002-03-29  Richard Williamson  <rjw@apple.com>

        Hooked up redirect.
        
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandle:didRedirectToURL:]):
	* src/kwq/external.h:

2002-03-29  Kenneth Kocienda  <kocienda@apple.com>

        Workaround for Radar 2890624 (Double free of image data in QPixmap)
        This hack is necessary for the app to run on some Jaguar system. Otherwise
        images that the GIF library cannot decode will cause a crash.
        
	* src/kwq/KWQPixmap.mm: (QPixmap::QPixmap):

2002-03-28  Richard Williamson  <rjw@apple.com>

        Fixed basic font horkage caused by removal of KDE font matching code.  We
        now work correctly for the basic font families.
        
	* src/kwq/KWQFont.mm: (QFont::getFont):

2002-03-28  Darin Adler  <darin@apple.com>

	* src/kwq/KWQKloader.mm: (Cache::requestImage), (Cache::requestStyleSheet),
	(Cache::requestScript): Set flags so the objects get freed when they are done
        in cases where the cache is disabled.

2002-03-28  Maciej Stachowiak  <mjs@apple.com>

	Fix Radar 2890340 (JavaScript doesn't work)

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::executeScript): Implement
	the other overloaded version of this function. This is needed for
	JavaScript to work.

2002-03-28  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/misc/loader.h: Added API for looking at the contents of the
        cache, flushing the cache, and disabling the cache.
	* src/kwq/KWQKloader.mm: (Cache::requestImage): Don't cache if disabled.
        (Cache::requestStyleSheet): Don't cache if disabled.
	(Cache::requestScript): Don't cache if disabled.
        (Cache::flush): Simplify ifdefs.
        (Cache::getStatistics), (Cache::flushAll), (Cache::setCacheDisabled): New.

2002-03-28  Richard Williamson  <rjw@apple.com>

        Fixed crasher.  Removed unnecessary cleanup to widget that was called after the
        widget was already disposed.
        
	* src/kdelibs/khtml/rendering/render_replaced.cpp: (RenderWidget::detach):

2002-03-27  Richard Williamson  <rjw@apple.com>

        Removed problematic code.  Not sure why it was necessary.  For now
        it prevents crasher.
        
	* src/kdelibs/khtml/rendering/render_table.cpp: (RenderTable::addColInfo):

2002-03-27  Darin Adler  <darin@apple.com>

	* src/kwq/KWQListImpl.mm: (KWQListImpl::insert): Fix disastrous name
        collision which could lead to infinite loops.

2002-03-27  Darin Adler  <darin@apple.com>

	* src/kwq/KWQCString.mm: (QCString::isEmpty): The || should be &&.

2002-03-27  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/css/css_valueimpl.cpp:
	(FontFamilyValueImpl::FontFamilyValueImpl): Disable misguided font matching
        code in khtml.
        
	* src/kwq/KWQFont.mm: (QFont::getFont): Change the fallback so that it uses
        the default font family, but the other settings as requested, rather than
        using the default font.

2002-03-27  Kenneth Kocienda  <kocienda@apple.com>

        Changed loadProgress->bytesSoFar to use [sender contentLengthReceived]
        instead of the size of the chunk that was delivered in the callback.
        This makes the activity window data more correct than it was.
        
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]):

2002-03-27  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/ecma/Makefile.am: Get the create_hash_table tool
        from JavaScriptCore. We might need a better way to handle this later.

2002-03-26  Maciej Stachowiak  <mjs@apple.com>

	Removed kjs from here - it's now been moved to JavaScriptCore at
	the top level.

	* src/Makefile.am: Don't link libkjs.o.
	* src/kdelibs/Makefile.am: Remove kjs from subdirs.
	* src/kdelibs/kjs/.cvsignore: Removed.
	* src/kdelibs/kjs/Makefile.am: Removed.
	* src/kdelibs/kjs/array_object.cpp: Removed.
	* src/kdelibs/kjs/array_object.h: Removed.
	* src/kdelibs/kjs/bool_object.cpp: Removed.
	* src/kdelibs/kjs/bool_object.h: Removed.
	* src/kdelibs/kjs/collector.cpp: Removed.
	* src/kdelibs/kjs/collector.h: Removed.
	* src/kdelibs/kjs/create_hash_table: Removed.
	* src/kdelibs/kjs/date_object.cpp: Removed.
	* src/kdelibs/kjs/date_object.h: Removed.
	* src/kdelibs/kjs/debugger.cpp: Removed.
	* src/kdelibs/kjs/debugger.h: Removed.
	* src/kdelibs/kjs/error_object.cpp: Removed.
	* src/kdelibs/kjs/error_object.h: Removed.
	* src/kdelibs/kjs/function.cpp: Removed.
	* src/kdelibs/kjs/function.h: Removed.
	* src/kdelibs/kjs/function_object.cpp: Removed.
	* src/kdelibs/kjs/function_object.h: Removed.
	* src/kdelibs/kjs/grammar.y: Removed.
	* src/kdelibs/kjs/internal.cpp: Removed.
	* src/kdelibs/kjs/internal.h: Removed.
	* src/kdelibs/kjs/interpreter.cpp: Removed.
	* src/kdelibs/kjs/interpreter.h: Removed.
	* src/kdelibs/kjs/keywords.table: Removed.
	* src/kdelibs/kjs/kjs-test: Removed.
	* src/kdelibs/kjs/kjs-test.chk: Removed.
	* src/kdelibs/kjs/lexer.cpp: Removed.
	* src/kdelibs/kjs/lexer.h: Removed.
	* src/kdelibs/kjs/lookup.cpp: Removed.
	* src/kdelibs/kjs/lookup.h: Removed.
	* src/kdelibs/kjs/math_object.cpp: Removed.
	* src/kdelibs/kjs/math_object.h: Removed.
	* src/kdelibs/kjs/nodes.cpp: Removed.
	* src/kdelibs/kjs/nodes.h: Removed.
	* src/kdelibs/kjs/nodes2string.cpp: Removed.
	* src/kdelibs/kjs/number_object.cpp: Removed.
	* src/kdelibs/kjs/number_object.h: Removed.
	* src/kdelibs/kjs/object.cpp: Removed.
	* src/kdelibs/kjs/object.h: Removed.
	* src/kdelibs/kjs/object_object.cpp: Removed.
	* src/kdelibs/kjs/object_object.h: Removed.
	* src/kdelibs/kjs/operations.cpp: Removed.
	* src/kdelibs/kjs/operations.h: Removed.
	* src/kdelibs/kjs/property_map.cpp: Removed.
	* src/kdelibs/kjs/property_map.h: Removed.
	* src/kdelibs/kjs/regexp.cpp: Removed.
	* src/kdelibs/kjs/regexp.h: Removed.
	* src/kdelibs/kjs/regexp_object.cpp: Removed.
	* src/kdelibs/kjs/regexp_object.h: Removed.
	* src/kdelibs/kjs/string_object.cpp: Removed.
	* src/kdelibs/kjs/string_object.h: Removed.
	* src/kdelibs/kjs/test.js: Removed.
	* src/kdelibs/kjs/testkjs.cpp: Removed.
	* src/kdelibs/kjs/types.cpp: Removed.
	* src/kdelibs/kjs/types.h: Removed.
	* src/kdelibs/kjs/ustring.cpp: Removed.
	* src/kdelibs/kjs/ustring.h: Removed.
	* src/kdelibs/kjs/value.cpp: Removed.
	* src/kdelibs/kjs/value.h: Removed.

2002-03-26  Maciej Stachowiak  <mjs@apple.com>

	Removed all the borrowed Qt code.

	* src/kwq/KWQGlobal.mm: Renamed from qt/_qglobal.cpp to avoid
	confusion about the borrowedness status of this file.
	* src/kwq/Makefile.am: Removed references to kde and qt
	subdirectories.
	* src/kwq/kde/.cvsignore: Removed.
	* src/kwq/kde/Makefile.am: Removed.
	* src/kwq/kde/_kurl.cpp: Removed.
	* src/kwq/kde/_kurl.h: Removed.
	* src/kwq/qt/Makefile.am: Removed.
	* src/kwq/qt/_qarray.h: Removed.
	* src/kwq/qt/_qbuffer.cpp: Removed.
	* src/kwq/qt/_qbuffer.h: Removed.
	* src/kwq/qt/_qcollection.cpp: Removed.
	* src/kwq/qt/_qcollection.h: Removed.
	* src/kwq/qt/_qcolor.h: Removed.
	* src/kwq/qt/_qcstring.cpp: Removed.
	* src/kwq/qt/_qcstring.h: Removed.
	* src/kwq/qt/_qdatetime.cpp: Removed.
	* src/kwq/qt/_qdatetime.h: Removed.
	* src/kwq/qt/_qdict.h: Removed.
	* src/kwq/qt/_qdir.cpp: Removed.
	* src/kwq/qt/_qdir.h: Removed.
	* src/kwq/qt/_qdir_unix.cpp: Removed.
	* src/kwq/qt/_qfile.cpp: Removed.
	* src/kwq/qt/_qfile.h: Removed.
	* src/kwq/qt/_qfileinfo.cpp: Removed.
	* src/kwq/qt/_qfileinfo.h: Removed.
	* src/kwq/qt/_qfileinfo_unix.cpp: Removed.
	* src/kwq/qt/_qgarray.cpp: Removed.
	* src/kwq/qt/_qgarray.h: Removed.
	* src/kwq/qt/_qgdict.cpp: Removed.
	* src/kwq/qt/_qgdict.h: Removed.
	* src/kwq/qt/_qglist.cpp: Removed.
	* src/kwq/qt/_qglist.h: Removed.
	* src/kwq/qt/_qglobal.cpp: Removed.
	* src/kwq/qt/_qgvector.cpp: Removed.
	* src/kwq/qt/_qgvector.h: Removed.
	* src/kwq/qt/_qiodevice.cpp: Removed.
	* src/kwq/qt/_qiodevice.h: Removed.
	* src/kwq/qt/_qlist.h: Removed.
	* src/kwq/qt/_qmap.cpp: Removed.
	* src/kwq/qt/_qmap.h: Removed.
	* src/kwq/qt/_qpoint.cpp: Removed.
	* src/kwq/qt/_qpoint.h: Removed.
	* src/kwq/qt/_qptrdict.h: Removed.
	* src/kwq/qt/_qrect.cpp: Removed.
	* src/kwq/qt/_qrect.h: Removed.
	* src/kwq/qt/_qregexp.cpp: Removed.
	* src/kwq/qt/_qregexp.h: Removed.
	* src/kwq/qt/_qregion.cpp: Removed.
	* src/kwq/qt/_qregion.h: Removed.
	* src/kwq/qt/_qshared.h: Removed.
	* src/kwq/qt/_qsize.cpp: Removed.
	* src/kwq/qt/_qsize.h: Removed.
	* src/kwq/qt/_qsortedlist.h: Removed.
	* src/kwq/qt/_qstack.h: Removed.
	* src/kwq/qt/_qstring.cpp: Removed.
	* src/kwq/qt/_qstring.h: Removed.
	* src/kwq/qt/_qstringlist.cpp: Removed.
	* src/kwq/qt/_qstringlist.h: Removed.
	* src/kwq/qt/_qstrlist.h: Removed.
	* src/kwq/qt/_qtextcodec.h: Removed.
	* src/kwq/qt/_qtextstream.h: Removed.
	* src/kwq/qt/_qtl.h: Removed.
	* src/kwq/qt/_qurl.cpp: Removed.
	* src/kwq/qt/_qurl.h: Removed.
	* src/kwq/qt/_qvaluelist.h: Removed.
	* src/kwq/qt/_qvector.h: Removed.

2002-03-26  Kenneth Kocienda  <kocienda@apple.com>

	* src/Makefile.am:

2002-03-26  Darin Adler  <darin@apple.com>

	* src/kwq/KWQKjobclasses.mm: (TransferJobPrivate::TransferJobPrivate):
        Nil out the handle so we don't autorelease garbage.
        
	* src/kwq/KWQKloader.mm:
        (-[URLLoadClient IFURLHandleResourceDidCancelLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidFinishLoading:data:]),
        (-[URLLoadClient IFURLHandle:resourceDidFailLoadingWithResult:]):
        Delete the job instead of just autoreleasing the sender. Fixes a leak.

2002-03-26  Richard Williamson  <rjw@apple.com>

        Fixed leak of decoder.  This caused us to leak the entire
        document text for every load!
        
	* src/kwq/KWQKHTMLPart.mm:

2002-03-26  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/rendering/render_list.cpp: (RenderListItem::setStyle):
        Fix a leak (missing delete).

	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQFontMetrics.mm:
        (-[KWQLayoutInfo drawString:atPoint:withFont:color:]): Don't bother keeping things
        around that we only need to use once.
	(-[KWQLayoutInfo _initializeCaches]): Create them here instead.
        (-[KWQLayoutInfo dealloc]): Don't need to free them here.

2002-03-26  Darin Adler  <darin@apple.com>

	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutInfo dealloc]): Free the
        style groups, styles, and glyph vectors.
       
	* src/kwq/KWQFont.mm: (QFont::getFont): Use default font if we can't
        find a font from the passed-in family. Before, we were raising an
        exception and quitting the application.

	* src/kwq/KWQCString.mm: (QCString::isEmpty): Faster version that
        doesn't call strlen.
         
2002-03-25  Richard Williamson  <rjw@apple.com>

        Removed conditional check that prevent layout of iframes.  I don't
        understand why the check was being done.
        
	* src/kdelibs/khtml/rendering/render_flow.cpp: (RenderFlow::layout):

2002-03-25  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::slotData): Use
	-[IFURLHandle characterSet] to get the character set, instead of
	parsing it out of the header by hand.

2002-03-25  Chris Blumenberg  <cblu@apple.com>

	* src/kwq/WCPlugin.mm: (-[WCPlugin load]):
	
	Temporary special case workaround for this Java plug-in bug:
	2885120

2002-03-25  Maciej Stachowiak  <mjs@apple.com>

	Improved KURL performance:

	* src/kwq/kdecore/kurl.h, src/kwq/KWQKURL.mm: 
	(KURL::normalizeURLString): New function to cache rewritten URL
	strings.
	(RelativeURLKeyRetainCallBack, RelativeURLKeyReleaseCallBack,
	RelativeURLKeyCopyDescriptionCallBack,
	RelativeURLKeyEqualCallBack, RelativeURLKeyHashCallBack,
	KURL::normalizeRelativeURLString): Cache results of relative URL
	resolution.
	(KURL::clearCaches): function to clear the caches so they don't
	grow forever.
	(KURL::KURL): Set nothing but the string at construction time.
	(KURL::isEmpty, KURL::isMalformed, KURL::hasPath, KURL::url,
	KURL::protocol, KURL::host, KURL::port, KURL::pass, KURL::user,
	KURL::ref, KURL::query, KURL::path, KURL::setProtocol,
	KURL::setHost, KURL::setPort, KURL::setRef, KURL::setQuery,
	KURL::setPath, KURL::prettyURL, KURL::copyOnWrite, KURL::parse,
	KURL::assemble): Parse into parts on demand instead.
	(KURL::swap, KURL::operator=): Handle KURL's new urlString field.
	
	* src/kwq/KWQKloader.mm: (Cache::requestImage, Cache::requestStyleSheet,
	Cache::requestScript): Don't redundantly check if KURL isMalformed.

	* src/kwq/KWQKHTMLPart.mm (KHTMLPart::end): Clear KURL caches at
	the end of each page load.

2002-03-24  Darin Adler  <darin@apple.com>

	* src/kwq/KWQListImpl.mm: (KWQListImpl::getFirst), (KWQListImpl::getLast):
        Apparently getLast needs to handle cases where the list is empty. Since
        getFirst didn't handle it either, I added a check in both cases.

2002-03-24  Darin Adler  <darin@apple.com>

        Add tail pointer to KWQListImpl, since that shows up on so many profiles.

	* src/kwq/KWQListImpl.mm: (KWQListImpl::KWQListPrivate::copyList): Return
        a tail pointer too.
	(KWQListImpl::KWQListPrivate::KWQListPrivate): Set up tail pointer.
        (KWQListImpl::clear): Clean tail pointer too.
	(KWQListImpl::at): Special case the tail so we don't walk the whole list
        when we ask for the last element.
        (KWQListImpl::insert): Update the tail node to when inserting. Also add
        a special case for adding at the end so we don't walk the whole list.
        (KWQListImpl::remove): Update the tail node. Also, use at() in the index-
        based remove so we don't ahve to replicate the logic about finding a
        node with the special case for the tail.
	(KWQListImpl::getLast): Trivial now.
        (KWQListImpl::last): Trivial now.
	(KWQListIteratorImpl::toLast): Trivial now.
        
	* src/kwq/KWQString.mm: (QString::operator=): Remove unneeded line of code.

2002-03-24  Richard Williamson  <rjw@apple.com>

        A number of fixes to support non-latin1 decoding 
        and font measurement/drawing.
        
	* src/kwq/KWQFontMetrics.mm: (_rectForString):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::slotData):
	* src/kwq/KWQMetrics.h:

2002-03-24  Richard Williamson  <rjw@apple.com>

        Cached available families from NSFontManager.  
        http://www.gamespy.com/gdc2002/okamoto went from 4.8 seconds
        to 0.7 seconds. [Do we need to worry about updating the cache if
        the available fonts change?]
        
	* src/kwq/KWQKHTMLSettings.mm: (KHTMLSettings::availableFamilies):

2002-03-24  Richard Williamson  <rjw@apple.com>

        Fixed big leak in QString assignment operator.
        Updated comments.  Removed old fprintfs.
        Added some frame debugging logs.
        
	* src/kwq/KWQFontMetrics.mm: (_rectForString):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::requestFrame):
	* src/kwq/KWQScrollView.mm: (QScrollView::addChild),
	(QScrollView::resizeContents), (QScrollView::updateContents),
	(QScrollView::repaintContents):
	* src/kwq/KWQString.mm: (QString::operator=):
	* src/kwq/kwqdebug.h:

2002-03-23  Darin Adler  <darin@apple.com>

        Fixed problem with extra empty items in menus.

	* src/kwq/KWQComboBox.mm: (QComboBox::insertItem): Add back logic that puts
        an item in a certain position. Even though this is called insertItem, the
        behavior is to replace an item at a certain position.
	* src/kwq/KWQKComboBox.mm: (KComboBox::setSize): No need to fill the
        array with empty strings; just a waste of time based on how we do things.

2002-03-22  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/java/Makefile.am:
	* src/kdelibs/khtml/java/tests/.cvsignore:
	* src/kdelibs/khtml/java/tests/Makefile.am:
	Remove empty test subdirectory.

	* src/kdelibs/kjs/.cvsignore: Ignore kjs-test output.

2002-03-22  Maciej Stachowiak  <mjs@apple.com>

	Fix some things that were making automake complain.

	* src/kdelibs/kjs/Makefile.am:
	* src/kwq/Makefile.am:

2002-03-22  Darin Adler  <darin@apple.com>

	* src/kdelibs/khtml/css/cssstyleselector.cpp: (khtml::applyRule):
	Fix boolean logic mistake from the original KDE sources.

2002-03-22  Darin Adler  <darin@apple.com>

        Finally giving up on the complete QString rewrite after doing it 3 times,
        Darin checks in some improvements for the old QString. This makes a QString
        be 8 bytes instead of 12, and improves a few other details. No dramatic
        speedups, but no slowdown either.

	* src/kwq/qt/qstring.h:
	* src/kwq/KWQString.mm:
	(QString::QString), (QString::~QString), (QString::operator=),
        (QString::unicode), (QString::latin1): Store the cache type inside the cache.
	(QString::copy): No need to deep copy here.
        (QString::simplifyWhiteSpace): Use CFStringInlineBuffer.
	(QString::insert): Fix single-character insertions so they don't create and
        destroy a mutable CFStringRef every time.
        (QString::operator+=): Call the appropriate insert function.
	(QString::flushCache): Store cache type inside cache.
        (QString::compareToLatin1): Use CFStringInlineBuffer.
	(operator==): Use CFStringInlineBuffer.
        (QConstString::QConstString): Store the cache type inside the cache.

2002-03-22  John Sullivan  <sullivan@apple.com>

	Made changing font sizes work immediately (other than an
	unrelated crash).

	* src/kwq/KWQKHTMLSettings.mm: 
	(KHTMLSettings::KHTMLSettings),
	(KHTMLSettings::fontSizes): Moved defaults-fetching code from
	constructor to accessor, so it doesn't get out of synch with
	preference changes.

	* src/kwq/khtml/khtml_settings.h: Added "mutable" keyword
	to declaration of m_fontSizes, so the other change would compile.

2002-03-22  Kenneth Kocienda  <kocienda@apple.com>

        Moved KWQKloader to the new thread-safe API for accessing handle attributes.

	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidBeginLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidCancelLoading:]), (-[URLLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):

2002-03-22  Richard Williamson  <rjw@apple.com>

        Fixed subtle measurement problems.  These were most evident of pages
        that had lots of rounding deviation.  My assumptions about being able to
        round glyph advances was incorrect.  We must pay the expense of a float addition,
        instead of integer addition.  This slows down our inner loop.  Oh well,
        we're still very fast.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutInfo
	drawString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	_initializeCaches]), (_rectForString), (QFontMetrics::width),
	(QFontMetrics::size):
	* src/kwq/KWQMetrics.h:

2002-03-22  Maciej Stachowiak  <mjs@apple.com>

	Fixed the following post-merge crashers:

	2885602 - Alexander crashes when clicking on a particular link in Google groups
	2885564 - Alexander crashes on load failures
	
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::~KHTMLView): Fix
	Radar 2885602 by detaching the document from the view when the
	view is destroyed. This was making the document reference a
	destroyed view later.

	* src/kwq/KWQKHTMLPart.mm: 
	(KHTMLPart::~KHTMLPart): Fix Radar 2885564 by checking if m_doc is
	NULL, since it's now inititally set to NULL.
	(KHTMLPart::KHTMLPart, KHTMLPart::init): Formatting tweaks.
	
2002-03-20  Maciej Stachowiak  <mjs@apple.com>

	Merged the following changes from LABYRINTH_KDE_3_MERGE branch:

	2002-03-20  Maciej Stachowiak  <mjs@apple.com>

		* src/kdelibs/khtml/rendering/render_applet.cpp:
		(RenderApplet::RenderApplet): Handle Java parameters properly,
		with Chris's assistance.

	2002-03-20  Maciej Stachowiak  <mjs@apple.com>

		Merged accumlated changes from HEAD, up to
		MERGED_TO_KDE_3_MERGE_BRANCH tag.

	2002-03-19  Maciej Stachowiak  <mjs@apple.com>

		Fixed two more crashers. Tree now looks pretty stable.

		* src/kdelibs/khtml/html/html_objectimpl.cpp:
		(HTMLObjectElementImpl::detach): Don't send an unload event, that
		needs the view to be a live, which it won't be when the DOM is
		being destroyed.

		* src/kwq/KWQListImpl.mm: (KWQListImpl::getFirst): Return
		d->head->data, not d->head. Whoops!

	2002-03-19  Maciej Stachowiak  <mjs@apple.com>

		Fixed two crashers:

		* src/kdelibs/khtml/rendering/render_object.h: Don't attempt to
		schedule a relayout ever. We control layout timing. This was
		resulting in calls on destroyed/trashed objects before.

		* src/kdelibs/khtml/xml/dom_nodeimpl.cpp:
		(NodeImpl::dispatchEvent): Check if view()->part() is NULL (looks
		like a bug in the KDE code that this wasn't checked).

	2002-03-19  Maciej Stachowiak  <mjs@apple.com>

		Changes needed to get WebCore to link: implement all the missing functions.
	
		* src/kdelibs/khtml/html/htmltokenizer.cpp: (HTMLTokenizer::end):
		* src/kdelibs/khtml/xml/xml_tokenizer.cpp: (XMLTokenizer::end):
		* src/kdelibs/khtml/xml/xml_tokenizer.h:
		* src/kwq/KWQApplication.mm: (QApplication::_initialize),
		(QApplication::focusWidget):
		* src/kwq/KWQColorGroup.mm: (QColorGroup::operator==):
		* src/kwq/KWQComboBox.mm: (QComboBox::currentItem):
		* src/kwq/KWQCursor.mm: (QCursor::operator=), (QCursor::handle):
		* src/kwq/KWQEvent.mm: (QMouseEvent::QMouseEvent), (QKeyEvent::isAutoRepeat),
		(QKeyEvent::text), (QKeyEvent::ascii), (QKeyEvent::count),
		(QKeyEvent::isAccepted), (QCustomEvent::QCustomEvent),
		(QContextMenuEvent::QContextMenuEvent), (QContextMenuEvent::globalPos),
		(QContextMenuEvent::reason), (QContextMenuEvent::state), (QContextMenuEvent::x),
		(QContextMenuEvent::y):
		* src/kwq/KWQFontMetrics.mm: (QFontMetrics::boundingRect):
		* src/kwq/KWQKCursor.mm: (KCursor::whatsThisCursor):
		* src/kwq/KWQKDebug.mm: (kdBacktrace):
		* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::metaRefreshEnabled),
		(KHTMLPart::executeScript), (KHTMLPart::requestObject),
		(KHTMLPart::setJSDefaultStatusBarText), (KHTMLPart::referrer),
		(KHTMLPart::lastModified):
		* src/kwq/KWQKMimeType.mm: (KMimeType::comment), (KMimeType::mimeType),
		(KMimeType::defaultMimeType):
		* src/kwq/KWQKPrinter.mm: (KPrinter::KPrinter):
		* src/kwq/KWQKProtocolManager.mm: (KProtocolManager::proxyFor):
		* src/kwq/KWQKstddirs.mm: (KStandardDirs::saveLocation):
		* src/kwq/KWQLineEdit.mm: (QLineEdit::edited), (QLineEdit::setEdited):
		* src/kwq/KWQListImpl.h:
		* src/kwq/KWQListImpl.mm: (KWQListImpl::getFirst), (KWQListImpl::take):
		* src/kwq/KWQMapImpl.h:
		* src/kwq/KWQMapImpl.mm: (KWQMapImpl::removeEqualInternal):
		* src/kwq/KWQNSTextField.h:
		* src/kwq/KWQNSTextField.mm: (-[KWQNSTextField edited]), (-[KWQNSTextField
		setEdited:]), (-[KWQNSTextField textDidChange:]):
		* src/kwq/KWQObject.mm: (QObject::eventFilter):
		* src/kwq/KWQPainter.mm: (QPainter::drawConvexPolygon), (QPainter::drawText):
		* src/kwq/KWQPalette.mm: (QPalette::operator==):
		* src/kwq/KWQRadioButton.mm: (QRadioButton::isChecked):
		* src/kwq/KWQRect.mm: (QRect::isEmpty), (QRect::intersect), (QRect::unite):
		* src/kwq/KWQRegion.mm: (QRegion::translate), (QRegion::boundingRect):
		* src/kwq/KWQScrollView.mm: (QScrollView::updateContents):
		* src/kwq/KWQString.mm: (QString::endsWith):
		* src/kwq/KWQStyle.h:
		* src/kwq/KWQTextArea.h:
		* src/kwq/KWQTextArea.mm: (-[KWQTextArea paragraphs]), (RangeOfParagraph),
		(-[KWQTextArea paragraphLength:]), (-[KWQTextArea textForParagraph:]),
		(-[KWQTextArea lineOfCharAtIndex:inParagraph:]), (-[KWQTextArea
		getCursorPositionAsIndex:inParagraph:]), (-[KWQTextArea
		setCursorPositionToIndex:inParagraph:]):
		* src/kwq/KWQTextEdit.mm: (QMultiLineEdit::QMultiLineEdit), (KEdit::KEdit),
		(KEdit::~KEdit), (QTextEdit::QTextEdit), (QTextEdit::setText), (QTextEdit::text),
		(QTextEdit::paragraphs), (QTextEdit::paragraphLength), (QTextEdit::lineOfChar),
		(QTextEdit::getCursorPosition), (QTextEdit::setCursorPosition),
		(QTextEdit::wordWrap), (QTextEdit::setWordWrap), (QTextEdit::setTextFormat),
		(QTextEdit::isReadOnly), (QTextEdit::setReadOnly), (QTextEdit::selectAll):
		* src/kwq/KWQVectorImpl.mm: (KWQVectorImpl::at), (KWQVectorImpl::data):
		* src/kwq/KWQWidget.mm: (QWidget::frameGeometry), (QWidget::cursor),
		(QWidget::unsetCursor):
		* src/kwq/KWQbrowserextension.mm:
		* src/kwq/KWQtextstream.mm: (QTextStream::QTextStream),
		(QTextStream::operator<<), (endl):
		* src/kwq/KWQxml.mm: (QXmlAttributes::uri), (QXmlParseException::lineNumber):
		* src/kwq/Makefile.am:
		* src/kwq/kdecore/kstandarddirs.h:
		* src/kwq/kdecore/kstaticdeleter.h:
		* src/kwq/kdeui/keditcl.h:
		* src/kwq/kio/kmimetype.h:
		* src/kwq/qt/qarray.h:
		* src/kwq/qt/qevent.h:
		* src/kwq/qt/qlist.h:
		* src/kwq/qt/qmap.h:
		* src/kwq/qt/qpalette.h:
		* src/kwq/qt/qptrqueue.h:
		* src/kwq/qt/qscrollview.h:
		* src/kwq/qt/qstring.h:
		* src/kwq/qt/qtextedit.h:

	2002-03-18  Maciej Stachowiak  <mjs@apple.com>

		Changes needed to get kwq compiling (doesn't link yet, though).

		* src/kdelibs/khtml/misc/loader.h:
		* src/kdelibs/khtml/xml/dom_elementimpl.h:
		* src/kwq/KWQCollection.mm: (QPtrCollection::QPtrCollection),
		(QPtrCollection::operator=), (QPtrCollection::~QPtrCollection),
		(QPtrCollection::autoDelete), (QPtrCollection::setAutoDelete):
		* src/kwq/KWQEvent.mm: (QKeyEvent::QKeyEvent):
		* src/kwq/KWQIcon.h:
		* src/kwq/KWQKHTMLFactory.mm:
		* src/kwq/KWQKHTMLPart.h:
		* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::KHTMLPart), (KHTMLPart::slotData),
		(KHTMLPart::begin), (KHTMLPart::write), (KHTMLPart::checkCompleted),
		(KHTMLPart::settings), (KHTMLPart::completeURL), (KHTMLPart::encoding),
		(KHTMLPart::overURL), (KHTMLPart::urlSelected), (KHTMLPart::requestObject),
		(KHTMLPart::frames), (KHTMLPart::event):
		* src/kwq/KWQKHTMLSettings.mm: (KHTMLSettings::KHTMLSettings),
		(KHTMLSettings::availableFamilies):
		* src/kwq/KWQKProcess.mm: (KProcess::args):
		* src/kwq/KWQKloader.mm: (CachedImage::CachedImage), (CachedImage::movieStatus),
		(DocLoader::DocLoader), (Loader::load), (Loader::servePendingRequests),
		(Loader::slotFinished), (Cache::requestScript):
		* src/kwq/KWQPainter.mm: (QPainter::save):
		* src/kwq/KWQPointArray.mm: (QPointArray::setPoint):
		* src/kwq/KWQValueListImpl.mm: (KWQValueListImpl::removeEqualNodes),
		(KWQValueListImpl::containsEqualNodes):
		* src/kwq/KWQView.mm: (-[KWQHTMLView layout]):
		* src/kwq/KWQsignals.mm: (khtml::Loader::requestDone),
		(khtml::Loader::requestFailed):
		* src/kwq/kdecore/kiconloader.h:
		* src/kwq/kparts/browserextension.h:
		* src/kwq/qt/qmovie.h:
		
	2002-03-16  Maciej Stachowiak  <mjs@apple.com>

		Updated to get khtml to compile. Changes included updating our
		headers for new classes, new methods, header name changes, etc, as
		well as occasionally commenting out or replacing portions of the
		khtml code with #if APPLE_CHANGES, and adding new files from the
		kde3 sources when appropriate. Also commit some kjs files that I
		forgot to cvs add before.

		* src/kdelibs/khtml/css/css_valueimpl.cpp:
		(CSSStyleDeclarationImpl::getPropertyCSSValue):
		* src/kdelibs/khtml/css/cssparser.cpp: (StyleBaseImpl::parseContent):
		* src/kdelibs/khtml/css/cssstyleselector.cpp:
		(CSSStyleSelector::CSSStyleSelector), (khtml::applyRule):
		* src/kdelibs/khtml/ecma/.cvsignore:
		* src/kdelibs/khtml/ecma/Makefile.am:
		* src/kdelibs/khtml/ecma/kjs_debugwin.h:
		* src/kdelibs/khtml/ecma/kjs_dom.cpp: (DOMNode::toString):
		* src/kdelibs/khtml/ecma/kjs_dom.h:
		* src/kdelibs/khtml/ecma/kjs_window.cpp:
		* src/kdelibs/khtml/html/html_documentimpl.cpp: (HTMLDocumentImpl::cookie),
		(HTMLDocumentImpl::setCookie):
		* src/kdelibs/khtml/html/html_formimpl.cpp:
		(HTMLKeygenElementImpl::HTMLKeygenElementImpl),
		(HTMLKeygenElementImpl::encoding):
		* src/kdelibs/khtml/java/kjavaprocess.cpp: (KJavaProcess::invokeJVM):
		* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::contentsContextMenuEvent):
		* src/kdelibs/khtml/misc/loader.h:
		* src/kdelibs/khtml/rendering/render_box.cpp: (RenderBox::calcReplacedWidth):
		* src/kdelibs/khtml/rendering/render_form.cpp: (RenderTextArea::calcMinMaxWidth):
		* src/kdelibs/khtml/rendering/render_image.cpp: (RenderImage::printObject):
		* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::nodeAtPoint):
		* src/kdelibs/khtml/xml/dom_docimpl.cpp: (DocumentImpl::close):
		* src/kdelibs/khtml/xml/dom_elementimpl.cpp:
		(ElementImpl::dispatchAttrRemovalEvent),
		(ElementImpl::dispatchAttrAdditionEvent):
		* src/kdelibs/kjs/interpreter.cpp: (Context::Context), (Context::operator=),
		(Context::~Context), (Context::isNull), (Context::imp), (Context::scopeChain),
		(Context::variableObject), (Context::thisValue), (Context::callingContext),
		(Interpreter::Interpreter), (Interpreter::~Interpreter),
		(Interpreter::globalObject), (Interpreter::globalExec),
		(Interpreter::checkSyntax), (Interpreter::evaluate), (Interpreter::imp),
		(Interpreter::builtinObject), (Interpreter::builtinFunction),
		(Interpreter::builtinArray), (Interpreter::builtinBoolean),
		(Interpreter::builtinString), (Interpreter::builtinNumber),
		(Interpreter::builtinDate), (Interpreter::builtinRegExp),
		(Interpreter::builtinError), (Interpreter::builtinObjectPrototype),
		(Interpreter::builtinFunctionPrototype), (Interpreter::builtinArrayPrototype),
		(Interpreter::builtinBooleanPrototype), (Interpreter::builtinStringPrototype),
		(Interpreter::builtinNumberPrototype), (Interpreter::builtinDatePrototype),
		(Interpreter::builtinRegExpPrototype), (Interpreter::builtinErrorPrototype),
		(Interpreter::builtinEvalError), (Interpreter::builtinRangeError),
		(Interpreter::builtinReferenceError), (Interpreter::builtinSyntaxError),
		(Interpreter::builtinTypeError), (Interpreter::builtinURIError),
		(Interpreter::builtinEvalErrorPrototype),
		(Interpreter::builtinRangeErrorPrototype),
		(Interpreter::builtinReferenceErrorPrototype),
		(Interpreter::builtinSyntaxErrorPrototype),
		(Interpreter::builtinTypeErrorPrototype),
		(Interpreter::builtinURIErrorPrototype), (Interpreter::setCompatMode),
		(Interpreter::compatMode), (Interpreter::finalCheck), (ExecState::~ExecState),
		(ExecState::interpreter), (ExecState::context), (ExecState::setException),
		(ExecState::clearException), (ExecState::exception), (ExecState::hadException),
		(ExecState::ExecState):
		* src/kdelibs/kjs/property_map.cpp: (PropertyMapNode::setLeft),
		(PropertyMapNode::setRight), (PropertyMapNode::setParent),
		(PropertyMapNode::findMax), (PropertyMapNode::findMin), (PropertyMapNode::next),
		(KJS::uscompare), (PropertyMap::PropertyMap), (PropertyMap::~PropertyMap),
		(PropertyMap::put), (PropertyMap::remove), (PropertyMap::get),
		(PropertyMap::clear), (PropertyMap::dump), (PropertyMap::checkTree),
		(PropertyMap::getNode), (PropertyMap::first), (PropertyMap::balance),
		(PropertyMap::updateHeight), (PropertyMap::rotateRR), (PropertyMap::rotateLL),
		(PropertyMap::rotateRL), (PropertyMap::rotateLR):
		* src/kdelibs/kjs/property_map.h:
		* src/kdelibs/kjs/value.cpp: (ValueImp::ValueImp), (ValueImp::~ValueImp),
		(ValueImp::mark), (ValueImp::marked), (ValueImp::setGcAllowed),
		(ValueImp::operator new), (ValueImp::operator delete), (ValueImp::toInteger),
		(ValueImp::toInt32), (ValueImp::toUInt32), (ValueImp::toUInt16),
		(ValueImp::getBase), (ValueImp::getPropertyName), (ValueImp::getValue),
		(ValueImp::putValue), (KJS::operator==), (KJS::operator!=), (Value::Value),
		(Value::~Value), (Value::operator=), (Value::isNull), (Value::imp),
		(Value::type), (Value::isA), (Value::toPrimitive), (Value::toBoolean),
		(Value::toNumber), (Value::toInteger), (Value::toInt32), (Value::toUInt32),
		(Value::toUInt16), (Value::toString), (Value::toObject), (Value::getBase),
		(Value::getPropertyName), (Value::getValue), (Value::putValue),
		(Undefined::Undefined), (Undefined::~Undefined), (Undefined::operator=),
		(Undefined::dynamicCast), (Null::Null), (Null::~Null), (Null::operator=),
		(Null::dynamicCast), (Boolean::Boolean), (Boolean::~Boolean),
		(Boolean::operator=), (Boolean::value), (Boolean::dynamicCast), (String::String),
		(String::~String), (String::operator=), (String::value), (String::dynamicCast),
		(Number::Number), (Number::~Number), (Number::operator=), (Number::dynamicCast),
		(Number::value), (Number::intValue), (Number::isNaN), (Number::isInf):
		* src/kwq/KWQDef.h:
		* src/kwq/KWQInputDialog.mm: (QInputDialog::getText):
		* src/kwq/KWQKConfigBase.mm: (KConfig::KConfig):
		* src/kwq/KWQKHTMLPart.h:
		* src/kwq/KWQListImpl.h:
		* src/kwq/KWQMapImpl.h:
		* src/kwq/KWQMapImpl.mm: (KWQMapImpl::removeEqualInternal):
		* src/kwq/KWQStrList.h:
		* src/kwq/KWQStyle.h:
		* src/kwq/KWQValueListImpl.h:
		* src/kwq/KWQVectorImpl.h:
		* src/kwq/kdecore/kapplication.h:
		* src/kwq/kdecore/kconfig.h:
		* src/kwq/kdecore/kdebug.h:
		* src/kwq/kdecore/kprocess.h:
		* src/kwq/kdecore/kstandarddirs.h:
		* src/kwq/kdecore/kstaticdeleter.h:
		* src/kwq/kdeui/kaction.h:
		* src/kwq/kdeui/kcursor.h:
		* src/kwq/khtml/khtml_factory.h:
		* src/kwq/khtml/khtml_settings.h:
		* src/kwq/kio/global.h:
		* src/kwq/kio/kmimetype.h:
		* src/kwq/kio/kprinter.h:
		* src/kwq/kio/kprotocolmanager.h:
		* src/kwq/kparts/browserextension.h:
		* src/kwq/qt/qapplication.h:
		* src/kwq/qt/qarray.h:
		* src/kwq/qt/qcollection.h:
		* src/kwq/qt/qcombobox.h:
		* src/kwq/qt/qcstring.h:
		* src/kwq/qt/qcursor.h:
		* src/kwq/qt/qdict.h:
		* src/kwq/qt/qevent.h:
		* src/kwq/qt/qfontmetrics.h:
		* src/kwq/qt/qinputdialog.h:
		* src/kwq/qt/qlineedit.h:
		* src/kwq/qt/qlist.h:
		* src/kwq/qt/qmap.h:
		* src/kwq/qt/qmemarray.h:
		* src/kwq/qt/qnamespace.h:
		* src/kwq/qt/qobject.h:
		* src/kwq/qt/qpainter.h:
		* src/kwq/qt/qpalette.h:
		* src/kwq/qt/qpoint.h:
		* src/kwq/qt/qpointarray.h:
		* src/kwq/qt/qprinter.h:
		* src/kwq/qt/qptrdict.h:
		* src/kwq/qt/qptrlist.h:
		* src/kwq/qt/qptrqueue.h:
		* src/kwq/qt/qptrstack.h:
		* src/kwq/qt/qptrvector.h:
		* src/kwq/qt/qradiobutton.h:
		* src/kwq/qt/qrect.h:
		* src/kwq/qt/qregion.h:
		* src/kwq/qt/qscrollview.h:
		* src/kwq/qt/qsortedlist.h:
		* src/kwq/qt/qstack.h:
		* src/kwq/qt/qstring.h:
		* src/kwq/qt/qstylesheet.h:
		* src/kwq/qt/qtextedit.h:
		* src/kwq/qt/qtextstream.h:
		* src/kwq/qt/qvaluelist.h:
		* src/kwq/qt/qvector.h:
		* src/kwq/qt/qwidget.h:
		* src/kwq/qt/qxml.h:
		
	2002-03-14  Maciej Stachowiak  <mjs@apple.com>

		Get kjs to compile and link by adding mssing files, setting up
		autogenerated files to autogenerate, and making a handful of minor
		tweaks. The test program passes. Yay!

		* src/kdelibs/kjs/Makefile.am:
		* src/kdelibs/kjs/create_hash_table:
		* src/kdelibs/kjs/global_object.cpp:
		* src/kdelibs/kjs/grammar.y:
		* src/kdelibs/kjs/interpreter.h:
		* src/kdelibs/kjs/keywords.table:
		* src/kdelibs/kjs/kjs.cpp:
		* src/kdelibs/kjs/kjs.h:
		* src/kdelibs/kjs/lexer.lut.h:
		* src/kdelibs/kjs/math_object.lut.h:
		* src/kdelibs/kjs/ustring.h:
		* src/kdelibs/kjs/value.h:
		* src/kdelibs/kjs/.cvsignore:
		
	2002-03-14  Maciej Stachowiak  <mjs@apple.com>

		Hand-merge KDE3 beta 2 changes into this frankenstein file.

		* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient setDataSource:]),
		(WCSetIFWebDataSourceMakeFunc), (WCSetIFErrorMakeFunc), (recursive),
		(encodingFromContentType), (splitUrlTarget), (KHTMLPart::KHTMLPart),
		(KHTMLPart::init), (KHTMLPart::~KHTMLPart), (KHTMLPart::browserExtension),
		(KHTMLPart::view), (KHTMLPart::setMetaRefreshEnabled), (KHTMLPart::jScript),
		(KHTMLPart::executeScript), (KHTMLPart::executeScheduledScript),
		(KHTMLPart::docImpl), (KHTMLPart::xmlDocImpl), (KHTMLPart::slotData),
		(KHTMLPart::begin), (KHTMLPart::write), (KHTMLPart::end),
		(KHTMLPart::checkCompleted), (KHTMLPart::settings), (KHTMLPart::completeURL),
		(KHTMLPart::scheduleRedirection), (KHTMLPart::setEncoding),
		(KHTMLPart::encoding), (KHTMLPart::gotoAnchor), (KHTMLPart::setFontSizes),
		(KHTMLPart::fontSizes), (KHTMLPart::onlyLocalReferences),
		(KHTMLPart::setOnlyLocalReferences), (KHTMLPart::findTextBegin),
		(KHTMLPart::findTextNext), (KHTMLPart::selectedText), (KHTMLPart::hasSelection),
		(KHTMLPart::selection), (KHTMLPart::setSelection), (KHTMLPart::overURL),
		(KHTMLPart::urlSelected), (KHTMLPart::requestFrame),
		(KHTMLPart::requestFrameName), (KHTMLPart::requestObject),
		(KHTMLPart::submitForm), (KHTMLPart::findFrame), (KHTMLPart::frameExists),
		(KHTMLPart::parentPart), (KHTMLPart::setJSStatusBarText),
		(KHTMLPart::setJSDefaultStatusBarText), (KHTMLPart::jsStatusBarText),
		(KHTMLPart::jsDefaultStatusBarText), (KHTMLPart::frames),
		(KHTMLPart::customEvent), (KHTMLPart::khtmlMousePressEvent):
		
	2002-03-13  Maciej Stachowiak  <mjs@apple.com>

		Merge KDE3 beta 2 changes into this frankenstein file.

		* src/kwq/KWQKloader.mm: (CachedCSSStyleSheet::CachedCSSStyleSheet),
		(CachedCSSStyleSheet::ref), (CachedCSSStyleSheet::data),
		(CachedCSSStyleSheet::checkNotify), (CachedCSSStyleSheet::error),
		(CachedScript::CachedScript), (CachedScript::ref), (CachedScript::data),
		(CachedScript::checkNotify), (CachedScript::error), (CachedImage::CachedImage),
		(CachedImage::ref), (CachedImage::tiled_pixmap), (CachedImage::pixmap_size),
		(CachedImage::do_notify), (CachedImage::movieStatus), (CachedImage::movieResize),
		(CachedImage::setShowAnimations), (CachedImage::deleteMovie),
		(CachedImage::data), (Request::Request), (DocLoader::DocLoader),
		(DocLoader::requestImage), (DocLoader::requestStyleSheet),
		(DocLoader::requestScript), (DocLoader::setAutoloadImages),
		(DocLoader::setShowAnimations), (Loader::Loader), (Loader::~Loader),
		(Loader::load), (Loader::servePendingRequests), (Loader::slotFinished),
		(Loader::slotData), (Loader::numRequests), (Loader::cancelRequests),
		(Cache::init), (Cache::requestImage), (Cache::requestStyleSheet),
		(Cache::preloadStyleSheet), (Cache::requestScript), (Cache::preloadScript),
		(Cache::flush):

	2002-03-13  Maciej Stachowiak  <mjs@apple.com>

		Clean up this frankenstein file in preparation for merging KDE
		beta 2 changes.

		* src/kwq/KWQKloader.mm: (CachedCSSStyleSheet::CachedCSSStyleSheet),
		(CachedScript::CachedScript), (CachedImage::CachedImage),
		(CachedImage::pixmap_size), (CachedImage::movieResize), (CachedImage::data),
		(DocLoader::DocLoader), (Loader::Loader), (Loader::~Loader), (Loader::load),
		(Loader::servePendingRequests), (Loader::slotFinished), (Loader::slotData),
		(Loader::numRequests), (Loader::cancelRequests), (Cache::requestImage),
		(Cache::requestStyleSheet), (Cache::requestScript), (Cache::flush):

	2002-03-13  Maciej Stachowiak  <mjs@apple.com>

		Remove files from build that are no longer in KDE 3 beta 2:

		* src/kdelibs/khtml/ecma/Makefile.am:
		* src/kdelibs/khtml/ecma/kjs_text.cpp:
		* src/kdelibs/khtml/ecma/kjs_text.h:
		* src/kdelibs/khtml/misc/Makefile.am:
		* src/kdelibs/khtml/misc/font.cpp:
		* src/kdelibs/khtml/misc/font.h:
		* src/kdelibs/khtml/rendering/Makefile.am:
		* src/kdelibs/khtml/rendering/render_hr.cpp:
		* src/kdelibs/khtml/rendering/render_hr.h:
		
	2002-03-08  Don Melton  <gramps@apple.com>

		Merged kdelibs from KDE 3 beta 2 into our 2.2.1-based sources.

		* src/kdelibs/kdecore/kentities.gperf:
		* src/kdelibs/khtml/css/css_ruleimpl.cpp: (CSSRuleImpl::CSSRuleImpl),
		(CSSRuleImpl::cssText), (CSSCharsetRuleImpl::CSSCharsetRuleImpl),
		(CSSImportRuleImpl::CSSImportRuleImpl), (CSSImportRuleImpl::~CSSImportRuleImpl),
		(CSSImportRuleImpl::setStyleSheet), (CSSImportRuleImpl::init),
		(CSSMediaRuleImpl::CSSMediaRuleImpl), (CSSMediaRuleImpl::~CSSMediaRuleImpl),
		(CSSMediaRuleImpl::cssRules), (CSSMediaRuleImpl::appendRule),
		(CSSMediaRuleImpl::insertRule), (CSSMediaRuleImpl::deleteRule),
		(CSSRuleListImpl::~CSSRuleListImpl), (CSSPageRuleImpl::selectorText),
		(CSSStyleRuleImpl::selectorText), (CSSStyleRuleImpl::setSelector),
		(CSSUnknownRuleImpl::~CSSUnknownRuleImpl), (CSSRuleListImpl::CSSRuleListImpl),
		(CSSRuleListImpl::length), (CSSRuleListImpl::item),
		(CSSRuleListImpl::deleteRule), (CSSRuleListImpl::insertRule):
		* src/kdelibs/khtml/css/css_ruleimpl.h:
		* src/kdelibs/khtml/css/css_stylesheetimpl.cpp: (StyleSheetImpl::setMedia),
		(CSSStyleSheetImpl::CSSStyleSheetImpl), (CSSStyleSheetImpl::parseString),
		(StyleSheetListImpl::~StyleSheetListImpl), (StyleSheetListImpl::length),
		(StyleSheetListImpl::item), (MediaListImpl::MediaListImpl),
		(MediaListImpl::contains), (MediaListImpl::item), (MediaListImpl::deleteMedium),
		(MediaListImpl::appendMedium), (MediaListImpl::setMediaText):
		* src/kdelibs/khtml/css/css_stylesheetimpl.h:
		* src/kdelibs/khtml/css/css_valueimpl.cpp:
		(CSSStyleDeclarationImpl::CSSStyleDeclarationImpl),
		(CSSStyleDeclarationImpl::getPropertyCSSValue),
		(CSSStyleDeclarationImpl::removeProperty),
		(CSSStyleDeclarationImpl::setProperty),
		(CSSStyleDeclarationImpl::setLengthProperty), (CSSStyleDeclarationImpl::item),
		(CSSValueListImpl::cssValueType), (CSSPrimitiveValueImpl::cssValueType),
		(CSSImageValueImpl::CSSImageValueImpl),
		(FontFamilyValueImpl::FontFamilyValueImpl):
		* src/kdelibs/khtml/css/css_valueimpl.h:
		* src/kdelibs/khtml/css/csshelper.cpp: (khtml::computeLengthFloat),
		(khtml::setFontSize):
		* src/kdelibs/khtml/css/csshelper.h:
		* src/kdelibs/khtml/css/cssparser.cpp: (StyleBaseImpl::baseURL),
		(StyleBaseImpl::parseAtRule), (StyleBaseImpl::parseSelector2),
		(StyleBaseImpl::parseSelector), (StyleBaseImpl::parseProperty),
		(StyleBaseImpl::parseProperties), (StyleBaseImpl::parseFont),
		(StyleBaseImpl::parseValue), (StyleBaseImpl::setParsedValue),
		(StyleBaseImpl::parseShortHand), (StyleBaseImpl::parseBackgroundPosition),
		(StyleBaseImpl::parseContent), (StyleBaseImpl::splitContent),
		(StyleBaseImpl::splitShorthandProperties), (StyleBaseImpl::parse2Values),
		(StyleBaseImpl::parse4Values), (StyleBaseImpl::parseUnit),
		(StyleBaseImpl::parseStyleRule), (StyleBaseImpl::preprocess),
		(CSSSelector::specificity):
		* src/kdelibs/khtml/css/cssparser.h:
		* src/kdelibs/khtml/css/cssproperties.in:
		* src/kdelibs/khtml/css/cssstyleselector.cpp:
		(CSSStyleSelector::CSSStyleSelector), (CSSStyleSelector::addSheet),
		(CSSStyleSelector::loadDefaultStyle), (CSSStyleSelector::clear),
		(CSSStyleSelector::styleForElement), (CSSStyleSelector::addInlineDeclarations),
		(CSSStyleSelector::checkSelector), (CSSStyleSelector::checkOneSelector),
		(CSSStyleSelector::buildLists), (CSSStyleSelectorList::CSSStyleSelectorList),
		(CSSStyleSelectorList::append), (CSSStyleSelectorList::collect),
		(CSSOrderedPropertyList::compareItems), (CSSOrderedPropertyList::append),
		(convertToLength), (khtml::applyRule):
		* src/kdelibs/khtml/css/cssstyleselector.h:
		* src/kdelibs/khtml/css/cssvalues.in:
		* src/kdelibs/khtml/css/html4.css:
		* src/kdelibs/khtml/css/makeprop:
		* src/kdelibs/khtml/css/makevalues:
		* src/kdelibs/khtml/dom/css_rule.cpp: (CSSRuleList::CSSRuleList):
		* src/kdelibs/khtml/dom/css_rule.h:
		* src/kdelibs/khtml/dom/css_stylesheet.cpp: (MediaList::length),
		(MediaList::item), (MediaList::deleteMedium), (MediaList::appendMedium):
		* src/kdelibs/khtml/dom/css_stylesheet.h:
		* src/kdelibs/khtml/dom/css_value.cpp: (CSSStyleDeclaration::getPropertyValue),
		(CSSStyleDeclaration::getPropertyCSSValue),
		(CSSStyleDeclaration::removeProperty),
		(CSSStyleDeclaration::getPropertyPriority), (CSSStyleDeclaration::setProperty),
		(CSSPrimitiveValue::setFloatValue):
		* src/kdelibs/khtml/dom/css_value.h:
		* src/kdelibs/khtml/dom/dom2_events.cpp: (Event::type), (Event::eventModuleName):
		* src/kdelibs/khtml/dom/dom2_events.h:
		* src/kdelibs/khtml/dom/dom2_range.cpp:
		* src/kdelibs/khtml/dom/dom2_range.h:
		* src/kdelibs/khtml/dom/dom2_traversal.cpp:
		* src/kdelibs/khtml/dom/dom2_traversal.h:
		* src/kdelibs/khtml/dom/dom2_views.cpp: (AbstractView::document),
		(AbstractView::getComputedStyle):
		* src/kdelibs/khtml/dom/dom2_views.h:
		* src/kdelibs/khtml/dom/dom_core.h:
		* src/kdelibs/khtml/dom/dom_doc.cpp: (DOMImplementation::hasFeature),
		(DOMImplementation::createDocumentType), (DOMImplementation::createDocument),
		(DOMImplementation::createHTMLDocument), (DOMImplementation::getInterface),
		(DOMImplementation::createCSSStyleSheet), (Document::Document),
		(Document::operator = ), (Document::createAttribute),
		(Document::createAttributeNS), (Document::getElementById),
		(Document::getElementsByTagName), (Document::getElementsByTagNameNS),
		(Document::importNode), (Document::isHTMLDocument), (Document::createRange),
		(Document::completeURL), (DocumentFragment::operator = ),
		(DocumentType::DocumentType), (DocumentType::operator = ), (DocumentType::name),
		(DocumentType::entities), (DocumentType::notations), (DocumentType::publicId),
		(DocumentType::systemId), (DocumentType::internalSubset):
		* src/kdelibs/khtml/dom/dom_doc.h:
		* src/kdelibs/khtml/dom/dom_element.cpp: (Attr::operator = ), (Attr::name),
		(Attr::ownerElement), (Attr::value), (Attr::setValue), (Element::operator = ),
		(Element::tagName), (Element::getAttribute), (Element::setAttribute),
		(Element::removeAttribute), (Element::getAttributeNode),
		(Element::setAttributeNode), (Element::removeAttributeNode),
		(Element::getElementsByTagName), (Element::getElementsByTagNameNS),
		(Element::getAttributeNS), (Element::setAttributeNS),
		(Element::removeAttributeNS), (Element::getAttributeNodeNS),
		(Element::setAttributeNodeNS), (Element::hasAttribute),
		(Element::hasAttributeNS), (Element::khtmlValidAttrName),
		(Element::khtmlValidPrefix), (Element::khtmlValidQualifiedName),
		(Element::khtmlMalformedQualifiedName), (Element::khtmlMalformedPrefix):
		* src/kdelibs/khtml/dom/dom_element.h:
		* src/kdelibs/khtml/dom/dom_exception.h:
		* src/kdelibs/khtml/dom/dom_html.h:
		* src/kdelibs/khtml/dom/dom_misc.cpp: (DomShared::deleteMe):
		* src/kdelibs/khtml/dom/dom_misc.h:
		* src/kdelibs/khtml/dom/dom_node.cpp: (NamedNodeMap::getNamedItem),
		(NamedNodeMap::setNamedItem), (NamedNodeMap::removeNamedItem),
		(NamedNodeMap::item), (NamedNodeMap::getNamedItemNS),
		(NamedNodeMap::setNamedItemNS), (NamedNodeMap::removeNamedItemNS),
		(NamedNodeMap::length), (throw), (Node::operator == ), (Node::operator != ),
		(Node::nodeValue), (Node::setNodeValue), (Node::nodeType), (Node::parentNode),
		(Node::childNodes), (Node::firstChild), (Node::lastChild),
		(Node::previousSibling), (Node::nextSibling), (Node::attributes),
		(Node::ownerDocument), (Node::insertBefore), (Node::replaceChild),
		(Node::removeChild), (Node::appendChild), (Node::hasAttributes),
		(Node::hasChildNodes), (Node::cloneNode), (Node::normalize), (Node::isSupported),
		(Node::namespaceURI), (Node::prefix), (Node::setPrefix), (Node::localName),
		(Node::addEventListener), (Node::removeEventListener), (Node::elementId),
		(Node::index), (Node::toHTML), (Node::applyChanges), (Node::getCursor),
		(Node::getRect), (NodeList::item), (NodeList::length):
		* src/kdelibs/khtml/dom/dom_node.h:
		* src/kdelibs/khtml/dom/dom_string.cpp: (DOMString::lower), (DOMString::upper),
		(DOM::operator==):
		* src/kdelibs/khtml/dom/dom_string.h:
		* src/kdelibs/khtml/dom/dom_text.cpp: (CharacterData::operator = ),
		(CharacterData::setData), (CharacterData::substringData),
		(CharacterData::appendData), (CharacterData::insertData),
		(CharacterData::deleteData), (CharacterData::replaceData), (Comment::operator =
		), (Text::operator = ), (Text::splitText):
		* src/kdelibs/khtml/dom/dom_text.h:
		* src/kdelibs/khtml/dom/dom_xml.cpp: (CDATASection::operator = ),
		(Entity::operator = ), (Entity::publicId), (Entity::systemId),
		(Entity::notationName), (EntityReference::operator = ), (Notation::operator = ),
		(Notation::publicId), (Notation::systemId), (ProcessingInstruction::operator = ),
		(ProcessingInstruction::target), (ProcessingInstruction::data),
		(ProcessingInstruction::setData):
		* src/kdelibs/khtml/dom/dom_xml.h:
		* src/kdelibs/khtml/dom/html_base.cpp: (HTMLFrameElement::setSrc),
		(HTMLFrameElement::contentDocument):
		* src/kdelibs/khtml/dom/html_base.h:
		* src/kdelibs/khtml/dom/html_block.cpp:
		* src/kdelibs/khtml/dom/html_block.h:
		* src/kdelibs/khtml/dom/html_document.cpp: (HTMLDocument::HTMLDocument),
		(HTMLDocument::operator = ), (HTMLDocument::title), (HTMLDocument::completeURL),
		(HTMLDocument::lastModified), (HTMLDocument::cookie), (HTMLDocument::setCookie),
		(HTMLDocument::getElementsByName):
		* src/kdelibs/khtml/dom/html_document.h:
		* src/kdelibs/khtml/dom/html_element.cpp: (HTMLElement::operator = ),
		(HTMLElement::removeCSSProperty), (HTMLElement::addCSSProperty),
		(HTMLElement::setInnerText), (HTMLElement::children):
		* src/kdelibs/khtml/dom/html_element.h:
		* src/kdelibs/khtml/dom/html_form.cpp: (HTMLInputElement::setDefaultChecked),
		(HTMLInputElement::name), (HTMLInputElement::setName), (HTMLInputElement::src),
		(HTMLInputElement::setType), (HTMLInputElement::blur), (HTMLInputElement::focus),
		(HTMLInputElement::select), (HTMLInputElement::click), (HTMLSelectElement::name),
		(HTMLSelectElement::setName), (HTMLSelectElement::blur),
		(HTMLSelectElement::focus), (HTMLTextAreaElement::name),
		(HTMLTextAreaElement::setName), (HTMLTextAreaElement::blur),
		(HTMLTextAreaElement::focus), (HTMLTextAreaElement::select),
		(HTMLOptionElement::value), (HTMLOptionElement::setValue):
		* src/kdelibs/khtml/dom/html_form.h:
		* src/kdelibs/khtml/dom/html_head.cpp:
		* src/kdelibs/khtml/dom/html_head.h:
		* src/kdelibs/khtml/dom/html_image.cpp: (HTMLImageElement::border),
		(HTMLImageElement::setBorder), (HTMLImageElement::height),
		(HTMLImageElement::setHeight), (HTMLImageElement::hspace),
		(HTMLImageElement::setHspace), (HTMLImageElement::src),
		(HTMLImageElement::vspace), (HTMLImageElement::setVspace),
		(HTMLImageElement::width), (HTMLImageElement::setWidth):
		* src/kdelibs/khtml/dom/html_image.h:
		* src/kdelibs/khtml/dom/html_inline.cpp: (HTMLAnchorElement::blur),
		(HTMLAnchorElement::focus), (HTMLIFrameElement::contentDocument),
		(HTMLModElement::HTMLModElement), (HTMLQuoteElement::HTMLQuoteElement):
		* src/kdelibs/khtml/dom/html_inline.h:
		* src/kdelibs/khtml/dom/html_list.cpp:
		* src/kdelibs/khtml/dom/html_list.h:
		* src/kdelibs/khtml/dom/html_misc.cpp: (HTMLCollection::base),
		(HTMLCollection::firstItem), (HTMLCollection::nextItem),
		(HTMLCollection::nextNamedItem):
		* src/kdelibs/khtml/dom/html_misc.h:
		* src/kdelibs/khtml/dom/html_object.cpp: (HTMLObjectElement::setWidth),
		(HTMLObjectElement::contentDocument):
		* src/kdelibs/khtml/dom/html_object.h:
		* src/kdelibs/khtml/dom/html_table.cpp:
		* src/kdelibs/khtml/dom/html_table.h:
		* src/kdelibs/khtml/ecma/kjs_binding.cpp: (DOMObject::get), (DOMObject::put),
		(DOMObject::toString), (DOMFunction::get), (DOMFunction::call),
		(ScriptInterpreter::~ScriptInterpreter), (ScriptInterpreter::forgetDOMObject),
		(ScriptInterpreter::mark), (ScriptInterpreter::isWindowOpenAllowed),
		(KJS::toNode), (KJS::getString), (KJS::ValueToVariant):
		* src/kdelibs/khtml/ecma/kjs_binding.h:
		* src/kdelibs/khtml/ecma/kjs_css.cpp:
		(DOMCSSStyleDeclaration::DOMCSSStyleDeclaration),
		(DOMCSSStyleDeclaration::~DOMCSSStyleDeclaration),
		(DOMCSSStyleDeclaration::hasProperty), (DOMCSSStyleDeclaration::tryGet),
		(DOMCSSStyleDeclaration::tryPut), (DOMCSSStyleDeclarationProtoFunc::tryCall),
		(KJS::getDOMCSSStyleDeclaration), (DOMStyleSheet::~DOMStyleSheet),
		(DOMStyleSheet::tryGet), (DOMStyleSheet::getValueProperty),
		(DOMStyleSheet::tryPut), (KJS::getDOMStyleSheet),
		(DOMStyleSheetList::~DOMStyleSheetList), (DOMStyleSheetList::tryGet),
		(KJS::getDOMStyleSheetList), (DOMStyleSheetListFunc::tryCall),
		(DOMMediaList::DOMMediaList), (DOMMediaList::~DOMMediaList),
		(DOMMediaList::tryGet), (DOMMediaList::tryPut), (KJS::getDOMMediaList),
		(KJS::DOMMediaListProtoFunc::tryCall), (DOMCSSStyleSheet::DOMCSSStyleSheet),
		(DOMCSSStyleSheet::tryGet), (DOMCSSStyleSheetProtoFunc::tryCall),
		(DOMCSSRuleList::~DOMCSSRuleList), (DOMCSSRuleList::tryGet),
		(DOMCSSRuleListFunc::tryCall), (KJS::getDOMCSSRuleList),
		(DOMCSSRule::~DOMCSSRule), (DOMCSSRule::classInfo), (DOMCSSRule::tryGet),
		(DOMCSSRule::getValueProperty), (DOMCSSRule::tryPut), (DOMCSSRule::putValue),
		(DOMCSSRuleFunc::tryCall), (KJS::getDOMCSSRule), (KJS::toCSSRule),
		(CSSRuleConstructor::tryGet), (CSSRuleConstructor::getValueProperty),
		(KJS::getCSSRuleConstructor), (DOMCSSValue::~DOMCSSValue), (DOMCSSValue::tryGet),
		(DOMCSSValue::tryPut), (KJS::getDOMCSSValue), (CSSValueConstructor::tryGet),
		(CSSValueConstructor::getValueProperty), (KJS::getCSSValueConstructor),
		(DOMCSSPrimitiveValue::DOMCSSPrimitiveValue), (DOMCSSPrimitiveValue::tryGet),
		(DOMCSSPrimitiveValueProtoFunc::tryCall), (CSSPrimitiveValueConstructor::tryGet),
		(CSSPrimitiveValueConstructor::getValueProperty),
		(KJS::getCSSPrimitiveValueConstructor), (DOMCSSValueList::DOMCSSValueList),
		(DOMCSSValueList::tryGet), (DOMCSSValueListFunc::tryCall), (DOMRGBColor::tryGet),
		(KJS::getDOMRGBColor), (DOMRect::~DOMRect), (DOMRect::tryGet), (KJS::getDOMRect),
		(DOMCounter::~DOMCounter), (DOMCounter::tryGet), (KJS::getDOMCounter):
		* src/kdelibs/khtml/ecma/kjs_css.h:
		* src/kdelibs/khtml/ecma/kjs_debugwin.cpp: (FakeModal::eventFilter),
		(FakeModal::enable), (FakeModal::disable), (StackFrame::toString),
		(SourceFragment::SourceFragment), (SourceFragment::~SourceFragment),
		(KJSDebugWin::KJSDebugWin), (KJSDebugWin::~KJSDebugWin),
		(KJSDebugWin::createInstance), (KJSDebugWin::destroyInstance),
		(KJSDebugWin::instance), (KJSDebugWin::next), (KJSDebugWin::step),
		(KJSDebugWin::cont), (KJSDebugWin::stop), (KJSDebugWin::showFrame),
		(KJSDebugWin::sourceSelected), (KJSDebugWin::eval), (KJSDebugWin::closeEvent),
		(KJSDebugWin::sourceParsed), (KJSDebugWin::sourceUnused), (KJSDebugWin::error),
		(KJSDebugWin::atLine), (KJSDebugWin::callEvent), (KJSDebugWin::returnEvent),
		(KJSDebugWin::setCode), (KJSDebugWin::highLight),
		(KJSDebugWin::setNextSourceInfo), (KJSDebugWin::setSourceFile),
		(KJSDebugWin::appendSourceFile), (KJSDebugWin::enterSession),
		(KJSDebugWin::leaveSession), (KJSDebugWin::updateFrameList),
		(KJSDebugWin::setBreakpoint), (KJSDebugWin::deleteBreakpoint),
		(KJSDebugWin::clearAllBreakpoints), (KJSDebugWin::breakpointLine),
		(KJSDebugWin::haveBreakpoint):
		* src/kdelibs/khtml/ecma/kjs_debugwin.h:
		* src/kdelibs/khtml/ecma/kjs_dom.cpp: (DOMNode::DOMNode), (DOMNode::~DOMNode),
		(DOMNode::toBoolean), (DOMNode::tryGet), (DOMNode::getValueProperty),
		(DOMNode::tryPut), (DOMNode::putValue), (DOMNode::toPrimitive),
		(DOMNode::toString), (DOMNode::setListener), (DOMNode::getListener),
		(DOMNode::eventHandlerScope), (DOMNodeProtoFunc::tryCall),
		(DOMNodeList::~DOMNodeList), (DOMNodeList::hasProperty), (DOMNodeList::tryGet),
		(DOMNodeList::call), (DOMNodeList::tryCall), (DOMNodeListFunc::DOMNodeListFunc),
		(DOMNodeListFunc::tryCall), (DOMAttr::tryGet), (DOMAttr::getValueProperty),
		(DOMAttr::tryPut), (DOMAttr::putValue), (DOMDocument::DOMDocument),
		(DOMDocument::tryGet), (DOMDocument::getValueProperty),
		(DOMDocumentProtoFunc::tryCall), (DOMElement::DOMElement), (DOMElement::tryGet),
		(DOMElementProtoFunc::tryCall), (DOMDOMImplementation::DOMDOMImplementation),
		(DOMDOMImplementation::~DOMDOMImplementation),
		(DOMDOMImplementationProtoFunc::tryCall), (DOMDocumentType::DOMDocumentType),
		(DOMDocumentType::tryGet), (DOMDocumentType::getValueProperty),
		(DOMNamedNodeMap::DOMNamedNodeMap), (DOMNamedNodeMap::~DOMNamedNodeMap),
		(DOMNamedNodeMap::hasProperty), (DOMNamedNodeMap::tryGet),
		(DOMNamedNodeMapProtoFunc::tryCall), (DOMProcessingInstruction::tryGet),
		(DOMProcessingInstruction::getValueProperty), (DOMProcessingInstruction::tryPut),
		(DOMNotation::tryGet), (DOMNotation::getValueProperty), (DOMEntity::tryGet),
		(DOMEntity::getValueProperty), (KJS::getDOMNode), (KJS::getDOMNamedNodeMap),
		(KJS::getDOMNodeList), (KJS::getDOMDOMImplementation), (NodeConstructor::tryGet),
		(NodeConstructor::getValueProperty), (KJS::getNodeConstructor),
		(DOMExceptionConstructor::tryGet), (DOMExceptionConstructor::getValueProperty),
		(KJS::getDOMExceptionConstructor),
		(DOMNamedNodesCollection::DOMNamedNodesCollection),
		(DOMNamedNodesCollection::tryGet), (DOMCharacterData::DOMCharacterData),
		(DOMCharacterData::tryGet), (DOMCharacterData::getValueProperty),
		(DOMCharacterData::tryPut), (DOMCharacterDataProtoFunc::tryCall),
		(DOMText::DOMText), (DOMText::tryGet), (DOMTextProtoFunc::tryCall):
		* src/kdelibs/khtml/ecma/kjs_dom.h:
		* src/kdelibs/khtml/ecma/kjs_events.cpp: (JSEventListener::JSEventListener),
		(JSEventListener::~JSEventListener), (JSEventListener::handleEvent),
		(KJS::getNodeEventListener), (EventConstructor::tryGet),
		(EventConstructor::getValueProperty), (KJS::getEventConstructor),
		(DOMEvent::DOMEvent), (DOMEvent::~DOMEvent), (DOMEvent::tryGet),
		(DOMEvent::getValueProperty), (DOMEventProtoFunc::tryCall), (KJS::getDOMEvent),
		(KJS::toEvent), (EventExceptionConstructor::tryGet),
		(EventExceptionConstructor::getValueProperty),
		(KJS::getEventExceptionConstructor), (DOMUIEvent::tryGet),
		(DOMUIEvent::getValueProperty), (DOMUIEventProtoFunc::tryCall),
		(DOMMouseEvent::tryGet), (DOMMouseEvent::getValueProperty),
		(DOMMouseEventProtoFunc::tryCall), (MutationEventConstructor::tryGet),
		(MutationEventConstructor::getValueProperty), (KJS::getMutationEventConstructor),
		(DOMMutationEvent::tryGet), (DOMMutationEvent::getValueProperty),
		(DOMMutationEventProtoFunc::tryCall):
		* src/kdelibs/khtml/ecma/kjs_events.h:
		* src/kdelibs/khtml/ecma/kjs_html.cpp: (KJS::HTMLDocFunction::tryCall),
		(KJS::HTMLDocument::hasProperty), (KJS::HTMLDocument::tryGet),
		(KJS::HTMLDocument::tryPut), (KJS::HTMLDocument::putValue),
		(KJS::HTMLElement::classInfo), (KJS::HTMLElement::tryGet),
		(KJS::HTMLElement::getValueProperty), (KJS::HTMLElement::hasProperty),
		(KJS::HTMLElement::toString), (KJS::HTMLElement::eventHandlerScope),
		(HTMLElementFunction::HTMLElementFunction), (KJS::HTMLElementFunction::tryCall),
		(KJS::HTMLElement::tryPut), (KJS::HTMLElement::putValue),
		(HTMLCollection::HTMLCollection), (HTMLCollection::~HTMLCollection),
		(KJS::HTMLCollection::hasProperty), (KJS::HTMLCollection::tryGet),
		(KJS::HTMLCollection::call), (KJS::HTMLCollection::tryCall),
		(KJS::HTMLCollection::getNamedItems), (KJS::HTMLCollectionProtoFunc::tryCall),
		(KJS::HTMLSelectCollection::tryGet), (KJS::HTMLSelectCollection::tryPut),
		(OptionConstructorImp::OptionConstructorImp),
		(OptionConstructorImp::implementsConstruct), (OptionConstructorImp::construct),
		(ImageConstructorImp::ImageConstructorImp),
		(ImageConstructorImp::implementsConstruct), (ImageConstructorImp::construct),
		(Image::tryGet), (Image::getValueProperty), (Image::tryPut),
		(KJS::getHTMLCollection), (KJS::getSelectHTMLCollection):
		* src/kdelibs/khtml/ecma/kjs_html.h:
		* src/kdelibs/khtml/ecma/kjs_navigator.cpp: (Navigator::Navigator),
		(Navigator::get), (Navigator::getValueProperty), (PluginBase::PluginBase),
		(Plugins::get), (MimeTypes::get), (Plugin::get), (MimeType::get),
		(PluginsFunc::tryCall), (NavigatorFunc::tryCall):
		* src/kdelibs/khtml/ecma/kjs_navigator.h:
		* src/kdelibs/khtml/ecma/kjs_proxy.cpp: (KJSProxyImpl::KJSProxyImpl),
		(KJSProxyImpl::~KJSProxyImpl), (KJSProxyImpl::evaluate), (KJSProxyImpl::clear),
		(KJSProxyImpl::createHTMLEventHandler), (KJSProxyImpl::finishedWithEvent),
		(KJSProxyImpl::interpreter), (KJSProxyImpl::setDebugEnabled),
		(KJSProxyImpl::paused), (KJSProxyImpl::setSourceFile),
		(KJSProxyImpl::appendSourceFile), (TestFunctionImp::call),
		(KJSProxyImpl::initScript), (KJSProxy::proxy), (kjs_html_init):
		* src/kdelibs/khtml/ecma/kjs_proxy.h:
		* src/kdelibs/khtml/ecma/kjs_range.cpp: (DOMRange::DOMRange),
		(DOMRange::~DOMRange), (DOMRange::tryGet), (DOMRange::getValueProperty),
		(DOMRangeProtoFunc::tryCall), (KJS::getDOMRange), (RangeConstructor::tryGet),
		(RangeConstructor::getValueProperty), (KJS::getRangeConstructor), (KJS::toRange):
		* src/kdelibs/khtml/ecma/kjs_range.h:
		* src/kdelibs/khtml/ecma/kjs_traversal.cpp: (DOMNodeIterator::DOMNodeIterator),
		(DOMNodeIterator::~DOMNodeIterator), (DOMNodeIterator::tryGet),
		(DOMNodeIterator::getValueProperty), (DOMNodeIteratorProtoFunc::tryCall),
		(KJS::getDOMNodeIterator), (NodeFilterConstructor::tryGet),
		(NodeFilterConstructor::getValueProperty), (KJS::getNodeFilterConstructor),
		(DOMNodeFilter::DOMNodeFilter), (DOMNodeFilter::~DOMNodeFilter),
		(DOMNodeFilterProtoFunc::tryCall), (KJS::getDOMNodeFilter),
		(DOMTreeWalker::DOMTreeWalker), (DOMTreeWalker::~DOMTreeWalker),
		(DOMTreeWalker::tryGet), (DOMTreeWalker::getValueProperty),
		(DOMTreeWalker::tryPut), (DOMTreeWalkerProtoFunc::tryCall),
		(KJS::getDOMTreeWalker), (KJS::toNodeFilter), (JSNodeFilter::JSNodeFilter),
		(JSNodeFilter::acceptNode):
		* src/kdelibs/khtml/ecma/kjs_traversal.h:
		* src/kdelibs/khtml/ecma/kjs_views.cpp: (DOMAbstractView::~DOMAbstractView),
		(DOMAbstractView::tryGet), (DOMAbstractViewFunc::tryCall),
		(KJS::getDOMAbstractView), (KJS::toAbstractView):
		* src/kdelibs/khtml/ecma/kjs_views.h:
		* src/kdelibs/khtml/ecma/kjs_window.cpp: (Screen::Screen), (Screen::get),
		(Screen::getValueProperty), (Window::Window), (Window::retrieveWindow),
		(Window::retrieveActive), (Window::retrieve), (Window::mark),
		(Window::hasProperty), (Window::toString), (Window::get), (Window::put),
		(Window::toBoolean), (Window::scheduleClose), (Window::isSafeScript),
		(Window::setListener), (Window::getListener), (Window::getJSEventListener),
		(Window::clear), (Window::setCurrentEvent), (WindowFunc::tryCall),
		(ScheduledAction::ScheduledAction), (ScheduledAction::execute),
		(ScheduledAction::~ScheduledAction), (WindowQObject::WindowQObject),
		(WindowQObject::~WindowQObject), (WindowQObject::parentDestroyed),
		(WindowQObject::installTimeout), (WindowQObject::clearTimeout),
		(WindowQObject::timerEvent), (WindowQObject::timeoutClose), (FrameArray::get),
		(Location::Location), (Location::~Location), (Location::get), (Location::put),
		(Location::toPrimitive), (Location::toString), (LocationFunc::tryCall),
		(History::get), (History::getValueProperty), (HistoryFunc::tryCall),
		(Konqueror::hasProperty), (Konqueror::get), (KonquerorFunc::tryCall),
		(Konqueror::toString):
		* src/kdelibs/khtml/ecma/kjs_window.h:
		* src/kdelibs/khtml/html/dtd.cpp: (DOM::checkChild), (DOM::addForbidden),
		(DOM::removeForbidden):
		* src/kdelibs/khtml/html/dtd.h:
		* src/kdelibs/khtml/html/html_baseimpl.cpp:
		(HTMLBodyElementImpl::HTMLBodyElementImpl), (HTMLBodyElementImpl::id),
		(HTMLBodyElementImpl::parseAttribute), (HTMLBodyElementImpl::init),
		(HTMLBodyElementImpl::attach), (HTMLFrameElementImpl::HTMLFrameElementImpl),
		(HTMLFrameElementImpl::id), (HTMLFrameElementImpl::parseAttribute),
		(HTMLFrameElementImpl::init), (HTMLFrameElementImpl::attach),
		(HTMLFrameElementImpl::detach), (HTMLFrameElementImpl::setLocation),
		(HTMLFrameElementImpl::setFocus), (HTMLFrameElementImpl::contentDocument),
		(HTMLFrameSetElementImpl::HTMLFrameSetElementImpl),
		(HTMLFrameSetElementImpl::~HTMLFrameSetElementImpl),
		(HTMLFrameSetElementImpl::id), (HTMLFrameSetElementImpl::parseAttribute),
		(HTMLFrameSetElementImpl::init), (HTMLFrameSetElementImpl::attach),
		(HTMLFrameSetElementImpl::defaultEventHandler),
		(HTMLFrameSetElementImpl::detach), (HTMLFrameSetElementImpl::recalcStyle),
		(HTMLHeadElementImpl::id), (HTMLHtmlElementImpl::attach),
		(HTMLHtmlElementImpl::id), (HTMLIFrameElementImpl::id),
		(HTMLIFrameElementImpl::parseAttribute), (HTMLIFrameElementImpl::attach),
		(HTMLIFrameElementImpl::recalcStyle):
		* src/kdelibs/khtml/html/html_baseimpl.h:
		* src/kdelibs/khtml/html/html_blockimpl.cpp: (HTMLBlockquoteElementImpl::id),
		(HTMLDivElementImpl::id), (HTMLDivElementImpl::parseAttribute),
		(HTMLHRElementImpl::id), (HTMLHRElementImpl::parseAttribute),
		(HTMLHRElementImpl::attach), (HTMLHeadingElementImpl::HTMLHeadingElementImpl),
		(HTMLParagraphElementImpl::id), (HTMLPreElementImpl::HTMLPreElementImpl),
		(HTMLLayerElementImpl::id), (HTMLLayerElementImpl::parseAttribute):
		* src/kdelibs/khtml/html/html_blockimpl.h:
		* src/kdelibs/khtml/html/html_documentimpl.cpp:
		(HTMLDocumentImpl::HTMLDocumentImpl), (HTMLDocumentImpl::~HTMLDocumentImpl),
		(HTMLDocumentImpl::referrer), (HTMLDocumentImpl::domain),
		(HTMLDocumentImpl::setDomain), (HTMLDocumentImpl::lastModified),
		(HTMLDocumentImpl::cookie), (HTMLDocumentImpl::setCookie),
		(HTMLDocumentImpl::setBody), (HTMLDocumentImpl::slotHistoryChanged),
		(isTransitional), (HTMLDocumentImpl::close),
		(HTMLDocumentImpl::determineParseMode):
		* src/kdelibs/khtml/html/html_documentimpl.h:
		* src/kdelibs/khtml/html/html_elementimpl.cpp:
		(HTMLElementImpl::HTMLElementImpl), (HTMLElementImpl::parseAttribute),
		(HTMLElementImpl::addCSSProperty), (HTMLElementImpl::addCSSLength),
		(HTMLElementImpl::removeCSSProperty), (HTMLElementImpl::innerText),
		(HTMLElementImpl::setInnerHTML), (HTMLElementImpl::namespaceURI):
		* src/kdelibs/khtml/html/html_elementimpl.h:
		* src/kdelibs/khtml/html/html_formimpl.cpp:
		(HTMLFormElementImpl::~HTMLFormElementImpl), (HTMLFormElementImpl::id),
		(HTMLFormElementImpl::length), (HTMLFormElementImpl::i18nData),
		(HTMLFormElementImpl::formData), (HTMLFormElementImpl::prepareSubmit),
		(HTMLFormElementImpl::submit), (HTMLFormElementImpl::reset),
		(HTMLFormElementImpl::parseAttribute), (HTMLFormElementImpl::radioClicked),
		(HTMLGenericFormElementImpl::HTMLGenericFormElementImpl),
		(HTMLGenericFormElementImpl::parseAttribute),
		(HTMLGenericFormElementImpl::attach), (HTMLGenericFormElementImpl::name),
		(HTMLGenericFormElementImpl::setName), (HTMLGenericFormElementImpl::onSelect),
		(HTMLGenericFormElementImpl::onChange),
		(HTMLGenericFormElementImpl::setDisabled),
		(HTMLGenericFormElementImpl::setParent),
		(HTMLGenericFormElementImpl::recalcStyle),
		(HTMLGenericFormElementImpl::isSelectable),
		(HTMLGenericFormElementImpl::defaultEventHandler),
		(HTMLGenericFormElementImpl::isEditable), (HTMLButtonElementImpl::id),
		(HTMLButtonElementImpl::parseAttribute), (HTMLButtonElementImpl::attach),
		(HTMLButtonElementImpl::defaultEventHandler), (HTMLButtonElementImpl::encoding),
		(HTMLFieldSetElementImpl::id), (HTMLInputElementImpl::HTMLInputElementImpl),
		(HTMLInputElementImpl::~HTMLInputElementImpl), (HTMLInputElementImpl::id),
		(HTMLInputElementImpl::setType), (HTMLInputElementImpl::state),
		(HTMLInputElementImpl::restoreState), (HTMLInputElementImpl::parseAttribute),
		(HTMLInputElementImpl::init), (HTMLInputElementImpl::attach),
		(HTMLInputElementImpl::altText), (HTMLInputElementImpl::encoding),
		(HTMLInputElementImpl::reset), (HTMLInputElementImpl::setChecked),
		(HTMLInputElementImpl::value), (HTMLInputElementImpl::setValue),
		(HTMLInputElementImpl::blur), (HTMLInputElementImpl::focus),
		(HTMLInputElementImpl::defaultEventHandler), (HTMLInputElementImpl::isEditable),
		(HTMLLabelElementImpl::id), (HTMLLabelElementImpl::parseAttribute),
		(HTMLLabelElementImpl::formElement), (HTMLLegendElementImpl::id),
		(HTMLSelectElementImpl::HTMLSelectElementImpl), (HTMLSelectElementImpl::id),
		(HTMLSelectElementImpl::add), (HTMLSelectElementImpl::blur),
		(HTMLSelectElementImpl::focus), (HTMLSelectElementImpl::value),
		(HTMLSelectElementImpl::setValue), (HTMLSelectElementImpl::state),
		(HTMLSelectElementImpl::restoreState), (HTMLSelectElementImpl::parseAttribute),
		(HTMLSelectElementImpl::init), (HTMLSelectElementImpl::attach),
		(HTMLSelectElementImpl::encoding), (HTMLSelectElementImpl::reset),
		(HTMLSelectElementImpl::notifyOptionSelected),
		(HTMLKeygenElementImpl::HTMLKeygenElementImpl), (HTMLKeygenElementImpl::id),
		(HTMLKeygenElementImpl::parseAttribute), (HTMLKeygenElementImpl::encoding),
		(HTMLOptGroupElementImpl::HTMLOptGroupElementImpl),
		(HTMLOptGroupElementImpl::id), (HTMLOptGroupElementImpl::parseAttribute),
		(HTMLOptionElementImpl::id), (HTMLOptionElementImpl::text),
		(HTMLOptionElementImpl::index), (HTMLOptionElementImpl::setIndex),
		(HTMLOptionElementImpl::parseAttribute), (HTMLOptionElementImpl::value),
		(HTMLOptionElementImpl::setValue), (HTMLOptionElementImpl::getSelect),
		(HTMLTextAreaElementImpl::HTMLTextAreaElementImpl),
		(HTMLTextAreaElementImpl::id), (HTMLTextAreaElementImpl::parseAttribute),
		(HTMLTextAreaElementImpl::init), (HTMLTextAreaElementImpl::attach),
		(HTMLTextAreaElementImpl::encoding), (HTMLTextAreaElementImpl::setDefaultValue),
		(HTMLTextAreaElementImpl::blur), (HTMLTextAreaElementImpl::focus),
		(HTMLTextAreaElementImpl::isEditable),
		(HTMLIsIndexElementImpl::HTMLIsIndexElementImpl), (HTMLIsIndexElementImpl::id),
		(HTMLIsIndexElementImpl::parseAttribute):
		* src/kdelibs/khtml/html/html_formimpl.h:
		* src/kdelibs/khtml/html/html_headimpl.cpp: (HTMLBaseElementImpl::id),
		(HTMLBaseElementImpl::parseAttribute),
		(HTMLBaseElementImpl::insertedIntoDocument),
		(HTMLBaseElementImpl::removedFromDocument), (HTMLBaseElementImpl::process),
		(HTMLLinkElementImpl::HTMLLinkElementImpl), (HTMLLinkElementImpl::id),
		(HTMLLinkElementImpl::parseAttribute), (HTMLLinkElementImpl::process),
		(HTMLLinkElementImpl::insertedIntoDocument),
		(HTMLLinkElementImpl::removedFromDocument), (HTMLLinkElementImpl::setStyleSheet),
		(HTMLLinkElementImpl::sheetLoaded), (HTMLMetaElementImpl::id),
		(HTMLMetaElementImpl::parseAttribute),
		(HTMLMetaElementImpl::insertedIntoDocument), (HTMLMetaElementImpl::process),
		(HTMLScriptElementImpl::id), (HTMLStyleElementImpl::id),
		(HTMLStyleElementImpl::parseAttribute),
		(HTMLStyleElementImpl::insertedIntoDocument),
		(HTMLStyleElementImpl::removedFromDocument),
		(HTMLStyleElementImpl::childrenChanged), (HTMLStyleElementImpl::isLoading),
		(HTMLStyleElementImpl::sheetLoaded), (HTMLTitleElementImpl::id),
		(HTMLTitleElementImpl::insertedIntoDocument),
		(HTMLTitleElementImpl::removedFromDocument),
		(HTMLTitleElementImpl::childrenChanged):
		* src/kdelibs/khtml/html/html_headimpl.h:
		* src/kdelibs/khtml/html/html_imageimpl.cpp: (HTMLImageElementImpl::id),
		(HTMLImageElementImpl::parseAttribute), (HTMLImageElementImpl::altText),
		(HTMLImageElementImpl::attach), (HTMLMapElementImpl::~HTMLMapElementImpl),
		(HTMLMapElementImpl::id), (HTMLMapElementImpl::mapMouseEvent),
		(HTMLMapElementImpl::parseAttribute), (HTMLAreaElementImpl::HTMLAreaElementImpl),
		(HTMLAreaElementImpl::~HTMLAreaElementImpl), (HTMLAreaElementImpl::id),
		(HTMLAreaElementImpl::parseAttribute), (HTMLAreaElementImpl::mapMouseEvent),
		(HTMLAreaElementImpl::getRect), (HTMLAreaElementImpl::getRegion):
		* src/kdelibs/khtml/html/html_imageimpl.h:
		* src/kdelibs/khtml/html/html_inlineimpl.cpp:
		(HTMLAnchorElementImpl::HTMLAnchorElementImpl),
		(HTMLAnchorElementImpl::~HTMLAnchorElementImpl), (HTMLAnchorElementImpl::id),
		(HTMLAnchorElementImpl::defaultEventHandler),
		(HTMLAnchorElementImpl::parseAttribute), (HTMLBRElementImpl::id),
		(HTMLBRElementImpl::parseAttribute), (HTMLBRElementImpl::attach),
		(HTMLFontElementImpl::id), (HTMLFontElementImpl::parseAttribute):
		* src/kdelibs/khtml/html/html_inlineimpl.h:
		* src/kdelibs/khtml/html/html_listimpl.cpp: (HTMLUListElementImpl::id),
		(HTMLUListElementImpl::parseAttribute), (HTMLDirectoryElementImpl::id),
		(HTMLMenuElementImpl::id), (HTMLOListElementImpl::id),
		(HTMLOListElementImpl::parseAttribute), (HTMLLIElementImpl::id),
		(HTMLLIElementImpl::parseAttribute), (HTMLLIElementImpl::attach),
		(HTMLDListElementImpl::id):
		* src/kdelibs/khtml/html/html_listimpl.h:
		* src/kdelibs/khtml/html/html_miscimpl.cpp:
		(HTMLBaseFontElementImpl::HTMLBaseFontElementImpl),
		(HTMLBaseFontElementImpl::id), (HTMLCollectionImpl::HTMLCollectionImpl),
		(HTMLCollectionImpl::calcLength), (HTMLCollectionImpl::getItem),
		(HTMLCollectionImpl::firstItem), (HTMLCollectionImpl::nextItem),
		(HTMLCollectionImpl::getNamedItem), (HTMLCollectionImpl::namedItem),
		(HTMLCollectionImpl::nextNamedItem), (HTMLCollectionImpl::nextNamedItemInternal),
		(HTMLFormCollectionImpl::calcLength), (HTMLFormCollectionImpl::getItem),
		(HTMLFormCollectionImpl::getNamedItem),
		(HTMLFormCollectionImpl::getNamedFormItem),
		(HTMLFormCollectionImpl::getNamedImgItem), (HTMLFormCollectionImpl::firstItem),
		(HTMLFormCollectionImpl::nextItem),
		(HTMLFormCollectionImpl::nextNamedItemInternal):
		* src/kdelibs/khtml/html/html_miscimpl.h:
		* src/kdelibs/khtml/html/html_objectimpl.cpp:
		(HTMLAppletElementImpl::HTMLAppletElementImpl),
		(HTMLAppletElementImpl::~HTMLAppletElementImpl), (HTMLAppletElementImpl::id),
		(HTMLAppletElementImpl::parseAttribute), (HTMLAppletElementImpl::attach),
		(HTMLEmbedElementImpl::id), (HTMLEmbedElementImpl::parseAttribute),
		(HTMLEmbedElementImpl::attach), (HTMLObjectElementImpl::id),
		(HTMLObjectElementImpl::parseAttribute),
		(HTMLObjectElementImpl::contentDocument), (HTMLObjectElementImpl::attach),
		(HTMLObjectElementImpl::detach), (HTMLObjectElementImpl::recalcStyle),
		(HTMLParamElementImpl::id), (HTMLParamElementImpl::parseAttribute):
		* src/kdelibs/khtml/html/html_objectimpl.h:
		* src/kdelibs/khtml/html/html_tableimpl.cpp:
		(HTMLTableElementImpl::HTMLTableElementImpl), (HTMLTableElementImpl::id),
		(HTMLTableElementImpl::setCaption), (HTMLTableElementImpl::setTHead),
		(HTMLTableElementImpl::setTFoot), (HTMLTableElementImpl::setTBody),
		(HTMLTableElementImpl::createTHead), (HTMLTableElementImpl::deleteTHead),
		(HTMLTableElementImpl::createTFoot), (HTMLTableElementImpl::deleteTFoot),
		(HTMLTableElementImpl::createCaption), (HTMLTableElementImpl::deleteCaption),
		(HTMLTableElementImpl::insertRow), (HTMLTableElementImpl::deleteRow),
		(HTMLTableElementImpl::addChild), (HTMLTableElementImpl::parseAttribute),
		(HTMLTableElementImpl::init), (HTMLTablePartElementImpl::parseAttribute),
		(HTMLTableSectionElementImpl::id), (HTMLTableSectionElementImpl::insertRow),
		(HTMLTableSectionElementImpl::deleteRow), (HTMLTableRowElementImpl::id),
		(HTMLTableRowElementImpl::insertCell), (HTMLTableRowElementImpl::deleteCell),
		(HTMLTableCellElementImpl::HTMLTableCellElementImpl),
		(HTMLTableCellElementImpl::parseAttribute), (HTMLTableCellElementImpl::init),
		(HTMLTableColElementImpl::HTMLTableColElementImpl),
		(HTMLTableColElementImpl::id), (HTMLTableColElementImpl::parseAttribute),
		(HTMLTableCaptionElementImpl::id), (HTMLTableCaptionElementImpl::parseAttribute):
		* src/kdelibs/khtml/html/html_tableimpl.h:
		* src/kdelibs/khtml/html/htmlparser.cpp: (KHTMLParser::parseToken),
		(KHTMLParser::insertNode), (KHTMLParser::getElement),
		(KHTMLParser::processCloseTag), (KHTMLParser::popOneBlock),
		(KHTMLParser::handleIsindex):
		* src/kdelibs/khtml/html/htmlparser.h:
		* src/kdelibs/khtml/html/htmltokenizer.cpp: (HTMLTokenizer::HTMLTokenizer),
		(HTMLTokenizer::reset), (HTMLTokenizer::begin), (HTMLTokenizer::processListing),
		(HTMLTokenizer::parseSpecial), (HTMLTokenizer::scriptHandler),
		(HTMLTokenizer::scriptExecution), (HTMLTokenizer::parseComment),
		(HTMLTokenizer::parseServer), (HTMLTokenizer::parseTag), (HTMLTokenizer::write),
		(HTMLTokenizer::finish), (HTMLTokenizer::processToken),
		(HTMLTokenizer::notifyFinished), (HTMLTokenizer::addPendingSource),
		(HTMLTokenizer::setSrc):
		* src/kdelibs/khtml/html/htmltokenizer.h:
		* src/kdelibs/khtml/java/javaembed.h:
		* src/kdelibs/khtml/java/kjavaapplet.h:
		* src/kdelibs/khtml/java/kjavaappletcontext.cpp:
		* src/kdelibs/khtml/java/kjavaappletcontext.h:
		* src/kdelibs/khtml/java/kjavaappletserver.cpp: (KJavaAppletServer::setupJava):
		* src/kdelibs/khtml/java/kjavaappletserver.h:
		* src/kdelibs/khtml/java/kjavaappletwidget.h:
		* src/kdelibs/khtml/java/kjavaprocess.cpp: (KJavaProcess::invokeJVM):
		* src/kdelibs/khtml/khtml_events.cpp: (khtml::MouseEvent::MouseEvent),
		(khtml::MouseEvent::offset):
		* src/kdelibs/khtml/khtml_events.h:
		* src/kdelibs/khtml/khtml_ext.h:
		* src/kdelibs/khtml/khtml_factory.h:
		* src/kdelibs/khtml/khtml_part.h:
		* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::KHTMLView),
		(KHTMLView::~KHTMLView), (KHTMLView::init), (KHTMLView::clear),
		(KHTMLView::resizeEvent), (KHTMLView::drawContents), (KHTMLView::setMarginWidth),
		(KHTMLView::setMarginHeight), (KHTMLView::layout),
		(KHTMLView::viewportMousePressEvent), (KHTMLView::viewportMouseDoubleClickEvent),
		(KHTMLView::viewportMouseMoveEvent), (KHTMLView::resetCursor),
		(KHTMLView::viewportMouseReleaseEvent), (KHTMLView::keyPressEvent),
		(KHTMLView::keyReleaseEvent), (KHTMLView::contentsContextMenuEvent),
		(KHTMLView::focusNextPrevChild), (KHTMLView::scrollTo),
		(KHTMLView::focusNextPrevNode), (KHTMLView::setMediaType),
		(KHTMLView::mediaType), (KHTMLView::print), (KHTMLView::slotPaletteChanged),
		(KHTMLView::restoreScrollBar), (KHTMLView::addFormCompletionItem),
		(KHTMLView::dispatchMouseEvent), (KHTMLView::setIgnoreEvents),
		(KHTMLView::ignoreEvents), (KHTMLView::setIgnoreWheelEvents),
		(KHTMLView::viewportWheelEvent), (KHTMLView::slotScrollBarMoved),
		(KHTMLView::timerEvent), (KHTMLView::scheduleRelayout),
		(KHTMLView::scheduleRepaint), (KHTMLView::complete):
		* src/kdelibs/khtml/khtmlview.h:
		* src/kdelibs/khtml/misc/decoder.cpp:
		* src/kdelibs/khtml/misc/decoder.h:
		* src/kdelibs/khtml/misc/helper.cpp: (khtml::setNamedColor),
		(khtml::setPrintPainter):
		* src/kdelibs/khtml/misc/helper.h:
		* src/kdelibs/khtml/misc/htmlattrs.in:
		* src/kdelibs/khtml/misc/htmltags.in:
		* src/kdelibs/khtml/misc/khtmllayout.h:
		* src/kdelibs/khtml/misc/loader.h:
		* src/kdelibs/khtml/misc/loader_client.h:
		* src/kdelibs/khtml/misc/makeattrs:
		* src/kdelibs/khtml/misc/maketags:
		* src/kdelibs/khtml/misc/stringit.h:
		* src/kdelibs/khtml/rendering/bidi.cpp: (Bidinext), (first),
		(BidiIterator::BidiIterator), (BidiIterator::operator ++ ),
		(BidiIterator::atEnd), (BidiIterator::current), (BidiIterator::direction),
		(appendRun), (embed), (RenderFlow::bidiReorderLine),
		(RenderFlow::layoutInlineChildren):
		* src/kdelibs/khtml/rendering/bidi.h:
		* src/kdelibs/khtml/rendering/break_lines.cpp:
		* src/kdelibs/khtml/rendering/render_applet.cpp: (RenderApplet::RenderApplet),
		(RenderApplet::intrinsicWidth), (RenderApplet::intrinsicHeight),
		(RenderApplet::layout), (RenderEmptyApplet::RenderEmptyApplet),
		(RenderEmptyApplet::layout):
		* src/kdelibs/khtml/rendering/render_applet.h:
		* src/kdelibs/khtml/rendering/render_body.cpp: (RenderBody::RenderBody),
		(RenderBody::setStyle):
		* src/kdelibs/khtml/rendering/render_body.h:
		* src/kdelibs/khtml/rendering/render_box.cpp: (RenderBox::RenderBox),
		(RenderBox::setPos), (RenderBox::setPixmap), (RenderBox::printBackground),
		(RenderBox::calcClip), (RenderBox::close), (RenderBox::repaintRectangle),
		(RenderBox::calcWidth), (RenderBox::calcHorizontalMargins),
		(RenderBox::calcHeight), (RenderBox::calcReplacedWidth),
		(RenderBox::calcReplacedHeight), (RenderBox::calcVerticalMargins):
		* src/kdelibs/khtml/rendering/render_box.h:
		* src/kdelibs/khtml/rendering/render_br.cpp: (RenderBR::RenderBR):
		* src/kdelibs/khtml/rendering/render_br.h:
		* src/kdelibs/khtml/rendering/render_container.cpp:
		(RenderContainer::RenderContainer), (RenderContainer::addChild),
		(RenderContainer::removeChildNode), (RenderContainer::removeChild),
		(RenderContainer::insertPseudoChild), (RenderContainer::appendChildNode),
		(RenderContainer::insertChildNode), (RenderContainer::layout):
		* src/kdelibs/khtml/rendering/render_container.h:
		* src/kdelibs/khtml/rendering/render_flow.cpp: (RenderFlow::RenderFlow),
		(RenderFlow::setStyle), (RenderFlow::print), (RenderFlow::printObject),
		(RenderFlow::printSpecialObjects), (RenderFlow::layout),
		(RenderFlow::layoutSpecialObjects), (RenderFlow::layoutBlockChildren),
		(RenderFlow::insertSpecialObject), (RenderFlow::removeSpecialObject),
		(RenderFlow::positionNewFloats), (RenderFlow::leftOffset),
		(RenderFlow::leftRelOffset), (RenderFlow::rightOffset),
		(RenderFlow::rightRelOffset), (RenderFlow::lineWidth), (RenderFlow::floatBottom),
		(RenderFlow::lowestPosition), (RenderFlow::rightmostPosition),
		(RenderFlow::leftBottom), (RenderFlow::rightBottom), (RenderFlow::clearFloats),
		(RenderFlow::addOverHangingFloats), (next), (RenderFlow::calcMinMaxWidth),
		(RenderFlow::close), (RenderFlow::addChild), (RenderFlow::makeChildrenNonInline),
		(RenderFlow::nodeAtPoint), (RenderFlow::printTree), (RenderFlow::dump):
		* src/kdelibs/khtml/rendering/render_flow.h:
		* src/kdelibs/khtml/rendering/render_form.cpp:
		(RenderFormElement::RenderFormElement), (RenderFormElement::updateFromElement),
		(RenderFormElement::layout), (RenderFormElement::slotClicked),
		(RenderButton::RenderButton), (RenderCheckBox::RenderCheckBox),
		(RenderCheckBox::calcMinMaxWidth), (RenderCheckBox::updateFromElement),
		(RenderCheckBox::slotStateChanged), (RenderRadioButton::RenderRadioButton),
		(RenderRadioButton::updateFromElement), (RenderRadioButton::slotClicked),
		(RenderRadioButton::calcMinMaxWidth), (RenderSubmitButton::RenderSubmitButton),
		(RenderSubmitButton::calcMinMaxWidth), (RenderImageButton::RenderImageButton),
		(RenderResetButton::RenderResetButton), (RenderPushButton::RenderPushButton),
		(RenderLineEdit::RenderLineEdit), (RenderLineEdit::slotReturnPressed),
		(RenderLineEdit::handleFocusOut), (RenderLineEdit::calcMinMaxWidth),
		(RenderLineEdit::updateFromElement), (RenderLineEdit::slotTextChanged),
		(RenderFieldset::RenderFieldset), (RenderFileButton::RenderFileButton),
		(RenderFileButton::calcMinMaxWidth), (RenderFileButton::handleFocusOut),
		(RenderFileButton::slotClicked), (RenderFileButton::updateFromElement),
		(RenderFileButton::slotReturnPressed), (RenderFileButton::slotTextChanged),
		(RenderLabel::RenderLabel), (RenderLegend::RenderLegend),
		(RenderSelect::RenderSelect), (RenderSelect::updateFromElement),
		(RenderSelect::calcMinMaxWidth), (RenderSelect::layout), (RenderSelect::close),
		(RenderSelect::slotSelected), (RenderSelect::slotSelectionChanged),
		(RenderSelect::createListBox), (RenderSelect::createComboBox),
		(RenderSelect::updateSelection), (TextAreaWidget::TextAreaWidget),
		(TextAreaWidget::event), (RenderTextArea::RenderTextArea),
		(RenderTextArea::~RenderTextArea), (RenderTextArea::handleFocusOut),
		(RenderTextArea::calcMinMaxWidth), (RenderTextArea::updateFromElement),
		(RenderTextArea::close), (RenderTextArea::text),
		(RenderTextArea::slotTextChanged):
		* src/kdelibs/khtml/rendering/render_form.h:
		* src/kdelibs/khtml/rendering/render_frames.cpp:
		(RenderFrameSet::RenderFrameSet), (RenderFrameSet::~RenderFrameSet),
		(RenderFrameSet::nodeAtPoint), (RenderFrameSet::layout),
		(RenderFrameSet::positionFrames), (RenderFrameSet::userResize),
		(RenderFrameSet::setResizing), (RenderFrameSet::canResize),
		(RenderFrameSet::dump), (RenderPart::RenderPart), (RenderPart::setWidget),
		(RenderPart::partLoadingErrorNotify), (RenderFrame::RenderFrame),
		(RenderFrame::slotViewCleared), (RenderPartObject::RenderPartObject),
		(RenderPartObject::updateWidget), (RenderPartObject::close),
		(RenderPartObject::partLoadingErrorNotify),
		(RenderPartObject::slotPartLoadingErrorNotify),
		(RenderPartObject::calcReplacedWidth), (RenderPartObject::calcReplacedHeight),
		(RenderPartObject::layout), (RenderPartObject::slotViewCleared):
		* src/kdelibs/khtml/rendering/render_frames.h:
		* src/kdelibs/khtml/rendering/render_html.cpp: (RenderHtml::RenderHtml),
		(RenderHtml::printBoxDecorations):
		* src/kdelibs/khtml/rendering/render_html.h:
		* src/kdelibs/khtml/rendering/render_image.cpp: (RenderImage::RenderImage),
		(RenderImage::setStyle), (RenderImage::setPixmap), (RenderImage::printObject),
		(RenderImage::layout), (RenderImage::notifyFinished), (RenderImage::nodeAtPoint),
		(RenderImage::updateFromElement):
		* src/kdelibs/khtml/rendering/render_image.h:
		* src/kdelibs/khtml/rendering/render_list.cpp: (toLetter), (toHebrew),
		(RenderListItem::RenderListItem), (RenderListItem::setStyle),
		(RenderListItem::calcListValue), (RenderListItem::layout),
		(RenderListMarker::RenderListMarker), (RenderListMarker::~RenderListMarker),
		(RenderListMarker::setStyle), (RenderListMarker::printObject),
		(RenderListMarker::layout), (RenderListMarker::setPixmap),
		(RenderListMarker::calcMinMaxWidth):
		* src/kdelibs/khtml/rendering/render_list.h:
		* src/kdelibs/khtml/rendering/render_object.cpp: (RenderObject::createObject),
		(RenderObject::RenderObject), (RenderObject::~RenderObject),
		(RenderObject::addChild), (RenderObject::removeChildNode),
		(RenderObject::removeChild), (RenderObject::appendChildNode),
		(RenderObject::insertChildNode), (RenderObject::containingBlock),
		(RenderObject::drawBorder), (RenderObject::printBorder),
		(RenderObject::printOutline), (RenderObject::information),
		(RenderObject::printTree), (RenderObject::dump),
		(RenderObject::selectionStartEnd), (RenderObject::setStyle),
		(RenderObject::setOverhangingContents), (RenderObject::root),
		(RenderObject::invalidateLayout), (RenderObject::checkSelectionPoint),
		(RenderObject::nodeAtPoint), (RenderObject::getVerticalPosition),
		(RenderObject::lineHeight), (RenderObject::baselinePosition),
		(RenderObject::recalcMinMaxWidths), (RenderObject::scheduleRelayout):
		* src/kdelibs/khtml/rendering/render_object.h:
		* src/kdelibs/khtml/rendering/render_replaced.cpp:
		(RenderReplaced::RenderReplaced), (RenderReplaced::print),
		(RenderReplaced::calcMinMaxWidth), (RenderReplaced::lineHeight),
		(RenderWidget::RenderWidget), (RenderWidget::detach),
		(RenderWidget::~RenderWidget), (RenderWidget::setQWidget),
		(RenderWidget::layout), (RenderWidget::setStyle), (RenderWidget::printObject),
		(RenderWidget::eventFilter), (RenderWidget::handleDOMEvent),
		(RenderWidget::sendWidgetEvent):
		* src/kdelibs/khtml/rendering/render_replaced.h:
		* src/kdelibs/khtml/rendering/render_root.cpp: (RenderRoot::RenderRoot),
		(RenderRoot::calcMinMaxWidth), (RenderRoot::layout), (RenderRoot::printObject),
		(RenderRoot::repaintRectangle), (RenderRoot::repaint), (RenderRoot::close),
		(RenderRoot::setSelection), (RenderRoot::clearSelection),
		(RenderRoot::selectionStartEnd), (RenderRoot::docWidth):
		* src/kdelibs/khtml/rendering/render_root.h:
		* src/kdelibs/khtml/rendering/render_style.cpp: (RenderStyle::setBitDefaults),
		(RenderStyle::RenderStyle), (RenderStyle::inheritFrom),
		(RenderStyle::~RenderStyle), (RenderStyle::operator==),
		(RenderStyle::getPseudoStyle), (RenderStyle::addPseudoStyle),
		(RenderStyle::removePseudoStyle), (RenderStyle::inheritedNotEqual),
		(RenderStyle::diff), (RenderStyle::cleanup),
		(RenderPseudoElementStyle::RenderPseudoElementStyle),
		(RenderPseudoElementStyle::~RenderPseudoElementStyle),
		(RenderPseudoElementStyle::setContent), (RenderPseudoElementStyle::contentText),
		(RenderPseudoElementStyle::contentObject),
		(RenderPseudoElementStyle::clearContent):
		* src/kdelibs/khtml/rendering/render_style.h:
		* src/kdelibs/khtml/rendering/render_table.cpp: (RenderTable::RenderTable),
		(RenderTable::setStyle), (RenderTable::addChild), (RenderTable::addCell),
		(RenderTable::setCells), (RenderTable::recalcColInfo), (RenderTable::addColInfo),
		(RenderTable::calcSingleColMinMax), (RenderTable::calcFinalColMax),
		(RenderTable::calcColMinMax), (RenderTable::calcWidth),
		(RenderTable::calcColWidth), (RenderTable::distributeRest),
		(RenderTable::layout), (RenderTable::layoutRows), (RenderTable::setCellWidths),
		(RenderTable::print), (RenderTable::calcMinMaxWidth), (RenderTable::close),
		(RenderTable::recalcCells), (RenderTable::dump),
		(RenderTableSection::RenderTableSection),
		(RenderTableSection::~RenderTableSection), (RenderTableSection::addChild),
		(RenderTableSection::dump), (RenderTableRow::RenderTableRow),
		(RenderTableRow::addChild), (RenderTableRow::dump), (RenderTableRow::layout),
		(RenderTableCell::RenderTableCell), (RenderTableCell::updateFromElement),
		(RenderTableCell::calcMinMaxWidth), (RenderTableCell::setWidth),
		(RenderTableCell::close), (RenderTableCell::print),
		(RenderTableCell::printBoxDecorations), (RenderTableCell::dump),
		(RenderTableCol::RenderTableCol), (RenderTableCol::updateFromElement),
		(RenderTableCol::dump), (RenderTableCaption::RenderTableCaption):
		* src/kdelibs/khtml/rendering/render_table.h:
		* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::~TextSlave),
		(TextSlave::print), (TextSlave::printSelection), (TextSlave::printDecoration),
		(TextSlave::printBoxDecorations), (TextSlave::checkSelectionPoint),
		(TextSlaveArray::compareItems), (RenderText::RenderText), (RenderText::setStyle),
		(RenderText::~RenderText), (RenderText::deleteSlaves), (RenderText::nodeAtPoint),
		(RenderText::checkSelectionPoint), (RenderText::cursorPos),
		(RenderText::absolutePosition), (RenderText::rightmostPosition),
		(RenderText::printObject), (RenderText::print), (RenderText::calcMinMaxWidth),
		(RenderText::font), (RenderText::setText), (RenderText::height),
		(RenderText::lineHeight), (RenderText::baselinePosition), (RenderText::position),
		(RenderText::width), (RenderText::metrics), (RenderText::printTextOutline):
		* src/kdelibs/khtml/rendering/render_text.h:
		* src/kdelibs/khtml/xml/dom2_eventsimpl.cpp: (EventImpl::~EventImpl),
		(EventImpl::setTarget), (EventImpl::initEvent), (EventImpl::idToType),
		(UIEventImpl::UIEventImpl), (UIEventImpl::~UIEventImpl),
		(KeyEventImpl::KeyEventImpl), (KeyEventImpl::~KeyEventImpl),
		(KeyEventImpl::checkModifier), (KeyEventImpl::initKeyEvent),
		(KeyEventImpl::initModifier), (KeyEventImpl::inputGenerated),
		(KeyEventImpl::keyVal), (KeyEventImpl::numPad), (KeyEventImpl::outputString),
		(KeyEventImpl::virtKeyVal), (RegisteredEventListener::operator==):
		* src/kdelibs/khtml/xml/dom2_eventsimpl.h:
		* src/kdelibs/khtml/xml/dom2_rangeimpl.cpp: (RangeImpl::~RangeImpl),
		(RangeImpl::compareBoundaryPoints), (RangeImpl::processContents):
		* src/kdelibs/khtml/xml/dom2_rangeimpl.h:
		* src/kdelibs/khtml/xml/dom2_traversalimpl.cpp:
		(NodeIteratorImpl::NodeIteratorImpl), (TreeWalkerImpl::TreeWalkerImpl),
		(TreeWalkerImpl::operator = ), (TreeWalkerImpl::~TreeWalkerImpl),
		(TreeWalkerImpl::getCurrentNode), (TreeWalkerImpl::setWhatToShow),
		(TreeWalkerImpl::setFilter), (TreeWalkerImpl::setExpandEntityReferences),
		(TreeWalkerImpl::setCurrentNode), (TreeWalkerImpl::parentNode),
		(TreeWalkerImpl::firstChild), (TreeWalkerImpl::lastChild),
		(TreeWalkerImpl::previousSibling), (TreeWalkerImpl::nextSibling),
		(TreeWalkerImpl::previousNode), (TreeWalkerImpl::nextNode),
		(TreeWalkerImpl::isAccepted), (TreeWalkerImpl::getParentNode),
		(TreeWalkerImpl::getPreviousSibling), (TreeWalkerImpl::getNextSibling):
		* src/kdelibs/khtml/xml/dom2_traversalimpl.h:
		* src/kdelibs/khtml/xml/dom2_viewsimpl.cpp:
		* src/kdelibs/khtml/xml/dom2_viewsimpl.h:
		* src/kdelibs/khtml/xml/dom_docimpl.cpp: (DOMImplementationImpl::hasFeature),
		(DOMImplementationImpl::createDocumentType),
		(DOMImplementationImpl::getInterface), (DOMImplementationImpl::createDocument),
		(DOMImplementationImpl::createCSSStyleSheet),
		(DOMImplementationImpl::createHTMLDocument), (DOMImplementationImpl::instance),
		(DocumentImpl::DocumentImpl), (DocumentImpl::~DocumentImpl),
		(DocumentImpl::doctype), (DocumentImpl::implementation),
		(DocumentImpl::createDocumentFragment), (DocumentImpl::createTextNode),
		(DocumentImpl::createComment), (DocumentImpl::createCDATASection),
		(DocumentImpl::createProcessingInstruction), (DocumentImpl::createAttribute),
		(DocumentImpl::createEntityReference), (DocumentImpl::importNode),
		(DocumentImpl::createElementNS), (DocumentImpl::getElementById),
		(DocumentImpl::setTitle), (DocumentImpl::nodeName), (DocumentImpl::nodeType),
		(DocumentImpl::createHTMLElement), (DocumentImpl::nextState),
		(DocumentImpl::docState), (DocumentImpl::createNodeIterator),
		(DocumentImpl::createTreeWalker), (DocumentImpl::setDocumentChanged),
		(DocumentImpl::recalcStyle), (DocumentImpl::updateRendering),
		(DocumentImpl::updateDocumentsRendering), (DocumentImpl::attach),
		(DocumentImpl::detach), (DocumentImpl::setVisuallyOrdered), (DocumentImpl::open),
		(DocumentImpl::close), (DocumentImpl::write), (DocumentImpl::setStyleSheet),
		(DocumentImpl::setUserStyleSheet), (DocumentImpl::elementSheet),
		(DocumentImpl::determineParseMode), (DocumentImpl::findElement),
		(DocumentImpl::nextFocusNode), (DocumentImpl::previousFocusNode),
		(DocumentImpl::nodeAbsIndex), (DocumentImpl::nodeWithAbsIndex),
		(DocumentImpl::processHttpEquiv), (DocumentImpl::prepareMouseEvent),
		(DocumentImpl::childAllowed), (DocumentImpl::cloneNode), (DocumentImpl::attrId),
		(DocumentImpl::attrName), (DocumentImpl::tagId), (DocumentImpl::tagName),
		(DocumentImpl::namespaceURI), (DocumentImpl::updateStyleSelector),
		(DocumentImpl::recalcStyleSelector), (DocumentImpl::setFocusNode),
		(DocumentImpl::notifyBeforeNodeRemoval), (DocumentImpl::defaultEventHandler),
		(DocumentImpl::setWindowEventListener), (DocumentImpl::getWindowEventListener),
		(DocumentImpl::removeWindowEventListener), (DocumentFragmentImpl::nodeName),
		(DocumentFragmentImpl::cloneNode), (DocumentTypeImpl::DocumentTypeImpl),
		(DocumentTypeImpl::~DocumentTypeImpl), (DocumentTypeImpl::copyFrom),
		(DocumentTypeImpl::nodeName), (DocumentTypeImpl::cloneNode):
		* src/kdelibs/khtml/xml/dom_docimpl.h:
		* src/kdelibs/khtml/xml/dom_elementimpl.cpp: (AttributeImpl::allocateImpl),
		(AttrImpl::AttrImpl), (AttrImpl::~AttrImpl), (AttrImpl::nodeName),
		(AttrImpl::prefix), (AttrImpl::setPrefix), (AttrImpl::nodeValue),
		(AttrImpl::setValue), (AttrImpl::setNodeValue), (AttrImpl::cloneNode),
		(ElementImpl::ElementImpl), (ElementImpl::~ElementImpl),
		(ElementImpl::removeAttribute), (ElementImpl::setAttribute),
		(ElementImpl::nodeType), (ElementImpl::getAttribute),
		(ElementImpl::setAttributeMap), (ElementImpl::cloneNode),
		(ElementImpl::nodeName), (ElementImpl::tagName), (ElementImpl::setPrefix),
		(ElementImpl::createAttributeMap), (ElementImpl::attach),
		(ElementImpl::recalcStyle), (ElementImpl::childAllowed),
		(ElementImpl::createDecl), (ElementImpl::dispatchAttrRemovalEvent),
		(ElementImpl::dispatchAttrAdditionEvent), (ElementImpl::dump),
		(XMLElementImpl::XMLElementImpl), (XMLElementImpl::~XMLElementImpl),
		(XMLElementImpl::localName), (XMLElementImpl::cloneNode),
		(NamedAttrMapImpl::NamedAttrMapImpl), (NamedAttrMapImpl::~NamedAttrMapImpl),
		(NamedAttrMapImpl::getNamedItem), (NamedAttrMapImpl::setNamedItem),
		(NamedAttrMapImpl::removeNamedItem), (NamedAttrMapImpl::item),
		(NamedAttrMapImpl::length), (NamedAttrMapImpl::getAttributeItem),
		(NamedAttrMapImpl::mapId), (NamedAttrMapImpl::clearAttributes),
		(NamedAttrMapImpl::detachFromElement), (NamedAttrMapImpl::operator=),
		(NamedAttrMapImpl::addAttribute), (NamedAttrMapImpl::removeAttribute):
		* src/kdelibs/khtml/xml/dom_elementimpl.h:
		* src/kdelibs/khtml/xml/dom_nodeimpl.cpp: (NodeImpl::NodeImpl),
		(NodeImpl::~NodeImpl), (NodeImpl::setNodeValue), (NodeImpl::nodeName),
		(NodeImpl::normalize), (NodeImpl::prefix), (NodeImpl::setPrefix),
		(NodeImpl::localName), (escapeHTML), (NodeImpl::recursive_toHTML),
		(NodeImpl::getRect), (NodeImpl::setChanged), (NodeImpl::isInline),
		(NodeImpl::nodeIndex), (NodeImpl::addEventListener),
		(NodeImpl::removeEventListener), (NodeImpl::removeHTMLEventListener),
		(NodeImpl::setHTMLEventListener), (NodeImpl::getHTMLEventListener),
		(NodeImpl::dispatchEvent), (NodeImpl::dispatchGenericEvent),
		(NodeImpl::dispatchHTMLEvent), (NodeImpl::dispatchWindowEvent),
		(NodeImpl::dispatchMouseEvent), (NodeImpl::dispatchUIEvent),
		(NodeImpl::dispatchSubtreeModifiedEvent), (NodeImpl::dispatchKeyEvent),
		(NodeImpl::handleLocalEvents), (NodeImpl::defaultEventHandler),
		(NodeImpl::traverseNextNode), (NodeImpl::traversePreviousNode),
		(NodeImpl::checkSetPrefix), (NodeImpl::checkAddChild), (NodeImpl::isAncestor),
		(NodeImpl::childAllowed), (NodeImpl::diff), (NodeImpl::dump),
		(NodeImpl::deleteMe), (NodeImpl::init), (NodeImpl::attach), (NodeImpl::detach),
		(NodeImpl::maintainsState), (NodeImpl::state), (NodeImpl::restoreState),
		(NodeImpl::insertedIntoDocument), (NodeImpl::removedFromDocument),
		(NodeImpl::childrenChanged), (NodeImpl::isReadOnly), (NodeImpl::nextRenderer),
		(NodeBaseImpl::NodeBaseImpl), (NodeBaseImpl::~NodeBaseImpl),
		(NodeBaseImpl::insertBefore), (NodeBaseImpl::replaceChild),
		(NodeBaseImpl::removeChild), (NodeBaseImpl::removeChildren),
		(NodeBaseImpl::appendChild), (NodeBaseImpl::checkSameDocument),
		(NodeBaseImpl::checkNoOwner), (NodeBaseImpl::addChild), (NodeBaseImpl::attach),
		(NodeBaseImpl::detach), (NodeBaseImpl::cloneChildNodes),
		(NodeBaseImpl::getElementsByTagNameNS), (NodeBaseImpl::getUpperLeftCorner),
		(NodeBaseImpl::getLowerRightCorner), (NodeBaseImpl::getRect),
		(NodeBaseImpl::setFocus), (NodeBaseImpl::setActive),
		(NodeBaseImpl::dispatchChildInsertedEvents),
		(NodeBaseImpl::dispatchChildRemovalEvents), (ChildNodeListImpl::nodeMatches),
		(TagNodeListImpl::TagNodeListImpl), (TagNodeListImpl::nodeMatches),
		(GenericRONamedNodeMapImpl::GenericRONamedNodeMapImpl),
		(GenericRONamedNodeMapImpl::getNamedItem),
		(GenericRONamedNodeMapImpl::setNamedItem),
		(GenericRONamedNodeMapImpl::removeNamedItem), (GenericRONamedNodeMapImpl::item),
		(GenericRONamedNodeMapImpl::length), (GenericRONamedNodeMapImpl::getNamedItemNS),
		(GenericRONamedNodeMapImpl::setNamedItemNS),
		(GenericRONamedNodeMapImpl::removeNamedItemNS),
		(GenericRONamedNodeMapImpl::addNode):
		* src/kdelibs/khtml/xml/dom_nodeimpl.h:
		* src/kdelibs/khtml/xml/dom_stringimpl.cpp: (DOMStringImpl::toLengthArray),
		(DOMStringImpl::lower), (DOMStringImpl::upper):
		* src/kdelibs/khtml/xml/dom_stringimpl.h:
		* src/kdelibs/khtml/xml/dom_textimpl.cpp: (CharacterDataImpl::CharacterDataImpl),
		(CharacterDataImpl::setData), (CharacterDataImpl::substringData),
		(CharacterDataImpl::appendData), (CharacterDataImpl::insertData),
		(CharacterDataImpl::deleteData), (CharacterDataImpl::replaceData),
		(CharacterDataImpl::nodeValue), (CharacterDataImpl::setNodeValue),
		(CharacterDataImpl::dispatchModifiedEvent),
		(CharacterDataImpl::checkCharDataOperation), (CharacterDataImpl::dump),
		(CommentImpl::nodeName), (CommentImpl::cloneNode), (CommentImpl::id),
		(TextImpl::splitText), (TextImpl::nodeName), (TextImpl::cloneNode),
		(TextImpl::attach), (TextImpl::id), (TextImpl::recalcStyle),
		(CDATASectionImpl::nodeName), (CDATASectionImpl::cloneNode):
		* src/kdelibs/khtml/xml/dom_textimpl.h:
		* src/kdelibs/khtml/xml/dom_xmlimpl.cpp: (EntityImpl::nodeName),
		(EntityImpl::nodeType), (EntityImpl::cloneNode), (EntityReferenceImpl::nodeName),
		(EntityReferenceImpl::cloneNode), (NotationImpl::publicId),
		(NotationImpl::systemId), (NotationImpl::nodeName), (NotationImpl::nodeType),
		(NotationImpl::cloneNode), (NotationImpl::childTypeAllowed),
		(ProcessingInstructionImpl::ProcessingInstructionImpl),
		(ProcessingInstructionImpl::target), (ProcessingInstructionImpl::data),
		(ProcessingInstructionImpl::setData), (ProcessingInstructionImpl::nodeName),
		(ProcessingInstructionImpl::setNodeValue),
		(ProcessingInstructionImpl::cloneNode), (ProcessingInstructionImpl::localHref),
		(ProcessingInstructionImpl::checkStyleSheet),
		(ProcessingInstructionImpl::setStyleSheet):
		* src/kdelibs/khtml/xml/dom_xmlimpl.h:
		* src/kdelibs/khtml/xml/xml_tokenizer.cpp: (XMLHandler::startDocument),
		(XMLHandler::startElement), (XMLHandler::endElement), (XMLHandler::startCDATA),
		(XMLHandler::characters), (XMLHandler::errorString), (XMLHandler::fatalError),
		(XMLHandler::enterText), (XMLHandler::exitText),
		(XMLHandler::internalEntityDecl), (XMLHandler::notationDecl),
		(XMLTokenizer::finish), (XMLTokenizer::addScripts),
		(XMLTokenizer::executeScripts), (XMLTokenizer::notifyFinished):
		* src/kdelibs/khtml/xml/xml_tokenizer.h:
		* src/kdelibs/kjs/array_object.cpp: (ArrayInstanceImp::ArrayInstanceImp),
		(ArrayInstanceImp::put), (ArrayInstanceImp::putDirect),
		(ArrayPrototypeImp::ArrayPrototypeImp), (ArrayPrototypeImp::get),
		(ArrayProtoFuncImp::ArrayProtoFuncImp), (ArrayProtoFuncImp::implementsCall),
		(ArrayProtoFuncImp::call), (ArrayObjectImp::ArrayObjectImp),
		(ArrayObjectImp::implementsConstruct), (ArrayObjectImp::construct),
		(ArrayObjectImp::implementsCall), (ArrayObjectImp::call):
		* src/kdelibs/kjs/array_object.h:
		* src/kdelibs/kjs/bool_object.cpp: (BooleanInstanceImp::BooleanInstanceImp),
		(BooleanPrototypeImp::BooleanPrototypeImp),
		(BooleanProtoFuncImp::BooleanProtoFuncImp),
		(BooleanProtoFuncImp::implementsCall), (BooleanProtoFuncImp::call),
		(BooleanObjectImp::BooleanObjectImp), (BooleanObjectImp::implementsConstruct),
		(BooleanObjectImp::construct), (BooleanObjectImp::implementsCall),
		(BooleanObjectImp::call):
		* src/kdelibs/kjs/bool_object.h:
		* src/kdelibs/kjs/collector.cpp: (Collector::allocate), (Collector::collect),
		(Collector::finalCheck):
		* src/kdelibs/kjs/collector.h:
		* src/kdelibs/kjs/date_object.cpp: (DateInstanceImp::DateInstanceImp),
		(DatePrototypeImp::DatePrototypeImp), (DatePrototypeImp::get),
		(DateProtoFuncImp::DateProtoFuncImp), (DateProtoFuncImp::implementsCall),
		(DateProtoFuncImp::call), (DateObjectImp::DateObjectImp),
		(DateObjectImp::implementsConstruct), (DateObjectImp::construct),
		(DateObjectImp::implementsCall), (DateObjectImp::call),
		(DateObjectFuncImp::DateObjectFuncImp), (DateObjectFuncImp::implementsCall),
		(DateObjectFuncImp::call), (KJS::parseDate), (ymdhms_to_seconds),
		(KJS::KRFCDate_parseDate), (KJS::timeClip):
		* src/kdelibs/kjs/date_object.h:
		* src/kdelibs/kjs/debugger.cpp: (Debugger::Debugger), (Debugger::~Debugger),
		(Debugger::attach), (Debugger::detach), (Debugger::sourceParsed),
		(Debugger::sourceUnused), (Debugger::exception), (Debugger::atStatement),
		(Debugger::callEvent), (Debugger::returnEvent):
		* src/kdelibs/kjs/debugger.h:
		* src/kdelibs/kjs/error_object.cpp: (ErrorPrototypeImp::ErrorPrototypeImp),
		(ErrorProtoFuncImp::ErrorProtoFuncImp), (ErrorProtoFuncImp::implementsCall),
		(ErrorProtoFuncImp::call), (ErrorObjectImp::ErrorObjectImp),
		(ErrorObjectImp::implementsConstruct), (ErrorObjectImp::construct),
		(ErrorObjectImp::implementsCall), (ErrorObjectImp::call),
		(NativeErrorPrototypeImp::NativeErrorPrototypeImp),
		(NativeErrorImp::NativeErrorImp), (NativeErrorImp::implementsConstruct),
		(NativeErrorImp::construct), (NativeErrorImp::implementsCall),
		(NativeErrorImp::call), (NativeErrorImp::mark):
		* src/kdelibs/kjs/error_object.h:
		* src/kdelibs/kjs/function.cpp: (FunctionImp::FunctionImp),
		(FunctionImp::~FunctionImp), (FunctionImp::mark), (FunctionImp::implementsCall),
		(FunctionImp::call), (FunctionImp::processParameters),
		(FunctionImp::processVarDecls), (FunctionImp::pushArgs), (FunctionImp::popArgs),
		(DeclaredFunctionImp::DeclaredFunctionImp),
		(DeclaredFunctionImp::~DeclaredFunctionImp),
		(DeclaredFunctionImp::implementsConstruct), (DeclaredFunctionImp::construct),
		(DeclaredFunctionImp::execute), (DeclaredFunctionImp::processVarDecls),
		(ArgumentsImp::ArgumentsImp), (ActivationImp::ActivationImp),
		(ActivationImp::~ActivationImp), (GlobalFuncImp::GlobalFuncImp),
		(GlobalFuncImp::codeType), (GlobalFuncImp::implementsCall),
		(GlobalFuncImp::call):
		* src/kdelibs/kjs/function.h:
		* src/kdelibs/kjs/function_object.cpp:
		(FunctionPrototypeImp::FunctionPrototypeImp),
		(FunctionPrototypeImp::~FunctionPrototypeImp),
		(FunctionPrototypeImp::implementsCall), (FunctionPrototypeImp::call),
		(FunctionProtoFuncImp::FunctionProtoFuncImp),
		(FunctionProtoFuncImp::implementsCall), (FunctionProtoFuncImp::call),
		(FunctionObjectImp::FunctionObjectImp), (FunctionObjectImp::~FunctionObjectImp),
		(FunctionObjectImp::implementsConstruct), (FunctionObjectImp::construct),
		(FunctionObjectImp::implementsCall), (FunctionObjectImp::call):
		* src/kdelibs/kjs/function_object.h:
		* src/kdelibs/kjs/grammar.y:
		* src/kdelibs/kjs/internal.cpp: (UndefinedImp::toPrimitive),
		(UndefinedImp::toBoolean), (UndefinedImp::toNumber), (UndefinedImp::toString),
		(UndefinedImp::toObject), (NullImp::toPrimitive), (NullImp::toBoolean),
		(NullImp::toNumber), (NullImp::toString), (NullImp::toObject),
		(BooleanImp::toPrimitive), (BooleanImp::toBoolean), (BooleanImp::toNumber),
		(BooleanImp::toString), (BooleanImp::toObject), (StringImp::StringImp),
		(StringImp::toPrimitive), (StringImp::toBoolean), (StringImp::toNumber),
		(StringImp::toString), (StringImp::toObject), (NumberImp::NumberImp),
		(NumberImp::toPrimitive), (NumberImp::toBoolean), (NumberImp::toNumber),
		(NumberImp::toString), (NumberImp::toObject), (ReferenceImp::ReferenceImp),
		(ReferenceImp::mark), (ReferenceImp::toPrimitive), (ReferenceImp::toBoolean),
		(ReferenceImp::toNumber), (ReferenceImp::toString), (ReferenceImp::toObject),
		(LabelStack::LabelStack), (LabelStack::operator=), (LabelStack::push),
		(LabelStack::contains), (LabelStack::pop), (LabelStack::~LabelStack),
		(LabelStack::clear), (CompletionImp::CompletionImp),
		(CompletionImp::~CompletionImp), (CompletionImp::mark),
		(CompletionImp::toPrimitive), (CompletionImp::toBoolean),
		(CompletionImp::toNumber), (CompletionImp::toString), (CompletionImp::toObject),
		(ListImp::toPrimitive), (ListImp::toBoolean), (ListImp::toNumber),
		(ListImp::toString), (ListImp::toObject), (ListImp::ListImp),
		(ListImp::~ListImp), (ListImp::mark), (ListImp::append), (ListImp::prepend),
		(ListImp::appendList), (ListImp::prependList), (ListImp::removeFirst),
		(ListImp::removeLast), (ListImp::remove), (ListImp::clear), (ListImp::copy),
		(ListImp::erase), (ListImp::isEmpty), (ListImp::size), (ListImp::at),
		(ListImp::empty), (ContextImp::ContextImp), (ContextImp::~ContextImp),
		(ContextImp::pushScope), (ContextImp::popScope), (Parser::parse),
		(InterpreterImp::globalInit), (InterpreterImp::globalClear),
		(InterpreterImp::InterpreterImp), (InterpreterImp::~InterpreterImp),
		(InterpreterImp::clear), (InterpreterImp::mark), (InterpreterImp::checkSyntax),
		(InterpreterImp::evaluate), (InterpreterImp::setDebugger),
		(InternalFunctionImp::InternalFunctionImp),
		(InternalFunctionImp::implementsHasInstance), (InternalFunctionImp::hasInstance),
		(KJS::roundValue), (KJS::printInfo):
		* src/kdelibs/kjs/internal.h:
		* src/kdelibs/kjs/lexer.cpp: (Lexer::Lexer), (Lexer::curr), (Lexer::setCode),
		(Lexer::lex), (Lexer::isLineTerminator), (Lexer::matchPunctuator),
		(Lexer::scanRegExp):
		* src/kdelibs/kjs/lexer.h:
		* src/kdelibs/kjs/lexer.lut.h:
		* src/kdelibs/kjs/lookup.cpp: (Lookup::findEntry), (Lookup::find):
		* src/kdelibs/kjs/lookup.h:
		* src/kdelibs/kjs/math_object.cpp: (MathObjectImp::MathObjectImp),
		(MathObjectImp::get), (MathObjectImp::getValueProperty),
		(MathFuncImp::MathFuncImp), (MathFuncImp::implementsCall), (MathFuncImp::call):
		* src/kdelibs/kjs/math_object.h:
		* src/kdelibs/kjs/math_object.lut.h:
		* src/kdelibs/kjs/nodes.cpp: (Node::Node), (Node::~Node), (Node::finalCheck),
		(Node::throwError), (StatementNode::StatementNode),
		(StatementNode::~StatementNode), (StatementNode::setLoc),
		(StatementNode::hitStatement), (StatementNode::abortStatement),
		(NullNode::evaluate), (BooleanNode::evaluate), (NumberNode::evaluate),
		(StringNode::evaluate), (RegExpNode::evaluate), (ThisNode::evaluate),
		(ResolveNode::evaluate), (GroupNode::~GroupNode), (GroupNode::ref),
		(GroupNode::deref), (GroupNode::evaluate), (ElisionNode::~ElisionNode),
		(ElisionNode::ref), (ElisionNode::deref), (ElisionNode::evaluate),
		(ElementNode::~ElementNode), (ElementNode::ref), (ElementNode::deref),
		(ElementNode::evaluate), (ArrayNode::~ArrayNode), (ArrayNode::ref),
		(ArrayNode::deref), (ArrayNode::evaluate),
		(ObjectLiteralNode::~ObjectLiteralNode), (ObjectLiteralNode::ref),
		(ObjectLiteralNode::deref), (ObjectLiteralNode::evaluate),
		(PropertyValueNode::~PropertyValueNode), (PropertyValueNode::ref),
		(PropertyValueNode::deref), (PropertyValueNode::evaluate),
		(PropertyNode::evaluate), (AccessorNode1::~AccessorNode1), (AccessorNode1::ref),
		(AccessorNode1::deref), (AccessorNode1::evaluate),
		(AccessorNode2::~AccessorNode2), (AccessorNode2::ref), (AccessorNode2::deref),
		(AccessorNode2::evaluate), (ArgumentListNode::ArgumentListNode),
		(ArgumentListNode::~ArgumentListNode), (ArgumentListNode::ref),
		(ArgumentListNode::deref), (ArgumentListNode::evaluate),
		(ArgumentListNode::evaluateList), (ArgumentsNode::ArgumentsNode),
		(ArgumentsNode::~ArgumentsNode), (ArgumentsNode::ref), (ArgumentsNode::deref),
		(ArgumentsNode::evaluate), (ArgumentsNode::evaluateList),
		(NewExprNode::~NewExprNode), (NewExprNode::ref), (NewExprNode::deref),
		(NewExprNode::evaluate), (FunctionCallNode::~FunctionCallNode),
		(FunctionCallNode::ref), (FunctionCallNode::deref), (FunctionCallNode::evaluate),
		(PostfixNode::~PostfixNode), (PostfixNode::ref), (PostfixNode::deref),
		(PostfixNode::evaluate), (DeleteNode::~DeleteNode), (DeleteNode::ref),
		(DeleteNode::deref), (DeleteNode::evaluate), (VoidNode::~VoidNode),
		(VoidNode::ref), (VoidNode::deref), (VoidNode::evaluate),
		(TypeOfNode::~TypeOfNode), (TypeOfNode::ref), (TypeOfNode::deref),
		(TypeOfNode::evaluate), (PrefixNode::~PrefixNode), (PrefixNode::ref),
		(PrefixNode::deref), (PrefixNode::evaluate), (UnaryPlusNode::~UnaryPlusNode),
		(UnaryPlusNode::ref), (UnaryPlusNode::deref), (UnaryPlusNode::evaluate),
		(NegateNode::~NegateNode), (NegateNode::ref), (NegateNode::deref),
		(NegateNode::evaluate), (BitwiseNotNode::~BitwiseNotNode), (BitwiseNotNode::ref),
		(BitwiseNotNode::deref), (BitwiseNotNode::evaluate),
		(LogicalNotNode::~LogicalNotNode), (LogicalNotNode::ref),
		(LogicalNotNode::deref), (LogicalNotNode::evaluate), (MultNode::~MultNode),
		(MultNode::ref), (MultNode::deref), (MultNode::evaluate), (AddNode::~AddNode),
		(AddNode::ref), (AddNode::deref), (AddNode::evaluate), (ShiftNode::~ShiftNode),
		(ShiftNode::ref), (ShiftNode::deref), (ShiftNode::evaluate),
		(RelationalNode::~RelationalNode), (RelationalNode::ref),
		(RelationalNode::deref), (RelationalNode::evaluate), (EqualNode::~EqualNode),
		(EqualNode::ref), (EqualNode::deref), (EqualNode::evaluate),
		(BitOperNode::~BitOperNode), (BitOperNode::ref), (BitOperNode::deref),
		(BitOperNode::evaluate), (BinaryLogicalNode::~BinaryLogicalNode),
		(BinaryLogicalNode::ref), (BinaryLogicalNode::deref),
		(BinaryLogicalNode::evaluate), (ConditionalNode::~ConditionalNode),
		(ConditionalNode::ref), (ConditionalNode::deref), (ConditionalNode::evaluate),
		(AssignNode::~AssignNode), (AssignNode::ref), (AssignNode::deref),
		(AssignNode::evaluate), (CommaNode::~CommaNode), (CommaNode::ref),
		(CommaNode::deref), (CommaNode::evaluate), (StatListNode::~StatListNode),
		(StatListNode::ref), (StatListNode::deref), (StatListNode::execute),
		(StatListNode::processVarDecls), (AssignExprNode::~AssignExprNode),
		(AssignExprNode::ref), (AssignExprNode::deref), (AssignExprNode::evaluate),
		(VarDeclNode::VarDeclNode), (VarDeclNode::~VarDeclNode), (VarDeclNode::ref),
		(VarDeclNode::deref), (VarDeclNode::evaluate), (VarDeclNode::processVarDecls),
		(VarDeclListNode::~VarDeclListNode), (VarDeclListNode::ref),
		(VarDeclListNode::deref), (VarDeclListNode::evaluate),
		(VarDeclListNode::processVarDecls), (VarStatementNode::~VarStatementNode),
		(VarStatementNode::ref), (VarStatementNode::deref), (VarStatementNode::execute),
		(VarStatementNode::processVarDecls), (BlockNode::~BlockNode), (BlockNode::ref),
		(BlockNode::deref), (BlockNode::execute), (BlockNode::processVarDecls),
		(EmptyStatementNode::execute), (ExprStatementNode::~ExprStatementNode),
		(ExprStatementNode::ref), (ExprStatementNode::deref),
		(ExprStatementNode::execute), (IfNode::~IfNode), (IfNode::ref), (IfNode::deref),
		(IfNode::execute), (IfNode::processVarDecls), (DoWhileNode::~DoWhileNode),
		(DoWhileNode::ref), (DoWhileNode::deref), (DoWhileNode::execute),
		(DoWhileNode::processVarDecls), (WhileNode::~WhileNode), (WhileNode::ref),
		(WhileNode::deref), (WhileNode::execute), (WhileNode::processVarDecls),
		(ForNode::~ForNode), (ForNode::ref), (ForNode::deref), (ForNode::execute),
		(ForNode::processVarDecls), (ForInNode::ForInNode), (ForInNode::~ForInNode),
		(ForInNode::ref), (ForInNode::deref), (ForInNode::execute),
		(ForInNode::processVarDecls), (ContinueNode::execute), (BreakNode::execute),
		(ReturnNode::~ReturnNode), (ReturnNode::ref), (ReturnNode::deref),
		(ReturnNode::execute), (WithNode::~WithNode), (WithNode::ref), (WithNode::deref),
		(WithNode::execute), (WithNode::processVarDecls),
		(CaseClauseNode::~CaseClauseNode), (CaseClauseNode::ref),
		(CaseClauseNode::deref), (CaseClauseNode::evaluate),
		(CaseClauseNode::evalStatements), (CaseClauseNode::processVarDecls),
		(ClauseListNode::~ClauseListNode), (ClauseListNode::ref),
		(ClauseListNode::deref), (ClauseListNode::evaluate),
		(ClauseListNode::processVarDecls), (CaseBlockNode::~CaseBlockNode),
		(CaseBlockNode::ref), (CaseBlockNode::deref), (CaseBlockNode::evaluate),
		(CaseBlockNode::evalBlock), (CaseBlockNode::processVarDecls),
		(SwitchNode::~SwitchNode), (SwitchNode::ref), (SwitchNode::deref),
		(SwitchNode::execute), (SwitchNode::processVarDecls), (LabelNode::~LabelNode),
		(LabelNode::ref), (LabelNode::deref), (LabelNode::execute),
		(LabelNode::processVarDecls), (ThrowNode::~ThrowNode), (ThrowNode::ref),
		(ThrowNode::deref), (ThrowNode::execute), (CatchNode::~CatchNode),
		(CatchNode::ref), (CatchNode::deref), (CatchNode::execute),
		(CatchNode::processVarDecls), (FinallyNode::~FinallyNode), (FinallyNode::ref),
		(FinallyNode::deref), (FinallyNode::execute), (FinallyNode::processVarDecls),
		(TryNode::~TryNode), (TryNode::ref), (TryNode::deref), (TryNode::execute),
		(TryNode::processVarDecls), (ParameterNode::~ParameterNode),
		(ParameterNode::ref), (ParameterNode::deref), (ParameterNode::append),
		(ParameterNode::evaluate), (FunctionBodyNode::FunctionBodyNode),
		(FunctionBodyNode::~FunctionBodyNode), (FunctionBodyNode::ref),
		(FunctionBodyNode::deref), (FunctionBodyNode::execute),
		(FunctionBodyNode::processFuncDecl), (FunctionBodyNode::processVarDecls),
		(FuncDeclNode::~FuncDeclNode), (FuncDeclNode::ref), (FuncDeclNode::deref),
		(FuncDeclNode::processFuncDecl), (FuncExprNode::~FuncExprNode),
		(FuncExprNode::ref), (FuncExprNode::deref), (FuncExprNode::evaluate),
		(SourceElementNode::~SourceElementNode), (SourceElementNode::ref),
		(SourceElementNode::deref), (SourceElementNode::execute),
		(SourceElementNode::processFuncDecl), (SourceElementNode::processVarDecls),
		(SourceElementsNode::~SourceElementsNode), (SourceElementsNode::ref),
		(SourceElementsNode::deref), (SourceElementsNode::execute),
		(SourceElementsNode::processFuncDecl), (SourceElementsNode::processVarDecls),
		(ProgramNode::ProgramNode), (ProgramNode::~ProgramNode):
		* src/kdelibs/kjs/nodes.h:
		* src/kdelibs/kjs/number_object.cpp: (NumberInstanceImp::NumberInstanceImp),
		(NumberPrototypeImp::NumberPrototypeImp),
		(NumberProtoFuncImp::NumberProtoFuncImp), (NumberProtoFuncImp::implementsCall),
		(NumberProtoFuncImp::call), (NumberObjectImp::NumberObjectImp),
		(NumberObjectImp::get), (NumberObjectImp::getValueProperty),
		(NumberObjectImp::implementsConstruct), (NumberObjectImp::construct),
		(NumberObjectImp::implementsCall), (NumberObjectImp::call):
		* src/kdelibs/kjs/number_object.h:
		* src/kdelibs/kjs/object.cpp: (Object::Object), (Object::~Object),
		(Object::operator=), (Object::classInfo), (Object::inherits),
		(Object::dynamicCast), (Object::prototype), (Object::className), (Object::get),
		(Object::put), (Object::canPut), (Object::hasProperty), (Object::deleteProperty),
		(Object::defaultValue), (Object::implementsConstruct), (Object::construct),
		(Object::implementsCall), (Object::call), (Object::implementsHasInstance),
		(Object::hasInstance), (Object::scope), (Object::setScope), (Object::propList),
		(Object::internalValue), (Object::setInternalValue), (ObjectImp::ObjectImp),
		(ObjectImp::~ObjectImp), (ObjectImp::mark), (ObjectImp::classInfo),
		(ObjectImp::inherits), (ObjectImp::type), (ObjectImp::prototype),
		(ObjectImp::setPrototype), (ObjectImp::className), (ObjectImp::get),
		(ObjectImp::getDirect), (ObjectImp::put), (ObjectImp::canPut),
		(ObjectImp::hasProperty), (ObjectImp::deleteProperty),
		(ObjectImp::deleteAllProperties), (ObjectImp::defaultValue),
		(ObjectImp::findPropertyHashEntry), (ObjectImp::implementsConstruct),
		(ObjectImp::construct), (ObjectImp::implementsCall), (ObjectImp::call),
		(ObjectImp::implementsHasInstance), (ObjectImp::hasInstance), (ObjectImp::scope),
		(ObjectImp::setScope), (ObjectImp::propList), (ObjectImp::internalValue),
		(ObjectImp::setInternalValue), (ObjectImp::toPrimitive), (ObjectImp::toBoolean),
		(ObjectImp::toNumber), (ObjectImp::toInteger), (ObjectImp::toInt32),
		(ObjectImp::toUInt32), (ObjectImp::toUInt16), (ObjectImp::toString),
		(ObjectImp::toObject), (Error::create):
		* src/kdelibs/kjs/object.h:
		* src/kdelibs/kjs/object_object.cpp: (ObjectPrototypeImp::ObjectPrototypeImp),
		(ObjectProtoFuncImp::ObjectProtoFuncImp), (ObjectProtoFuncImp::implementsCall),
		(ObjectProtoFuncImp::call), (ObjectObjectImp::ObjectObjectImp),
		(ObjectObjectImp::implementsConstruct), (ObjectObjectImp::construct),
		(ObjectObjectImp::implementsCall), (ObjectObjectImp::call):
		* src/kdelibs/kjs/object_object.h:
		* src/kdelibs/kjs/operations.cpp: (KJS::isPosInf), (KJS::isNegInf), (KJS::equal),
		(KJS::strictEqual), (KJS::relation), (KJS::maxInt), (KJS::minInt), (KJS::add),
		(KJS::mult):
		* src/kdelibs/kjs/operations.h:
		* src/kdelibs/kjs/regexp.cpp: (RegExp::RegExp), (RegExp::~RegExp),
		(RegExp::match), (RegExp::test):
		* src/kdelibs/kjs/regexp.h:
		* src/kdelibs/kjs/regexp_object.cpp: (RegExpPrototypeImp::RegExpPrototypeImp),
		(RegExpProtoFuncImp::RegExpProtoFuncImp), (RegExpProtoFuncImp::implementsCall),
		(RegExpProtoFuncImp::call), (RegExpImp::RegExpImp), (RegExpImp::~RegExpImp),
		(RegExpObjectImp::RegExpObjectImp), (RegExpObjectImp::~RegExpObjectImp),
		(RegExpObjectImp::registerRegexp), (RegExpObjectImp::arrayOfMatches),
		(RegExpObjectImp::get), (RegExpObjectImp::implementsConstruct),
		(RegExpObjectImp::construct), (RegExpObjectImp::implementsCall),
		(RegExpObjectImp::call):
		* src/kdelibs/kjs/regexp_object.h:
		* src/kdelibs/kjs/string_object.cpp: (StringInstanceImp::StringInstanceImp),
		(StringPrototypeImp::StringPrototypeImp), (StringPrototypeImp::get),
		(StringProtoFuncImp::StringProtoFuncImp), (StringProtoFuncImp::implementsCall),
		(StringProtoFuncImp::call), (StringObjectImp::StringObjectImp),
		(StringObjectImp::implementsConstruct), (StringObjectImp::construct),
		(StringObjectImp::implementsCall), (StringObjectImp::call),
		(StringObjectFuncImp::StringObjectFuncImp),
		(StringObjectFuncImp::implementsCall), (StringObjectFuncImp::call):
		* src/kdelibs/kjs/string_object.h:
		* src/kdelibs/kjs/testkjs.cpp: (TestFunctionImp::call), (main):
		* src/kdelibs/kjs/types.cpp: (Reference::Reference), (Reference::~Reference),
		(Reference::operator=), (Reference::dynamicCast), (ListIterator::ListIterator),
		(ListIterator::operator=), (ListIterator::~ListIterator),
		(ListIterator::operator->), (ListIterator::operator*),
		(ListIterator::operator++), (ListIterator::operator--),
		(ListIterator::operator==), (ListIterator::operator!=), (List::List),
		(List::~List), (List::operator=), (List::dynamicCast), (List::append),
		(List::prepend), (List::appendList), (List::prependList), (List::removeFirst),
		(List::removeLast), (List::remove), (List::clear), (List::copy), (List::begin),
		(List::end), (List::isEmpty), (List::size), (List::at), (List::operator[]),
		(List::empty), (Completion::Completion), (Completion::~Completion),
		(Completion::operator=), (Completion::dynamicCast), (Completion::complType),
		(Completion::value), (Completion::target), (Completion::isValueCompletion):
		* src/kdelibs/kjs/types.h:
		* src/kdelibs/kjs/ustring.cpp: (UChar::UChar), (UChar::toLower),
		(UChar::toUpper), (UString::from), (UString::ascii), (UString::operator=),
		(UString::is8Bit), (UString::toDouble), (KJS::operator==):
		* src/kdelibs/kjs/ustring.h:

2002-03-19  Richard Williamson  <rjw@apple.com>

        Fixed NSPopupButton performance bottleneck.
        
	* src/kdelibs/khtml/rendering/render_form.cpp: (RenderSelect::layout):
	* src/kwq/KWQComboBox.mm: (QComboBox::insertItem):
	* src/kwq/KWQKComboBox.mm: (KComboBox::~KComboBox), (KComboBox::doneLoading),
	(KComboBox::setSize):
	* src/kwq/kdeui/kcombobox.h:
	* src/kwq/qt/qcombobox.h:

2002-03-19  Richard Williamson  <rjw@apple.com>
    
        Changed float width cache to use shorts.

	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutInfo _initializeCaches]),
	(_rectForString):
	* src/kwq/KWQMetrics.h:

2002-03-19  Richard Williamson  <rjw@apple.com>

        Improved cache-miss case for non-latin1 characters.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutInfo initWithFont:]), (-[KWQLayoutInfo
	layoutManager]), (-[KWQLayoutInfo textStorage]), (-[KWQLayoutInfo
	_initializeCaches]), (_rectForString), (-[KWQLayoutInfo setColor:]),
	(-[KWQLayoutInfo attributes]), (-[KWQLayoutInfo dealloc]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/kwqdebug.h:

2002-03-18  Darin Adler  <darin@apple.com>

	* src/kwq/KWQListImpl.mm: (KWQListImpl::sort): Use insertion sort for
	small lists. Also special case for lists of size 2 and under.

2002-03-18  Richard Williamson  <rjw@apple.com>

        Added comments about new layout scheme.  Cleaned up code.
        Improved core measurement routine.

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::boundingRect):
	* src/kwq/kwqdebug.h:

2002-03-18  Darin Adler  <darin@apple.com>

	* src/kwq/KWQString.mm: (QString::latin1): Handle null case properly.
	We must return "", not 0.

2002-03-18  Darin Adler  <darin@apple.com>

        Redo inlining of QChar and QString and some other small speed improvements.
        Sadly, this doesn't seem to make things measurably faster, but I decided to
        commit my work rather than discarding it; it doesn't make things slower.

	* src/kwq/qt/qstring.h:
	* src/kwq/KWQChar.mm:
	* src/kwq/KWQString.mm:
        Do a lot more inlining. Also, the CFStringRef inside a QString is now never
        nil, so we can get rid of many checks for nil.

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::width): Use _rectForString() a
        couple more places.

2002-03-18  Richard Williamson  <rjw@apple.com>

        Changed to use non direct _rectForString() function.   Avoids
        unnecessary NSString allocation.
        
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::boundingRect):

2002-03-18  Darin Adler  <darin@apple.com>

	* src/kwq/KWQFontMetrics.mm: (QFontMetricsPrivate::getInfo),
	(QFontMetrics::width), (QFontMetrics::_width), (QFontMetrics::boundingRect),
	(QFontMetrics::size): Don't make the info object right away, in case the
	metrics object is only used to compute ascent and descent.

2002-03-17  Richard Williamson  <rjw@apple.com>

        Implementation of replacement code for NSLayoutManager.  Huge
        performance gains.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::calcMinMaxWidth),
	(RenderText::width):
	* src/kwq/KWQFontMetrics.mm: (ROUND_TO_INT), (__IFInitATSGlyphVector),
	(__IFResetATSGlyphVector), (__IFFillStyleWithAttributes), (-[KWQLayoutInfo
	drawString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	drawString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	initWithFont:]), (-[KWQLayoutInfo _initializeCaches]), (_rectForString),
	(-[KWQLayoutInfo rectForString:]), (-[KWQLayoutInfo attributes]),
	(-[KWQLayoutInfo lineHeight]), (-[KWQLayoutInfo font]), (-[KWQLayoutInfo
	dealloc]), (QFontMetrics::_width):
	* src/kwq/KWQMetrics.h:
	* src/kwq/Makefile.am:
	* src/kwq/qt/qfontmetrics.h:

2002-03-16  Richard Williamson  <rjw@apple.com>

        Fixed error handling.  Removed ObjC code for url handle client from KHTMLPart.
        Need to sanitize KHTMLPart further.
        
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::closeURL),
	(KHTMLPart::requestFrameName), (KHTMLPart::requestFrame), (KHTMLPart::overURL):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidCancelLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):
	* src/kwq/external.h:

2002-03-15  Richard Williamson  <rjw@apple.com>

        Fixed crasher initializing items in popup button.
        Increased fragment cache initial size.
        
	* src/kwq/KWQComboBox.mm: (QComboBox::init), (QComboBox::~QComboBox),
	(QComboBox::insertItem):
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage _buildFragmentForString:]):
	* src/kwq/qt/qcombobox.h:

2002-03-15  Richard Williamson  <rjw@apple.com>

        More string usage optimizations.  Got another 10% or so.
        
	* src/kdelibs/khtml/css/cssstyleselector.cpp: (checkPseudoState),
	(khtml::applyRule):
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::calcMinMaxWidth),
	(RenderText::width):

2002-03-15  Darin Adler  <darin@apple.com>

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::descent): Oops, removed a - sign
	that I should have left in there.

2002-03-15  Darin Adler  <darin@apple.com>

	Some more optimizations. Carves another 6% or so off of NSView.html.

	* src/kwq/KWQChar.mm: (QChar::QChar): Handle characters > 0x7F correctly.
	(QChar::cell): Remove unnecessary & operation.
	(QChar::row): Remove unnecessary & operation.
	(QChar::latin1): Do a simpler check rather than calling row().
	(QChar::operator char): Do the same work as latin1 inline.
	(operator==) (operator!=), (operator>=), (operator>), (operator<=), (operator<):
	Handle characters > 0x7F correctly.

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::ascent), (QFontMetrics::descent):
	Cache the ascent and descent rather than computing it each time we are called.

2002-03-15  Darin Adler  <darin@apple.com>

	Optimizations for creating empty QFont objects, measuring certain single
	characters, and copying QFontMetrics objects. Makes loading NSView.html about
	18% faster.

	* src/kwq/qt/qfontmetrics.h: Use a ref-counted pointer so QFontMetrics objects
	for the same QFont can share data.

	* src/kwq/KWQFont.mm: (loadDefaultFont): New, used to load the default
	font used for default-initialized QFont objects.
	(QFont::_initializeWithFont): Don't recompute the family name, point size, or
	traits.
	(QFont::setFamily), (QFont::setPixelSizeFloat), (QFont::setWeight),
	(QFont::setItalic): autorelease the font, as we do in the destructor, since
	someone could still be using the result of getFont.
	(QFont::operator==): Add a comment about a problem with this function.

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::QFontMetrics): Add a refCount, and
	a cached width for space and lower-case "x", the two single characters that
	are often measured.
	(QFontMetrics::~QFontMetrics): Simplify.
	(QFontMetrics::operator=): Just copy the underlying data pointer rather than
	making our own KWQLayoutInfo object.
	(QFontMetrics::baselineOffset): Make const.
	(QFontMetrics::width): Add the caching for space and "x".

2002-03-15  Richard Williamson  <rjw@apple.com>

        Optimizations that remove unnecessary cfstring allocations of local scope
        strings.  QString::gstring_toQString and QString::gstring_toCFString were
        added to simplify the reuse of a static CFString as the backing store for
        local QStrings.  Hit the top two problem areas.  Many more gains to be had
        by using this technique.
        
	* src/kdelibs/khtml/css/cssstyleselector.cpp:
	(CSSStyleSelector::checkOneSelector):
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::calcMinMaxWidth):
	* src/kwq/KWQString.mm: (QString::gstring_toQString),
	(QString::gstring_toCFString):
	* src/kwq/qt/qstring.h:

2002-03-14  Richard Williamson  <rjw@apple.com>

        Fixed another problem in QString::find().
        Added dangerous but fast string allocation optimization to render_text.cpp.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::calcMinMaxWidth):
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::_width):
	* src/kwq/KWQString.mm: (QString::find):
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage _buildFragmentForString:]),
	(-[KWQTextStorage setString:]):
	* src/kwq/qt/qfontmetrics.h:

2002-03-14  Richard Williamson  <rjw@apple.com>

        Fixed optimized find() implementation.  I had the sense of caseSensitive inverted.
        
	* src/kwq/KWQString.mm: (QString::find):

2002-03-14  Richard Williamson  <rjw@apple.com>

        Attempted implementation of space optimizations.  Disabled for now.
        
	* src/kwq/KWQFontMetrics.mm: (+[KWQLayoutInfo _dumpLayoutCache:]),
	(-[KWQLayoutInfo rectForString:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQTextStorage.h:
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage _buildFragmentForString:]),
	(-[KWQTextStorage getFragmentForString:]), (-[KWQTextStorage
	initWithFontAttribute:]), (-[KWQTextStorage addLayoutManager:]):

2002-03-14  Richard Williamson  <rjw@apple.com>

        Implemented a progressively cache fragment.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQSmallLayoutFragment setGlyphRange:]),
	(-[KWQSmallLayoutFragment setBoundingRect:]), (-[KWQSmallLayoutFragment
	boundingRect]), (-[KWQLargeLayoutFragment glyphRange]), (-[KWQLargeLayoutFragment
	setGlyphRange:]), (-[KWQLargeLayoutFragment setBoundingRect:]),
	(-[KWQLargeLayoutFragment boundingRect]), (-[KWQLargeLayoutFragment compare:]),
	(+[KWQLayoutInfo drawString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	_dumpLayoutCache:]), (-[KWQLayoutInfo rectForString:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQTextStorage.h:
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage getFragmentForString:]),
	(-[KWQTextStorage addFragmentForString:]):

2002-03-13  Richard Williamson  <rjw@apple.com>

        Added font cache.  Attempted to reduce size of fragment cache, but
        malloc forces a minimum of 30 bytes for our 14 byte objects.
        
	* src/kwq/KWQFont.mm: (-[IFFontCacheKey dealloc]), (-[IFFontCacheKey
	copyWithZone:]), (-[IFFontCacheKey hash]), (-[IFFontCacheKey string]),
	(-[IFFontCacheKey isEqual:]), (QFont::getFont):
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutFragment setGlyphRangeLength:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage addFragmentForString:]):

2002-03-13  Richard Williamson  <rjw@apple.com>

        Re-worked fragment cache to minimize memory usage.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutFragment glyphRange]),
	(-[KWQLayoutFragment setGlyphRangeLength:]), (-[KWQLayoutFragment
	setBoundingRectSize:]), (-[KWQLayoutFragment boundingRect]), (+[KWQLayoutInfo
	drawString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	initWithFont:]), (-[KWQLayoutInfo layoutManager]), (-[KWQLayoutInfo
	textStorage]), (-[KWQLayoutInfo rectForString:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQTextStorage.h:
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage getFragmentForString:]),
	(-[KWQTextStorage addFragmentForString:]), (-[KWQTextStorage
	initWithFontAttribute:]), (-[KWQTextStorage dealloc]), (-[KWQTextStorage
	length]), (-[KWQTextStorage setAttributes:]), (-[KWQTextStorage setString:]),
	(-[KWQTextStorage string]):

2002-03-13  Kenneth Kocienda  <kocienda@apple.com>

	Updated for new didRedirectToURL callback. This is a partial fix for this bug:
	Radar 2879234 (Redirected URLs not used for subsequent GETs)

	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandle:didRedirectToURL:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandle:didRedirectToURL:]):

2002-03-12  Richard Williamson  <rjw@apple.com>

	* src/kwq/KWQString.mm: (QString::find), (QString::contains),
	(QString::compareToLatin1):

2002-03-11  Richard Williamson  <rjw@apple.com>

Re-implemented QPainter::drawTiledPixmap to use core graphics patterns.  Currently this depends
on SPI.  The performance boost is huge osx.macnn.com draws 40x faster now.

	* src/kwq/KWQPainter.mm: (QPainter::drawTiledPixmap):

2002-03-08  Richard Williamson  <rjw@apple.com>

Re-implemented KWQFont to lazily request font from NSFontManager instead of
user converFont:.  I did this after sampling loads of http://www.apple.com/retail/theater
and found that converting fonts was very expensive.

	* src/kwq/KWQFont.mm: (QFont::defaultNSFont), (QFont::_initializeWithFont),
	(QFont::QFont), (QFont::_free), (QFont::getFont), (QFont::pixelSize),
	(QFont::family), (QFont::setFamily), (QFont::setPixelSizeFloat),
	(QFont::setWeight), (QFont::weight), (QFont::setItalic), (QFont::italic),
	(QFont::bold), (QFont::operator!=):
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::QFontMetrics):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::requestFrame):
	* src/kwq/KWQPainter.mm: (QPainter::drawText), (QPainter::drawUnderlineForText):
	* src/kwq/qt/qfont.h:

2002-03-08  Richard Williamson  <rjw@apple.com>

        Instrumentation of the text fragment metrics cache.
        Added _FAST_QSTRING_TO_NSSTRING.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutFragment initWithString:attributes:]),
	(-[KWQLayoutFragment boundingRect]), (-[KWQLayoutFragment compare:]),
	(+[KWQLayoutInfo _dumpLayoutCache:]), (+[KWQLayoutInfo _dumpAllLayoutCaches]),
	(-[KWQLayoutInfo rectForString:]), (QFontMetrics::width),
	(QFontMetrics::boundingRect), (QFontMetrics::size):
	* src/kwq/KWQMetrics.h:
	* src/kwq/qt/qstring.h:

2002-03-08  John Sullivan  <sullivan@apple.com>

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::end):
	Changed openURL() and end() messages to use debug levels. You
	can see these by setting your WebKitLogLevel mask to include 
	0x00000008

2002-03-07  John Sullivan  <sullivan@apple.com>

	* src/kwq/kwqdebug.h: New debug level constants, kept in
	synch with WebKitDebug.h

	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandleResourceDidBeginLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidCancelLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidBeginLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidCancelLoading:]), (-[URLLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]), (Loader::load),
	(Loader::servePendingRequests):
	* src/kwq/KWQView.mm: (-[KWQHTMLView layout]), (-[KWQHTMLView drawRect:]):
	Changed numeric debug levels to symbolic ones.

2002-03-07  Don Melton  <gramps@apple.com>

	Removed unused file in kdelibs that I missed in previous commit.

	* src/kdelibs/khtml/test/layout.html:

2002-03-06  Don Melton  <gramps@apple.com>

	Removed unused files in kdelibs.

	* src/kdelibs/AUTHORS:
	* src/kdelibs/README:
	* src/kdelibs/khtml/CHANGES:
	* src/kdelibs/khtml/DESIGN.html:
	* src/kdelibs/khtml/README.HTMLWidget:
	* src/kdelibs/khtml/README.tags:
	* src/kdelibs/khtml/SECURITY:
	* src/kdelibs/khtml/TODO:
	* src/kdelibs/khtml/design.h:
	* src/kdelibs/khtml/domtreeview.cpp:
	* src/kdelibs/khtml/domtreeview.h:
	* src/kdelibs/khtml/ecma/AUTHORS:
	* src/kdelibs/khtml/ecma/README:
	* src/kdelibs/khtml/ecma/THANKS:
	* src/kdelibs/khtml/ecma/TODO:
	* src/kdelibs/khtml/ecma/jsk.html:
	* src/kdelibs/khtml/ecma/testecma.cpp:
	* src/kdelibs/khtml/html/dtd.dtd:
	* src/kdelibs/khtml/java/KJAS_GRAMMAR.txt:
	* src/kdelibs/khtml/java/README:
	* src/kdelibs/khtml/java/TODO:
	* src/kdelibs/khtml/java/build.xml:
	* src/kdelibs/khtml/java/javaembed.cpp:
	* src/kdelibs/khtml/java/kjava.jar:
	* src/kdelibs/khtml/java/kjava.policy.in:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASAppletClassLoader.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASAppletContext.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASAppletStub.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASConsole.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASProtocolHandler.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASSecurityManager.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASSoundPlayer.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/Main.java:
	* src/kdelibs/khtml/java/tests/badapplets/BadApplet.jar:
	* src/kdelibs/khtml/java/tests/badapplets/BadApplet.java:
	* src/kdelibs/khtml/java/tests/badapplets/applet.html:
	* src/kdelibs/khtml/java/tests/good_sites:
	* src/kdelibs/khtml/java/tests/testkjavaappletserver.cpp:
	* src/kdelibs/khtml/khtml.desktop:
	* src/kdelibs/khtml/khtml.rc:
	* src/kdelibs/khtml/khtml_browser.rc:
	* src/kdelibs/khtml/khtml_ext.cpp:
	* src/kdelibs/khtml/khtml_factory.cpp:
	* src/kdelibs/khtml/khtml_find.cpp:
	* src/kdelibs/khtml/khtml_find.h:
	* src/kdelibs/khtml/khtml_pagecache.cpp:
	* src/kdelibs/khtml/khtml_pagecache.h:
	* src/kdelibs/khtml/khtml_part.cpp:
	* src/kdelibs/khtml/khtml_popupmenu.rc:
	* src/kdelibs/khtml/khtml_run.cpp:
	* src/kdelibs/khtml/khtml_run.h:
	* src/kdelibs/khtml/khtmldefaults.h:
	* src/kdelibs/khtml/khtmlimage.cpp:
	* src/kdelibs/khtml/khtmlimage.desktop:
	* src/kdelibs/khtml/khtmlimage.h:
	* src/kdelibs/khtml/pics/hi16-action-images_display.png:
	* src/kdelibs/khtml/pics/hi22-action-images_display.png:
	* src/kdelibs/khtml/pics/hi32-action-images_display.png:
	* src/kdelibs/khtml/test/README:
	* src/kdelibs/khtml/test/URL1.html:
	* src/kdelibs/khtml/test/URL2.html:
	* src/kdelibs/khtml/test/align.html:
	* src/kdelibs/khtml/test/align1.html:
	* src/kdelibs/khtml/test/align2.html:
	* src/kdelibs/khtml/test/anchor1.html:
	* src/kdelibs/khtml/test/anchor2.html:
	* src/kdelibs/khtml/test/badpages.html:
	* src/kdelibs/khtml/test/buggy.html:
	* src/kdelibs/khtml/test/button.html:
	* src/kdelibs/khtml/test/color.html:
	* src/kdelibs/khtml/test/fixed-background.html:
	* src/kdelibs/khtml/test/image.gif:
	* src/kdelibs/khtml/test/image_map.html:
	* src/kdelibs/khtml/test/index.html:
	* src/kdelibs/khtml/test/java.html:
	* src/kdelibs/khtml/test/javascript.html:
	* src/kdelibs/khtml/test/jsplugins.html:
	* src/kdelibs/khtml/test/konqi.gif:
	* src/kdelibs/khtml/test/lake.class:
	* src/kdelibs/khtml/test/listing.html:
	* src/kdelibs/khtml/test/lists.html:
	* src/kdelibs/khtml/test/nav_bar.gif:
	* src/kdelibs/khtml/test/nbsp.html:
	* src/kdelibs/khtml/test/notitle.html:
	* src/kdelibs/khtml/test/object.html:
	* src/kdelibs/khtml/test/pseudo.html:
	* src/kdelibs/khtml/test/renders.html:
	* src/kdelibs/khtml/test/supsub.html:
	* src/kdelibs/khtml/test/testpages.html:
	* src/kdelibs/khtml/test/textarea.html:
	* src/kdelibs/khtml/test/title.html:
	* src/kdelibs/khtml/testcss.cpp:
	* src/kdelibs/khtml/testkhtml.cpp:
	* src/kdelibs/khtml/testkhtml.h:
	* src/kdelibs/khtml/testrender.cpp:
	* src/kdelibs/khtml/testrender.h:
	* src/kdelibs/kjs/README:
	* src/kdelibs/kjs/THANKS:
	* src/kdelibs/kjs/create_hash_table:
	* src/kdelibs/kjs/keywords.table:

2002-03-06  Don Melton  <gramps@apple.com>

	Cleaned up all our changes to kdelibs, removed bitrot, and replaced use
	of _KWQ_ with new APPLE_CHANGES define.

	* src/kdelibs/khtml/css/csshelper.cpp: (khtml::computeLengthFloat),
	(khtml::setFontSize):
	* src/kdelibs/khtml/css/cssstyleselector.cpp:
	(CSSStyleSelector::CSSStyleSelector), (khtml::applyRule):
	* src/kdelibs/khtml/dom/dom_misc.cpp:
	* src/kdelibs/khtml/dom/dom_misc.h:
	* src/kdelibs/khtml/dom/html_document.cpp: (HTMLDocument::cookie),
	(HTMLDocument::setCookie):
	* src/kdelibs/khtml/dom/html_element.cpp:
	* src/kdelibs/khtml/ecma/kjs_binding.h:
	* src/kdelibs/khtml/ecma/kjs_css.cpp: (DOMCSSStyleDeclarationFunc::tryExecute),
	(DOMStyleSheetListFunc::tryExecute), (DOMMediaListFunc::tryExecute),
	(DOMCSSStyleSheetFunc::tryExecute), (DOMCSSRuleListFunc::tryExecute),
	(DOMCSSRuleFunc::tryExecute), (DOMCSSPrimitiveValueFunc::tryExecute),
	(DOMCSSValueListFunc::tryExecute):
	* src/kdelibs/khtml/ecma/kjs_css.h:
	* src/kdelibs/khtml/ecma/kjs_dom.cpp: (DOMNodeFunc::tryExecute),
	(DOMNodeListFunc::tryExecute), (DOMDocFunction::DOMDocFunction),
	(DOMDocFunction::tryExecute), (DOMElementFunction::DOMElementFunction),
	(DOMElementFunction::tryExecute),
	(DOMDOMImplementationFunction::DOMDOMImplementationFunction),
	(DOMDOMImplementationFunction::tryExecute),
	(DOMNamedNodeMapFunction::DOMNamedNodeMapFunction),
	(DOMNamedNodeMapFunction::tryExecute):
	* src/kdelibs/khtml/ecma/kjs_dom.h:
	* src/kdelibs/khtml/ecma/kjs_window.cpp: (Window::isSafeScript):
	* src/kdelibs/khtml/html/html_formimpl.cpp: (HTMLFormElementImpl::formData),
	(HTMLSelectElementImpl::state), (HTMLSelectElementImpl::restoreState):
	* src/kdelibs/khtml/html/html_headimpl.cpp: (HTMLLinkElementImpl::detach),
	(HTMLStyleElementImpl::detach), (HTMLTitleElementImpl::setTitle):
	* src/kdelibs/khtml/html/html_objectimpl.cpp:
	(HTMLEmbedElementImpl::parseAttribute):
	* src/kdelibs/khtml/html/html_tableimpl.cpp:
	(HTMLTableElementImpl::parseAttribute),
	(HTMLTablePartElementImpl::parseAttribute):
	* src/kdelibs/khtml/html/htmlparser.cpp: (KHTMLParser::parseToken),
	(KHTMLParser::insertNode), (KHTMLParser::getElement),
	(KHTMLParser::processCloseTag), (KHTMLParser::popBlock),
	(KHTMLParser::popOneBlock):
	* src/kdelibs/khtml/html/htmltokenizer.cpp: (HTMLTokenizer::parseSpecial),
	(HTMLTokenizer::scriptHandler), (HTMLTokenizer::parseComment),
	(HTMLTokenizer::parseTag), (HTMLTokenizer::processToken):
	* src/kdelibs/khtml/html/htmltokenizer.h:
	* src/kdelibs/khtml/java/kjavaprocess.h:
	* src/kdelibs/khtml/khtml_part.h:
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::~KHTMLView), (KHTMLView::init),
	(printRenderTree), (KHTMLView::drawContents), (KHTMLView::layout),
	(KHTMLView::viewportMousePressEvent), (KHTMLView::viewportMouseDoubleClickEvent),
	(KHTMLView::viewportMouseMoveEvent), (KHTMLView::viewportMouseReleaseEvent),
	(KHTMLView::addFormCompletionItem):
	* src/kdelibs/khtml/khtmlview.h:
	* src/kdelibs/khtml/misc/decoder.cpp: (Decoder::setEncoding), (Decoder::decode):
	* src/kdelibs/khtml/misc/helper.cpp: (khtml::setNamedColor):
	* src/kdelibs/khtml/misc/loader.h:
	* src/kdelibs/khtml/rendering/bidi.cpp: (RenderFlow::layoutInlineChildren):
	* src/kdelibs/khtml/rendering/render_applet.cpp: (RenderApplet::RenderApplet):
	* src/kdelibs/khtml/rendering/render_body.cpp: (RenderBody::layout):
	* src/kdelibs/khtml/rendering/render_box.cpp: (RenderBox::printBackground):
	* src/kdelibs/khtml/rendering/render_flow.cpp: (RenderFlow::print):
	* src/kdelibs/khtml/rendering/render_form.cpp:
	(RenderFormElement::baselinePosition), (RenderFormElement::slotClicked),
	(RenderCheckBox::RenderCheckBox), (RenderCheckBox::performAction),
	(RenderRadioButton::RenderRadioButton), (RenderRadioButton::slotClicked),
	(RenderSubmitButton::RenderSubmitButton), (RenderSubmitButton::baselinePosition),
	(RenderLineEdit::RenderLineEdit), (RenderLineEdit::calcMinMaxWidth),
	(RenderLineEdit::performAction), (RenderFileButton::RenderFileButton),
	(RenderSelect::RenderSelect), (RenderSelect::layout),
	(RenderSelect::createListBox), (RenderSelect::createComboBox),
	(RenderTextArea::RenderTextArea), (RenderTextArea::calcMinMaxWidth),
	(RenderTextArea::layout):
	* src/kdelibs/khtml/rendering/render_form.h:
	* src/kdelibs/khtml/rendering/render_frames.cpp:
	(RenderPartObject::updateWidget):
	* src/kdelibs/khtml/rendering/render_hr.cpp: (RenderHR::print):
	* src/kdelibs/khtml/rendering/render_image.cpp: (RenderImage::printObject):
	* src/kdelibs/khtml/rendering/render_list.cpp: (RenderListMarker::printObject):
	* src/kdelibs/khtml/rendering/render_style.h:
	* src/kdelibs/khtml/rendering/render_table.cpp: (RenderTable::calcFinalColMax),
	(RenderTable::layoutRows):
	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration),
	(TextSlaveArray::findFirstMatching), (RenderText::print):
	* src/kdelibs/khtml/xml/dom_docimpl.cpp: (DocumentImpl::recalcStyle):
	* src/kdelibs/khtml/xml/dom_nodeimpl.cpp: (NodeImpl::renderer):
	* src/kdelibs/khtml/xml/dom_nodeimpl.h:
	* src/kdelibs/khtml/xml/dom_stringimpl.cpp: (DOMStringImpl::toLengthList):

2002-03-06  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQKURL.mm: (KURL::KURL): If resolving a relative URL
	fails, assume it's absolute and possibly malformed, rather than
	appending it to the path of the previous URL. This fixes a
	CPU-spinning hang that John and Richard found.

2002-03-05  Richard Williamson  <rjw@apple.com>

        Pass errors correctly to browser.
        Removed old notification code.
        Added support for IFError.
        Lots of little cleanups.
        
	* src/kwq/KWQComboBox.mm: (QComboBox::setCurrentItem):
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandleResourceDidBeginLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidCancelLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]), (KHTMLPart::openURL),
	(KHTMLPart::closeURL):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):
	* src/kwq/WCError.h:
	* src/kwq/WCWebDataSource.h:
	* src/kwq/external.h:

2002-03-05  Richard Williamson  <rjw@apple.com>

        With fonts now being correctly specified we're exercising some new code paths.  This introduced a new
        class of weird string bugs.  Turns out that CFString is doing some mojo that I suspect is a performance
        optimization.  Constants strings appears to be uniqued and hard-wired to have a -1 retain count.  It
        looks like strings created by preferences are uniqued in this manner.  This plays havoc with our
        copy-on-write QString implementation.  The following GDB exercise illustrates the problem:
        
        (gdb) po (id)[(id)[NSUserDefaults standardUserDefaults] objectForKey:(id)[NSString stringWithCString: "WebKitFixedFont"]]
        Andale Mono
        (gdb) p (int)[(id)[(id)[NSUserDefaults standardUserDefaults] objectForKey:(id)[NSString stringWithCString: "WebKitFixedFont"]] retainCount]
        $28 = -1
        (gdb) p (id)[(id)[NSUserDefaults standardUserDefaults] objectForKey:(id)[NSString stringWithCString: "WebKitFixedFont"]]
        $27 = (objc_object *) 0x40172a4
        (gdb) p (void)[$27 retain]
        $29 = void
        (gdb) p (int)[$27 retainCount]
        $30 = -1
        (gdb) p (void)[$27 release]
        $33 = void
        (gdb) p (int)[$27 retainCount]
        $32 = -1
        
        So, it appears that these strings are permanently allocated.  It'd be interesting to find out what is in the uniqued string cache, and how big it is.
        
        I've fixed the problem by special casing our copy-on-write trigger to also check for -1.

	* src/kwq/KWQString.mm: (QString::_copyIfNeededInternalString):

2002-03-04  Richard Williamson  <rjw@apple.com>
 
        Changes to support 'provisional' data sources.
        API changes to IFBaseWebController, removed redundant methods.
 
	* src/kwq/KWQKHTMLPart.mm: (WCSetIFWebDataSourceMakeFunc), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidBeginLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidCancelLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]),
	(KHTMLPart::khtmlMouseReleaseEvent), (KHTMLPart::submitForm),
	(KHTMLPart::requestFrame):
	* src/kwq/external.h:

2002-02-28  Richard Williamson  <rjw@apple.com>

        Finished up progress notification for main document.  
        Made the IFLoadProgress allocator accessible to KHTMLPart.mm.
        
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	setDataSource:]), (KHTMLPart::openURL):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]):
	* src/kwq/WCLoadProgress.h:

2002-02-27  Kenneth Kocienda  <kocienda@apple.com>

	I have changed the way that WebCore is glued to WebFoundation and WebKit. 
	If you used or relied upon any code in the following files, you should 
	now use the IF* equivalents straight up. 

	- Labyrinth/WebCore/include/WCBackForwardList.h
	- Labyrinth/WebCore/include/WCURICache.h
	- Labyrinth/WebCore/include/WCURICacheData.h
	- Labyrinth/WebCore/include/WCURIEntry.h
	- Labyrinth/WebCore/include/WCURIEntry.h

	All changes in this commit are related to making dependant code work with the new convention.

	* include/WCBackForwardList.h:
	* include/WCURICache.h:
	* include/WCURICacheData.h:
	* include/WCURIEntry.h:
	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandleResourceDidBeginLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidCancelLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]), (KHTMLPart::slotData),
	(KHTMLPart::openURL):
	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidBeginLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidCancelLoading:]), (-[URLLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):
	* src/kwq/Makefile.am:
	* src/kwq/kio/jobclasses.h:

2002-02-27  Maciej Stachowiak  <mjs@apple.com>

	Replace QDir and QFile with clean-room implementations. Add glob
	support ot QRegExp reimplementation.

	* src/kwq/KWQDir.mm: (QDir::KWQDirPrivate::KWQDirPrivate),
	(QDir::KWQDirPrivate::~KWQDirPrivate), (QDir::QDir), (QDir::~QDir),
	(QDir::absPath), (QDir::absFilePath), (QDir::cdUp), (QDir::exists),
	(QDir::entryList), (QDir::operator=), (QDir::swap):
	* src/kwq/KWQFile.mm: (QFile::KWQFilePrivate::KWQFilePrivate),
	(QFile::KWQFilePrivate::~KWQFilePrivate), (QFile::QFile), (QFile::~QFile),
	(QFile::exists), (QFile::open), (QFile::close), (QFile::readBlock),
	(QFile::size):
	* src/kwq/KWQRegExp.mm: (QRegExp::KWQRegExpPrivate::KWQRegExpPrivate),
	(RegExpFromGlob), (QRegExp::KWQRegExpPrivate::compile), (QRegExp::QRegExp):
	* src/kwq/KWQStrList.h:
	* src/kwq/Makefile.am:
	* src/kwq/qt/_qdir.h:
	* src/kwq/qt/_qfile.h:
	* src/kwq/qt/_qfileinfo.h:
	* src/kwq/qt/qdir.h:
	* src/kwq/qt/qfile.h:
	* src/kwq/qt/qiodevice.h:
	* src/kwq/qt/qregexp.h:

2002-02-25  Maciej Stachowiak  <mjs@apple.com>

	Fix two significant memory leaks in QList found by our automated
	leak-checking code.

	* src/kwq/KWQListImpl.mm: (KWQListNode::~KWQListNode),
	(KWQListImpl::KWQListPrivate::copyList),
	(KWQListImpl::KWQListPrivate::~KWQListPrivate), (KWQListImpl::sort):

	Fix a tiny bug tweaked by the new regexp code - we need to flush
	the cache after calling out to QRegExp::match because it might
	make calls on the string which create a cache. Caught by the
	regression tests.
	
	* src/kwq/KWQString.mm: (QString::replace): 
	
2002-02-24  Maciej Stachowiak  <mjs@apple.com>

	Reimplemented QRegExp in terms of POSIX regexp facilities. This
	will only support Latin1, however, it won't support all languages.
	
	* src/kwq/qt/qregexp.h:
	* src/kwq/KWQRegExp.mm: (QRegExp::KWQRegExpPrivate::KWQRegExpPrivate),
	(QRegExp::KWQRegExpPrivate::compile),
	(QRegExp::KWQRegExpPrivate::~KWQRegExpPrivate), (QRegExp::QRegExp),
	(QRegExp::~QRegExp), (QRegExp::operator=), (QRegExp::pattern), (QRegExp::match):

	Reimplement QValueList as a doubly-linked list, using a generic
	implementation class and a templatized facade.
	
	* src/kwq/qt/qvaluelist.h:
	* src/kwq/KWQValueListImpl.h:
	* src/kwq/KWQValueListImpl.mm: (KWQValueListNodeImpl::KWQValueListNodeImpl),
	(KWQValueListNodeImpl::~KWQValueListNodeImpl),
	(KWQValueListIteratorImpl::KWQValueListIteratorImpl),
	(KWQValueListIteratorImpl::~KWQValueListIteratorImpl),
	(KWQValueListIteratorImpl::operator=), (KWQValueListIteratorImpl::operator==),
	(KWQValueListIteratorImpl::operator!=), (KWQValueListIteratorImpl::node),
	(KWQValueListIteratorImpl::operator++), (KWQValueListIteratorImpl::operator--),
	(KWQValueListImpl::KWQValueListPrivate::KWQValueListPrivate),
	(KWQValueListImpl::KWQValueListPrivate::~KWQValueListPrivate),
	(KWQValueListImpl::KWQValueListPrivate::copyList),
	(KWQValueListImpl::KWQValueListPrivate::deleteList),
	(KWQValueListImpl::KWQValueListImpl), (KWQValueListImpl::~KWQValueListImpl),
	(KWQValueListImpl::clear), (KWQValueListImpl::count),
	(KWQValueListImpl::isEmpty), (KWQValueListImpl::appendNode),
	(KWQValueListImpl::prependNode), (KWQValueListImpl::removeEqualNodes),
	(KWQValueListImpl::containsEqualNodes), (KWQValueListImpl::removeIterator),
	(KWQValueListImpl::fromLast), (KWQValueListImpl::firstNode),
	(KWQValueListImpl::lastNode), (KWQValueListImpl::begin), (KWQValueListImpl::end),
	(KWQValueListImpl::nodeAt), (KWQValueListImpl::operator=),
	(KWQValueListImpl::copyOnWrite):
	* src/kwq/Makefile.am:

	* src/kwq/kio/netaccess.h: Don't declare private copy constructor
	- this class needs to be copyable to be stored in a QValueList!

	Hack these scripts a bit so the large tables they generate are
	constant data.
	
	* src/kwq/make-charset-table.pl:
	* src/kdelibs/khtml/css/makeprop:
	* src/kdelibs/khtml/css/makevalues:
	* src/kdelibs/khtml/misc/makeattrs:
	* src/kdelibs/khtml/misc/maketags:

2002-02-23  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/WCLoadProgress.h: Add the forgotten WCLoadProgress.h.

2002-02-22  Maciej Stachowiak  <mjs@apple.com>

	Fix prebinding:

	* src/Makefile.am: Enable prebinding, set first segment address to
	0x2200000 to avoid colliding with apps or our other
	frameworks. Change other link flags to support prebinding.

	Set up some hacks to avoid link-time dependency on
	WebKit. Prebinding is incompatible with - undefined suppress, so
	we can't have WebCore depend on symbols provided by WebKit any
	more:
	
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKloader.mm: (WCSetIFLoadProgressMakeFunc), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:data:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]):
	* src/kwq/WCPluginWidget.h:
	* src/kwq/WCPluginWidget.mm: (WCSetIFPluginMakeFunc),
	(WCPluginWidget::WCPluginWidget):

2002-02-22  Richard Williamson  <rjw@apple.com>

        Added data: to IFURLHandleResourceDidFinishLoading:
        
	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandleResourceDidFinishLoading:data:userData:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:data:userData:]):

2002-02-22  Kenneth Kocienda  <kocienda@apple.com>

	Sent handle an autorelease message.

	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]):

2002-02-21  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQString.mm: (QString::fill): Fix a bug that was
	triggering assertion failures in CF.
	
	* src/kdelibs/kjs/kjs-test: Turn off some environment variables to
	make the tests pass.

2002-02-21  Richard Williamson  <rjw@apple.com>

    Stop mostly working.
    
	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]),
	(Loader::servePendingRequests):
	* src/kwq/kio/jobclasses.h:

2002-02-21  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQString.mm: (QString::fromCFString): Don't pass a
	length to CFStringCreateMutableCopy, since that makes the string
	fixed-length, which makes assertions fail when in debugging mode.

2002-02-20  Richard Williamson  <rjw@apple.com>

    Some groundwork to bring WebFoundation callbacks up to 
    WebKit.
    
	* src/kdelibs/khtml/misc/loader.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandleResourceDidBeginLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]), (-[KHTMLPartLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]), (KHTMLPart::openURL),
	(KHTMLPart::closeURL), (KHTMLPart::write), (KHTMLPart::checkCompleted):
	* src/kwq/KWQKloader.mm: (CachedCSSStyleSheet::CachedCSSStyleSheet),
	(CachedScript::CachedScript), (CachedImage::CachedImage), (-[URLLoadClient
	initWithLoader:dataSource:]), (-[URLLoadClient
	WCURLHandleResourceDidBeginLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]), (Loader::load),
	(Loader::servePendingRequests), (Cache::requestImage),
	(Cache::requestStyleSheet), (Cache::requestScript):
	* src/kwq/kio/jobclasses.h:

2002-02-20  Maciej Stachowiak  <mjs@apple.com>

	* src/kdelibs/kjs/kjs-test:
	* src/kwq/KWQKURL.mm: (KURL::setQuery):

2002-02-18  Kenneth Kocienda  <kocienda@apple.com>

	* src/Makefile.am:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseMoveEvent):
	* src/kwq/KWQView.mm: (-[KWQHTMLView mouseUp:]), (-[KWQHTMLView mouseDown:]):
	* src/kwq/kde/_kurl.cpp: (KURL::htmlRef):

2002-02-18  Richard Williamson  <rjw@apple.com>

        Fixed the prefences won't stay in front problem after John found 
        and correctly diagnosed the problem.
        
	* src/kwq/KWQWidget.mm: (QWidget::show), (QWidget::hide):

2002-02-18  Richard Williamson  <rjw@apple.com>

        Performance measurement.
        
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::begin), (KHTMLPart::write):

2002-02-16  Maciej Stachowiak  <mjs@apple.com>

	Reimplement KURL in terms of CFURL (many workarounds needed to
	account for differing semantics).

	* src/kwq/kdecore/kurl.h:
	* src/kwq/KWQKURL.mm: (KURL::KWQKURLPrivate::KWQKURLPrivate),
	(KURL::KWQKURLPrivate::~KWQKURLPrivate), (KURL::KWQKURLPrivate::init),
	(KURL::KWQKURLPrivate::makeRef), (CFStringToQString), (escapeQString),
	(pathEndsWithSlash), (KWQCFURLCopyEscapedPath),
	(KURL::KWQKURLPrivate::decompose), (KURL::KWQKURLPrivate::compose), (KURL::KURL),
	(KURL::~KURL), (KURL::isEmpty), (KURL::isMalformed), (KURL::hasPath),
	(KURL::url), (KURL::protocol), (KURL::host), (KURL::port), (KURL::pass),
	(KURL::user), (KURL::ref), (KURL::query), (KURL::path), (KURL::setProtocol),
	(KURL::setHost), (KURL::setPort), (KURL::setRef), (KURL::setQuery),
	(KURL::setPath), (KURL::prettyURL), (KURL::operator=), (KURL::decode_string),
	(KURL::copyOnWrite):
	* src/kwq/Makefile.am: Add new file to build.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::begin,
	KHTMLPart::submitForm): Don't 

	Minor tweaks to make it all build:

	* src/kwq/kde/_kurl.cpp:
	* src/kwq/qt/_qurl.cpp:
	* src/kwq/qt/_qurl.h:

2002-02-16  Richard Williamson  <rjw@apple.com>

        Fixed problem with default text not showing up in text area.
        Fixed problem with scroll widgets not showing up in select list.
        
	* src/kdelibs/khtml/rendering/render_form.cpp: (RenderSelect::layout):
	* src/kwq/KWQListBox.mm: (QListBox::QListBox):
	* src/kwq/KWQTextArea.mm: (-[KWQTextArea _createTextView]), (-[KWQTextArea
	initWithFrame:widget:]), (-[KWQTextArea setFrame:]):

2002-02-15  Richard Williamson  <rjw@apple.com>
    
    Lots of changes to support forms.

	* src/kdelibs/khtml/rendering/render_form.cpp: (RenderFormElement::slotClicked),
	(RenderCheckBox::performAction), (RenderRadioButton::slotClicked),
	(RenderSelect::RenderSelect), (RenderSelect::layout),
	(RenderSelect::performAction), (RenderTextArea::layout), (RenderTextArea::text),
	(RenderTextArea::performAction):
	* src/kdelibs/khtml/rendering/render_form.h:
	* src/kwq/KWQCheckBox.mm: (QCheckBox::QCheckBox), (QCheckBox::isChecked):
	* src/kwq/KWQComboBox.mm: (QComboBox::indexOfCurrentItem):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::requestFrame):
	* src/kwq/KWQListBox.h:
	* src/kwq/KWQListBox.mm: (-[KWQBrowserDelegate initWithListBox:]),
	(-[KWQBrowserDelegate browser:numberOfRowsInColumn:]), (-[KWQBrowserDelegate
	browser:willDisplayCell:atRow:column:]), (-[KWQBrowserDelegate
	browserSingleClick:]), (-[KWQBrowserDelegate browserDoubleClick:]),
	(QListBox::QListBox), (QListBox::~QListBox), (QListBox::count),
	(QListBox::scrollBarWidth), (QListBox::clear), (QListBox::setSelectionMode),
	(QListBox::currentItem), (QListBox::insertItem), (QListBox::setSelected),
	(QListBox::isSelected), (QListBoxItem::QListBoxItem),
	(QListBoxItem::~QListBoxItem), (QListBoxItem::setSelectable),
	(QListBoxItem::width), (QListBoxItem::height):
	* src/kwq/KWQNSTextField.mm: (-[KWQNSTextField action:]), (-[KWQNSTextField
	controlTextDidEndEditing:]):
	* src/kwq/KWQScrollView.mm: (QScrollView::addChild):
	* src/kwq/KWQTextArea.mm: (-[KWQTextArea initWithFrame:]), (-[KWQTextArea
	_createTextView]), (-[KWQTextArea initWithFrame:widget:]), (-[KWQTextArea
	textDidEndEditing:]), (-[KWQTextArea setFrame:]):
	* src/kwq/KWQTextEdit.mm: (QMultiLineEdit::setCursorPosition),
	(QMultiLineEdit::getCursorPosition):
	* src/kwq/KWQView.mm: (-[KWQNSButton stateChanged:]), (-[KWQNSComboBox
	initWithFrame:widget:]), (-[KWQNSComboBox action:]):
	* src/kwq/KWQWidget.mm: (QWidget::endEditing):
	* src/kwq/qt/qcheckbox.h:
	* src/kwq/qt/qcombobox.h:
	* src/kwq/qt/qobject.h:

2002-02-13  Richard Williamson  <rjw@apple.com>
    
    Use NSSwitchButtons for check boxes.

	* src/kwq/KWQCheckBox.mm: (QCheckBox::QCheckBox):

2002-02-13  Richard Williamson  <rjw@apple.com>

    Removed dead code from setView.
    
	* src/kwq/KWQWidget.mm: (QWidget::setView):

2002-02-12  Richard Williamson  <rjw@apple.com>

    Made basic forms work.

	* src/kdelibs/khtml/rendering/render_form.cpp:
	(RenderFormElement::performAction), (RenderLineEdit::RenderLineEdit),
	(RenderLineEdit::performAction):
	* src/kdelibs/khtml/rendering/render_form.h:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::submitForm):
	* src/kwq/KWQLineEdit.mm: (QLineEdit::text):
	* src/kwq/KWQNSTextField.mm: (-[KWQNSTextField initWithFrame:widget:]),
	(-[KWQNSTextField action:]), (-[KWQNSTextField controlTextDidEndEditing:]),
	(-[KWQNSTextField setMaximumLength:]), (-[KWQNSTextField maximumLength]):
	* src/kwq/KWQObject.mm: (QObject::emitAction), (QObject::performAction):
	* src/kwq/KWQWidget.mm: (QWidget::setView), (QWidget::endEditing):
	* src/kwq/kwqdebug.mm: (KWQGetLogLevel):
	* src/kwq/qt/qlineedit.h:
	* src/kwq/qt/qobject.h:
	* src/kwq/qt/qwidget.h:

2002-02-12  Maciej Stachowiak  <mjs@apple.com>

	Make some tweaks to glue together KDE's and CF's concepts of URLs
	a bit better. In particular, CF thinks "file:/some/path" is an
	invalid URL, while KDE thinks this is the canonical form for a
	file URL.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::closeURL),
	(KHTMLPart::checkCompleted):
	* src/kwq/KWQKjobclasses.mm:

2002-02-12  Maciej Stachowiak  <mjs@apple.com>

	Reimplemented QList, QVector and QCollection from
	scratch. Implemented copy-on-write optimization for QMap.

	Minimally reimplement QCollection.

	* src/kwq/qt/qcollection.h:
	* src/kwq/KWQCollection.mm: (QCollection::QCollection), (QCollection::operator=),
	(QCollection::~QCollection), (QCollection::autoDelete),
	(QCollection::setAutoDelete):

	* src/kwq/qt/qdict.h, src/kwq/qt/qptrdict.h: Include
	qcollection.h, not _qcollection.h

	Reimplement QList as a doubly-linked list.
	
	* src/kwq/qt/qlist.h:
	* src/kwq/KWQListImpl.h:
	* src/kwq/KWQListImpl.mm: (KWQListImpl::KWQListPrivate::copyList),
	(KWQListImpl::KWQListPrivate::KWQListPrivate),
	(KWQListImpl::KWQListPrivate::~KWQListPrivate),
	(KWQListIteratorImpl::KWQListIteratorPrivate::KWQListIteratorPrivate),
	(KWQListImpl::KWQListImpl), (KWQListImpl::~KWQListImpl), (KWQListImpl::isEmpty),
	(KWQListImpl::count), (KWQListImpl::clear), (KWQListImpl::sort),
	(KWQListImpl::at), (KWQListImpl::insert), (KWQListImpl::remove),
	(KWQListImpl::removeFirst), (KWQListImpl::removeLast), (KWQListImpl::removeRef),
	(KWQListImpl::getLast), (KWQListImpl::current), (KWQListImpl::first),
	(KWQListImpl::last), (KWQListImpl::next), (KWQListImpl::prev),
	(KWQListImpl::take), (KWQListImpl::append), (KWQListImpl::prepend),
	(KWQListImpl::containsRef), (KWQListImpl::assign), (KWQListImpl::addIterator),
	(KWQListImpl::removeIterator), (KWQListIteratorImpl::KWQListIteratorImpl),
	(KWQListIteratorImpl::~KWQListIteratorImpl), (KWQListIteratorImpl::count),
	(KWQListIteratorImpl::toFirst), (KWQListIteratorImpl::toLast),
	(KWQListIteratorImpl::current), (KWQListIteratorImpl::operator--),
	(KWQListIteratorImpl::operator++), (KWQListIteratorImpl::operator=):

	Reimplement QVector in terms of CFArray.
	
	* src/kwq/qt/qvector.h:
	* src/kwq/KWQVectorImpl.h:
	* src/kwq/KWQVectorImpl.mm: (KWQVectorImpl::KWQVectorPrivate::KWQVectorPrivate),
	(KWQVectorImpl::KWQVectorPrivate::~KWQVectorPrivate),
	(KWQVectorImpl::KWQVectorImpl), (KWQVectorImpl::~KWQVectorImpl),
	(KWQVectorImpl::clear), (KWQVectorImpl::isEmpty), (KWQVectorImpl::count),
	(KWQVectorImpl::size), (KWQVectorImpl::remove), (KWQVectorImpl::resize),
	(KWQVectorImpl::insert), (KWQVectorImpl::at), (KWQVectorImpl::assign),
	(KWQVectorImpl::KWQVectorImpl::swap):

	Implemented copy-on-write optimization for QMap. This had the
	pleasant side effect of improving the separation between pointer
	manipulation and key/value manipulation.

	* src/kwq/qt/qmap.h:
	* src/kwq/KWQMapImpl.h:
	* src/kwq/KWQMapImpl.mm: (KWQMapImpl::KWQMapPrivate::KWQMapPrivate),
	(KWQMapImpl::KWQMapPrivate::~KWQMapPrivate), (KWQMapImpl::KWQMapImpl),
	(KWQMapImpl::~KWQMapImpl), (KWQMapImpl::copyOnWrite), (KWQMapImpl::copyTree),
	(KWQMapImpl::rebalanceAfterInsert), (KWQMapImpl::rebalanceAfterRemove),
	(KWQMapImpl::findInternal), (KWQMapImpl::insertInternal),
	(KWQMapImpl::removeInternal), (KWQMapImpl::swap), (KWQMapImpl::countInternal),
	(KWQMapImpl::clearInternal), (KWQMapImpl::beginInternal),
	(KWQMapImpl::endInternal):

	* src/kwq/Makefile.am: Add new files to build.

	* src/kdelibs/khtml/rendering/render_text.cpp
	(TextSlaveArray::findFirstMatching): Fix two places where the KDE
	code was depending on implementation details of QVector.

2002-02-07  Richard Williamson  <rjw@apple.com>

    More changes to IFLocationChangeHandler API.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent):

2002-02-07  Richard Williamson  <rjw@apple.com>

    Factored URL loading code out and moved to IFBaseWebController.
    
	* ChangeLog:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::requestFrame):

2002-02-06  Richard Williamson  <rjw@apple.com>

    Fixed allocation problems.
    
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::requestFrame):

2002-02-05  Richard Williamson  <rjw@apple.com>

    Updated part to use 'official' controller APIs.
    
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::~KHTMLPart),
	(KHTMLPart::khtmlMouseReleaseEvent), (KHTMLPart::requestFrame),
	(KHTMLPart::checkCompleted):

2002-02-05  Richard Williamson  <rjw@apple.com>

    Changes to support dynamic scroll bars in frames/iframes.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent):
	* src/kwq/KWQScrollView.mm: (QScrollView::addChild),
	(QScrollView::resizeContents), (QScrollView::updateContents),
	(QScrollView::repaintContents):
	* src/kwq/KWQWidget.mm: (QWidget::resize), (QWidget::move),
	(QWidget::internalSetGeometry):

2002-02-05  Kenneth Kocienda  <kocienda@apple.com>

	Changes to move these last bits of code to the new cache API.

	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/WKPluginView.h:
	* src/kwq/WKPluginView.mm: (-[WKPluginView drawRect:]), (-[WKPluginView
	WCURLHandleResourceDidBeginLoading:userData:]), (-[WKPluginView
	WCURLHandleResourceDidCancelLoading:userData:]), (-[WKPluginView
	WCURLHandleResourceDidFinishLoading:userData:]), (-[WKPluginView
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]), (-[WKPluginView
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]):

2002-02-04  Maciej Stachowiak  <mjs@apple.com>

	Fix everything for WK --> IF rename.

	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::requestFrame), (KHTMLPart::checkCompleted):

2002-02-01  Kenneth Kocienda  <kocienda@apple.com>

	More cleanups to the no-copy NSData API.
	This time the callback from the cache/loader has been
	simplified from:
	- (void)WKURLHandle:(WKURLHandle *)sender resourceDataDidBecomeAvailable:(UInt8 *)bytes offset:(unsigned)offset length:(unsigned)length;
	to:
	- (void)WKURLHandle:(WKURLHandle *)sender resourceDataDidBecomeAvailable:(NSData *)data;
	This was made possible by some rearrangement in the private API.

	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]):

2002-02-01  Richard Williamson  <rjw@apple.com>

    Added support for dynamic scrolling frames.  Also added first callback for
    WKLocationChangeHandler.
    
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::end), (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::checkCompleted):

2002-02-01  Kenneth Kocienda  <kocienda@apple.com>

        Made some cleanups to the no-copy NSData API, and those changes
        make the use of the no-copy functionality in this client code
        much cleaner.
        
	* include/WCURLHandle.h:
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]):

2002-01-31  Richard Williamson  <rjw@apple.com>

    Added QString constructor, fixed javascript at head of document bug.
    
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::closeURL),
	(KHTMLPart::write):
	* src/kwq/KWQString.mm: (QString::QString):
	* src/kwq/qt/qstring.h:

2002-01-31  Richard Williamson  <rjw@apple.com>

	* src/kdelibs/khtml/html/html_headimpl.cpp: (HTMLStyleElementImpl::detach):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::write):

2002-01-31  Kenneth Kocienda  <kocienda@apple.com>

        Changes to incorporate use of the no-copy NSData object.

	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]):

2002-01-30  Richard Williamson  <rjw@apple.com>
    
    Cleaned up frame code a bit.  Fixed duplicate content problem.

	* src/kdelibs/khtml/html/html_headimpl.cpp: (HTMLLinkElementImpl::detach):
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::layout):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::~KHTMLPart), (KHTMLPart::openURL),
	(KHTMLPart::requestFrame):

2002-01-30  Kenneth Kocienda  <kocienda@apple.com>

        Added *.lo, *.la, and .libs to .cvsignore files
        
	* .cvsignore:
	* src/.cvsignore:
	* src/kdelibs/khtml/css/.cvsignore:
	* src/kdelibs/khtml/misc/.cvsignore:
	* src/kdelibs/kjs/.cvsignore:

2002-01-29  Richard Williamson  <rjw@apple.com>

    Fixed QConstString to make a copy on initial chars.
    
	* ChangeLog:
	* src/kwq/KWQString.mm: (QString::_copyIfNeededInternalString),
	(QString::insert), (QString::remove), (QString::replace), (QString::truncate),
	(QConstString::QConstString):
	* src/kwq/qt/qstring.h:

2002-01-29  Richard Williamson  <rjw@apple.com>

	* src/kwq/KWQString.mm: (QString::_copyIfNeededInternalString),
	(QString::insert), (QString::remove), (QString::replace), (QString::truncate),
	(QConstString::QConstString):
	* src/kwq/qt/qstring.h:

2002-01-29  Kenneth Kocienda  <kocienda@apple.com>

        - Added in a dummy protocol to clean up a warning that results
        from calling a method on an id.
        - Cleaned up handle variable in KWQKHTMLPart. This can now be freed
        once we get a proper notification that a load is done.
        - Support for reading text encoding from HTTP headers added back in.
        
	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.mm: (encodingFromContentType), (KHTMLPart::slotData),
	(KHTMLPart::openURL), (KHTMLPart::closeURL):

2002-01-29  Richard Williamson  <rjw@apple.com>

    First pass as frame code.  Still needs cleanup.
    
	* src/kdelibs/khtml/dom/dom_misc.cpp: (DomShared::ref), (DomShared::deref):
	* src/kdelibs/khtml/dom/dom_misc.h:
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::~KHTMLView):
	* src/kwq/KWQComboBox.mm: (QComboBox::setCurrentItem):
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::~KHTMLPart), (KHTMLPart::begin),
	(KHTMLPart::end), (KHTMLPart::xmlDocImpl), (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::requestFrameName), (KHTMLPart::requestFrame),
	(KHTMLPart::requestObject), (KHTMLPart::checkCompleted):

2002-01-29  Kenneth Kocienda  <kocienda@apple.com>

        Checked in the missing file
        
	* include/WCURLHandle.h:

2002-01-29  Kenneth Kocienda  <kocienda@apple.com>

        Changed over to the new cache loader in WebFoundation
        
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient init]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidBeginLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]),
	(-[KHTMLPartLoadClient WCURLHandle:resourceDidFailLoadingWithResult:userData:]),
	(-[KHTMLPartLoadClient dealloc]), (KHTMLPart::slotData), (KHTMLPart::openURL):
	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/KWQKloader.mm: (-[URLLoadClient initWithLoader:]), (-[URLLoadClient
	WCURLHandleResourceDidBeginLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]),
	(-[URLLoadClient WCURLHandle:resourceDidFailLoadingWithResult:userData:]),
	(-[URLLoadClient dealloc]):
	* src/kwq/kio/jobclasses.h:

2002-01-29  Maciej Stachowiak  <mjs@apple.com>

	Reimplement QDict, QMap, QPtrDict and QSortedList.

	Reimplement QDict in terms of CFDictionary:
	
	* src/kwq/qt/qdict.h:
	* src/kwq/KWQDictImpl.h:
	* src/kwq/KWQDictImpl.mm: (KWQDictImpl::KWQDictImpl), (KWQDictImpl::insert),
	(KWQDictImpl::remove), (KWQDictImpl::find),
	(KWQDictIteratorImpl::KWQDictIteratorImpl),
	(KWQDictIteratorImpl::currentStringKey):

	Reimplement QMap as a right-threaded red-black tree, splitting
	the work between template classes that manipulate keys and values
	and non-template base classes that handle all the pointer
	manipulation:
	
	* src/kwq/qt/qmap.h:
	* src/kwq/KWQMapImpl.h:
	* src/kwq/KWQMapImpl.mm: (KWQMapNodeImpl::KWQMapNodeImpl),
	(KWQMapNodeImpl::left), (KWQMapNodeImpl::right), (KWQMapNodeImpl::predecessor),
	(KWQMapNodeImpl::successor), (KWQMapIteratorImpl::KWQMapIteratorImpl),
	(KWQMapIteratorImpl::incrementInternal), (KWQMapImpl::KWQMapImpl),
	(KWQMapImpl::rotateRight), (KWQMapImpl::rotateLeft),
	(KWQMapImpl::rebalanceAfterInsert), (KWQMapImpl::rebalanceAfterRemove),
	(KWQMapImpl::findInternal), (KWQMapImpl::insertInternal),
	(KWQMapImpl::removeInternal), (KWQMapImpl::swap), (KWQMapImpl::countInternal),
	(KWQMapImpl::clearInternal), (KWQMapImpl::beginInternal),
	(KWQMapImpl::endInternal):

	Reimplement QPtrDict in terms of CFDictionary:

	* src/kwq/qt/qptrdict.h:
	* src/kwq/KWQPtrDictImpl.h:
	* src/kwq/KWQPtrDictImpl.mm:
	(KWQPtrDictImpl::KWQPtrDictPrivate::KWQPtrDictPrivate),
	(KWQPtrDictImpl::KWQPtrDictPrivate::~KWQPtrDictPrivate),
	(KWQPtrDictImpl::KWQPtrDictImpl), (KWQPtrDictImpl::~KWQPtrDictImpl),
	(invokeDeleteFuncOnValue), (KWQPtrDictImpl::clear), (KWQPtrDictImpl::count),
	(KWQPtrDictImpl::insert), (KWQPtrDictImpl::remove), (KWQPtrDictImpl::find),
	(KWQPtrDictImpl::swap), (KWQPtrDictImpl::assign), (KWQPtrDictImpl::take),
	(KWQPtrDictIteratorImpl::KWQPtrDictIteratorPrivate::KWQPtrDictIteratorPrivate),
	(KWQPtrDictIteratorImpl::KWQPtrDictIteratorPrivate::~KWQPtrDictIteratorPrivate),
	(KWQPtrDictIteratorImpl::KWQPtrDictIteratorImpl),
	(KWQPtrDictIteratorImpl::~KWQPtrDictIteratorImpl),
	(KWQPtrDictIteratorImpl::count), (KWQPtrDictIteratorImpl::current),
	(KWQPtrDictIteratorImpl::currentKey), (KWQPtrDictIteratorImpl::toFirst),
	(KWQPtrDictIteratorImpl::operator++):

	Reimplement QSortedList:
	
	* src/kwq/qt/qsortedlist.h:

	* src/kwq/KWQArrayImpl.mm: Remove stray include.

	* src/kwq/Makefile.am: Add new files to build.

	* src/kwq/qt/_qdict.h, src/kwq/qt/_qgdict.h,
	src/kwq/qt/_qptrdict.h: Avoid causing problems when the relevant
	defines are not defined.

2002-01-22  Richard Williamson  <rjw@apple.com>

    Implemented KWQDesktopWidget to represent main screen.  Used by javascript.
    
	* src/kwq/KWQApplication.mm: (KWQDesktopWidget::width),
	(KWQDesktopWidget::height), (QApplication::desktop):

2002-01-21  Maciej Stachowiak  <mjs@apple.com>

	Reimplemented QArray, QBuffer, QStack and QStringList; also fixed
	some files for borrowed switchability, and fixed some bugs found
	by my new test cases.

	# Reimplement QArray:

	* src/kwq/qt/qarray.h:
	* src/kwq/KWQArrayImpl.h:
	* src/kwq/KWQArrayImpl.mm: (KWQArrayImpl::KWQArrayPrivate::KWQArrayPrivate),
	(KWQArrayImpl::KWQArrayPrivate::~KWQArrayPrivate), (KWQArrayImpl::KWQArrayImpl),
	(KWQArrayImpl::~KWQArrayImpl), (KWQArrayImpl::operator=), (KWQArrayImpl::at),
	(KWQArrayImpl::data), (KWQArrayImpl::size), (KWQArrayImpl::resize),
	(KWQArrayImpl::duplicate), (KWQArrayImpl::fill), (KWQArrayImpl::operator==):

	# Reimplement QBuffer:

	* src/kwq/qt/qbuffer.h:
	* src/kwq/KWQBuffer.mm: (QBuffer::QBuffer), (QBuffer::~QBuffer),
	(QBuffer::buffer), (QBuffer::size), (QBuffer::isOpen), (QBuffer::open),
	(QBuffer::close), (QBuffer::writeBlock):
	* src/kwq/qt/qiodevice.h:

	# Reimplement QStringList:

	* src/kwq/KWQStringList.mm: (QStringToCFString), (QStringList::split),
	(QStringList::QStringList), (QStringList::~QStringList), (QStringList::join),
	(QStringList::operator=):

	# Reimplement QStack:
	* src/kwq/qt/qstack.h:

	* src/kwq/Makefile.am: Add new files to build.

	* src/kwq/KWQString.mm: (QString::find): Fix bug which returned
	the very first occurence in the string even when the optional
	starting point was passed in. Some of my new regression tests
	picked this up.

	# Temporarily work around uses of non-kwq APIs:
	
	* src/kwq/WKPluginWidget.h:
	* src/kwq/qt/_qfile.cpp
	* src/kwq/qt/_qbuffer.cpp
	
	# Guard contents of all these with the appropriate USING ifdef:
	
	* src/kwq/KWQStrList.h:
	* src/kwq/qt/_qarray.h:
	* src/kwq/qt/_qgarray.h:
	* src/kwq/qt/_qstrlist.h:
	
2002-01-19  Maciej Stachowiak  <mjs@apple.com>

	* src/kdelibs/kjs/Makefile.am: Fix testkjs build.

	Fix a couple more static initialization problems:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::urlCursor):
	* src/kwq/KWQRegion.mm: (QRegion::QRegion), (QRegion::operator=):

	* src/.cvsignore, src/kdelibs/.cvsignore,
	src/kdelibs/khtml/css/.cvsignore,
	src/kdelibs/khtml/misc/.cvsignore, src/kdelibs/kjs/.cvsignore:
	Ignore stamp files.

2002-01-18  Richard Williamson  <rjw@apple.com>

    First pass at new view/datasource/controller API.

	* src/kwq/KWQApplication.mm: (QApplication::QApplication),
	(QApplication::setMainWidget), (QApplication::exec):
	* src/kwq/KWQRegion.mm: (QRegion::QRegion), (QRegion::~QRegion),
	(QRegion::contains), (QRegion::isNull):
	* src/kwq/Makefile.am:
	* src/kwq/_KWQOwner.h:
	* src/kwq/_KWQOwner.m:
	* src/kwq/qt/qnamespace.h:

2002-01-18  Maciej Stachowiak  <mjs@apple.com>

	Avoid static initialization of objects as much as possible. Order
	of static initializers is unpredictable and we had some
	cross-dependencies, so avoid this practice as much as possible to
	fix various startup crashes.

	* src/kwq/KWQApplication.mm: (QApplication::palette),
	(QApplication::globalStrut):
	* src/kwq/KWQChar.mm:
	* src/kwq/KWQColor.mm:
	* src/kwq/KWQCursor.mm: (QCursor::QCursor), (QCursor::~QCursor):
	* src/kwq/KWQEvent.mm:
	* src/kwq/KWQKConfigBase.mm: (KConfigBase::readEntry),
	(KConfigBase::readColorEntry), (KConfigBase::readListEntry):
	* src/kwq/KWQKHTMLSettings.mm: (KHTMLSettings::encoding):
	* src/kwq/KWQKJavaEmbed.mm: (KJavaEmbed::sizeHint),
	(KJavaEmbed::minimumSizeHint):
	* src/kwq/KWQKLocale.mm: (KLocale::language):
	* src/kwq/KWQKMimeType.mm: (KMimeType::findByURL), (KMimeType::name):
	* src/kwq/KWQKPrinter.mm: (KPrinter::margins):
	* src/kwq/KWQKProtocolManager.mm: (KProtocolManager::httpProxy):
	* src/kwq/KWQKWinModule.mm: (KWinModule::workArea):
	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/KWQKnetaccess.mm:
	* src/kwq/KWQPart.mm: (KParts::Part::widget), (KParts::ReadOnlyPart::url):
	* src/kwq/KWQPixmap.mm: (QPixmap::mask):
	* src/kwq/KWQToolTip.mm: (QToolTip::palette):
	* src/kwq/kde/_kurl.cpp:
	* src/kwq/kdecore/kurl.h:

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	Fix a couple of problems that kept `make -j3' from working from a
	clean start (use stamp files to serialize build a bit more where
	needed)

	* src/Makefile.am:
	* src/kdelibs/khtml/css/Makefile.am:
	* src/kdelibs/khtml/misc/Makefile.am:
	* src/kdelibs/kjs/Makefile.am:

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/Makefile.am: Fix another bonehead mistake.

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	Fix bonehead mistakes in last checkin which were killing Jersey.

	* src/kdelibs/khtml/ecma/Makefile.am:
	* src/kdelibs/khtml/html/Makefile.am:
	* src/kdelibs/khtml/rendering/Makefile.am:
	* src/kwq/kde/Makefile.am:

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	More build system speedups; instead of building static libraries
	in each directory, build relocatble object files, using the magic
	of incremental linking.

	* src/Makefile.am:
	* src/kdelibs/khtml/Makefile.am:
	* src/kdelibs/khtml/css/Makefile.am:
	* src/kdelibs/khtml/dom/Makefile.am:
	* src/kdelibs/khtml/ecma/Makefile.am:
	* src/kdelibs/khtml/html/Makefile.am:
	* src/kdelibs/khtml/java/Makefile.am:
	* src/kdelibs/khtml/misc/Makefile.am:
	* src/kdelibs/khtml/rendering/Makefile.am:
	* src/kdelibs/khtml/xml/Makefile.am:
	* src/kdelibs/kjs/Makefile.am:
	* src/kwq/Makefile.am:
	* src/kwq/kde/Makefile.am:
	* src/kwq/qt/Makefile.am:

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	Build speedups: Don't use libtool, and don't link static libraries
	into each other.
	
	* src/Makefile.am
	* src/kdelibs/khtml/Makefile.am:
	* src/kdelibs/khtml/css/Makefile.am:
	* src/kdelibs/khtml/dom/Makefile.am:
	* src/kdelibs/khtml/ecma/Makefile.am:
	* src/kdelibs/khtml/html/Makefile.am:
	* src/kdelibs/khtml/java/Makefile.am:
	* src/kdelibs/khtml/misc/Makefile.am:
	* src/kdelibs/khtml/rendering/Makefile.am:
	* src/kdelibs/khtml/xml/Makefile.am:
	* src/kdelibs/kjs/Makefile.am:
	* src/kwq/Makefile.am:
	* src/kwq/kde/Makefile.am:
	* src/kwq/qt/Makefile.am:

2002-01-16  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/qt/_qpoint.h, src/kwq/qt/_qrect.h, src/kwq/qt/_qsize.h,
	src/kwq/qt/qpoint.h, src/kwq/qt/qrect.h, src/kwq/qt/qsize.h: Make
	QPoint, QRect and QSize easily turn-off-able again.

2002-01-15  Maciej Stachowiak  <mjs@apple.com>

	* src/kdelibs/kjs/Makefile.am: Add missing files to BUILT_SOURCES
	and build rules to fix `make -j3'

2002-01-14  Maciej Stachowiak  <mjs@apple.com>

	* .cvsignore:
	* Makefile.am:
	* Makefile.in:
	* include/.cvsignore:
	* include/Makefile.am:
	* include/private/.cvsignore:
	* include/private/Makefile.am:
	* lib/.cvsignore:
	* lib/Makefile.in:
	* src/.cvsignore:
	* src/Makefile.am:
	* src/kdelibs/.cvsignore:
	* src/kdelibs/Makefile.am:
	* src/kdelibs/kdecore/.cvsignore:
	* src/kdelibs/kdecore/Makefile.am:
	* src/kdelibs/kdecore/Makefile.in:
	* src/kdelibs/khtml/.cvsignore:
	* src/kdelibs/khtml/Makefile.am:
	* src/kdelibs/khtml/Makefile.in:
	* src/kdelibs/khtml/css/.cvsignore:
	* src/kdelibs/khtml/css/Makefile.am:
	* src/kdelibs/khtml/css/Makefile.in:
	* src/kdelibs/khtml/dom/.cvsignore:
	* src/kdelibs/khtml/dom/Makefile.am:
	* src/kdelibs/khtml/dom/Makefile.in:
	* src/kdelibs/khtml/ecma/.cvsignore:
	* src/kdelibs/khtml/ecma/Makefile.am:
	* src/kdelibs/khtml/ecma/Makefile.in:
	* src/kdelibs/khtml/html/.cvsignore:
	* src/kdelibs/khtml/html/Makefile.am:
	* src/kdelibs/khtml/html/Makefile.in:
	* src/kdelibs/khtml/java/.cvsignore:
	* src/kdelibs/khtml/java/ChangeLog:
	* src/kdelibs/khtml/java/Makefile.am:
	* src/kdelibs/khtml/java/Makefile.in:
	* src/kdelibs/khtml/java/tests/Makefile.am:
	* src/kdelibs/khtml/misc/.cvsignore:
	* src/kdelibs/khtml/misc/Makefile.am:
	* src/kdelibs/khtml/misc/Makefile.in:
	* src/kdelibs/khtml/pics/Makefile.am:
	* src/kdelibs/khtml/rendering/.cvsignore:
	* src/kdelibs/khtml/rendering/Makefile.am:
	* src/kdelibs/khtml/rendering/Makefile.in:
	* src/kdelibs/khtml/xml/.cvsignore:
	* src/kdelibs/khtml/xml/Makefile.am:
	* src/kdelibs/khtml/xml/Makefile.in:
	* src/kdelibs/kjs/.cvsignore:
	* src/kdelibs/kjs/ChangeLog:
	* src/kdelibs/kjs/Makefile.am:
	* src/kdelibs/kjs/Makefile.in:
	* src/kdelibs/kjs/kjs-test:
	* src/kdelibs/kjs/kjs-test.chk:
	* src/kwq/.cvsignore:
	* src/kwq/Makefile.am:
	* src/kwq/Makefile.in:
	* src/kwq/_KWQOwner.m: (-[_KWQOwner backForwardUriDone:]):
	* src/kwq/kde/.cvsignore:
	* src/kwq/kde/Makefile.am:
	* src/kwq/kde/Makefile.in:
	* src/kwq/kdecore/.cvsignore:
	* src/kwq/kdecore/Makefile.in:
	* src/kwq/khtml/khtml_factory.h:
	* src/kwq/qt/.cvsignore:
	* src/kwq/qt/Makefile.am:
	* src/kwq/qt/Makefile.in:

2002-01-09  Richard Williamson  <rjw@apple.com>

        Re-implemented underlining.  Now it REALLY works, honest.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):
	* src/kwq/KWQFontMetrics.mm: (+[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQPainter.mm: (QPainter::drawUnderlineForText):
	* src/kwq/qt/qpainter.h:

2001-12-20  Richard Williamson  <rjw@apple.com>
        
        More tweaks to text layout and underlining.

	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::baselineOffset),
	(QFontMetrics::ascent), (QFontMetrics::descent), (QFontMetrics::height),
	(QFontMetrics::width):
	* src/kwq/KWQPainter.mm: (QPainter::drawText):
	* src/kwq/qt/qfontmetrics.h:

2001-12-18  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQCString.mm: (QCString::QCString),
	(QCString::isEmpty), (QCString::isNull), (QCString::length): Fix
	some bugs found by the test suite in the emptiness/null semantics.

	Reimplement QPoint, QSize and QRect:

	* src/kwq/qt/qpoint.h, src/kwq/qt/qrect.h, src/kwq/qt/qsize.h:
	Update.
	* src/kwq/KWQPoint.mm: (QPoint::QPoint), (QPoint::x), (QPoint::y),
	(QPoint::manhattanLength), (operator+), (operator-), (operator<<):
	Fresh implementations.
	* src/kwq/KWQRect.mm: (QRect::QRect), (QRect::isNull), (QRect::isValid),
	(QRect::x), (QRect::y), (QRect::left), (QRect::top), (QRect::right),
	(QRect::bottom), (QRect::width), (QRect::height), (QRect::topLeft),
	(QRect::size), (QRect::setWidth), (QRect::setHeight), (QRect::intersect),
	(QRect::intersects), (QRect::operator&), (operator==), (operator!=),
	(operator<<): Likewise.
	* src/kwq/KWQSize.mm: (QSize::QSize), (QSize::isValid), (QSize::width),
	(QSize::height), (QSize::setWidth), (QSize::setHeight), (QSize::expandedTo),
	(operator+), (operator==), (operator!=), (operator<<): Likewise.
	* src/kwq/qt/_qpoint.cpp, src/kwq/qt/_qrect.cpp,
	src/kwq/qt/_qsize.cpp: Disable the whole file contents when
	building.
	* src/kwq/Makefile.in: Add new files to build.
	
	Start moving away from QShared so we can remove it:

	* src/kwq/qt/qbrush.h, src/kwq/KWQBrush.mm: (QBrush::QBrush),
	(QBrush::color),
	(QBrush::setColor), (QBrush::style), (QBrush::setStyle),
	(QBrush::operator==), (QBrush::operator!=): Don't use shared data
	for this simple value object, the optimization value is
	quastionable anyway.
	* src/kwq/qt/qpen.h, src/kwq/KWQPen.mm: (QPen::QPen),
	(QPen::color), (QPen::width), (QPen::style),
	(QPen::setColor), (QPen::setWidth), (QPen::setStyle),
	(QPen::operator==): Likewise.
	* src/kwq/KWQPainter.mm: (QPainter::setPen), (QPainter::setBrush):
	Update for changes to pen.
	* src/kwq/KWQRefPtr.h: New reference-counted pointer template.
	* src/kwq/qt/qguardedptr.h, src/kwq/KWQGuardedPtr.mm:
	(QGuardedPtrPrivate::QGuardedPtrPrivate): Use KWQRefPtr instead of
	QShared.
	* src/kwq/qt/qvariant.h, src/kwq/KWQVariant.mm:
	(QVariant::QVariant), (QVariant::~QVariant),
	(QVariant::operator=): Use KWQRefPtr instead of
	QShared.
	* src/kwq/qt/qnamespace.h: Remove private constructor and
	destructor since people want to subclass this.

	* src/kwq/_KWQOwner.h: Add include guards and standard license.

	* src/kdelibs/khtml/ecma/kjs_binding.h: Add include of qvariant.h,
	how could stuff ever compile without this?

2001-12-18  Richard Williamson  <rjw@apple.com>

        Finally fixed underlining.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):
	* src/kwq/KWQFontMetrics.mm:

2001-12-18  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/Makefile.in: Re-apply my changes, which accidentally got
	clobbered.

2001-12-13  Maciej Stachowiak  <mjs@apple.com>

	Changes for international character set support. Still needs work,
	but no worse than before. amazon.co.jp renders almost correctly.
	
	* src/kwq/KWQCharsets.h, src/kwq/KWQCharsets.mm:
	(KWQCFStringEncodingFromIANACharsetName,
	KWQCFStringEncodingFromMIB, KWQCFStringEncodingToIANACharsetName,
	KWQCFStringEncodingToMIB): New functions that translate between
	the Qt concept of charaxcter sets and the
	(buildDictionaries): static helper function for the above.
	* src/kwq/KWQtextcodec.mm: (codecForCFStringEncoding,
	QTextCodec::codecForMib), QTextCodec::codecForName,
	QTextCodec::codecForLocale, QTextCodec::name,QTextCodec::mibEnum):
	Implement for real.
	* src/kwq/KWQKCharsets.mm: (KCharsets::codecForName,
	KCharsets::charsetForEncoding, KCharsets::charsetForEncoding):
	Implement for real.
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::slotData): Get encoding
	from headers if present.
	(encodingFromContentType): Helper function for the above. 
	(KHTMLPart::begin): Reinitialize decoder for every page.
	(KHTMLPart::write): Minor bug fix.
	(KHTMLPart::setEncoding): Implement.
	(KHTMLPart::khtmlMouseMoveEvent,
	KHTMLPart::khtmlMouseReleaseEvent, KHTMLPart::checkCompleted):
	Simplify ifdefs to make prepare-ChangeLog happy.
	* src/kwq/qt/qstring.h, src/kwq/KWQString.mm:
	(QString::fromCFString): New convenience method to create a
	QString from an immutable CFString by copying,
	* src/kwq/character-sets.txt: IANA document describing character
	sets.
	* src/kwq/make-charset-table.pl, src/kwq/make-mac-encodings.c:
	Helper programs to construct charset tables from IANA document.
	* src/kwq/Makefile.in: Update to handle the autogenerated code.
	* src/kwq/.cvsignore: Ignore new autogenerated files.
	
	* src/kdelibs/khtml/misc/decoder.cpp: (Decoder::decode): Fix
	decoding when the encoding is specified in the http headers (which
	seems like it could never have worked in KDE).

	* include/WCBackForwardList.h, include/WCURICache.h,
	include/WCURICacheData.h, include/WCURIEntry.h: Fix prototypes of
	C functions with no arguments to use (void), not (), to avoid
	warnings in WebKit.

2001-12-11  Chris Blumenberg  <cblu@apple.com>

	* ChangeLog:
	* src/kwq/KWQKHTMLPart.mm:

2001-12-11  Chris Blumenberg  <cblu@apple.com>

	* src/kwq/KWQKHTMLPart.mm:

2001-12-10  Kenneth Kocienda  <kocienda@apple.com>

        Went back and did a better job of cleaning up the warnings
        that resulted from comparing signed and unsigned numbers.

	* src/kwq/KWQString.mm: (QString::insert), (QString::remove),
	(QString::truncate):

2001-12-07  Richard Williamson  <richwill@richwill.com>

        Fixed bug that was highlighted when we turned on warnings.
        
	* src/kwq/KWQFontMetrics.mm:
	* src/kwq/KWQMetrics.h:

2001-12-07  Kenneth Kocienda  <kocienda@apple.com>

        Fixed small bug in a comparison that was making -Wall complain

	* src/kwq/KWQString.mm:

