#======================================================================
#
# $RCSfile$
# $Revision$
# $Author$
# $Date$
#
# Make.rules boilerplate 
#
#======================================================================
# Suffix rules
#

$(filter %.c,$(CLEXOBJECTS)): %.c: %.l
	$(LEX) $(LEXFLAGS) $<

$(filter %.cpp,$(CXXLEXOBJECTS)): %.cpp: %.l
	$(LEX) $(LEXFLAGS) $<

$(filter %.c,$(CYACCOBJECTS)): %.c: %.y
	$(YACC) $(YACCFLAGS) $<

$(filter %.cpp,$(CXXYACCOBJECTS)): %.cpp: %.y
	$(YACC) $(YACCFLAGS) $<

$(filter %.o,$(COBJECTS)): %.o: %.c
	$(CC) $(CFLAGS) -I$(TOPSRCDIR) -c $< -o $@

$(filter %.o,$(CMMOBJECTS)): %.o: %.mm
	$(CC) $(CFLAGS) -I$(TOPSRCDIR) -c $< -o $@

$(filter %.o,$(CMOBJECTS)): %.o: %.m
	$(CC) $(CFLAGS) -I$(TOPSRCDIR) -c $< -o $@

$(filter %.o,$(CXXOBJECTS)): %.o: %.cpp
	$(CXX) $(CXXFLAGS) -I$(TOPSRCDIR) -c $< -o $@

.SUFFIXES: .cpp .h .c .mm .m

.cpp.o:
	$(CXX) $(CXXFLAGS) -I$(TOPSRCDIR) -c $< -o $@

.mm.o:
	$(CC) $(CMMFLAGS) -I$(TOPSRCDIR) -c $< -o $@

.m.o:
	$(CC) $(CMFLAGS) -I$(TOPSRCDIR) -c $< -o $@

#----------------------------------------------------------------------
# Standard subdir targets

export-objects: $(EXPORT_OBJECTS)
	if [ ! -d "$(EXPORT_OBJECTS_DIR)" ]; then \
		rm -f $(EXPORT_OBJECTS_DIR); \
		mkdir -p $(EXPORT_OBJECTS_DIR); \
	fi
	for OBJECT in $?; do \
		ln -f $$OBJECT $(EXPORT_OBJECTS_DIR)/$$OBJECT; \
	done
	touch $@

lib:
	@$(MAKE)
	if [ ! -d "$(TOPSRCDIR)/lib" ]; then \
	rm -f $(EXPORT_OBJECTS_DIR); \
	mkdir -p $(EXPORT_OBJECTS_DIR); \
	fi
	cd $(TOPSRCDIR)/lib; $(MAKE)

setup:
	@if (test -f "./MakeSystemChanges.sh"); then \
		./MakeSystemChanges.sh; \
	fi

depend: 
	$(CC) -MM $(DEPFLAGS) $(SOURCES) > Makefile.dep

clean:
	rm -rf ${CLEAN_FILES} core

distclean:
	${MAKE} clean
	rm -f Makefile \
	config.h \
	config.cache \
	config.log \
	config.status \
	$(NULL)

maintainer-clean:
	rm -f configure
	${MAKE} distclean;
	
#----------------------------------------------------------------------
# include make dependency rules

-include Makefile.dep

#======================================================================
# end $RCSfile$
#======================================================================
