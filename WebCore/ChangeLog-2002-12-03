2002-03-18  Darin Adler  <darin@apple.com>

        Redo inlining of QChar and QString and some other small speed improvements.
        Sadly, this doesn't seem to make things measurably faster, but I decided to
        commit my work rather than discarding it; it doesn't make things slower.

	* src/kwq/qt/qstring.h:
	* src/kwq/KWQChar.mm:
	* src/kwq/KWQString.mm:
        Do a lot more inlining. Also, the CFStringRef inside a QString is now never
        nil, so we can get rid of many checks for nil.

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::width): Use _rectForString() a
        couple more places.

2002-03-18  Richard Williamson  <rjw@apple.com>

        Changed to use non direct _rectForString() function.   Avoids
        unnecessary NSString allocation.
        
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::boundingRect):

2002-03-18  Darin Adler  <darin@apple.com>

	* src/kwq/KWQFontMetrics.mm: (QFontMetricsPrivate::getInfo),
	(QFontMetrics::width), (QFontMetrics::_width), (QFontMetrics::boundingRect),
	(QFontMetrics::size): Don't make the info object right away, in case the
	metrics object is only used to compute ascent and descent.

2002-03-17  Richard Williamson  <rjw@apple.com>

        Implementation of replacement code for NSLayoutManager.  Huge
        performance gains.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::calcMinMaxWidth),
	(RenderText::width):
	* src/kwq/KWQFontMetrics.mm: (ROUND_TO_INT), (__IFInitATSGlyphVector),
	(__IFResetATSGlyphVector), (__IFFillStyleWithAttributes), (-[KWQLayoutInfo
	drawString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	drawString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	initWithFont:]), (-[KWQLayoutInfo _initializeCaches]), (_rectForString),
	(-[KWQLayoutInfo rectForString:]), (-[KWQLayoutInfo attributes]),
	(-[KWQLayoutInfo lineHeight]), (-[KWQLayoutInfo font]), (-[KWQLayoutInfo
	dealloc]), (QFontMetrics::_width):
	* src/kwq/KWQMetrics.h:
	* src/kwq/Makefile.am:
	* src/kwq/qt/qfontmetrics.h:

2002-03-16  Richard Williamson  <rjw@apple.com>

        Fixed error handling.  Removed ObjC code for url handle client from KHTMLPart.
        Need to sanitize KHTMLPart further.
        
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::closeURL),
	(KHTMLPart::requestFrameName), (KHTMLPart::requestFrame), (KHTMLPart::overURL):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidCancelLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):
	* src/kwq/external.h:

2002-03-15  Richard Williamson  <rjw@apple.com>

        Fixed crasher initializing items in popup button.
        Increased fragment cache initial size.
        
	* src/kwq/KWQComboBox.mm: (QComboBox::init), (QComboBox::~QComboBox),
	(QComboBox::insertItem):
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage _buildFragmentForString:]):
	* src/kwq/qt/qcombobox.h:

2002-03-15  Richard Williamson  <rjw@apple.com>

        More string usage optimizations.  Got another 10% or so.
        
	* src/kdelibs/khtml/css/cssstyleselector.cpp: (checkPseudoState),
	(khtml::applyRule):
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::calcMinMaxWidth),
	(RenderText::width):

2002-03-15  Darin Adler  <darin@apple.com>

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::descent): Oops, removed a - sign
	that I should have left in there.

2002-03-15  Darin Adler  <darin@apple.com>

	Some more optimizations. Carves another 6% or so off of NSView.html.

	* src/kwq/KWQChar.mm: (QChar::QChar): Handle characters > 0x7F correctly.
	(QChar::cell): Remove unnecessary & operation.
	(QChar::row): Remove unnecessary & operation.
	(QChar::latin1): Do a simpler check rather than calling row().
	(QChar::operator char): Do the same work as latin1 inline.
	(operator==) (operator!=), (operator>=), (operator>), (operator<=), (operator<):
	Handle characters > 0x7F correctly.

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::ascent), (QFontMetrics::descent):
	Cache the ascent and descent rather than computing it each time we are called.

2002-03-15  Darin Adler  <darin@apple.com>

	Optimizations for creating empty QFont objects, measuring certain single
	characters, and copying QFontMetrics objects. Makes loading NSView.html about
	18% faster.

	* src/kwq/qt/qfontmetrics.h: Use a ref-counted pointer so QFontMetrics objects
	for the same QFont can share data.

	* src/kwq/KWQFont.mm: (loadDefaultFont): New, used to load the default
	font used for default-initialized QFont objects.
	(QFont::_initializeWithFont): Don't recompute the family name, point size, or
	traits.
	(QFont::setFamily), (QFont::setPixelSizeFloat), (QFont::setWeight),
	(QFont::setItalic): autorelease the font, as we do in the destructor, since
	someone could still be using the result of getFont.
	(QFont::operator==): Add a comment about a problem with this function.

	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::QFontMetrics): Add a refCount, and
	a cached width for space and lower-case "x", the two single characters that
	are often measured.
	(QFontMetrics::~QFontMetrics): Simplify.
	(QFontMetrics::operator=): Just copy the underlying data pointer rather than
	making our own KWQLayoutInfo object.
	(QFontMetrics::baselineOffset): Make const.
	(QFontMetrics::width): Add the caching for space and "x".

2002-03-15  Richard Williamson  <rjw@apple.com>

        Optimizations that remove unnecessary cfstring allocations of local scope
        strings.  QString::gstring_toQString and QString::gstring_toCFString were
        added to simplify the reuse of a static CFString as the backing store for
        local QStrings.  Hit the top two problem areas.  Many more gains to be had
        by using this technique.
        
	* src/kdelibs/khtml/css/cssstyleselector.cpp:
	(CSSStyleSelector::checkOneSelector):
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::calcMinMaxWidth):
	* src/kwq/KWQString.mm: (QString::gstring_toQString),
	(QString::gstring_toCFString):
	* src/kwq/qt/qstring.h:

2002-03-14  Richard Williamson  <rjw@apple.com>

        Fixed another problem in QString::find().
        Added dangerous but fast string allocation optimization to render_text.cpp.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (RenderText::calcMinMaxWidth):
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::_width):
	* src/kwq/KWQString.mm: (QString::find):
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage _buildFragmentForString:]),
	(-[KWQTextStorage setString:]):
	* src/kwq/qt/qfontmetrics.h:

2002-03-14  Richard Williamson  <rjw@apple.com>

        Fixed optimized find() implementation.  I had the sense of caseSensitive inverted.
        
	* src/kwq/KWQString.mm: (QString::find):

2002-03-14  Richard Williamson  <rjw@apple.com>

        Attempted implementation of space optimizations.  Disabled for now.
        
	* src/kwq/KWQFontMetrics.mm: (+[KWQLayoutInfo _dumpLayoutCache:]),
	(-[KWQLayoutInfo rectForString:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQTextStorage.h:
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage _buildFragmentForString:]),
	(-[KWQTextStorage getFragmentForString:]), (-[KWQTextStorage
	initWithFontAttribute:]), (-[KWQTextStorage addLayoutManager:]):

2002-03-14  Richard Williamson  <rjw@apple.com>

        Implemented a progressively cache fragment.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQSmallLayoutFragment setGlyphRange:]),
	(-[KWQSmallLayoutFragment setBoundingRect:]), (-[KWQSmallLayoutFragment
	boundingRect]), (-[KWQLargeLayoutFragment glyphRange]), (-[KWQLargeLayoutFragment
	setGlyphRange:]), (-[KWQLargeLayoutFragment setBoundingRect:]),
	(-[KWQLargeLayoutFragment boundingRect]), (-[KWQLargeLayoutFragment compare:]),
	(+[KWQLayoutInfo drawString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	_dumpLayoutCache:]), (-[KWQLayoutInfo rectForString:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQTextStorage.h:
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage getFragmentForString:]),
	(-[KWQTextStorage addFragmentForString:]):

2002-03-13  Richard Williamson  <rjw@apple.com>

        Added font cache.  Attempted to reduce size of fragment cache, but
        malloc forces a minimum of 30 bytes for our 14 byte objects.
        
	* src/kwq/KWQFont.mm: (-[IFFontCacheKey dealloc]), (-[IFFontCacheKey
	copyWithZone:]), (-[IFFontCacheKey hash]), (-[IFFontCacheKey string]),
	(-[IFFontCacheKey isEqual:]), (QFont::getFont):
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutFragment setGlyphRangeLength:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage addFragmentForString:]):

2002-03-13  Richard Williamson  <rjw@apple.com>

        Re-worked fragment cache to minimize memory usage.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutFragment glyphRange]),
	(-[KWQLayoutFragment setGlyphRangeLength:]), (-[KWQLayoutFragment
	setBoundingRectSize:]), (-[KWQLayoutFragment boundingRect]), (+[KWQLayoutInfo
	drawString:atPoint:withFont:color:]), (+[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]), (-[KWQLayoutInfo
	initWithFont:]), (-[KWQLayoutInfo layoutManager]), (-[KWQLayoutInfo
	textStorage]), (-[KWQLayoutInfo rectForString:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQTextStorage.h:
	* src/kwq/KWQTextStorage.mm: (-[KWQTextStorage getFragmentForString:]),
	(-[KWQTextStorage addFragmentForString:]), (-[KWQTextStorage
	initWithFontAttribute:]), (-[KWQTextStorage dealloc]), (-[KWQTextStorage
	length]), (-[KWQTextStorage setAttributes:]), (-[KWQTextStorage setString:]),
	(-[KWQTextStorage string]):

2002-03-13  Kenneth Kocienda  <kocienda@apple.com>

	Updated for new didRedirectToURL callback. This is a partial fix for this bug:
	Radar 2879234 (Redirected URLs not used for subsequent GETs)

	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandle:didRedirectToURL:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandle:didRedirectToURL:]):

2002-03-12  Richard Williamson  <rjw@apple.com>

	* src/kwq/KWQString.mm: (QString::find), (QString::contains),
	(QString::compareToLatin1):

2002-03-11  Richard Williamson  <rjw@apple.com>

Re-implemented QPainter::drawTiledPixmap to use core graphics patterns.  Currently this depends
on SPI.  The performance boost is huge osx.macnn.com draws 40x faster now.

	* src/kwq/KWQPainter.mm: (QPainter::drawTiledPixmap):

2002-03-08  Richard Williamson  <rjw@apple.com>

Re-implemented KWQFont to lazily request font from NSFontManager instead of
user converFont:.  I did this after sampling loads of http://www.apple.com/retail/theater
and found that converting fonts was very expensive.

	* src/kwq/KWQFont.mm: (QFont::defaultNSFont), (QFont::_initializeWithFont),
	(QFont::QFont), (QFont::_free), (QFont::getFont), (QFont::pixelSize),
	(QFont::family), (QFont::setFamily), (QFont::setPixelSizeFloat),
	(QFont::setWeight), (QFont::weight), (QFont::setItalic), (QFont::italic),
	(QFont::bold), (QFont::operator!=):
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::QFontMetrics):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::requestFrame):
	* src/kwq/KWQPainter.mm: (QPainter::drawText), (QPainter::drawUnderlineForText):
	* src/kwq/qt/qfont.h:

2002-03-08  Richard Williamson  <rjw@apple.com>

        Instrumentation of the text fragment metrics cache.
        Added _FAST_QSTRING_TO_NSSTRING.
        
	* src/kwq/KWQFontMetrics.mm: (-[KWQLayoutFragment initWithString:attributes:]),
	(-[KWQLayoutFragment boundingRect]), (-[KWQLayoutFragment compare:]),
	(+[KWQLayoutInfo _dumpLayoutCache:]), (+[KWQLayoutInfo _dumpAllLayoutCaches]),
	(-[KWQLayoutInfo rectForString:]), (QFontMetrics::width),
	(QFontMetrics::boundingRect), (QFontMetrics::size):
	* src/kwq/KWQMetrics.h:
	* src/kwq/qt/qstring.h:

2002-03-08  John Sullivan  <sullivan@apple.com>

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::end):
	Changed openURL() and end() messages to use debug levels. You
	can see these by setting your WebKitLogLevel mask to include 
	0x00000008

2002-03-07  John Sullivan  <sullivan@apple.com>

	* src/kwq/kwqdebug.h: New debug level constants, kept in
	synch with WebKitDebug.h

	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandleResourceDidBeginLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidCancelLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidBeginLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidCancelLoading:]), (-[URLLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]), (Loader::load),
	(Loader::servePendingRequests):
	* src/kwq/KWQView.mm: (-[KWQHTMLView layout]), (-[KWQHTMLView drawRect:]):
	Changed numeric debug levels to symbolic ones.

2002-03-07  Don Melton  <gramps@apple.com>

	Removed unused file in kdelibs that I missed in previous commit.

	* src/kdelibs/khtml/test/layout.html:

2002-03-06  Don Melton  <gramps@apple.com>

	Removed unused files in kdelibs.

	* src/kdelibs/AUTHORS:
	* src/kdelibs/README:
	* src/kdelibs/khtml/CHANGES:
	* src/kdelibs/khtml/DESIGN.html:
	* src/kdelibs/khtml/README.HTMLWidget:
	* src/kdelibs/khtml/README.tags:
	* src/kdelibs/khtml/SECURITY:
	* src/kdelibs/khtml/TODO:
	* src/kdelibs/khtml/design.h:
	* src/kdelibs/khtml/domtreeview.cpp:
	* src/kdelibs/khtml/domtreeview.h:
	* src/kdelibs/khtml/ecma/AUTHORS:
	* src/kdelibs/khtml/ecma/README:
	* src/kdelibs/khtml/ecma/THANKS:
	* src/kdelibs/khtml/ecma/TODO:
	* src/kdelibs/khtml/ecma/jsk.html:
	* src/kdelibs/khtml/ecma/testecma.cpp:
	* src/kdelibs/khtml/html/dtd.dtd:
	* src/kdelibs/khtml/java/KJAS_GRAMMAR.txt:
	* src/kdelibs/khtml/java/README:
	* src/kdelibs/khtml/java/TODO:
	* src/kdelibs/khtml/java/build.xml:
	* src/kdelibs/khtml/java/javaembed.cpp:
	* src/kdelibs/khtml/java/kjava.jar:
	* src/kdelibs/khtml/java/kjava.policy.in:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASAppletClassLoader.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASAppletContext.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASAppletStub.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASConsole.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASProtocolHandler.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASSecurityManager.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/KJASSoundPlayer.java:
	* src/kdelibs/khtml/java/org/kde/kjas/server/Main.java:
	* src/kdelibs/khtml/java/tests/badapplets/BadApplet.jar:
	* src/kdelibs/khtml/java/tests/badapplets/BadApplet.java:
	* src/kdelibs/khtml/java/tests/badapplets/applet.html:
	* src/kdelibs/khtml/java/tests/good_sites:
	* src/kdelibs/khtml/java/tests/testkjavaappletserver.cpp:
	* src/kdelibs/khtml/khtml.desktop:
	* src/kdelibs/khtml/khtml.rc:
	* src/kdelibs/khtml/khtml_browser.rc:
	* src/kdelibs/khtml/khtml_ext.cpp:
	* src/kdelibs/khtml/khtml_factory.cpp:
	* src/kdelibs/khtml/khtml_find.cpp:
	* src/kdelibs/khtml/khtml_find.h:
	* src/kdelibs/khtml/khtml_pagecache.cpp:
	* src/kdelibs/khtml/khtml_pagecache.h:
	* src/kdelibs/khtml/khtml_part.cpp:
	* src/kdelibs/khtml/khtml_popupmenu.rc:
	* src/kdelibs/khtml/khtml_run.cpp:
	* src/kdelibs/khtml/khtml_run.h:
	* src/kdelibs/khtml/khtmldefaults.h:
	* src/kdelibs/khtml/khtmlimage.cpp:
	* src/kdelibs/khtml/khtmlimage.desktop:
	* src/kdelibs/khtml/khtmlimage.h:
	* src/kdelibs/khtml/pics/hi16-action-images_display.png:
	* src/kdelibs/khtml/pics/hi22-action-images_display.png:
	* src/kdelibs/khtml/pics/hi32-action-images_display.png:
	* src/kdelibs/khtml/test/README:
	* src/kdelibs/khtml/test/URL1.html:
	* src/kdelibs/khtml/test/URL2.html:
	* src/kdelibs/khtml/test/align.html:
	* src/kdelibs/khtml/test/align1.html:
	* src/kdelibs/khtml/test/align2.html:
	* src/kdelibs/khtml/test/anchor1.html:
	* src/kdelibs/khtml/test/anchor2.html:
	* src/kdelibs/khtml/test/badpages.html:
	* src/kdelibs/khtml/test/buggy.html:
	* src/kdelibs/khtml/test/button.html:
	* src/kdelibs/khtml/test/color.html:
	* src/kdelibs/khtml/test/fixed-background.html:
	* src/kdelibs/khtml/test/image.gif:
	* src/kdelibs/khtml/test/image_map.html:
	* src/kdelibs/khtml/test/index.html:
	* src/kdelibs/khtml/test/java.html:
	* src/kdelibs/khtml/test/javascript.html:
	* src/kdelibs/khtml/test/jsplugins.html:
	* src/kdelibs/khtml/test/konqi.gif:
	* src/kdelibs/khtml/test/lake.class:
	* src/kdelibs/khtml/test/listing.html:
	* src/kdelibs/khtml/test/lists.html:
	* src/kdelibs/khtml/test/nav_bar.gif:
	* src/kdelibs/khtml/test/nbsp.html:
	* src/kdelibs/khtml/test/notitle.html:
	* src/kdelibs/khtml/test/object.html:
	* src/kdelibs/khtml/test/pseudo.html:
	* src/kdelibs/khtml/test/renders.html:
	* src/kdelibs/khtml/test/supsub.html:
	* src/kdelibs/khtml/test/testpages.html:
	* src/kdelibs/khtml/test/textarea.html:
	* src/kdelibs/khtml/test/title.html:
	* src/kdelibs/khtml/testcss.cpp:
	* src/kdelibs/khtml/testkhtml.cpp:
	* src/kdelibs/khtml/testkhtml.h:
	* src/kdelibs/khtml/testrender.cpp:
	* src/kdelibs/khtml/testrender.h:
	* src/kdelibs/kjs/README:
	* src/kdelibs/kjs/THANKS:
	* src/kdelibs/kjs/create_hash_table:
	* src/kdelibs/kjs/keywords.table:

2002-03-06  Don Melton  <gramps@apple.com>

	Cleaned up all our changes to kdelibs, removed bitrot, and replaced use
	of _KWQ_ with new APPLE_CHANGES define.

	* src/kdelibs/khtml/css/csshelper.cpp: (khtml::computeLengthFloat),
	(khtml::setFontSize):
	* src/kdelibs/khtml/css/cssstyleselector.cpp:
	(CSSStyleSelector::CSSStyleSelector), (khtml::applyRule):
	* src/kdelibs/khtml/dom/dom_misc.cpp:
	* src/kdelibs/khtml/dom/dom_misc.h:
	* src/kdelibs/khtml/dom/html_document.cpp: (HTMLDocument::cookie),
	(HTMLDocument::setCookie):
	* src/kdelibs/khtml/dom/html_element.cpp:
	* src/kdelibs/khtml/ecma/kjs_binding.h:
	* src/kdelibs/khtml/ecma/kjs_css.cpp: (DOMCSSStyleDeclarationFunc::tryExecute),
	(DOMStyleSheetListFunc::tryExecute), (DOMMediaListFunc::tryExecute),
	(DOMCSSStyleSheetFunc::tryExecute), (DOMCSSRuleListFunc::tryExecute),
	(DOMCSSRuleFunc::tryExecute), (DOMCSSPrimitiveValueFunc::tryExecute),
	(DOMCSSValueListFunc::tryExecute):
	* src/kdelibs/khtml/ecma/kjs_css.h:
	* src/kdelibs/khtml/ecma/kjs_dom.cpp: (DOMNodeFunc::tryExecute),
	(DOMNodeListFunc::tryExecute), (DOMDocFunction::DOMDocFunction),
	(DOMDocFunction::tryExecute), (DOMElementFunction::DOMElementFunction),
	(DOMElementFunction::tryExecute),
	(DOMDOMImplementationFunction::DOMDOMImplementationFunction),
	(DOMDOMImplementationFunction::tryExecute),
	(DOMNamedNodeMapFunction::DOMNamedNodeMapFunction),
	(DOMNamedNodeMapFunction::tryExecute):
	* src/kdelibs/khtml/ecma/kjs_dom.h:
	* src/kdelibs/khtml/ecma/kjs_window.cpp: (Window::isSafeScript):
	* src/kdelibs/khtml/html/html_formimpl.cpp: (HTMLFormElementImpl::formData),
	(HTMLSelectElementImpl::state), (HTMLSelectElementImpl::restoreState):
	* src/kdelibs/khtml/html/html_headimpl.cpp: (HTMLLinkElementImpl::detach),
	(HTMLStyleElementImpl::detach), (HTMLTitleElementImpl::setTitle):
	* src/kdelibs/khtml/html/html_objectimpl.cpp:
	(HTMLEmbedElementImpl::parseAttribute):
	* src/kdelibs/khtml/html/html_tableimpl.cpp:
	(HTMLTableElementImpl::parseAttribute),
	(HTMLTablePartElementImpl::parseAttribute):
	* src/kdelibs/khtml/html/htmlparser.cpp: (KHTMLParser::parseToken),
	(KHTMLParser::insertNode), (KHTMLParser::getElement),
	(KHTMLParser::processCloseTag), (KHTMLParser::popBlock),
	(KHTMLParser::popOneBlock):
	* src/kdelibs/khtml/html/htmltokenizer.cpp: (HTMLTokenizer::parseSpecial),
	(HTMLTokenizer::scriptHandler), (HTMLTokenizer::parseComment),
	(HTMLTokenizer::parseTag), (HTMLTokenizer::processToken):
	* src/kdelibs/khtml/html/htmltokenizer.h:
	* src/kdelibs/khtml/java/kjavaprocess.h:
	* src/kdelibs/khtml/khtml_part.h:
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::~KHTMLView), (KHTMLView::init),
	(printRenderTree), (KHTMLView::drawContents), (KHTMLView::layout),
	(KHTMLView::viewportMousePressEvent), (KHTMLView::viewportMouseDoubleClickEvent),
	(KHTMLView::viewportMouseMoveEvent), (KHTMLView::viewportMouseReleaseEvent),
	(KHTMLView::addFormCompletionItem):
	* src/kdelibs/khtml/khtmlview.h:
	* src/kdelibs/khtml/misc/decoder.cpp: (Decoder::setEncoding), (Decoder::decode):
	* src/kdelibs/khtml/misc/helper.cpp: (khtml::setNamedColor):
	* src/kdelibs/khtml/misc/loader.h:
	* src/kdelibs/khtml/rendering/bidi.cpp: (RenderFlow::layoutInlineChildren):
	* src/kdelibs/khtml/rendering/render_applet.cpp: (RenderApplet::RenderApplet):
	* src/kdelibs/khtml/rendering/render_body.cpp: (RenderBody::layout):
	* src/kdelibs/khtml/rendering/render_box.cpp: (RenderBox::printBackground):
	* src/kdelibs/khtml/rendering/render_flow.cpp: (RenderFlow::print):
	* src/kdelibs/khtml/rendering/render_form.cpp:
	(RenderFormElement::baselinePosition), (RenderFormElement::slotClicked),
	(RenderCheckBox::RenderCheckBox), (RenderCheckBox::performAction),
	(RenderRadioButton::RenderRadioButton), (RenderRadioButton::slotClicked),
	(RenderSubmitButton::RenderSubmitButton), (RenderSubmitButton::baselinePosition),
	(RenderLineEdit::RenderLineEdit), (RenderLineEdit::calcMinMaxWidth),
	(RenderLineEdit::performAction), (RenderFileButton::RenderFileButton),
	(RenderSelect::RenderSelect), (RenderSelect::layout),
	(RenderSelect::createListBox), (RenderSelect::createComboBox),
	(RenderTextArea::RenderTextArea), (RenderTextArea::calcMinMaxWidth),
	(RenderTextArea::layout):
	* src/kdelibs/khtml/rendering/render_form.h:
	* src/kdelibs/khtml/rendering/render_frames.cpp:
	(RenderPartObject::updateWidget):
	* src/kdelibs/khtml/rendering/render_hr.cpp: (RenderHR::print):
	* src/kdelibs/khtml/rendering/render_image.cpp: (RenderImage::printObject):
	* src/kdelibs/khtml/rendering/render_list.cpp: (RenderListMarker::printObject):
	* src/kdelibs/khtml/rendering/render_style.h:
	* src/kdelibs/khtml/rendering/render_table.cpp: (RenderTable::calcFinalColMax),
	(RenderTable::layoutRows):
	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration),
	(TextSlaveArray::findFirstMatching), (RenderText::print):
	* src/kdelibs/khtml/xml/dom_docimpl.cpp: (DocumentImpl::recalcStyle):
	* src/kdelibs/khtml/xml/dom_nodeimpl.cpp: (NodeImpl::renderer):
	* src/kdelibs/khtml/xml/dom_nodeimpl.h:
	* src/kdelibs/khtml/xml/dom_stringimpl.cpp: (DOMStringImpl::toLengthList):

2002-03-06  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQKURL.mm: (KURL::KURL): If resolving a relative URL
	fails, assume it's absolute and possibly malformed, rather than
	appending it to the path of the previous URL. This fixes a
	CPU-spinning hang that John and Richard found.

2002-03-05  Richard Williamson  <rjw@apple.com>

        Pass errors correctly to browser.
        Removed old notification code.
        Added support for IFError.
        Lots of little cleanups.
        
	* src/kwq/KWQComboBox.mm: (QComboBox::setCurrentItem):
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandleResourceDidBeginLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidCancelLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]), (KHTMLPart::openURL),
	(KHTMLPart::closeURL):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):
	* src/kwq/WCError.h:
	* src/kwq/WCWebDataSource.h:
	* src/kwq/external.h:

2002-03-05  Richard Williamson  <rjw@apple.com>

        With fonts now being correctly specified we're exercising some new code paths.  This introduced a new
        class of weird string bugs.  Turns out that CFString is doing some mojo that I suspect is a performance
        optimization.  Constants strings appears to be uniqued and hard-wired to have a -1 retain count.  It
        looks like strings created by preferences are uniqued in this manner.  This plays havoc with our
        copy-on-write QString implementation.  The following GDB exercise illustrates the problem:
        
        (gdb) po (id)[(id)[NSUserDefaults standardUserDefaults] objectForKey:(id)[NSString stringWithCString: "WebKitFixedFont"]]
        Andale Mono
        (gdb) p (int)[(id)[(id)[NSUserDefaults standardUserDefaults] objectForKey:(id)[NSString stringWithCString: "WebKitFixedFont"]] retainCount]
        $28 = -1
        (gdb) p (id)[(id)[NSUserDefaults standardUserDefaults] objectForKey:(id)[NSString stringWithCString: "WebKitFixedFont"]]
        $27 = (objc_object *) 0x40172a4
        (gdb) p (void)[$27 retain]
        $29 = void
        (gdb) p (int)[$27 retainCount]
        $30 = -1
        (gdb) p (void)[$27 release]
        $33 = void
        (gdb) p (int)[$27 retainCount]
        $32 = -1
        
        So, it appears that these strings are permanently allocated.  It'd be interesting to find out what is in the uniqued string cache, and how big it is.
        
        I've fixed the problem by special casing our copy-on-write trigger to also check for -1.

	* src/kwq/KWQString.mm: (QString::_copyIfNeededInternalString):

2002-03-04  Richard Williamson  <rjw@apple.com>
 
        Changes to support 'provisional' data sources.
        API changes to IFBaseWebController, removed redundant methods.
 
	* src/kwq/KWQKHTMLPart.mm: (WCSetIFWebDataSourceMakeFunc), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidBeginLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidCancelLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]),
	(KHTMLPart::khtmlMouseReleaseEvent), (KHTMLPart::submitForm),
	(KHTMLPart::requestFrame):
	* src/kwq/external.h:

2002-02-28  Richard Williamson  <rjw@apple.com>

        Finished up progress notification for main document.  
        Made the IFLoadProgress allocator accessible to KHTMLPart.mm.
        
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	setDataSource:]), (KHTMLPart::openURL):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]):
	* src/kwq/WCLoadProgress.h:

2002-02-27  Kenneth Kocienda  <kocienda@apple.com>

	I have changed the way that WebCore is glued to WebFoundation and WebKit. 
	If you used or relied upon any code in the following files, you should 
	now use the IF* equivalents straight up. 

	- Labyrinth/WebCore/include/WCBackForwardList.h
	- Labyrinth/WebCore/include/WCURICache.h
	- Labyrinth/WebCore/include/WCURICacheData.h
	- Labyrinth/WebCore/include/WCURIEntry.h
	- Labyrinth/WebCore/include/WCURIEntry.h

	All changes in this commit are related to making dependant code work with the new convention.

	* include/WCBackForwardList.h:
	* include/WCURICache.h:
	* include/WCURICacheData.h:
	* include/WCURIEntry.h:
	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	IFURLHandleResourceDidBeginLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidCancelLoading:]), (-[KHTMLPartLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[KHTMLPartLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]), (KHTMLPart::slotData),
	(KHTMLPart::openURL):
	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/KWQKloader.mm: (-[URLLoadClient IFURLHandleResourceDidBeginLoading:]),
	(-[URLLoadClient IFURLHandleResourceDidCancelLoading:]), (-[URLLoadClient
	IFURLHandleResourceDidFinishLoading:data:]), (-[URLLoadClient
	IFURLHandle:resourceDataDidBecomeAvailable:]), (-[URLLoadClient
	IFURLHandle:resourceDidFailLoadingWithResult:]):
	* src/kwq/Makefile.am:
	* src/kwq/kio/jobclasses.h:

2002-02-27  Maciej Stachowiak  <mjs@apple.com>

	Replace QDir and QFile with clean-room implementations. Add glob
	support ot QRegExp reimplementation.

	* src/kwq/KWQDir.mm: (QDir::KWQDirPrivate::KWQDirPrivate),
	(QDir::KWQDirPrivate::~KWQDirPrivate), (QDir::QDir), (QDir::~QDir),
	(QDir::absPath), (QDir::absFilePath), (QDir::cdUp), (QDir::exists),
	(QDir::entryList), (QDir::operator=), (QDir::swap):
	* src/kwq/KWQFile.mm: (QFile::KWQFilePrivate::KWQFilePrivate),
	(QFile::KWQFilePrivate::~KWQFilePrivate), (QFile::QFile), (QFile::~QFile),
	(QFile::exists), (QFile::open), (QFile::close), (QFile::readBlock),
	(QFile::size):
	* src/kwq/KWQRegExp.mm: (QRegExp::KWQRegExpPrivate::KWQRegExpPrivate),
	(RegExpFromGlob), (QRegExp::KWQRegExpPrivate::compile), (QRegExp::QRegExp):
	* src/kwq/KWQStrList.h:
	* src/kwq/Makefile.am:
	* src/kwq/qt/_qdir.h:
	* src/kwq/qt/_qfile.h:
	* src/kwq/qt/_qfileinfo.h:
	* src/kwq/qt/qdir.h:
	* src/kwq/qt/qfile.h:
	* src/kwq/qt/qiodevice.h:
	* src/kwq/qt/qregexp.h:

2002-02-25  Maciej Stachowiak  <mjs@apple.com>

	Fix two significant memory leaks in QList found by our automated
	leak-checking code.

	* src/kwq/KWQListImpl.mm: (KWQListNode::~KWQListNode),
	(KWQListImpl::KWQListPrivate::copyList),
	(KWQListImpl::KWQListPrivate::~KWQListPrivate), (KWQListImpl::sort):

	Fix a tiny bug tweaked by the new regexp code - we need to flush
	the cache after calling out to QRegExp::match because it might
	make calls on the string which create a cache. Caught by the
	regression tests.
	
	* src/kwq/KWQString.mm: (QString::replace): 
	
2002-02-24  Maciej Stachowiak  <mjs@apple.com>

	Reimplemented QRegExp in terms of POSIX regexp facilities. This
	will only support Latin1, however, it won't support all languages.
	
	* src/kwq/qt/qregexp.h:
	* src/kwq/KWQRegExp.mm: (QRegExp::KWQRegExpPrivate::KWQRegExpPrivate),
	(QRegExp::KWQRegExpPrivate::compile),
	(QRegExp::KWQRegExpPrivate::~KWQRegExpPrivate), (QRegExp::QRegExp),
	(QRegExp::~QRegExp), (QRegExp::operator=), (QRegExp::pattern), (QRegExp::match):

	Reimplement QValueList as a doubly-linked list, using a generic
	implementation class and a templatized facade.
	
	* src/kwq/qt/qvaluelist.h:
	* src/kwq/KWQValueListImpl.h:
	* src/kwq/KWQValueListImpl.mm: (KWQValueListNodeImpl::KWQValueListNodeImpl),
	(KWQValueListNodeImpl::~KWQValueListNodeImpl),
	(KWQValueListIteratorImpl::KWQValueListIteratorImpl),
	(KWQValueListIteratorImpl::~KWQValueListIteratorImpl),
	(KWQValueListIteratorImpl::operator=), (KWQValueListIteratorImpl::operator==),
	(KWQValueListIteratorImpl::operator!=), (KWQValueListIteratorImpl::node),
	(KWQValueListIteratorImpl::operator++), (KWQValueListIteratorImpl::operator--),
	(KWQValueListImpl::KWQValueListPrivate::KWQValueListPrivate),
	(KWQValueListImpl::KWQValueListPrivate::~KWQValueListPrivate),
	(KWQValueListImpl::KWQValueListPrivate::copyList),
	(KWQValueListImpl::KWQValueListPrivate::deleteList),
	(KWQValueListImpl::KWQValueListImpl), (KWQValueListImpl::~KWQValueListImpl),
	(KWQValueListImpl::clear), (KWQValueListImpl::count),
	(KWQValueListImpl::isEmpty), (KWQValueListImpl::appendNode),
	(KWQValueListImpl::prependNode), (KWQValueListImpl::removeEqualNodes),
	(KWQValueListImpl::containsEqualNodes), (KWQValueListImpl::removeIterator),
	(KWQValueListImpl::fromLast), (KWQValueListImpl::firstNode),
	(KWQValueListImpl::lastNode), (KWQValueListImpl::begin), (KWQValueListImpl::end),
	(KWQValueListImpl::nodeAt), (KWQValueListImpl::operator=),
	(KWQValueListImpl::copyOnWrite):
	* src/kwq/Makefile.am:

	* src/kwq/kio/netaccess.h: Don't declare private copy constructor
	- this class needs to be copyable to be stored in a QValueList!

	Hack these scripts a bit so the large tables they generate are
	constant data.
	
	* src/kwq/make-charset-table.pl:
	* src/kdelibs/khtml/css/makeprop:
	* src/kdelibs/khtml/css/makevalues:
	* src/kdelibs/khtml/misc/makeattrs:
	* src/kdelibs/khtml/misc/maketags:

2002-02-23  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/WCLoadProgress.h: Add the forgotten WCLoadProgress.h.

2002-02-22  Maciej Stachowiak  <mjs@apple.com>

	Fix prebinding:

	* src/Makefile.am: Enable prebinding, set first segment address to
	0x2200000 to avoid colliding with apps or our other
	frameworks. Change other link flags to support prebinding.

	Set up some hacks to avoid link-time dependency on
	WebKit. Prebinding is incompatible with - undefined suppress, so
	we can't have WebCore depend on symbols provided by WebKit any
	more:
	
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKloader.mm: (WCSetIFLoadProgressMakeFunc), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:data:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]):
	* src/kwq/WCPluginWidget.h:
	* src/kwq/WCPluginWidget.mm: (WCSetIFPluginMakeFunc),
	(WCPluginWidget::WCPluginWidget):

2002-02-22  Richard Williamson  <rjw@apple.com>

        Added data: to IFURLHandleResourceDidFinishLoading:
        
	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandleResourceDidFinishLoading:data:userData:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:data:userData:]):

2002-02-22  Kenneth Kocienda  <kocienda@apple.com>

	Sent handle an autorelease message.

	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]):

2002-02-21  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQString.mm: (QString::fill): Fix a bug that was
	triggering assertion failures in CF.
	
	* src/kdelibs/kjs/kjs-test: Turn off some environment variables to
	make the tests pass.

2002-02-21  Richard Williamson  <rjw@apple.com>

    Stop mostly working.
    
	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]),
	(Loader::servePendingRequests):
	* src/kwq/kio/jobclasses.h:

2002-02-21  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQString.mm: (QString::fromCFString): Don't pass a
	length to CFStringCreateMutableCopy, since that makes the string
	fixed-length, which makes assertions fail when in debugging mode.

2002-02-20  Richard Williamson  <rjw@apple.com>

    Some groundwork to bring WebFoundation callbacks up to 
    WebKit.
    
	* src/kdelibs/khtml/misc/loader.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandleResourceDidBeginLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]), (-[KHTMLPartLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]), (KHTMLPart::openURL),
	(KHTMLPart::closeURL), (KHTMLPart::write), (KHTMLPart::checkCompleted):
	* src/kwq/KWQKloader.mm: (CachedCSSStyleSheet::CachedCSSStyleSheet),
	(CachedScript::CachedScript), (CachedImage::CachedImage), (-[URLLoadClient
	initWithLoader:dataSource:]), (-[URLLoadClient
	WCURLHandleResourceDidBeginLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]), (Loader::load),
	(Loader::servePendingRequests), (Cache::requestImage),
	(Cache::requestStyleSheet), (Cache::requestScript):
	* src/kwq/kio/jobclasses.h:

2002-02-20  Maciej Stachowiak  <mjs@apple.com>

	* src/kdelibs/kjs/kjs-test:
	* src/kwq/KWQKURL.mm: (KURL::setQuery):

2002-02-18  Kenneth Kocienda  <kocienda@apple.com>

	* src/Makefile.am:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseMoveEvent):
	* src/kwq/KWQView.mm: (-[KWQHTMLView mouseUp:]), (-[KWQHTMLView mouseDown:]):
	* src/kwq/kde/_kurl.cpp: (KURL::htmlRef):

2002-02-18  Richard Williamson  <rjw@apple.com>

        Fixed the prefences won't stay in front problem after John found 
        and correctly diagnosed the problem.
        
	* src/kwq/KWQWidget.mm: (QWidget::show), (QWidget::hide):

2002-02-18  Richard Williamson  <rjw@apple.com>

        Performance measurement.
        
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::begin), (KHTMLPart::write):

2002-02-16  Maciej Stachowiak  <mjs@apple.com>

	Reimplement KURL in terms of CFURL (many workarounds needed to
	account for differing semantics).

	* src/kwq/kdecore/kurl.h:
	* src/kwq/KWQKURL.mm: (KURL::KWQKURLPrivate::KWQKURLPrivate),
	(KURL::KWQKURLPrivate::~KWQKURLPrivate), (KURL::KWQKURLPrivate::init),
	(KURL::KWQKURLPrivate::makeRef), (CFStringToQString), (escapeQString),
	(pathEndsWithSlash), (KWQCFURLCopyEscapedPath),
	(KURL::KWQKURLPrivate::decompose), (KURL::KWQKURLPrivate::compose), (KURL::KURL),
	(KURL::~KURL), (KURL::isEmpty), (KURL::isMalformed), (KURL::hasPath),
	(KURL::url), (KURL::protocol), (KURL::host), (KURL::port), (KURL::pass),
	(KURL::user), (KURL::ref), (KURL::query), (KURL::path), (KURL::setProtocol),
	(KURL::setHost), (KURL::setPort), (KURL::setRef), (KURL::setQuery),
	(KURL::setPath), (KURL::prettyURL), (KURL::operator=), (KURL::decode_string),
	(KURL::copyOnWrite):
	* src/kwq/Makefile.am: Add new file to build.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::begin,
	KHTMLPart::submitForm): Don't 

	Minor tweaks to make it all build:

	* src/kwq/kde/_kurl.cpp:
	* src/kwq/qt/_qurl.cpp:
	* src/kwq/qt/_qurl.h:

2002-02-16  Richard Williamson  <rjw@apple.com>

        Fixed problem with default text not showing up in text area.
        Fixed problem with scroll widgets not showing up in select list.
        
	* src/kdelibs/khtml/rendering/render_form.cpp: (RenderSelect::layout):
	* src/kwq/KWQListBox.mm: (QListBox::QListBox):
	* src/kwq/KWQTextArea.mm: (-[KWQTextArea _createTextView]), (-[KWQTextArea
	initWithFrame:widget:]), (-[KWQTextArea setFrame:]):

2002-02-15  Richard Williamson  <rjw@apple.com>
    
    Lots of changes to support forms.

	* src/kdelibs/khtml/rendering/render_form.cpp: (RenderFormElement::slotClicked),
	(RenderCheckBox::performAction), (RenderRadioButton::slotClicked),
	(RenderSelect::RenderSelect), (RenderSelect::layout),
	(RenderSelect::performAction), (RenderTextArea::layout), (RenderTextArea::text),
	(RenderTextArea::performAction):
	* src/kdelibs/khtml/rendering/render_form.h:
	* src/kwq/KWQCheckBox.mm: (QCheckBox::QCheckBox), (QCheckBox::isChecked):
	* src/kwq/KWQComboBox.mm: (QComboBox::indexOfCurrentItem):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::requestFrame):
	* src/kwq/KWQListBox.h:
	* src/kwq/KWQListBox.mm: (-[KWQBrowserDelegate initWithListBox:]),
	(-[KWQBrowserDelegate browser:numberOfRowsInColumn:]), (-[KWQBrowserDelegate
	browser:willDisplayCell:atRow:column:]), (-[KWQBrowserDelegate
	browserSingleClick:]), (-[KWQBrowserDelegate browserDoubleClick:]),
	(QListBox::QListBox), (QListBox::~QListBox), (QListBox::count),
	(QListBox::scrollBarWidth), (QListBox::clear), (QListBox::setSelectionMode),
	(QListBox::currentItem), (QListBox::insertItem), (QListBox::setSelected),
	(QListBox::isSelected), (QListBoxItem::QListBoxItem),
	(QListBoxItem::~QListBoxItem), (QListBoxItem::setSelectable),
	(QListBoxItem::width), (QListBoxItem::height):
	* src/kwq/KWQNSTextField.mm: (-[KWQNSTextField action:]), (-[KWQNSTextField
	controlTextDidEndEditing:]):
	* src/kwq/KWQScrollView.mm: (QScrollView::addChild):
	* src/kwq/KWQTextArea.mm: (-[KWQTextArea initWithFrame:]), (-[KWQTextArea
	_createTextView]), (-[KWQTextArea initWithFrame:widget:]), (-[KWQTextArea
	textDidEndEditing:]), (-[KWQTextArea setFrame:]):
	* src/kwq/KWQTextEdit.mm: (QMultiLineEdit::setCursorPosition),
	(QMultiLineEdit::getCursorPosition):
	* src/kwq/KWQView.mm: (-[KWQNSButton stateChanged:]), (-[KWQNSComboBox
	initWithFrame:widget:]), (-[KWQNSComboBox action:]):
	* src/kwq/KWQWidget.mm: (QWidget::endEditing):
	* src/kwq/qt/qcheckbox.h:
	* src/kwq/qt/qcombobox.h:
	* src/kwq/qt/qobject.h:

2002-02-13  Richard Williamson  <rjw@apple.com>
    
    Use NSSwitchButtons for check boxes.

	* src/kwq/KWQCheckBox.mm: (QCheckBox::QCheckBox):

2002-02-13  Richard Williamson  <rjw@apple.com>

    Removed dead code from setView.
    
	* src/kwq/KWQWidget.mm: (QWidget::setView):

2002-02-12  Richard Williamson  <rjw@apple.com>

    Made basic forms work.

	* src/kdelibs/khtml/rendering/render_form.cpp:
	(RenderFormElement::performAction), (RenderLineEdit::RenderLineEdit),
	(RenderLineEdit::performAction):
	* src/kdelibs/khtml/rendering/render_form.h:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::submitForm):
	* src/kwq/KWQLineEdit.mm: (QLineEdit::text):
	* src/kwq/KWQNSTextField.mm: (-[KWQNSTextField initWithFrame:widget:]),
	(-[KWQNSTextField action:]), (-[KWQNSTextField controlTextDidEndEditing:]),
	(-[KWQNSTextField setMaximumLength:]), (-[KWQNSTextField maximumLength]):
	* src/kwq/KWQObject.mm: (QObject::emitAction), (QObject::performAction):
	* src/kwq/KWQWidget.mm: (QWidget::setView), (QWidget::endEditing):
	* src/kwq/kwqdebug.mm: (KWQGetLogLevel):
	* src/kwq/qt/qlineedit.h:
	* src/kwq/qt/qobject.h:
	* src/kwq/qt/qwidget.h:

2002-02-12  Maciej Stachowiak  <mjs@apple.com>

	Make some tweaks to glue together KDE's and CF's concepts of URLs
	a bit better. In particular, CF thinks "file:/some/path" is an
	invalid URL, while KDE thinks this is the canonical form for a
	file URL.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::closeURL),
	(KHTMLPart::checkCompleted):
	* src/kwq/KWQKjobclasses.mm:

2002-02-12  Maciej Stachowiak  <mjs@apple.com>

	Reimplemented QList, QVector and QCollection from
	scratch. Implemented copy-on-write optimization for QMap.

	Minimally reimplement QCollection.

	* src/kwq/qt/qcollection.h:
	* src/kwq/KWQCollection.mm: (QCollection::QCollection), (QCollection::operator=),
	(QCollection::~QCollection), (QCollection::autoDelete),
	(QCollection::setAutoDelete):

	* src/kwq/qt/qdict.h, src/kwq/qt/qptrdict.h: Include
	qcollection.h, not _qcollection.h

	Reimplement QList as a doubly-linked list.
	
	* src/kwq/qt/qlist.h:
	* src/kwq/KWQListImpl.h:
	* src/kwq/KWQListImpl.mm: (KWQListImpl::KWQListPrivate::copyList),
	(KWQListImpl::KWQListPrivate::KWQListPrivate),
	(KWQListImpl::KWQListPrivate::~KWQListPrivate),
	(KWQListIteratorImpl::KWQListIteratorPrivate::KWQListIteratorPrivate),
	(KWQListImpl::KWQListImpl), (KWQListImpl::~KWQListImpl), (KWQListImpl::isEmpty),
	(KWQListImpl::count), (KWQListImpl::clear), (KWQListImpl::sort),
	(KWQListImpl::at), (KWQListImpl::insert), (KWQListImpl::remove),
	(KWQListImpl::removeFirst), (KWQListImpl::removeLast), (KWQListImpl::removeRef),
	(KWQListImpl::getLast), (KWQListImpl::current), (KWQListImpl::first),
	(KWQListImpl::last), (KWQListImpl::next), (KWQListImpl::prev),
	(KWQListImpl::take), (KWQListImpl::append), (KWQListImpl::prepend),
	(KWQListImpl::containsRef), (KWQListImpl::assign), (KWQListImpl::addIterator),
	(KWQListImpl::removeIterator), (KWQListIteratorImpl::KWQListIteratorImpl),
	(KWQListIteratorImpl::~KWQListIteratorImpl), (KWQListIteratorImpl::count),
	(KWQListIteratorImpl::toFirst), (KWQListIteratorImpl::toLast),
	(KWQListIteratorImpl::current), (KWQListIteratorImpl::operator--),
	(KWQListIteratorImpl::operator++), (KWQListIteratorImpl::operator=):

	Reimplement QVector in terms of CFArray.
	
	* src/kwq/qt/qvector.h:
	* src/kwq/KWQVectorImpl.h:
	* src/kwq/KWQVectorImpl.mm: (KWQVectorImpl::KWQVectorPrivate::KWQVectorPrivate),
	(KWQVectorImpl::KWQVectorPrivate::~KWQVectorPrivate),
	(KWQVectorImpl::KWQVectorImpl), (KWQVectorImpl::~KWQVectorImpl),
	(KWQVectorImpl::clear), (KWQVectorImpl::isEmpty), (KWQVectorImpl::count),
	(KWQVectorImpl::size), (KWQVectorImpl::remove), (KWQVectorImpl::resize),
	(KWQVectorImpl::insert), (KWQVectorImpl::at), (KWQVectorImpl::assign),
	(KWQVectorImpl::KWQVectorImpl::swap):

	Implemented copy-on-write optimization for QMap. This had the
	pleasant side effect of improving the separation between pointer
	manipulation and key/value manipulation.

	* src/kwq/qt/qmap.h:
	* src/kwq/KWQMapImpl.h:
	* src/kwq/KWQMapImpl.mm: (KWQMapImpl::KWQMapPrivate::KWQMapPrivate),
	(KWQMapImpl::KWQMapPrivate::~KWQMapPrivate), (KWQMapImpl::KWQMapImpl),
	(KWQMapImpl::~KWQMapImpl), (KWQMapImpl::copyOnWrite), (KWQMapImpl::copyTree),
	(KWQMapImpl::rebalanceAfterInsert), (KWQMapImpl::rebalanceAfterRemove),
	(KWQMapImpl::findInternal), (KWQMapImpl::insertInternal),
	(KWQMapImpl::removeInternal), (KWQMapImpl::swap), (KWQMapImpl::countInternal),
	(KWQMapImpl::clearInternal), (KWQMapImpl::beginInternal),
	(KWQMapImpl::endInternal):

	* src/kwq/Makefile.am: Add new files to build.

	* src/kdelibs/khtml/rendering/render_text.cpp
	(TextSlaveArray::findFirstMatching): Fix two places where the KDE
	code was depending on implementation details of QVector.

2002-02-07  Richard Williamson  <rjw@apple.com>

    More changes to IFLocationChangeHandler API.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent):

2002-02-07  Richard Williamson  <rjw@apple.com>

    Factored URL loading code out and moved to IFBaseWebController.
    
	* ChangeLog:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::requestFrame):

2002-02-06  Richard Williamson  <rjw@apple.com>

    Fixed allocation problems.
    
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::requestFrame):

2002-02-05  Richard Williamson  <rjw@apple.com>

    Updated part to use 'official' controller APIs.
    
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::~KHTMLPart),
	(KHTMLPart::khtmlMouseReleaseEvent), (KHTMLPart::requestFrame),
	(KHTMLPart::checkCompleted):

2002-02-05  Richard Williamson  <rjw@apple.com>

    Changes to support dynamic scroll bars in frames/iframes.

	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent):
	* src/kwq/KWQScrollView.mm: (QScrollView::addChild),
	(QScrollView::resizeContents), (QScrollView::updateContents),
	(QScrollView::repaintContents):
	* src/kwq/KWQWidget.mm: (QWidget::resize), (QWidget::move),
	(QWidget::internalSetGeometry):

2002-02-05  Kenneth Kocienda  <kocienda@apple.com>

	Changes to move these last bits of code to the new cache API.

	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/WKPluginView.h:
	* src/kwq/WKPluginView.mm: (-[WKPluginView drawRect:]), (-[WKPluginView
	WCURLHandleResourceDidBeginLoading:userData:]), (-[WKPluginView
	WCURLHandleResourceDidCancelLoading:userData:]), (-[WKPluginView
	WCURLHandleResourceDidFinishLoading:userData:]), (-[WKPluginView
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]), (-[WKPluginView
	WCURLHandle:resourceDidFailLoadingWithResult:userData:]):

2002-02-04  Maciej Stachowiak  <mjs@apple.com>

	Fix everything for WK --> IF rename.

	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::requestFrame), (KHTMLPart::checkCompleted):

2002-02-01  Kenneth Kocienda  <kocienda@apple.com>

	More cleanups to the no-copy NSData API.
	This time the callback from the cache/loader has been
	simplified from:
	- (void)WKURLHandle:(WKURLHandle *)sender resourceDataDidBecomeAvailable:(UInt8 *)bytes offset:(unsigned)offset length:(unsigned)length;
	to:
	- (void)WKURLHandle:(WKURLHandle *)sender resourceDataDidBecomeAvailable:(NSData *)data;
	This was made possible by some rearrangement in the private API.

	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:userData:]):

2002-02-01  Richard Williamson  <rjw@apple.com>

    Added support for dynamic scrolling frames.  Also added first callback for
    WKLocationChangeHandler.
    
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::end), (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::checkCompleted):

2002-02-01  Kenneth Kocienda  <kocienda@apple.com>

        Made some cleanups to the no-copy NSData API, and those changes
        make the use of the no-copy functionality in this client code
        much cleaner.
        
	* include/WCURLHandle.h:
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]):

2002-01-31  Richard Williamson  <rjw@apple.com>

    Added QString constructor, fixed javascript at head of document bug.
    
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::openURL), (KHTMLPart::closeURL),
	(KHTMLPart::write):
	* src/kwq/KWQString.mm: (QString::QString):
	* src/kwq/qt/qstring.h:

2002-01-31  Richard Williamson  <rjw@apple.com>

	* src/kdelibs/khtml/html/html_headimpl.cpp: (HTMLStyleElementImpl::detach):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::write):

2002-01-31  Kenneth Kocienda  <kocienda@apple.com>

        Changes to incorporate use of the no-copy NSData object.

	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]):
	* src/kwq/KWQKloader.mm: (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]):

2002-01-30  Richard Williamson  <rjw@apple.com>
    
    Cleaned up frame code a bit.  Fixed duplicate content problem.

	* src/kdelibs/khtml/html/html_headimpl.cpp: (HTMLLinkElementImpl::detach):
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::layout):
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::~KHTMLPart), (KHTMLPart::openURL),
	(KHTMLPart::requestFrame):

2002-01-30  Kenneth Kocienda  <kocienda@apple.com>

        Added *.lo, *.la, and .libs to .cvsignore files
        
	* .cvsignore:
	* src/.cvsignore:
	* src/kdelibs/khtml/css/.cvsignore:
	* src/kdelibs/khtml/misc/.cvsignore:
	* src/kdelibs/kjs/.cvsignore:

2002-01-29  Richard Williamson  <rjw@apple.com>

    Fixed QConstString to make a copy on initial chars.
    
	* ChangeLog:
	* src/kwq/KWQString.mm: (QString::_copyIfNeededInternalString),
	(QString::insert), (QString::remove), (QString::replace), (QString::truncate),
	(QConstString::QConstString):
	* src/kwq/qt/qstring.h:

2002-01-29  Richard Williamson  <rjw@apple.com>

	* src/kwq/KWQString.mm: (QString::_copyIfNeededInternalString),
	(QString::insert), (QString::remove), (QString::replace), (QString::truncate),
	(QConstString::QConstString):
	* src/kwq/qt/qstring.h:

2002-01-29  Kenneth Kocienda  <kocienda@apple.com>

        - Added in a dummy protocol to clean up a warning that results
        from calling a method on an id.
        - Cleaned up handle variable in KWQKHTMLPart. This can now be freed
        once we get a proper notification that a load is done.
        - Support for reading text encoding from HTTP headers added back in.
        
	* include/WCURLHandle.h:
	* src/kwq/KWQKHTMLPart.mm: (encodingFromContentType), (KHTMLPart::slotData),
	(KHTMLPart::openURL), (KHTMLPart::closeURL):

2002-01-29  Richard Williamson  <rjw@apple.com>

    First pass as frame code.  Still needs cleanup.
    
	* src/kdelibs/khtml/dom/dom_misc.cpp: (DomShared::ref), (DomShared::deref):
	* src/kdelibs/khtml/dom/dom_misc.h:
	* src/kdelibs/khtml/khtmlview.cpp: (KHTMLView::~KHTMLView):
	* src/kwq/KWQComboBox.mm: (QComboBox::setCurrentItem):
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::~KHTMLPart), (KHTMLPart::begin),
	(KHTMLPart::end), (KHTMLPart::xmlDocImpl), (KHTMLPart::khtmlMouseReleaseEvent),
	(KHTMLPart::requestFrameName), (KHTMLPart::requestFrame),
	(KHTMLPart::requestObject), (KHTMLPart::checkCompleted):

2002-01-29  Kenneth Kocienda  <kocienda@apple.com>

        Checked in the missing file
        
	* include/WCURLHandle.h:

2002-01-29  Kenneth Kocienda  <kocienda@apple.com>

        Changed over to the new cache loader in WebFoundation
        
	* src/kwq/KWQKHTMLPart.h:
	* src/kwq/KWQKHTMLPart.mm: (-[KHTMLPartLoadClient init]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidBeginLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[KHTMLPartLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]),
	(-[KHTMLPartLoadClient WCURLHandle:resourceDidFailLoadingWithResult:userData:]),
	(-[KHTMLPartLoadClient dealloc]), (KHTMLPart::slotData), (KHTMLPart::openURL):
	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/KWQKloader.mm: (-[URLLoadClient initWithLoader:]), (-[URLLoadClient
	WCURLHandleResourceDidBeginLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidCancelLoading:userData:]), (-[URLLoadClient
	WCURLHandleResourceDidFinishLoading:userData:]), (-[URLLoadClient
	WCURLHandle:resourceDataDidBecomeAvailable:offset:length:userData:]),
	(-[URLLoadClient WCURLHandle:resourceDidFailLoadingWithResult:userData:]),
	(-[URLLoadClient dealloc]):
	* src/kwq/kio/jobclasses.h:

2002-01-29  Maciej Stachowiak  <mjs@apple.com>

	Reimplement QDict, QMap, QPtrDict and QSortedList.

	Reimplement QDict in terms of CFDictionary:
	
	* src/kwq/qt/qdict.h:
	* src/kwq/KWQDictImpl.h:
	* src/kwq/KWQDictImpl.mm: (KWQDictImpl::KWQDictImpl), (KWQDictImpl::insert),
	(KWQDictImpl::remove), (KWQDictImpl::find),
	(KWQDictIteratorImpl::KWQDictIteratorImpl),
	(KWQDictIteratorImpl::currentStringKey):

	Reimplement QMap as a right-threaded red-black tree, splitting
	the work between template classes that manipulate keys and values
	and non-template base classes that handle all the pointer
	manipulation:
	
	* src/kwq/qt/qmap.h:
	* src/kwq/KWQMapImpl.h:
	* src/kwq/KWQMapImpl.mm: (KWQMapNodeImpl::KWQMapNodeImpl),
	(KWQMapNodeImpl::left), (KWQMapNodeImpl::right), (KWQMapNodeImpl::predecessor),
	(KWQMapNodeImpl::successor), (KWQMapIteratorImpl::KWQMapIteratorImpl),
	(KWQMapIteratorImpl::incrementInternal), (KWQMapImpl::KWQMapImpl),
	(KWQMapImpl::rotateRight), (KWQMapImpl::rotateLeft),
	(KWQMapImpl::rebalanceAfterInsert), (KWQMapImpl::rebalanceAfterRemove),
	(KWQMapImpl::findInternal), (KWQMapImpl::insertInternal),
	(KWQMapImpl::removeInternal), (KWQMapImpl::swap), (KWQMapImpl::countInternal),
	(KWQMapImpl::clearInternal), (KWQMapImpl::beginInternal),
	(KWQMapImpl::endInternal):

	Reimplement QPtrDict in terms of CFDictionary:

	* src/kwq/qt/qptrdict.h:
	* src/kwq/KWQPtrDictImpl.h:
	* src/kwq/KWQPtrDictImpl.mm:
	(KWQPtrDictImpl::KWQPtrDictPrivate::KWQPtrDictPrivate),
	(KWQPtrDictImpl::KWQPtrDictPrivate::~KWQPtrDictPrivate),
	(KWQPtrDictImpl::KWQPtrDictImpl), (KWQPtrDictImpl::~KWQPtrDictImpl),
	(invokeDeleteFuncOnValue), (KWQPtrDictImpl::clear), (KWQPtrDictImpl::count),
	(KWQPtrDictImpl::insert), (KWQPtrDictImpl::remove), (KWQPtrDictImpl::find),
	(KWQPtrDictImpl::swap), (KWQPtrDictImpl::assign), (KWQPtrDictImpl::take),
	(KWQPtrDictIteratorImpl::KWQPtrDictIteratorPrivate::KWQPtrDictIteratorPrivate),
	(KWQPtrDictIteratorImpl::KWQPtrDictIteratorPrivate::~KWQPtrDictIteratorPrivate),
	(KWQPtrDictIteratorImpl::KWQPtrDictIteratorImpl),
	(KWQPtrDictIteratorImpl::~KWQPtrDictIteratorImpl),
	(KWQPtrDictIteratorImpl::count), (KWQPtrDictIteratorImpl::current),
	(KWQPtrDictIteratorImpl::currentKey), (KWQPtrDictIteratorImpl::toFirst),
	(KWQPtrDictIteratorImpl::operator++):

	Reimplement QSortedList:
	
	* src/kwq/qt/qsortedlist.h:

	* src/kwq/KWQArrayImpl.mm: Remove stray include.

	* src/kwq/Makefile.am: Add new files to build.

	* src/kwq/qt/_qdict.h, src/kwq/qt/_qgdict.h,
	src/kwq/qt/_qptrdict.h: Avoid causing problems when the relevant
	defines are not defined.

2002-01-22  Richard Williamson  <rjw@apple.com>

    Implemented KWQDesktopWidget to represent main screen.  Used by javascript.
    
	* src/kwq/KWQApplication.mm: (KWQDesktopWidget::width),
	(KWQDesktopWidget::height), (QApplication::desktop):

2002-01-21  Maciej Stachowiak  <mjs@apple.com>

	Reimplemented QArray, QBuffer, QStack and QStringList; also fixed
	some files for borrowed switchability, and fixed some bugs found
	by my new test cases.

	# Reimplement QArray:

	* src/kwq/qt/qarray.h:
	* src/kwq/KWQArrayImpl.h:
	* src/kwq/KWQArrayImpl.mm: (KWQArrayImpl::KWQArrayPrivate::KWQArrayPrivate),
	(KWQArrayImpl::KWQArrayPrivate::~KWQArrayPrivate), (KWQArrayImpl::KWQArrayImpl),
	(KWQArrayImpl::~KWQArrayImpl), (KWQArrayImpl::operator=), (KWQArrayImpl::at),
	(KWQArrayImpl::data), (KWQArrayImpl::size), (KWQArrayImpl::resize),
	(KWQArrayImpl::duplicate), (KWQArrayImpl::fill), (KWQArrayImpl::operator==):

	# Reimplement QBuffer:

	* src/kwq/qt/qbuffer.h:
	* src/kwq/KWQBuffer.mm: (QBuffer::QBuffer), (QBuffer::~QBuffer),
	(QBuffer::buffer), (QBuffer::size), (QBuffer::isOpen), (QBuffer::open),
	(QBuffer::close), (QBuffer::writeBlock):
	* src/kwq/qt/qiodevice.h:

	# Reimplement QStringList:

	* src/kwq/KWQStringList.mm: (QStringToCFString), (QStringList::split),
	(QStringList::QStringList), (QStringList::~QStringList), (QStringList::join),
	(QStringList::operator=):

	# Reimplement QStack:
	* src/kwq/qt/qstack.h:

	* src/kwq/Makefile.am: Add new files to build.

	* src/kwq/KWQString.mm: (QString::find): Fix bug which returned
	the very first occurence in the string even when the optional
	starting point was passed in. Some of my new regression tests
	picked this up.

	# Temporarily work around uses of non-kwq APIs:
	
	* src/kwq/WKPluginWidget.h:
	* src/kwq/qt/_qfile.cpp
	* src/kwq/qt/_qbuffer.cpp
	
	# Guard contents of all these with the appropriate USING ifdef:
	
	* src/kwq/KWQStrList.h:
	* src/kwq/qt/_qarray.h:
	* src/kwq/qt/_qgarray.h:
	* src/kwq/qt/_qstrlist.h:
	
2002-01-19  Maciej Stachowiak  <mjs@apple.com>

	* src/kdelibs/kjs/Makefile.am: Fix testkjs build.

	Fix a couple more static initialization problems:
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::urlCursor):
	* src/kwq/KWQRegion.mm: (QRegion::QRegion), (QRegion::operator=):

	* src/.cvsignore, src/kdelibs/.cvsignore,
	src/kdelibs/khtml/css/.cvsignore,
	src/kdelibs/khtml/misc/.cvsignore, src/kdelibs/kjs/.cvsignore:
	Ignore stamp files.

2002-01-18  Richard Williamson  <rjw@apple.com>

    First pass at new view/datasource/controller API.

	* src/kwq/KWQApplication.mm: (QApplication::QApplication),
	(QApplication::setMainWidget), (QApplication::exec):
	* src/kwq/KWQRegion.mm: (QRegion::QRegion), (QRegion::~QRegion),
	(QRegion::contains), (QRegion::isNull):
	* src/kwq/Makefile.am:
	* src/kwq/_KWQOwner.h:
	* src/kwq/_KWQOwner.m:
	* src/kwq/qt/qnamespace.h:

2002-01-18  Maciej Stachowiak  <mjs@apple.com>

	Avoid static initialization of objects as much as possible. Order
	of static initializers is unpredictable and we had some
	cross-dependencies, so avoid this practice as much as possible to
	fix various startup crashes.

	* src/kwq/KWQApplication.mm: (QApplication::palette),
	(QApplication::globalStrut):
	* src/kwq/KWQChar.mm:
	* src/kwq/KWQColor.mm:
	* src/kwq/KWQCursor.mm: (QCursor::QCursor), (QCursor::~QCursor):
	* src/kwq/KWQEvent.mm:
	* src/kwq/KWQKConfigBase.mm: (KConfigBase::readEntry),
	(KConfigBase::readColorEntry), (KConfigBase::readListEntry):
	* src/kwq/KWQKHTMLSettings.mm: (KHTMLSettings::encoding):
	* src/kwq/KWQKJavaEmbed.mm: (KJavaEmbed::sizeHint),
	(KJavaEmbed::minimumSizeHint):
	* src/kwq/KWQKLocale.mm: (KLocale::language):
	* src/kwq/KWQKMimeType.mm: (KMimeType::findByURL), (KMimeType::name):
	* src/kwq/KWQKPrinter.mm: (KPrinter::margins):
	* src/kwq/KWQKProtocolManager.mm: (KProtocolManager::httpProxy):
	* src/kwq/KWQKWinModule.mm: (KWinModule::workArea):
	* src/kwq/KWQKjobclasses.mm:
	* src/kwq/KWQKnetaccess.mm:
	* src/kwq/KWQPart.mm: (KParts::Part::widget), (KParts::ReadOnlyPart::url):
	* src/kwq/KWQPixmap.mm: (QPixmap::mask):
	* src/kwq/KWQToolTip.mm: (QToolTip::palette):
	* src/kwq/kde/_kurl.cpp:
	* src/kwq/kdecore/kurl.h:

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	Fix a couple of problems that kept `make -j3' from working from a
	clean start (use stamp files to serialize build a bit more where
	needed)

	* src/Makefile.am:
	* src/kdelibs/khtml/css/Makefile.am:
	* src/kdelibs/khtml/misc/Makefile.am:
	* src/kdelibs/kjs/Makefile.am:

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/Makefile.am: Fix another bonehead mistake.

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	Fix bonehead mistakes in last checkin which were killing Jersey.

	* src/kdelibs/khtml/ecma/Makefile.am:
	* src/kdelibs/khtml/html/Makefile.am:
	* src/kdelibs/khtml/rendering/Makefile.am:
	* src/kwq/kde/Makefile.am:

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	More build system speedups; instead of building static libraries
	in each directory, build relocatble object files, using the magic
	of incremental linking.

	* src/Makefile.am:
	* src/kdelibs/khtml/Makefile.am:
	* src/kdelibs/khtml/css/Makefile.am:
	* src/kdelibs/khtml/dom/Makefile.am:
	* src/kdelibs/khtml/ecma/Makefile.am:
	* src/kdelibs/khtml/html/Makefile.am:
	* src/kdelibs/khtml/java/Makefile.am:
	* src/kdelibs/khtml/misc/Makefile.am:
	* src/kdelibs/khtml/rendering/Makefile.am:
	* src/kdelibs/khtml/xml/Makefile.am:
	* src/kdelibs/kjs/Makefile.am:
	* src/kwq/Makefile.am:
	* src/kwq/kde/Makefile.am:
	* src/kwq/qt/Makefile.am:

2002-01-17  Maciej Stachowiak  <mjs@apple.com>

	Build speedups: Don't use libtool, and don't link static libraries
	into each other.
	
	* src/Makefile.am
	* src/kdelibs/khtml/Makefile.am:
	* src/kdelibs/khtml/css/Makefile.am:
	* src/kdelibs/khtml/dom/Makefile.am:
	* src/kdelibs/khtml/ecma/Makefile.am:
	* src/kdelibs/khtml/html/Makefile.am:
	* src/kdelibs/khtml/java/Makefile.am:
	* src/kdelibs/khtml/misc/Makefile.am:
	* src/kdelibs/khtml/rendering/Makefile.am:
	* src/kdelibs/khtml/xml/Makefile.am:
	* src/kdelibs/kjs/Makefile.am:
	* src/kwq/Makefile.am:
	* src/kwq/kde/Makefile.am:
	* src/kwq/qt/Makefile.am:

2002-01-16  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/qt/_qpoint.h, src/kwq/qt/_qrect.h, src/kwq/qt/_qsize.h,
	src/kwq/qt/qpoint.h, src/kwq/qt/qrect.h, src/kwq/qt/qsize.h: Make
	QPoint, QRect and QSize easily turn-off-able again.

2002-01-15  Maciej Stachowiak  <mjs@apple.com>

	* src/kdelibs/kjs/Makefile.am: Add missing files to BUILT_SOURCES
	and build rules to fix `make -j3'

2002-01-14  Maciej Stachowiak  <mjs@apple.com>

	* .cvsignore:
	* Makefile.am:
	* Makefile.in:
	* include/.cvsignore:
	* include/Makefile.am:
	* include/private/.cvsignore:
	* include/private/Makefile.am:
	* lib/.cvsignore:
	* lib/Makefile.in:
	* src/.cvsignore:
	* src/Makefile.am:
	* src/kdelibs/.cvsignore:
	* src/kdelibs/Makefile.am:
	* src/kdelibs/kdecore/.cvsignore:
	* src/kdelibs/kdecore/Makefile.am:
	* src/kdelibs/kdecore/Makefile.in:
	* src/kdelibs/khtml/.cvsignore:
	* src/kdelibs/khtml/Makefile.am:
	* src/kdelibs/khtml/Makefile.in:
	* src/kdelibs/khtml/css/.cvsignore:
	* src/kdelibs/khtml/css/Makefile.am:
	* src/kdelibs/khtml/css/Makefile.in:
	* src/kdelibs/khtml/dom/.cvsignore:
	* src/kdelibs/khtml/dom/Makefile.am:
	* src/kdelibs/khtml/dom/Makefile.in:
	* src/kdelibs/khtml/ecma/.cvsignore:
	* src/kdelibs/khtml/ecma/Makefile.am:
	* src/kdelibs/khtml/ecma/Makefile.in:
	* src/kdelibs/khtml/html/.cvsignore:
	* src/kdelibs/khtml/html/Makefile.am:
	* src/kdelibs/khtml/html/Makefile.in:
	* src/kdelibs/khtml/java/.cvsignore:
	* src/kdelibs/khtml/java/ChangeLog:
	* src/kdelibs/khtml/java/Makefile.am:
	* src/kdelibs/khtml/java/Makefile.in:
	* src/kdelibs/khtml/java/tests/Makefile.am:
	* src/kdelibs/khtml/misc/.cvsignore:
	* src/kdelibs/khtml/misc/Makefile.am:
	* src/kdelibs/khtml/misc/Makefile.in:
	* src/kdelibs/khtml/pics/Makefile.am:
	* src/kdelibs/khtml/rendering/.cvsignore:
	* src/kdelibs/khtml/rendering/Makefile.am:
	* src/kdelibs/khtml/rendering/Makefile.in:
	* src/kdelibs/khtml/xml/.cvsignore:
	* src/kdelibs/khtml/xml/Makefile.am:
	* src/kdelibs/khtml/xml/Makefile.in:
	* src/kdelibs/kjs/.cvsignore:
	* src/kdelibs/kjs/ChangeLog:
	* src/kdelibs/kjs/Makefile.am:
	* src/kdelibs/kjs/Makefile.in:
	* src/kdelibs/kjs/kjs-test:
	* src/kdelibs/kjs/kjs-test.chk:
	* src/kwq/.cvsignore:
	* src/kwq/Makefile.am:
	* src/kwq/Makefile.in:
	* src/kwq/_KWQOwner.m: (-[_KWQOwner backForwardUriDone:]):
	* src/kwq/kde/.cvsignore:
	* src/kwq/kde/Makefile.am:
	* src/kwq/kde/Makefile.in:
	* src/kwq/kdecore/.cvsignore:
	* src/kwq/kdecore/Makefile.in:
	* src/kwq/khtml/khtml_factory.h:
	* src/kwq/qt/.cvsignore:
	* src/kwq/qt/Makefile.am:
	* src/kwq/qt/Makefile.in:

2002-01-09  Richard Williamson  <rjw@apple.com>

        Re-implemented underlining.  Now it REALLY works, honest.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):
	* src/kwq/KWQFontMetrics.mm: (+[KWQLayoutInfo
	drawUnderlineForString:atPoint:withFont:color:]):
	* src/kwq/KWQMetrics.h:
	* src/kwq/KWQPainter.mm: (QPainter::drawUnderlineForText):
	* src/kwq/qt/qpainter.h:

2001-12-20  Richard Williamson  <rjw@apple.com>
        
        More tweaks to text layout and underlining.

	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):
	* src/kwq/KWQFontMetrics.mm: (QFontMetrics::baselineOffset),
	(QFontMetrics::ascent), (QFontMetrics::descent), (QFontMetrics::height),
	(QFontMetrics::width):
	* src/kwq/KWQPainter.mm: (QPainter::drawText):
	* src/kwq/qt/qfontmetrics.h:

2001-12-18  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/KWQCString.mm: (QCString::QCString),
	(QCString::isEmpty), (QCString::isNull), (QCString::length): Fix
	some bugs found by the test suite in the emptiness/null semantics.

	Reimplement QPoint, QSize and QRect:

	* src/kwq/qt/qpoint.h, src/kwq/qt/qrect.h, src/kwq/qt/qsize.h:
	Update.
	* src/kwq/KWQPoint.mm: (QPoint::QPoint), (QPoint::x), (QPoint::y),
	(QPoint::manhattanLength), (operator+), (operator-), (operator<<):
	Fresh implementations.
	* src/kwq/KWQRect.mm: (QRect::QRect), (QRect::isNull), (QRect::isValid),
	(QRect::x), (QRect::y), (QRect::left), (QRect::top), (QRect::right),
	(QRect::bottom), (QRect::width), (QRect::height), (QRect::topLeft),
	(QRect::size), (QRect::setWidth), (QRect::setHeight), (QRect::intersect),
	(QRect::intersects), (QRect::operator&), (operator==), (operator!=),
	(operator<<): Likewise.
	* src/kwq/KWQSize.mm: (QSize::QSize), (QSize::isValid), (QSize::width),
	(QSize::height), (QSize::setWidth), (QSize::setHeight), (QSize::expandedTo),
	(operator+), (operator==), (operator!=), (operator<<): Likewise.
	* src/kwq/qt/_qpoint.cpp, src/kwq/qt/_qrect.cpp,
	src/kwq/qt/_qsize.cpp: Disable the whole file contents when
	building.
	* src/kwq/Makefile.in: Add new files to build.
	
	Start moving away from QShared so we can remove it:

	* src/kwq/qt/qbrush.h, src/kwq/KWQBrush.mm: (QBrush::QBrush),
	(QBrush::color),
	(QBrush::setColor), (QBrush::style), (QBrush::setStyle),
	(QBrush::operator==), (QBrush::operator!=): Don't use shared data
	for this simple value object, the optimization value is
	quastionable anyway.
	* src/kwq/qt/qpen.h, src/kwq/KWQPen.mm: (QPen::QPen),
	(QPen::color), (QPen::width), (QPen::style),
	(QPen::setColor), (QPen::setWidth), (QPen::setStyle),
	(QPen::operator==): Likewise.
	* src/kwq/KWQPainter.mm: (QPainter::setPen), (QPainter::setBrush):
	Update for changes to pen.
	* src/kwq/KWQRefPtr.h: New reference-counted pointer template.
	* src/kwq/qt/qguardedptr.h, src/kwq/KWQGuardedPtr.mm:
	(QGuardedPtrPrivate::QGuardedPtrPrivate): Use KWQRefPtr instead of
	QShared.
	* src/kwq/qt/qvariant.h, src/kwq/KWQVariant.mm:
	(QVariant::QVariant), (QVariant::~QVariant),
	(QVariant::operator=): Use KWQRefPtr instead of
	QShared.
	* src/kwq/qt/qnamespace.h: Remove private constructor and
	destructor since people want to subclass this.

	* src/kwq/_KWQOwner.h: Add include guards and standard license.

	* src/kdelibs/khtml/ecma/kjs_binding.h: Add include of qvariant.h,
	how could stuff ever compile without this?

2001-12-18  Richard Williamson  <rjw@apple.com>

        Finally fixed underlining.
        
	* src/kdelibs/khtml/rendering/render_text.cpp: (TextSlave::printDecoration):
	* src/kwq/KWQFontMetrics.mm:

2001-12-18  Maciej Stachowiak  <mjs@apple.com>

	* src/kwq/Makefile.in: Re-apply my changes, which accidentally got
	clobbered.

2001-12-13  Maciej Stachowiak  <mjs@apple.com>

	Changes for international character set support. Still needs work,
	but no worse than before. amazon.co.jp renders almost correctly.
	
	* src/kwq/KWQCharsets.h, src/kwq/KWQCharsets.mm:
	(KWQCFStringEncodingFromIANACharsetName,
	KWQCFStringEncodingFromMIB, KWQCFStringEncodingToIANACharsetName,
	KWQCFStringEncodingToMIB): New functions that translate between
	the Qt concept of charaxcter sets and the
	(buildDictionaries): static helper function for the above.
	* src/kwq/KWQtextcodec.mm: (codecForCFStringEncoding,
	QTextCodec::codecForMib), QTextCodec::codecForName,
	QTextCodec::codecForLocale, QTextCodec::name,QTextCodec::mibEnum):
	Implement for real.
	* src/kwq/KWQKCharsets.mm: (KCharsets::codecForName,
	KCharsets::charsetForEncoding, KCharsets::charsetForEncoding):
	Implement for real.
	* src/kwq/KWQKHTMLPart.mm: (KHTMLPart::slotData): Get encoding
	from headers if present.
	(encodingFromContentType): Helper function for the above. 
	(KHTMLPart::begin): Reinitialize decoder for every page.
	(KHTMLPart::write): Minor bug fix.
	(KHTMLPart::setEncoding): Implement.
	(KHTMLPart::khtmlMouseMoveEvent,
	KHTMLPart::khtmlMouseReleaseEvent, KHTMLPart::checkCompleted):
	Simplify ifdefs to make prepare-ChangeLog happy.
	* src/kwq/qt/qstring.h, src/kwq/KWQString.mm:
	(QString::fromCFString): New convenience method to create a
	QString from an immutable CFString by copying,
	* src/kwq/character-sets.txt: IANA document describing character
	sets.
	* src/kwq/make-charset-table.pl, src/kwq/make-mac-encodings.c:
	Helper programs to construct charset tables from IANA document.
	* src/kwq/Makefile.in: Update to handle the autogenerated code.
	* src/kwq/.cvsignore: Ignore new autogenerated files.
	
	* src/kdelibs/khtml/misc/decoder.cpp: (Decoder::decode): Fix
	decoding when the encoding is specified in the http headers (which
	seems like it could never have worked in KDE).

	* include/WCBackForwardList.h, include/WCURICache.h,
	include/WCURICacheData.h, include/WCURIEntry.h: Fix prototypes of
	C functions with no arguments to use (void), not (), to avoid
	warnings in WebKit.

2001-12-11  Chris Blumenberg  <cblu@apple.com>

	* ChangeLog:
	* src/kwq/KWQKHTMLPart.mm:

2001-12-11  Chris Blumenberg  <cblu@apple.com>

	* src/kwq/KWQKHTMLPart.mm:

2001-12-10  Kenneth Kocienda  <kocienda@apple.com>

        Went back and did a better job of cleaning up the warnings
        that resulted from comparing signed and unsigned numbers.

	* src/kwq/KWQString.mm: (QString::insert), (QString::remove),
	(QString::truncate):

2001-12-07  Richard Williamson  <richwill@richwill.com>

        Fixed bug that was highlighted when we turned on warnings.
        
	* src/kwq/KWQFontMetrics.mm:
	* src/kwq/KWQMetrics.h:

2001-12-07  Kenneth Kocienda  <kocienda@apple.com>

        Fixed small bug in a comparison that was making -Wall complain

	* src/kwq/KWQString.mm:

