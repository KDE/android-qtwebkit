2002-12-22  Darin Adler  <darin@apple.com>

        Reviewed by Don and John.

	- fixed 3134449 -- Date.UTC returns NaN (invalid date)

	Did more testing of the date functions and made them behave like the other browsers.
	There were three problems:

            1) We did a validity check that other browsers don't do (hence the NaN).
            2) We treated passed-in dates as local time even in Date.UTC (hence a wrong result
               once I fixed the NaN).
            3) The results of ToUTCString (and ToGMTString) weren't formatted quite the same
	       as other browsers.

	Also found a couple of silly but unrelated coding mistakes.

        * kjs/date_object.cpp:
        (timetUsingCF): Added. Has the guts of mktimeUsingCF, but without the CFGregorianDateIsValid
        check. Other browsers accept invalid dates. Also takes a time zone parameter.
        (mktimeUsingCF): Calls timetUsingCF with the current time zone.
        (timegmUsingCF): Calls timetUsingCF with the UTC time zone.
        (formatDate): Remove the includeComma flag.
        (formatDateUTCVariant): Added. For use instead of formatDate with the includeComma flag.
	Puts the day before the month name.
        (DateProtoFuncImp::call): Use the new formatDateUTCVariant for ToGMTString and ToUTCString.
	Without this change the date didn't match other browsers.
        (DateObjectImp::DateObjectImp): Use UTCPropertyName. Somehow I declared this and didn't use
	it before.
        (DateObjectImp::construct): Pass -1 for is_dst literally instead of using invalidDate.
	Changing this to invalidDate was just a mistake (although no real difference in compiled
	code since invalidDate is just -1).
        (DateObjectFuncImp::call): Call timegm for the UTC case instead of mktime.

=== Alexander-44 ===

=== Alexander-43 ===

2002-12-20  Trey Matteson  <trey@apple.com>

	We now build with symbols the B&I.  Deployment builds are without symbols,
	so it is easy to generate a non-huge app as a one-off.

        Reviewed by Darin

        * JavaScriptCore.pbproj/project.pbxproj:

=== Alexander-42 ===

=== Alexander-41 ===

=== Alexander-40 ===

2002-12-18  Maciej Stachowiak  <mjs@apple.com>

	Reviewed by John.

	- fixed 3131171 - Change Alex versions to satisfy both marketing and B&I requirements
	
        * English.lproj/InfoPlist.strings:
        * JavaScriptCore.pbproj/project.pbxproj:

2002-12-17  Darin Adler  <darin@apple.com>

        Reviewed by Trey.

        * JavaScriptCore.pbproj/project.pbxproj: Removed signature.

=== Alexander-39 ===

=== Alexander-38 ===

2002-12-16  Darin Adler  <darin@apple.com>

        Reviewed by Don and Maciej.

	- fixed 3129115 -- need Apple copyright added to open source documents

	* tons of files: Added our copyright to files we modified, and updated all to standard format.

	- other changes

        * JavaScriptCore.pbproj/project.pbxproj: Set MACOSX_DEPLOYMENT_TARGET to 10.2.
	Also removed completion.cpp.
        * kjs/completion.cpp: Removed.
        * kjs/completion.h: Made the Completion constructor inline.

        * kjs/grammar.y: Removed an obsolete "pretend ifdef". No need to put these in APPLE_CHANGES now.

=== Alexander-37 ===

=== JavaScriptCore-37u2 ===

2002-12-15  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

        * JavaScriptCore.pbproj/project.pbxproj: Bump version to 37u2.

2002-12-14  Darin Adler  <darin@apple.com>

        Reviewed by Maciej.

        * JavaScriptCore.pbproj/project.pbxproj: Make dtoa.h visible as an SPI so I can
	use it inside QString.

2002-12-14  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Ken.

	- further corrections to number printing.

        * kjs/ustring.cpp:
        (UString::from): Make number printing match the ECMA standard
	algorithm.

2002-12-14  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Dave.

	- fix toString() conversion for numbers less than 1. Negative
	exponents are still wrong though (things like 1E-34).
 
        * kjs/ustring.cpp:
	(UString::from): Don't print empty string for numbers less than 1,
	and remember to add extra 0s after the decimal for negative
	decimal positions.
	
=== Alexander-37u1 ===

=== Alexander-36 ===

2002-12-12  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Darin.

	- fixed 3056449 - can't select state at tucows.com

        * kjs/array_instance.h:
        * kjs/array_object.cpp:
	(ArrayInstanceImp::propList): Add numeric proprties that are in
	special storage.
        * kjs/array_object.h:
        * kjs/object.h: Make propList a virtual method.

2002-12-11  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Don.

	- Add kjsprint global function in Development build for ease of	debugging.
	- Print uncaught JavaScript exceptions to the console in Development.
	- Improve wording of exception error messages.
	
        * kjs/function.cpp:
        (GlobalFuncImp::call):
        * kjs/function.h:
        * kjs/internal.cpp:
        (InterpreterImp::initGlobalObject):
        * kjs/interpreter.cpp:
        (Interpreter::evaluate):
        * kjs/nodes.cpp:
        (NewExprNode::evaluate):
        (FunctionCallNode::evaluate):
        (RelationalNode::evaluate):

2002-12-10  John Sullivan  <sullivan@apple.com>

	Fixed more "Alexander"s that were lurking in places I forgot 
	to look before.

        Reviewed by Darin

        * Makefile.am:
	"rm -rf $(SYMROOTS)/Safari.app/Frameworks/JavaScriptCore.framework"

2002-12-09  Darin Adler  <darin@apple.com>

        Reviewed by Maciej.

        * JavaScriptCore.pbproj/project.pbxproj: Bump versions to 0.8 and 35u.
	* English.lproj/InfoPlist.strings: In here too.

2002-12-09  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Ken.

	- fixed 3059637 - all articles missing at excite.com sports page
	- fixed 3065903 - most of content missing at excite.com news page

	These bugs both came up because a JavaScript function has a var
	declaration that collides with a function parameter name.
	
        * kjs/nodes.cpp:
        (VarDeclNode::processVarDecls): Don't set the property to
	undefined if a property with that name is already set on the
	global object. Otherwise we may clobber function parameters with
	undefined even before hitting a possible var initializer.

2002-12-06  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by: Darin Adler

	- made framework embedding work correctly with buildit

        * JavaScriptCore.pbproj/project.pbxproj: Give framework a relative
	install path, don't install it the normal way, and copy it
	manually to /AppleInternal/Library/Frameworks if installing.

=== Alexander-35 ===

2002-12-04  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by: Richard Williamson

	Added explicit lock/unlock methods so Sherlock can grab the
	interpreter lock as needed.
	
	- partially addressed 3084320 - JavaScriptCore crash
	
        * kjs/internal.cpp:
        (InterpreterImp::InterpreterImp):
        (InterpreterImp::lock):
        (InterpreterImp::unlock):
        * kjs/internal.h:
        * kjs/interpreter.cpp:
        (Interpreter::lock):
        (Interpreter::unlock):
        * kjs/interpreter.h:

2002-12-04  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by: Darin Adler

	Set things up so JavaScriptCore builds in PCRE and uses it for
	regular expressions. This fixes many form validation bugs:

	- fixed 3103197 - javascript at fidelity.com rejects valid input
	- fixed 2942552 - form validation at weather.com fails
	- fixed 3079752 - js always reports textarea is empty
	- fixed 3079719 - covad.com "check availalbility" fails
	
        * Makefile.am: Add pcre subdir.
        * kjs/config.h: define HAVE_PCREPOSIX to true.
	* kjs/regexp.h: Don't include pcreposix.h since nothing from there
	is used.
	* pcre/.cvsignore: Added.
        * pcre/ChangeLog: Removed.
        * pcre/INSTALL: Removed.
        * pcre/Makefile.am: Added.
        * pcre/Makefile.in: Removed.
        * pcre/NEWS: Removed.
        * pcre/NON-UNIX-USE: Removed.
        * pcre/README: Removed.
        * pcre/chartables.c: Added.
        * pcre/config.guess: Removed.
        * pcre/config.in: Removed.
        * pcre/config.sub: Removed.
        * pcre/configure: Removed.
        * pcre/configure.in: Removed.
        * pcre/dll.mk: Removed.
        * pcre/doc/Tech.Notes: Removed.
        * pcre/doc/pcre.3: Removed.
        * pcre/doc/pcre.html: Removed.
        * pcre/doc/pcre.txt: Removed.
        * pcre/doc/pcregrep.1: Removed.
        * pcre/doc/pcregrep.html: Removed.
        * pcre/doc/pcregrep.txt: Removed.
        * pcre/doc/pcreposix.3: Removed.
        * pcre/doc/pcreposix.html: Removed.
        * pcre/doc/pcreposix.txt: Removed.
        * pcre/doc/pcretest.1: Removed.
        * pcre/doc/pcretest.html: Removed.
        * pcre/doc/pcretest.txt: Removed.
        * pcre/doc/perltest.txt: Removed.
        * pcre/install-sh: Removed.
        * pcre/ltmain.sh: Removed.
        * pcre/pcre-config.h: Added.
        * pcre/pcre-config.in: Removed.
        * pcre/internal.h: Include pcre-config.h instead of config.h
        * pcre/pcre.c:
        (ord2utf8): Fix warnings.
        (pcre_compile): Fix warnings.
        * pcre/pcre.def: Removed.
        * pcre/pcre.h: Added.
        * pcre/pcre.in: Removed.
        * JavaScriptCore.pbproj/project.pbxproj: Added pcre files to build.
        * JavaScriptCorePrefix.h: Guard c++ headers with #ifdef __cplusplus.

2002-12-04  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by: Richard Williamson

        * pcre/doc/*: Added.
        * pcre/testdata/*: Added.

2002-12-03  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by: Darin Adler

	- imported PCRE 3.9 into the tree; this isn't actually compiled or
	used yet.

        * pcre/*: Added.

== Rolled over to ChangeLog-2002-12-03 ==
