2002-06-15  Darin Adler  <darin@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Removed explicit PFE_FILE_C_DIALECTS now that
	Project Builder handles this automatically. Removed explicit USE_GCC3 since that's implicit
	now. Also, since this project is all C++, only use WARNING_CFLAGS with flags that are appropriate
	for C++; don't bother breaking out C vs. C++.

	* kjs/collector.cpp: Now that the system warning is fixed, use PTHREAD_MUTEX_INITIALIZER and
	PTHREAD_COND_INITIALIZER.
	* kjs/internal.cpp: Use PTHREAD_MUTEX_INITIALIZER.
	* kjs/ustring.cpp: Use PTHREAD_ONCE_INIT.

2002-06-15  Maciej Stachowiak  <mjs@apple.com>

        Made Development build mode mean what Unoptimized used to mean. Removed Unoptimized build mode. 
        Added a Mixed build mode which does what Deployment used to. All this to fix:
        
        Radar 2955367 - Change default build style to "Unoptimized"
        
	* JavaScriptCore.pbproj/project.pbxproj:

2002-06-12  Darin Adler  <darin@apple.com>

	* kjs/nodes.cpp: (Node::finalCheck): A bit of APPLE_CHANGES so we
	can compile with KJS_DEBUG_MEM defined if we want to.

2002-06-10  Darin Adler  <darin@apple.com>

	Merged in changes from KDE 3.0.1.

	* kjs/collector.cpp:
	* kjs/date_object.cpp:
	* kjs/function.cpp:
	* kjs/internal.cpp:
	* kjs/lookup.h:
	* kjs/object.cpp:
	* kjs/operations.cpp:
	* kjs/regexp.cpp:
	* kjs/regexp_object.cpp:
	* kjs/regexp_object.h:
	* kjs/string_object.cpp:
	* kjs/testkjs.cpp:
	* kjs/ustring.cpp:
	* kjs/value.cpp:
	* kjs/value.h:
	Do the merge, and add APPLE_CHANGES as needed to make things compile.

	* kjs/date_object.lut.h: Re-generated.

2002-06-07  Darin Adler  <darin@apple.com>

	* Makefile.am: Use new shared "embed.am" file so we don't need four copies of
	the embedding rules for WebFoundation, JavaScriptCore, WebCore, and WebKit.

2002-06-07  Darin Adler  <darin@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Don't use any warning flags for C that won't work
	for C++, because PFE uses the C warning flags on a C++ compile.

=== Alexander-8 ===

2002-06-06  Darin Adler  <darin@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Update warning flags for compatibility
	with new C++.

2002-06-05  Darin Adler  <darin@apple.com>

	Fix problem seen as build failure on Jersey.

	* Makefile.am: JavaScriptCore-stamp needs to be a dependency, not a
	source file, because it doesn't have a corresponding object file.
	Making it a dependency causes things to compile in the right order.

2002-06-04  Darin Adler  <darin@apple.com>

	Improve the speed of the JavaScript string append operation by growing
	the capacity so we don't need to reallocate the string every time.

	Also fix script execution so it doesn't use recursion to advance from
	one statement to the next, using iteration instead.

	* Makefile.am: Stop using BUILT_SOURCES to build JavaScriptCore-stamp,
	because this causes the Project Builder project to build *before* the
	subdir. Intead, use an all-am rule in a way more similar to all our
	other directories.

	* kjs/grammar.y: Link the SourceElementsNode in the opposite direction,
	so we can walk the list and execute each element instead of using
	recursion to reverse the list.
	* kjs/grammar.cpp: Check in new generated file.

	* kjs/nodes.cpp:
	(SourceElementsNode::execute):
	(SourceElementsNode::processFuncDecl):
	(SourceElementsNode::processVarDecls):
	Use loops instead of recursion.

	* kjs/ustring.h: Don't initialize all UChar objects to 0. This was
	wasting a *huge* amount of time.
	* kjs/ustring.cpp:
	(UString::Rep::create): Add a "capacity" along with the length.
	(UString::append): Include 50% extra capacity when appending.
	(UString::operator=): Reuse the buffer if possible rather than
	always creating a new one.

2002-06-02  Darin Adler  <darin@apple.com>

	* COPYING.LIB: Fix line endings. It was using CRs.

2002-05-31  Darin Adler  <darin@apple.com>

	* Makefile.am:
	* kjs/Makefile.am:
	Slight improvements to rules that touch stamp files.

2002-05-28  Maciej Stachowiak  <mjs@apple.com>

	* THANKS: Demangled.

=== Alexander-7 ===

2002-05-24  Maciej Stachowiak  <mjs@apple.com>

	Added license and acknowledgements.

	* AUTHORS: Added.
	* COPYING.LIB: Added.
	* THANKS: Added.

=== 0.3 ===

=== Alexander-6 ===

=== Alexander-5 ===

=== Alexander-4 ===

=== JavaScriptCore-5 ===

2002-05-21  Maciej Stachowiak  <mjs@apple.com>

	Reviewed by: Richard Williamson

	Fixed Radar 2928775 - Sherlock crashes sitting in stocks channel

	* kjs/internal.cpp:
	(InterpreterImp::InterpreterImp): Set the interp pointer earlier,
	in case garbage collection takes place while creating the global
	values.

2002-05-15  Darin Adler  <darin@apple.com>

	Reviewed by: Maciej Stachowiak
	
	* Makefile.am:
	Use all-am and clean-am instead of all and clean because it's better and
	to make "make check" at the top level work right.

2002-05-13  Darin Adler  <darin@apple.com>

	Reviewed by: Maciej Stachowiak

	* kjs/value.h: Fix comment typos.

=== JavaScriptCore-4 ===

2002-05-10  Maciej Stachowiak  <mjs@apple.com>

	Reviewed by: Ken Kocienda and Darin Adler

	Fixed the following bug:

	Radar 2890573 - JavaScriptCore needs to be thread-safe

	Actually this is only a weak form of thread-safety - you can safely
	use different interpreters from different threads at the same
	time. If you try to use a single interpreter object from multiple
	threads, you need to provide your own locking.

	* kjs/collector.h, kjs/collector.cpp:
	(Collector::lock, Collector::unlock): Trivial implementation of a
	recursive mutex.
	(Collector::allocate): Lock around the body of this function.
	(Collector::collect): Likewise.
	(Collector::finalCheck): Likewise.
	(Collector::numInterpreters): Likewise.
	(Collector::numGCNotAllowedObjects): Likewise.
	(Collector::numReferencedObjects): Likewise.
	* kjs/internal.cpp:
	(Parser::parse): use a mutex to lock around the whole parse, since
	it uses a bunch of global state.
	(InterpreterImp::InterpreterImp): Grab the Collector lock here,
	both the mutually exclude calls to the body of this function, and
	to protect the s_hook static member which the collector pokes at.
	(InterpreterImp::clear): Likewise.
	* kjs/ustring.cpp:
	(statBufferKeyCleanup, statBufferKeyInit, UString::ascii): Convert
	use of static variable
	* kjs/value.cpp:
	(ValueImp::ValueImp, ValueImp::mark, ValueImp::marked,
	ValueImp::setGcAllowed): Grab the GC lock around any flag changes.

=== Alexander-3 ===

2002-05-08  Darin Adler  <darin@apple.com>

	* kjs/collector.h:
	* kjs/collector.cpp:
	(Collector::numInterpreters):
	(Collector::numGCNotAllowedObjects):
	(Collector::numReferencedObjects):
	Add three new functions so we can see a bit more about leaking JavaScriptCore.

2002-05-06  Darin Adler  <darin@apple.com>

	* JavaScriptCorePrefix.h: Added.
	* JavaScriptCore.pbproj/project.pbxproj: Use PFE precompiling.
	Also switch from xNDEBUG to NDEBUG.

=== Alexander 0.3c2 (v1) ===

2002-04-18  Darin Adler  <darin@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Oops. Take out -Wstrict-prototypes, put back
	-Wmissing-prototypes.

2002-04-18  Darin Adler  <darin@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Take out -Wmissing-prototypes
	because system headers are triggering it when we don't have
	precompiled headers on.

2002-04-18  Darin Adler  <darin@apple.com>

	Reviewed by Maciej

	* JavaScriptCore.pbproj/project.pbxproj: Turn on gcc3 and the same set of warnings
	as in the rest of Labyrinth (see top level ChangeLog for details).

2002-04-17  Maciej Stachowiak  <mjs@apple.com>

	Reviewed by: Darin Adler  <darin@apple.com>

	* kjs/testkjs.cpp: Don't include <iostream.h> to avoid gcc3
	warning.

2002-04-15  Darin Adler  <darin@apple.com>

	Reviwed by: Maciej Stachowiak  <mjs@apple.com>

	* kjs/internal.cpp:
	* kjs/property_map.cpp:
	* kjs/ustring.h:
	Removed some unneeded <config.h> includes so we are more similar
	to the real KDE sources.

2002-04-15  Darin Adler  <darin@apple.com>

	Reviwed by: Maciej Stachowiak  <mjs@apple.com>

	Merged changes from KDE 3.0 final and did some build fixes.

	* JavaScriptCore.pbproj/project.pbxproj: Added nodes2string.cpp.

	* kjs/grammar.*: Regenerated.
	* kjs/*.lut.h: Regenerated.

2002-04-08  Darin Adler  <darin@apple.com>

	Reviwed by: Maciej Stachowiak  <mjs@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Re-added -Wno-format-y2k.

2002-04-04  Darin Adler  <darin@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Add an Unoptimized build
	style: exactly like Development except without the -O.

2002-04-03  Darin Adler  <darin@apple.com>

	* kjs/Makefile.am: Gratuitous cleanup.

2002-04-02  Darin Adler  <darin@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Update flags as I did for
	WebFoundation.

2002-04-02  Maciej Stachowiak  <mjs@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Pass -Wno-format-y2k so
	the project builds with gcc3.
	
	* kjs/nodes.cpp: Avoid including an obsolete header to avoid
	warning with gcc3.

2002-04-02  Darin Adler  <darin@apple.com>

	* kjs/property_map.cpp: (PropertyMap::~PropertyMap): Deallocate the
        map by calling clear so we don't leak the entire map.

2002-04-02  Darin Adler  <darin@apple.com>

	* kjs/internal.cpp: (InterpreterImp::globalClear): Add code to
        deallocate and null out emptyList, because once the last interpreter
        is destroyed there's nothing to keep it from being garbage collected.

2002-04-01  Darin Adler  <darin@apple.com>

        Got rid of KWQDef.h because it's dangerous to have two files with
        the same name and different contents.

	* JavaScriptCore.pbproj/project.pbxproj:
	* kjs/KWQDef.h: Removed.
	* kjs/ustring.h: Defines unsigned int types inline now.

2002-03-30  Maciej Stachowiak  <mjs@apple.com>

	Fixed Radar 2891272 (JavaScript crashes loading quicktime.com and
	apple.com)

	* kjs/object.cpp: (ObjectImp::~ObjectImp): Don't call setGCAlloc
	on object internals pointed to, because they may have already been
	collected by the time this object is collected, and in that case
	we would corrupt the malloc arena.

	* Makefile.am: Make the stamp file depend on all the sources and
	headers so the framework gets rebuilt properly.

	* JavaScriptCore.pbproj/project.pbxproj: Some random numbers moved
	around. No idea what I really changed.

2002-03-30  Darin Adler  <darin@apple.com>

	* kjs/grammar.y: Took out Id tag so we won't constantly need to
        update grammar.cpp.
	* kjs/grammar.cpp: Regenerated without Id tag.

	* .cvsignore: Ignore some additional autogenerated files.
	* kjs/.cvsignore: Ignore some additional autogenerated files.

2002-03-30  Maciej Stachowiak  <mjs@apple.com>

	* JavaScriptCore.pbproj/project.pbxproj: Install some of the
	headers.

2002-03-30  Maciej Stachowiak  <mjs@apple.com>

	Converted JavaScriptCore to build with Project Builder, in
	preparation for B&I submission.

	* English.lproj/InfoPlist.strings: Added.
	* JavaScriptCore.pbproj/.cvsignore: Added.
	* JavaScriptCore.pbproj/project.pbxproj: Added.
	
	* .cvsignore: Update the set of ignored things.

	* Makefile.am: Hand off to PB for the main build, but still handle
	the generated files and the test program.

	* kjs/Makefile.am: Don't build anything except the generated
	source files.

	* kjs/KWQDef.h, kjs/config.h: Added minimal versions of these
	files to get kjs to build.

	Check in all the genrated files, since Project Builder isn't up to
	the task of handling built sources:
	
	* kjs/array_object.lut.h: Added.
	* kjs/date_object.lut.h: Added.
	* kjs/grammar.cpp: Added.
	* kjs/grammar.cpp.h: Added.
	* kjs/grammar.h: Added.
	* kjs/lexer.lut.h: Added.
	* kjs/math_object.lut.h: Added.
	* kjs/number_object.lut.h: Added.
	* kjs/string_object.lut.h: Added.

	* kjs/.cvsignore: Update set of ignored things.

2002-03-28  Maciej Stachowiak  <mjs@apple.com>

	* kjs/kjs-test.chk: Update output for new test results.

2002-03-26  Maciej Stachowiak  <mjs@apple.com>

	Set up kjs to build by itself into libJavaScriptCore.dylib.
	
	* .cvsignore: Added.
	* Makefile.am: Added.
	* dummy.cpp: Added.
	* kjs/.cvsignore: Added.
