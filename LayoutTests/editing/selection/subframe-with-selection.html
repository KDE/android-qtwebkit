<p>This test sets an editable selection inside a subframe and then makes the main frame the first responder.  The selection shouldn't be blown away.</p>
<iframe src="../resources/contenteditable-iframe-src.html"></iframe>
<script>

function foo() {
    var f = frames[0];
    var s = f.getSelection();
    var d = f.document;
    
    eventSender.mouseMoveTo(100, 100);
    eventSender.mouseDown();
    eventSender.mouseUp();
    
    d.execCommand("InsertText", false, "Hello world!");
    s.modify("extend", "backward", "word");
    
    window.layoutTestController.setMainFrameIsFirstResponder(true);
    
    window.layoutTestController.notifyDone();
}

if (window.layoutTestController) {
    window.layoutTestController.waitUntilDone();
    
    window.setTimeout(foo, 200);    
}

</script>