<html>
<head>
<script src="../http/tests/inspector/inspector-test2.js"></script>
<script src="../http/tests/inspector/debugger-test2.js"></script>
<script>

function appendElement()
{
    var child = document.createElement("div");
    document.getElementById("d0").appendChild(child);
}

var test = function()
{
    InspectorTest.startDebuggerTest(startDebuggerTestCallback);

    function startDebuggerTestCallback()
    {
        InspectorTest.findDOMNode(null, function(node) {
            return node.getAttribute("id") === "d0";
        }, findDOMNodeCallback);
    }

    function findDOMNodeCallback(node)
    {
        InspectorTest.addResult("Found div element.");
        WebInspector.domBreakpointManager.setBreakpoint(node, WebInspector.DOMBreakpoint.Types.SubtreeModified);
        InspectorTest.addResult("Set DOM breakpoint.");
        InspectorTest.evaluateInConsole("appendElement()");
        InspectorTest.waitUntilPaused(waitUntilPausedCallback);
    }

    function waitUntilPausedCallback(callFrames)
    {
        InspectorTest.addResult("Paused at line " + callFrames[0].line + " in " + callFrames[0].functionName);
        InspectorTest.completeDebuggerTest();
    }
};

</script>
</head>

<body onload="runTest()">
<p>
Tests DOM breakpoints. <a href="https://bugs.webkit.org/show_bug.cgi?id=42886">Bug 42886</a>
</p>
<div id="d0"></div>
</body>
</html>

