<html>
<head>
    <script src="resources/cross-frame-access.js"></script>
</head>
<body>
<p>This test checks cross-frame access security (rdar://problem/5251309).</p>
<iframe src="http://localhost:8000/security/resources/cross-frame-iframe.html" style=""></iframe>
<pre id="console"></pre>
<script>
var windowPropertiesNotAllowed = [
    "Attr", 
    "CDATASection", 
    "CSSPrimitiveValue", 
    "CSSRule", 
    "CSSStyleDeclaration", 
    "CSSValue", 
    "CharacterData", 
    "Comment", 
    "DOMException", 
    "DOMImplementation", 
    "DOMParser", 
    "Document", 
    "DocumentFragment", 
    "DocumentType", 
    "Element", 
    "Entity", 
    "EntityReference", 
    "EvalError", 
    "Event", 
    "HTMLAnchorElement", 
    "HTMLAppletElement", 
    "HTMLAreaElement", 
    "HTMLBRElement", 
    "HTMLBaseElement", 
    "HTMLBaseFontElement", 
    "HTMLBodyElement", 
    "HTMLButtonElement", 
    "HTMLCanvasElement", 
    "HTMLDListElement", 
    "HTMLDirectoryElement", 
    "HTMLDivElement", 
    "HTMLDocument", 
    "HTMLElement", 
    "HTMLFieldSetElement", 
    "HTMLFontElement", 
    "HTMLFormElement", 
    "HTMLFrameElement", 
    "HTMLFrameSetElement", 
    "HTMLHRElement", 
    "HTMLHeadElement", 
    "HTMLHeadingElement", 
    "HTMLHtmlElement", 
    "HTMLIFrameElement", 
    "HTMLImageElement", 
    "HTMLInputElement", 
    "HTMLIsIndexElement", 
    "HTMLLIElement", 
    "HTMLLabelElement", 
    "HTMLLegendElement", 
    "HTMLLinkElement", 
    "HTMLMapElement", 
    "HTMLMarqueeElement", 
    "HTMLMenuElement", 
    "HTMLMetaElement", 
    "HTMLModElement", 
    "HTMLOListElement", 
    "HTMLOptGroupElement", 
    "HTMLOptionElement", 
    "HTMLParagraphElement", 
    "HTMLParamElement", 
    "HTMLPreElement", 
    "HTMLQuoteElement", 
    "HTMLScriptElement", 
    "HTMLSelectElement", 
    "HTMLStyleElement", 
    "HTMLTableCaptionElement", 
    "HTMLTableCellElement", 
    "HTMLTableColElement", 
    "HTMLTableElement", 
    "HTMLTableRowElement", 
    "HTMLTableSectionElement", 
    "HTMLTextAreaElement", 
    "HTMLTitleElement", 
    "HTMLUListElement", 
    "Image", 
    "MutationEvent", 
    "Node", 
    "NodeFilter", 
    "Notation", 
    "Option", 
    "ProcessingInstruction", 
    "Range", 
    "RangeError", 
    "RangeException", 
    "ReferenceError", 
    "SyntaxError", 
    "Text", 
    "TypeError", 
    "URIError", 
    "XMLDocument", 
    "XMLHttpRequest", 
    "XMLSerializer", 
    "XPathEvaluator", 
    "XPathResult", 
    "XSLTProcessor", 
    "addEventListener", 
    "alert", 
    "atob", 
    "btoa", 
    "captureEvents", 
    "clearInterval", 
    "clearTimeout", 
    "clientInformation", 
    "confirm", 
    "console", 
    "crypto", 
    "defaultStatus", 
    "defaultstatus", 
    "devicePixelRatio", 
    "document",
    "embeds",
    "eval",
    "event", 
    "find", 
    "frameElement", 
    "getComputedStyle",
    "getMatchedCSSRules", 
    "getSelection", 
    "images",
    "innerHeight", 
    "innerWidth", 
    "locationbar", 
    "menubar", 
    "moveBy", 
    "moveTo", 
    "name", 
    "navigator", 
    "offscreenBuffering", 
    "onabort", 
    "onbeforeunload", 
    "onblur", 
    "onchange", 
    "onclick", 
    "ondblclick", 
    "onerror", 
    "onfocus", 
    "onkeydown", 
    "onkeypress", 
    "onkeyup", 
    "onload", 
    "onmousedown", 
    "onmousemove", 
    "onmouseout", 
    "onmouseover", 
    "onmouseup", 
    "onmousewheel", 
    "onreset", 
    "onresize", 
    "onscroll", 
    "onsearch", 
    "onselect", 
    "onsubmit", 
    "onunload", 
    "open", 
    "outerHeight", 
    "outerWidth", 
    "pageXOffset", 
    "pageYOffset", 
    "personalbar", 
    "plugins",
    "print", 
    "prompt", 
    "releaseEvents", 
    "removeEventListener", 
    "resizeBy", 
    "resizeTo", 
    "screen", 
    "screenLeft", 
    "screenTop", 
    "screenX", 
    "screenY", 
    "scroll", 
    "scrollBy", 
    "scrollTo", 
    "scrollX", 
    "scrollY", 
    "scrollbars", 
    "setInterval", 
    "setTimeout", 
    "showModalDialog", 
    "status", 
    "statusbar", 
    "stop", 
    "toolbar"
];

var windowPropertiesAllowed = [
    "blur",
    "close",
    "closed",
    "focus",
    "frames",
    "history",
    "length",
    "opener",
    "parent",
    "self",
    "top",
    "window",
];

window.targetWindow = frames[0];

window.onload = function()
{
    if (window.layoutTestController)
        layoutTestController.dumpAsText();

    log("\n----- tests for getting/setting vanilla properties -----\n");

    for (var i = 0; i < windowPropertiesAllowed.length; i++) { //>
        var property = windowPropertiesAllowed[i];
        shouldBeTrue("canGet('targetWindow." + property + "')");
    }

    for (var i = 0; i < windowPropertiesNotAllowed.length; i++) { //>
        var property = windowPropertiesNotAllowed[i];
        if (property == "document")
            log("Firefox allows access to 'document' but throws an exception when you access its properties.");
        shouldBeFalse("canGet('targetWindow." + property + "')");
        shouldBeFalse("canSet('targetWindow." + property + "')");
    }

    // Work around DRT bug that causes subsequent tests to fail.
    window.stop();
}
</script>
</body>
</html>
