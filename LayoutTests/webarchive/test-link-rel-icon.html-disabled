<html>
<head>
<script>
function runTest()
{
    if (!location.href.match('\\?')) {
        if (window.layoutTestController) {
            layoutTestController.setIconDatabaseEnabled(true);
            layoutTestController.dumpDOMAsWebArchive();
            layoutTestController.waitUntilDone();
        }
        // Reload once since we just enabled the icon database
        redirect('1');
    } else if (!location.href.match('\\?2')) {
        // Reload twice to work around Bug 21026 / <rdar://problem/6240826>
        redirect('2');
    } else {
        if (window.layoutTestController) {
            layoutTestController.notifyDone();
        }
    }
}

function redirect(arg)
{
    var loc = '' + document.location;
    if (loc.indexOf('?') > 0)
        loc = loc.substring(0, loc.indexOf('?'));
    document.location = loc + '?' + arg;
}
</script>
<link rel="icon" href="resources/favicon.ico" type="image/x-icon">
</head>
<body onload="runTest()">
</body>
</html>
